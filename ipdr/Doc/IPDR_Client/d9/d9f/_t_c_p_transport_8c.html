<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>IPDRAPI: For Doxygen/src/Transports/TCP/TCPTransport.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.2 -->
<div class="qindex"><a class="qindex" href="../../index.html">Main&nbsp;Page</a> | <a class="qindex" href="../../modules.html">Modules</a> | <a class="qindex" href="../../namespaces.html">Namespace List</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="../../dirs.html">Directories</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="../../globals.html">Globals</a></div>
<div class="nav">
<a class="el" href="../../dir_000000.html">For Doxygen</a>&nbsp;/&nbsp;<a class="el" href="../../dir_000003.html">src</a>&nbsp;/&nbsp;<a class="el" href="../../dir_000015.html">Transports</a>&nbsp;/&nbsp;<a class="el" href="../../dir_000016.html">TCP</a></div>
<h1>TCPTransport.c File Reference</h1>Implementation of IPDR's TCP based transport. <a href="#_details">More...</a>
<p>
<code>#include &lt;<a class="el" href="../../d4/d71/_config_8h.html">IPDR/Config.h</a>&gt;</code><br>
<code>#include &lt;<a class="el" href="../../d3/dfd/_t_c_p_transport_8h.html">Transports/TCP/TCPTransport.h</a>&gt;</code><br>
<code>#include &lt;<a class="el" href="../../db/d48/_t_c_p_msgs_8h.html">Transports/TCP/TCPMsgs.h</a>&gt;</code><br>
<code>#include &lt;<a class="el" href="../../d5/d93/_transport_8h.html">Common/Transport.h</a>&gt;</code><br>
<code>#include &lt;fcntl.h&gt;</code><br>
<code>#include &lt;string.h&gt;</code><br>
<code>#include &lt;stdio.h&gt;</code><br>
<code>#include &lt;<a class="el" href="../../df/dde/_defs_8h.html">IPDR/Defs.h</a>&gt;</code><br>
<code>#include &lt;<a class="el" href="../../db/d1e/_protocol_8h.html">Common/Protocol.h</a>&gt;</code><br>
<code>#include &lt;<a class="el" href="../../de/d8f/_configuration_names_8h.html">Common/ConfigurationNames.h</a>&gt;</code><br>
<code>#include &lt;<a class="el" href="../../d9/d7b/_protocol_debug_8h.html">Exporter/ProtocolDebug.h</a>&gt;</code><br>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>&nbsp;&nbsp;&nbsp;(T-&gt;PS)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d9f/_t_c_p_transport_8c.html#a1">TRANSPORT_LOG</a>&nbsp;&nbsp;&nbsp;(T-&gt;Logger)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d9f/_t_c_p_transport_8c.html#a2">CONNECTION_LOG</a>(C)&nbsp;&nbsp;&nbsp;((/*(<a class="el" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html">TCPTransport</a> *)*/ (C)-&gt;<a class="el" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html">Transport</a>)-&gt;Logger)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d9f/_t_c_p_transport_8c.html#a3">MAX_RECV_MESSAGE_LENGTH</a>&nbsp;&nbsp;&nbsp;20000</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d9f/_t_c_p_transport_8c.html#a4">RECV_TIMEOUT</a>&nbsp;&nbsp;&nbsp;4000</td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d9f/_t_c_p_transport_8c.html#a9">TCP_ConnectionCallback</a> (<a class="el" href="../../db/d76/struct_i_p_d_r__tag___socket.html">IPDR_SocketHandle</a> FD, void *Arg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d9f/_t_c_p_transport_8c.html#a10">TCP_ConnectionWriteCallback</a> (<a class="el" href="../../db/d76/struct_i_p_d_r__tag___socket.html">IPDR_SocketHandle</a> FD, void *Arg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static <a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d9f/_t_c_p_transport_8c.html#a11">TCP_SendBuffers</a> (<a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">TCPConnection</a> *C)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d9f/_t_c_p_transport_8c.html#a12">TCP_ReceiveHeader</a> (<a class="el" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html">TCPTransport</a> *T, <a class="el" href="../../db/d76/struct_i_p_d_r__tag___socket.html">IPDR_SocketHandle</a> FD, int Timeout, MessageHeader *Header)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d9f/_t_c_p_transport_8c.html#a13">TCP_ReceiveMsgBody</a> (<a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">TCPConnection</a> *C, int Timeout, <a class="el" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html">BufferHandle</a> *BH, MessageHeader *Header)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d9f/_t_c_p_transport_8c.html#a14">TCP_CreateConnection</a> (<a class="el" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html">TCPTransport</a> *T, <a class="el" href="../../db/d76/struct_i_p_d_r__tag___socket.html">IPDR_SocketHandle</a> FD, <a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga9">IPDR_IPAddress</a> RemoteAddr, unsigned short RemotePort, <a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">TCPConnection</a> **C)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d9f/_t_c_p_transport_8c.html#a15">TCPMsgs_Initialize</a> (<a class="el" href="../../dc/d30/struct_i_p_d_r__tag___log.html">Log</a> *L)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga9">IPDR_IPAddress</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d9f/_t_c_p_transport_8c.html#a16">TCP_ParseAddress</a> (const char *Str)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d9f/_t_c_p_transport_8c.html#a17">TCP_PrintAddress</a> (<a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga9">IPDR_IPAddress</a> Addr, char *AddressStr)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d9f/_t_c_p_transport_8c.html#a18">TCP_PrintAddressAndPort</a> (<a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga9">IPDR_IPAddress</a> Addr, unsigned int Port, char *AddressStr)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d9f/_t_c_p_transport_8c.html#a19">TCP_PrintConnectionRemote</a> (<a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a> C, char *AddressStr)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d9f/_t_c_p_transport_8c.html#a20">TCP_PrintConnectionLocale</a> (<a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a> C, char *AddressStr)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d9f/_t_c_p_transport_8c.html#a21">TCP_PrintConnectionFull</a> (<a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a> C, char *AddressStr)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static <a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d9f/_t_c_p_transport_8c.html#a22">Log_LogPlatformConnError</a> (<a class="el" href="../../dc/d30/struct_i_p_d_r__tag___log.html">Log</a> *L, <a class="el" href="../../da/df4/_log_8h.html#a39">IPDR_ModuleID</a> ModuleID, const char *Func, const char *PlatformFunc, <a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a> Conn, <a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a> Status)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d9f/_t_c_p_transport_8c.html#a23">Log_LogPlatformSocketError</a> (<a class="el" href="../../dc/d30/struct_i_p_d_r__tag___log.html">Log</a> *L, <a class="el" href="../../da/df4/_log_8h.html#a39">IPDR_ModuleID</a> ModuleID, const char *Func, const char *PlatformFunc, <a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga9">IPDR_IPAddress</a> Addr, unsigned short Port, <a class="el" href="../../db/d76/struct_i_p_d_r__tag___socket.html">IPDR_SocketHandle</a> FD)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static <a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d9f/_t_c_p_transport_8c.html#a24">TCP_InitializeParameters</a> (<a class="el" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html">TCPTransport</a> *T)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d9f/_t_c_p_transport_8c.html#a25">TCP_FlushTimerCallback</a> (void *Arg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static <a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d9f/_t_c_p_transport_8c.html#a26">TCP_AllocateConnection</a> (<a class="el" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html">TCPTransport</a> *T, <a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga9">IPDR_IPAddress</a> Addr, unsigned short Port, <a class="el" href="../../db/d5a/struct_chunk_allocator.html">ChunkAllocator</a> Alloc, <a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">TCPConnection</a> **C)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d9f/_t_c_p_transport_8c.html#a27">TCP_HandleDisconnection</a> (<a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">TCPConnection</a> *C)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d9f/_t_c_p_transport_8c.html#a28">TCP_CreateConnectionIdle</a> (<a class="el" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html">TCPTransport</a> *T, <a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga9">IPDR_IPAddress</a> LocalAddr, <a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga9">IPDR_IPAddress</a> RemoteAddr, unsigned short RemotePort, <a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">TCPConnection</a> **Conn)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d9f/_t_c_p_transport_8c.html#a29">TCP_Connect</a> (<a class="el" href="../../dd/dc5/struct_i_p_d_r__tag___platform.html">IPDR_PlatformServices</a> *PS, <a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">TCPConnection</a> *Conn)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d9f/_t_c_p_transport_8c.html#a30">TCP_GetSockName</a> (<a class="el" href="../../dd/dc5/struct_i_p_d_r__tag___platform.html">IPDR_PlatformServices</a> *PS, <a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">TCPConnection</a> *Conn)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d9f/_t_c_p_transport_8c.html#a31">TCP_AcceptCallback</a> (<a class="el" href="../../db/d76/struct_i_p_d_r__tag___socket.html">IPDR_SocketHandle</a> FD, void *Arg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d9f/_t_c_p_transport_8c.html#a32">TCP_InitializePassive</a> (<a class="el" href="../../dd/dc5/struct_i_p_d_r__tag___platform.html">IPDR_PlatformServices</a> *PS, <a class="el" href="../../dc/d30/struct_i_p_d_r__tag___log.html">Log</a> *Logger, <a class="el" href="../../db/d5a/struct_chunk_allocator.html">ChunkAllocator</a> RcvAllocator, <a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga9">IPDR_IPAddress</a> LocalAddr, unsigned short LocalPort, <a class="el" href="../../db/dcd/struct_i_p_d_r__tag___connection_handlers.html">ConnectionHandlers</a> *DefaultHandlers, void *DefaultArg, <a class="el" href="../../df/d84/struct_parameters_handler.html">ParametersHandler</a> *ParamsHandler, <a class="el" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html">Transport</a> *Handle)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d9f/_t_c_p_transport_8c.html#a33">TCP_Shutdown</a> (<a class="el" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html">Transport</a> Handle)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d9f/_t_c_p_transport_8c.html#a34">TCP_Send</a> (<a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a> C, <a class="el" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html">BufferHandle</a> *BH, <a class="el" href="../../df/dde/_defs_8h.html#a16">IPDR_BOOL</a> Immediate)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d9f/_t_c_p_transport_8c.html#a35">TCP_Receive</a> (<a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a> C, int Timeout, <a class="el" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html">BufferHandle</a> *BH)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d9f/_t_c_p_transport_8c.html#a36">TCP_Disconnect</a> (<a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a> C)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d9f/_t_c_p_transport_8c.html#a37">TCP_ResetConnection</a> (<a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a> C)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d9f/_t_c_p_transport_8c.html#a38">TCP_SetConnectionHandlers</a> (<a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a> C, <a class="el" href="../../db/dcd/struct_i_p_d_r__tag___connection_handlers.html">ConnectionHandlers</a> *Handlers, void *Arg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d9f/_t_c_p_transport_8c.html#a39">TCP_GetConnectionInfo</a> (<a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a> C, <a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga9">IPDR_IPAddress</a> *Addr, unsigned short *Port)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d9f/_t_c_p_transport_8c.html#a40">TCP_GetConnectionInfoStr</a> (<a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">TCPConnection</a> *TC)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d9f/_t_c_p_transport_8c.html#a41">TCP_GetReceiveChunksManager</a> (<a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">TCPConnection</a> *TC, <a class="el" href="../../d1/d38/struct_i_p_d_r__tag___chunks_manager.html">ChunksManager</a> **Mgr)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d9f/_t_c_p_transport_8c.html#a42">TCP_GetSendChunksManager</a> (<a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">TCPConnection</a> *TC, <a class="el" href="../../d1/d38/struct_i_p_d_r__tag___chunks_manager.html">ChunksManager</a> **Mgr)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d9f/_t_c_p_transport_8c.html#a43">TCP_Reconfigure</a> (<a class="el" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html">Transport</a> TH)</td></tr>

<tr><td colspan="2"><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">const char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d9f/_t_c_p_transport_8c.html#a5">TCPTransport_rcsid</a> [] = "@(#) $Id: TCPTransport.c,v 1.31 2005/04/21 11:30:58 dmitryk Exp $" IPDR_COPYRIGHT_STR</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">const char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d9f/_t_c_p_transport_8c.html#a6">TCPTransport_h_rcsid</a> [] = TCP_TRANSPORT_H_RCSID</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">const char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d9f/_t_c_p_transport_8c.html#a7">Transport_h_rcsid</a> [] = TRANSPORT_H_RCSID</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">const char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d9f/_t_c_p_transport_8c.html#a8">TCPMsgs_h_rcsid</a> [] = TCP_MSGS_H_RCSID</td></tr>

</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
Implementation of IPDR's TCP based transport. 
<p>
Copyright (2005) © Amdocs, All Rights Reserved<p>
This software is distributed on an "AS IS" basis, WITHOUT WARRANTY OF ANY KIND either expresses or implied.<p>
<dl compact><dt><b>Note:</b></dt><dd>XXX Some of the code here is not needed any more. There used to be combined code for the client (transmitter) and server; the client (transmitter) is "passive" (accepts connections) and the server (collector) is "active" (tries to connect). But it's not a lot of code, and does no particular harm (besides making things a bit more complicated than necessary). </dd></dl>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a2" doxytag="TCPTransport.c::CONNECTION_LOG"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">#define CONNECTION_LOG          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">C&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;((/*(<a class="el" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html">TCPTransport</a> *)*/ (C)-&gt;<a class="el" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html">Transport</a>)-&gt;Logger)</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="TCPTransport.c::MAX_RECV_MESSAGE_LENGTH"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">#define MAX_RECV_MESSAGE_LENGTH&nbsp;&nbsp;&nbsp;20000          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="TCPTransport.c::RECV_TIMEOUT"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">#define RECV_TIMEOUT&nbsp;&nbsp;&nbsp;4000          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="TCPTransport.c::TRANSPORT_LOG"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">#define TRANSPORT_LOG&nbsp;&nbsp;&nbsp;(T-&gt;Logger)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="TCPTransport.c::TRANSPORT_PLATFORM"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">#define TRANSPORT_PLATFORM&nbsp;&nbsp;&nbsp;(T-&gt;PS)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a22" doxytag="TCPTransport.c::Log_LogPlatformConnError"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static <a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a> Log_LogPlatformConnError           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../dc/d30/struct_i_p_d_r__tag___log.html">Log</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>L</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../da/df4/_log_8h.html#a39">IPDR_ModuleID</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ModuleID</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>Func</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>PlatformFunc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Conn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Status</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00185 {
00186     <a class="code" href="../../d2/dc9/_platform_8h.html#a6">Platform_GetLastErrorMessage</a>(L-&gt;<a class="code" href="../../dc/d30/struct_i_p_d_r__tag___log.html#o3">PS</a>, L-&gt;<a class="code" href="../../dc/d30/struct_i_p_d_r__tag___log.html#o20">msgStrErr</a>);
00187 
00188     <span class="comment">/* XXX Special case for end-of-file ... this is not as clean as it</span>
00189 <span class="comment">     * should be because the generic platform reports end-of-file as a</span>
00190 <span class="comment">     * connection error (it is, in a way) ... we depend on the error</span>
00191 <span class="comment">     * code being "No error" [which it isn't really] to avoid a</span>
00192 <span class="comment">     * confusing error message.</span>
00193 <span class="comment">     */</span>
00194 
00195     <span class="keywordflow">if</span> (Status == <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga15a188">IPDR_ERR_COMMUNICATION_ERROR</a> &amp;&amp;
00196         0 == strcmp(L-&gt;<a class="code" href="../../dc/d30/struct_i_p_d_r__tag___log.html#o20">msgStrErr</a>, <a class="code" href="../../d0/dfa/group___i_p_d_r__msg__services.html#ga2">IPDR_NO_ERROR_ERROR_MESSAGE</a>)) {
00197         <a class="code" href="../../da/df4/_log_8h.html#a31">Log_Write3</a>(L, ModuleID, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga6a170">IPDR_LEVEL_WARNING</a>, Func,
00198                    <a class="code" href="../../da/df4/_log_8h.html#a10">MSG_LOG_PLATFORM_CONN_EOF</a>,
00199                    PlatformFunc,
00200                    <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_StatusMsg</a>(NULL, Status),
00201                    <a class="code" href="../../d5/d93/_transport_8h.html#a14">TL_GetConnectionInfoStr</a>(Conn));
00202 
00203     } <span class="keywordflow">else</span> {
00204         <span class="comment">/* XXX should signal error event */</span>
00205         <a class="code" href="../../da/df4/_log_8h.html#a32">Log_Write4</a>(L, ModuleID, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga6a169">IPDR_LEVEL_ERROR</a>, Func,
00206                    <a class="code" href="../../da/df4/_log_8h.html#a9">MSG_LOG_PLATFORM_CONN_ERR</a>,
00207                    PlatformFunc, L-&gt;msgStrErr,
00208                    <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_StatusMsg</a>(NULL, Status),
00209                    <a class="code" href="../../d5/d93/_transport_8h.html#a14">TL_GetConnectionInfoStr</a>(Conn));
00210     }
00211     <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga15a174">IPDR_OK</a>;
00212 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a23" doxytag="TCPTransport.c::Log_LogPlatformSocketError"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a> Log_LogPlatformSocketError           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../dc/d30/struct_i_p_d_r__tag___log.html">Log</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>L</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../da/df4/_log_8h.html#a39">IPDR_ModuleID</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ModuleID</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>Func</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>PlatformFunc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga9">IPDR_IPAddress</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Addr</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>unsigned short&nbsp;</td>
          <td class="mdname" nowrap> <em>Port</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../db/d76/struct_i_p_d_r__tag___socket.html">IPDR_SocketHandle</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>FD</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00223 {
00224     <a class="code" href="../../d5/d93/_transport_8h.html#a28">TL_PABuf</a> paBuf;
00225     <a class="code" href="../../d2/dc9/_platform_8h.html#a6">Platform_GetLastErrorMessage</a>(L-&gt;<a class="code" href="../../dc/d30/struct_i_p_d_r__tag___log.html#o3">PS</a>, L-&gt;<a class="code" href="../../dc/d30/struct_i_p_d_r__tag___log.html#o20">msgStrErr</a>);
00226     <span class="comment">/* XXX should signal error event */</span>
00227     <a class="code" href="../../da/df4/_log_8h.html#a32">Log_Write4</a>(L, ModuleID, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga6a169">IPDR_LEVEL_ERROR</a>, Func,
00228                <a class="code" href="../../da/df4/_log_8h.html#a8">MSG_LOG_PLATFORM_SOCKET_ERR</a>,
00229                PlatformFunc, L-&gt;<a class="code" href="../../dc/d30/struct_i_p_d_r__tag___log.html#o20">msgStrErr</a>,
00230                <a class="code" href="../../d5/d93/_transport_8h.html#a16">TL_PrintAddressAndPort</a>(Addr, Port, paBuf), <a class="code" href="../../d4/d2e/group___i_p_d_r___socket.html#ga1">Platform_SOCKET_DISPLAY</a>(FD));
00231     <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga15a174">IPDR_OK</a>;
00232 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a31" doxytag="TCPTransport.c::TCP_AcceptCallback"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static void TCP_AcceptCallback           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../db/d76/struct_i_p_d_r__tag___socket.html">IPDR_SocketHandle</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>FD</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>void *&nbsp;</td>
          <td class="mdname" nowrap> <em>Arg</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Callback triggered whenever a socket becomes a listening socket becomes readable (a connection arrives).<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>FD</em>&nbsp;</td><td>socket file descriptor </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Arg</em>&nbsp;</td><td>callback argument (the transport)</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga15a174">IPDR_OK</a> on success; <a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga15">IPDR_STATUS_RETURN_CODE</a> otherwise. </dd></dl>
<div class="fragment"><pre class="fragment">01036 {
01037     <a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html">TCPTransport</a> *T = <span class="comment">/*(TCPTransport *)*/</span> Arg;
01038     <a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">TCPConnection</a> *C;
01039     <a class="code" href="../../db/d76/struct_i_p_d_r__tag___socket.html">IPDR_SocketHandle</a> NewSocketFD;
01040     <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a> Status;
01041     <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> RemotePort;
01042     <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga9">IPDR_IPAddress</a> RemoteAddr;
01043         <a class="code" href="../../d5/d93/_transport_8h.html#a28">TL_PABuf</a> paBuf2;
01044 
01045     Status = <a class="code" href="../../d2/dc9/_platform_8h.html#a46">Platform_Accept</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>, FD, &amp; RemoteAddr, &amp; RemotePort,
01046                              &amp; NewSocketFD);
01047 
01048         <a class="code" href="../../d2/dc9/_platform_8h.html#a34">Platform_Lock</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>);
01049 
01050     <span class="keywordflow">if</span> (<a class="code" href="../../da/d39/_i_p_d_r_8h.html#a18">FAILURE</a>(Status)) {
01051         <a class="code" href="../../da/df4/_log_8h.html#a57">Log_LogPlatformSocketError</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a1">TRANSPORT_LOG</a>, <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a1">TCP_MODULE_ID</a>,
01052                                    <span class="stringliteral">"TCP_AcceptCallback"</span>,
01053                                    <span class="stringliteral">"Platform_Accept"</span>, RemoteAddr, RemotePort, FD);
01054         <a class="code" href="../../d2/dc9/_platform_8h.html#a35">Platform_Unlock</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>);
01055         return ;
01056     }
01057 
01058     Status = <a class="code" href="../../d2/dc9/_platform_8h.html#a47">Platform_SetExporterSocketParams</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>,
01059                                             NewSocketFD,
01060                                             T-&gt;<a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html#o10">ParamsHandler</a>.<a class="code" href="../../df/d84/struct_parameters_handler.html#o0">ParamsFunc</a>,
01061                                             T-&gt;<a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html#o10">ParamsHandler</a>.<a class="code" href="../../df/d84/struct_parameters_handler.html#o1">ParamsArg</a>);
01062     <span class="keywordflow">if</span> (<a class="code" href="../../da/d39/_i_p_d_r_8h.html#a18">FAILURE</a>(Status)) {
01063         <a class="code" href="../../da/df4/_log_8h.html#a57">Log_LogPlatformSocketError</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a1">TRANSPORT_LOG</a>, <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a1">TCP_MODULE_ID</a>,
01064                                    <span class="stringliteral">"TCP_AcceptCallback"</span>,
01065                                    <span class="stringliteral">"Platform_SetExporterSocketParams"</span>,
01066                                    RemoteAddr, RemotePort, NewSocketFD);
01067         <a class="code" href="../../d2/dc9/_platform_8h.html#a44">Platform_CloseAndInvalidate</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>, &amp;NewSocketFD);
01068         <a class="code" href="../../d2/dc9/_platform_8h.html#a35">Platform_Unlock</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>);
01069         return ;
01070     }
01071 
01072     <a class="code" href="../../da/df4/_log_8h.html#a29">Log_Write1</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a1">TRANSPORT_LOG</a>, <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a1">TCP_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga6a171">IPDR_LEVEL_INFO</a>, <span class="stringliteral">"TCP_AcceptCallback"</span>,
01073                <span class="stringliteral">"CONNECT from %.98s"</span>,
01074                <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a18">TCP_PrintAddressAndPort</a>(RemoteAddr, RemotePort, paBuf2));
01075 
01076     <span class="comment">/* create a new connection */</span>
01077 
01078         Status = <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a14">TCP_CreateConnection</a>(  T, NewSocketFD,
01079                                                                         RemoteAddr, RemotePort, &amp;C) ;
01080 
01081     <span class="keywordflow">if</span> (<a class="code" href="../../da/d39/_i_p_d_r_8h.html#a18">FAILURE</a>(Status)) {
01082         <a class="code" href="../../dd/d28/_log_8c.html#a28">Log_LogPlatformError</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a1">TRANSPORT_LOG</a>, <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a1">TCP_MODULE_ID</a>,
01083                              <span class="stringliteral">"TCP_AcceptCallback"</span>,
01084                              <span class="stringliteral">"TCP_CreateConnection"</span>);
01085         <a class="code" href="../../d2/dc9/_platform_8h.html#a44">Platform_CloseAndInvalidate</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>, &amp;NewSocketFD);
01086         <a class="code" href="../../d2/dc9/_platform_8h.html#a35">Platform_Unlock</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>);
01087         return ;
01088     }
01089 
01090         Status = <a class="code" href="../../d2/dc9/_platform_8h.html#a43">Platform_GetSockName</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>, C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o6">FD</a>, &amp;(C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o3">LocaleAddr</a>), &amp;(C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o4">LocalePort</a>));
01091         <span class="keywordflow">if</span>(<a class="code" href="../../da/d39/_i_p_d_r_8h.html#a18">FAILURE</a>(Status))
01092         {
01093            <a class="code" href="../../dd/d28/_log_8c.html#a28">Log_LogPlatformError</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a2">CONNECTION_LOG</a>(C), <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a1">TCP_MODULE_ID</a>,
01094                              <span class="stringliteral">"TCP_AcceptCallback"</span>,
01095                              <span class="stringliteral">"Platform_GetSockName"</span>);
01096                 return ;
01097         }
01098 
01099     <span class="keywordflow">if</span> (C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o9">Handlers</a> != NULL)
01100         C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o9">Handlers</a>-&gt;<a class="code" href="../../db/dcd/struct_i_p_d_r__tag___connection_handlers.html#o0">Connect</a>(C, C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o1">RemoteAddr</a>,
01101                              C-&gt;RemotePort, C-&gt;Arg);
01102 
01103     <span class="comment">/* In case something goes wrong on the server (collector) (misconfiguration or</span>
01104 <span class="comment">     * just bad implementation), we need to watch out for a new</span>
01105 <span class="comment">     * connection when there is an already existing connection for</span>
01106 <span class="comment">     * that "port". We destroy the old connection and also the new</span>
01107 <span class="comment">     * connection; the server (collector) should just try another connection.</span>
01108 <span class="comment">     *</span>
01109 <span class="comment">     * XXX Although this is safer, it can lead to a "denial of</span>
01110 <span class="comment">     * service" attack, by repeatedly connecting to the client</span>
01111 <span class="comment">     * (transmitter).  The solution is to instead delay this decision</span>
01112 <span class="comment">     * until a START is received and do the disconnect if there is</span>
01113 <span class="comment">     * more than one connection.</span>
01114 <span class="comment">     */</span>
01115 
01116     {
01117         <a class="code" href="../../df/dde/_defs_8h.html#a16">IPDR_BOOL</a> duplicateCX = <a class="code" href="../../df/dde/_defs_8h.html#a4">IPDR_FALSE</a>;
01118         <a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">TCPConnection</a> *CX = T-&gt;<a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html#o3">Connections</a>;
01119         <span class="keywordflow">while</span> (CX) {
01120             <a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">TCPConnection</a> *nextCX = CX-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o12">NextConnection</a>; <span class="comment">/* save "next" because CX might be deallocated */</span>
01121             <span class="keywordflow">if</span> (CX != C &amp;&amp; CX-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o1">RemoteAddr</a> == RemoteAddr &amp;&amp; CX-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o2">RemotePort</a> == RemotePort) {
01122                 <span class="comment">/* XXX should signal error event */</span>
01123                 <a class="code" href="../../da/df4/_log_8h.html#a29">Log_Write1</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a1">TRANSPORT_LOG</a>, <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a1">TCP_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga6a169">IPDR_LEVEL_ERROR</a>,
01124                            <span class="stringliteral">"TCP_AcceptCallback"</span>, <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a16">MSG_TCP_DUPLICATE_ACCEPT</a>,
01125                            <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a40">TCP_GetConnectionInfoStr</a>(CX));
01126                 <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a27">TCP_HandleDisconnection</a>(CX); <span class="comment">/* destroy old connection */</span>
01127                 <a class="code" href="../../d2/dc9/_platform_8h.html#a56">Platform_SleepMS</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>, 1000); <span class="comment">/* avoid rapid connect/disconnect loop */</span>
01128                 duplicateCX = <a class="code" href="../../df/dde/_defs_8h.html#a5">IPDR_TRUE</a>;
01129             }
01130             CX = nextCX;
01131         }
01132         <span class="keywordflow">if</span> (duplicateCX) {
01133             <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a27">TCP_HandleDisconnection</a>(C); <span class="comment">/* and destroy the new connection as well */</span>
01134             <a class="code" href="../../d2/dc9/_platform_8h.html#a56">Platform_SleepMS</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>, 1000); <span class="comment">/* avoid rapid connect/disconnect loop */</span>
01135         }
01136     }
01137 
01138     <a class="code" href="../../d2/dc9/_platform_8h.html#a35">Platform_Unlock</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>);
01139 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a26" doxytag="TCPTransport.c::TCP_AllocateConnection"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static <a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a> TCP_AllocateConnection           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html">TCPTransport</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>T</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga9">IPDR_IPAddress</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Addr</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>unsigned short&nbsp;</td>
          <td class="mdname" nowrap> <em>Port</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../db/d5a/struct_chunk_allocator.html">ChunkAllocator</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Alloc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">TCPConnection</a> **&nbsp;</td>
          <td class="mdname" nowrap> <em>C</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00267 {
00268     <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a> Status;
00269     <a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">TCPConnection</a> *C1;
00270     <a class="code" href="../../db/d5a/struct_chunk_allocator.html">ChunkAllocator</a> SendBuffersAlloc;
00271 
00272     Status = <a class="code" href="../../d2/dc9/_platform_8h.html#a22">Platform_MEMORYALLOCATE</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>, C1);
00273     <span class="keywordflow">if</span> (<a class="code" href="../../da/d39/_i_p_d_r_8h.html#a18">FAILURE</a>(Status)) {
00274         <span class="comment">/* XXX should signal error event */</span>
00275         <a class="code" href="../../da/df4/_log_8h.html#a29">Log_Write1</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a1">TRANSPORT_LOG</a>, <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a1">TCP_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga6a169">IPDR_LEVEL_ERROR</a>,
00276                    <span class="stringliteral">"TCP_AllocateConnection"</span>, <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a12">MSG_TCP_ALLOC_FAILED</a>, <span class="keyword">sizeof</span> (<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">TCPConnection</a>));
00277         <a class="code" href="../../d2/dc9/_platform_8h.html#a26">X_MEMPANIC</a>(C1, __FILE__, __LINE__);
00278         <span class="keywordflow">return</span> Status;
00279     }
00280 
00281     strncpy(C1-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o0">eyecatcher</a>, <span class="stringliteral">"TCPCONN"</span>, <span class="keyword">sizeof</span> C1-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o0">eyecatcher</a>);
00282     C1-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o1">RemoteAddr</a> = Addr;
00283     C1-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o2">RemotePort</a> = Port;
00284     C1-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o13">Transport</a> = <span class="comment">/*(TCPTransport *)*/</span> T;
00285     C1-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o9">Handlers</a> = NULL;
00286     C1-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o10">Arg</a> = NULL;
00287     C1-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o17">ConnectionTimer</a> = NULL;
00288     C1-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o18">FlushTimer</a> = NULL;
00289     C1-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o8">WriteEventID</a> = NULL;
00290     C1-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o7">ReadEventID</a> = NULL;
00291     C1-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o19">Disconnected</a> = <a class="code" href="../../df/dde/_defs_8h.html#a4">IPDR_FALSE</a>;
00292     C1-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o20">InUseCount</a> = 0;
00293 
00294     Status = <a class="code" href="../../d8/d51/_chunks_manager_8c.html#a16">ChunksManager_Initialize</a>(
00295         0,
00296         0,
00297         0,
00298         0,
00299         <a class="code" href="../../de/d8f/_configuration_names_8h.html#a178">STR_configuration_transport_tcpTransport_dataRcvChunkSize</a>,
00300         <a class="code" href="../../de/d8f/_configuration_names_8h.html#a179">STR_configuration_transport_tcpTransport_dataRcvInitialNumChunks</a>,
00301         <a class="code" href="../../de/d8f/_configuration_names_8h.html#a180">STR_configuration_transport_tcpTransport_dataRcvMaxMemory</a>,
00302         &amp; T-&gt;<a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html#o10">ParamsHandler</a>,
00303         Alloc,
00304         <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a1">TRANSPORT_LOG</a>,
00305         &amp; (C1-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o14">ReceivedData</a>));
00306 
00307     <span class="keywordflow">if</span> (<a class="code" href="../../da/d39/_i_p_d_r_8h.html#a18">FAILURE</a>(Status)) {
00308         <span class="comment">/* XXX should signal error event */</span>
00309         <a class="code" href="../../da/df4/_log_8h.html#a28">Log_Write</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a1">TRANSPORT_LOG</a>, <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a1">TCP_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga6a169">IPDR_LEVEL_ERROR</a>,
00310                   <span class="stringliteral">"TCP_AllocateConnection(ReceivedData)"</span>, <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a13">MSG_TCP_INIT_CHUNKS_FAILED</a>);
00311         strncpy(C1-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o0">eyecatcher</a>, <span class="stringliteral">"Dtcpcon"</span>, <span class="keyword">sizeof</span> C1-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o0">eyecatcher</a>);
00312         <a class="code" href="../../d2/dc9/_platform_8h.html#a20">Platform_MemoryFree</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>, C1);
00313         <span class="keywordflow">return</span> Status;
00314     }
00315 
00316     <a class="code" href="../../d8/d51/_chunks_manager_8c.html#a15">ChunksManager_GetDefaultChunkAllocator</a>(T-&gt;<a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html#o0">PS</a>, &amp; SendBuffersAlloc);
00317     Status = <a class="code" href="../../d8/d51/_chunks_manager_8c.html#a16">ChunksManager_Initialize</a>(
00318         0,
00319         0,
00320         0,
00321         <a class="code" href="../../db/d10/_chunks_manager_8h.html#a1">CHUNK_TAG_RELEASE_AFTER_SEND</a>,
00322         <a class="code" href="../../de/d8f/_configuration_names_8h.html#a181">STR_configuration_transport_tcpTransport_dataSndChunkSize</a>,
00323         <a class="code" href="../../de/d8f/_configuration_names_8h.html#a182">STR_configuration_transport_tcpTransport_dataSndInitialNumChunks</a>,
00324         <a class="code" href="../../de/d8f/_configuration_names_8h.html#a183">STR_configuration_transport_tcpTransport_dataSndMaxMemory</a>,
00325         &amp; T-&gt;<a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html#o10">ParamsHandler</a>,
00326         Alloc,
00327         <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a1">TRANSPORT_LOG</a>,
00328         &amp; (C1-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o15">SentData</a>));
00329     <span class="keywordflow">if</span> (<a class="code" href="../../da/d39/_i_p_d_r_8h.html#a18">FAILURE</a>(Status)) {
00330         <span class="comment">/* XXX should signal error event */</span>
00331         <a class="code" href="../../da/df4/_log_8h.html#a28">Log_Write</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a1">TRANSPORT_LOG</a>, <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a1">TCP_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga6a169">IPDR_LEVEL_ERROR</a>,
00332                   <span class="stringliteral">"TCP_AllocateConnection(SentData)"</span>, <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a13">MSG_TCP_INIT_CHUNKS_FAILED</a>);
00333         <a class="code" href="../../d8/d51/_chunks_manager_8c.html#a18">ChunksManager_Destroy</a>(&amp; (C1-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o14">ReceivedData</a>));
00334         strncpy(C1-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o0">eyecatcher</a>, <span class="stringliteral">"Dtcpcon"</span>, <span class="keyword">sizeof</span> C1-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o0">eyecatcher</a>);
00335         <a class="code" href="../../d2/dc9/_platform_8h.html#a20">Platform_MemoryFree</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>, C1);
00336         <span class="keywordflow">return</span> Status;
00337     }
00338 
00339     Status = <a class="code" href="../../d8/d51/_chunks_manager_8c.html#a16">ChunksManager_Initialize</a>(
00340         0,
00341         0,
00342         0,
00343         0,
00344         <a class="code" href="../../de/d8f/_configuration_names_8h.html#a184">STR_configuration_transport_tcpTransport_sendBuffersChunkSize</a>,
00345         <a class="code" href="../../de/d8f/_configuration_names_8h.html#a185">STR_configuration_transport_tcpTransport_sendBuffersInitialNumChunks</a>,
00346         <a class="code" href="../../de/d8f/_configuration_names_8h.html#a186">STR_configuration_transport_tcpTransport_sendBuffersMaxMemory</a>,
00347         &amp; T-&gt;<a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html#o10">ParamsHandler</a>,
00348         SendBuffersAlloc,
00349         <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a1">TRANSPORT_LOG</a>,
00350         &amp; (C1-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o16">SendBuffers</a>));
00351     <span class="keywordflow">if</span> (<a class="code" href="../../da/d39/_i_p_d_r_8h.html#a18">FAILURE</a>(Status)) {
00352         <a class="code" href="../../d8/d51/_chunks_manager_8c.html#a18">ChunksManager_Destroy</a>(&amp; (C1-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o15">SentData</a>));
00353         <a class="code" href="../../d8/d51/_chunks_manager_8c.html#a18">ChunksManager_Destroy</a>(&amp; (C1-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o14">ReceivedData</a>));
00354         <span class="comment">/* XXX should signal error event */</span>
00355         <a class="code" href="../../da/df4/_log_8h.html#a28">Log_Write</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a1">TRANSPORT_LOG</a>, <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a1">TCP_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga6a169">IPDR_LEVEL_ERROR</a>,
00356                   <span class="stringliteral">"TCP_AllocateConnection(SendBuffers)"</span>, <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a13">MSG_TCP_INIT_CHUNKS_FAILED</a>);
00357         strncpy(C1-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o0">eyecatcher</a>, <span class="stringliteral">"Dtcpcon"</span>, <span class="keyword">sizeof</span> C1-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o0">eyecatcher</a>);
00358         <a class="code" href="../../d2/dc9/_platform_8h.html#a20">Platform_MemoryFree</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>, C1);
00359         <span class="keywordflow">return</span> Status;
00360     }
00361 
00362     *C = C1;
00363 
00364     <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga15a174">IPDR_OK</a>;
00365 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a29" doxytag="TCPTransport.c::TCP_Connect"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a> TCP_Connect           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../dd/dc5/struct_i_p_d_r__tag___platform.html">IPDR_PlatformServices</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>PS</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">TCPConnection</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>Conn</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00983 {
00984         <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a> Status;
00985 
00986         Status = <a class="code" href="../../d2/dc9/_platform_8h.html#a42">Platform_Connect</a>(PS, Conn-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o6">FD</a>, Conn-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o1">RemoteAddr</a>, Conn-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o2">RemotePort</a>);
00987         <span class="keywordflow">if</span>(<a class="code" href="../../da/d39/_i_p_d_r_8h.html#a18">FAILURE</a>(Status))
00988         {
00989            <a class="code" href="../../dd/d28/_log_8c.html#a28">Log_LogPlatformError</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a2">CONNECTION_LOG</a>(Conn), <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a1">TCP_MODULE_ID</a>,
00990                              <span class="stringliteral">"TCP_Connect"</span>,
00991                              <span class="stringliteral">"Platform_Connect"</span>);
00992                 <span class="keywordflow">return</span> Status;
00993         }
00994 
00995         Status = <a class="code" href="../../d2/dc9/_platform_8h.html#a43">Platform_GetSockName</a>(PS, Conn-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o6">FD</a>, &amp;(Conn-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o3">LocaleAddr</a>), &amp;(Conn-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o4">LocalePort</a>));
00996         <span class="keywordflow">if</span>(<a class="code" href="../../da/d39/_i_p_d_r_8h.html#a18">FAILURE</a>(Status))
00997         {
00998            <a class="code" href="../../dd/d28/_log_8c.html#a28">Log_LogPlatformError</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a2">CONNECTION_LOG</a>(Conn), <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a1">TCP_MODULE_ID</a>,
00999                              <span class="stringliteral">"TCP_Connect"</span>,
01000                              <span class="stringliteral">"Platform_GetSockName"</span>);
01001                 <span class="keywordflow">return</span> Status;
01002         }
01003 
01004         <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga15a174">IPDR_OK</a> ;
01005 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="TCPTransport.c::TCP_ConnectionCallback"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static void TCP_ConnectionCallback           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../db/d76/struct_i_p_d_r__tag___socket.html">IPDR_SocketHandle</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>FD</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>void *&nbsp;</td>
          <td class="mdname" nowrap> <em>Arg</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Callback triggered whenever a socket becomes readable.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>FD</em>&nbsp;</td><td>socket file descriptor </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Arg</em>&nbsp;</td><td>callback argument (the connection)</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga15a174">IPDR_OK</a> on success; <a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga15">IPDR_STATUS_RETURN_CODE</a> otherwise. </dd></dl>
<div class="fragment"><pre class="fragment">00630 {
00631     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> B;
00632     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> MessageLength, Pos, RemainingBytes;
00633     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> TotalBufferSize;
00634     <a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">TCPConnection</a> *C = <span class="comment">/*(TCPConnection *)*/</span> Arg;
00635     <a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html">TCPTransport</a> *T = <span class="comment">/*(TCPTransport *)*/</span> C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o13">Transport</a>;
00636     MessageHeader *Header;
00637 
00638         <span class="comment">/* This temporary header is here because the data is not padded any more and we can not work with</span>
00639 <span class="comment">        arbitrary chanks ...*/</span>
00640         MessageHeader tmpHeader;
00641 
00642     <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a> Status;
00643     <a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html">BufferHandle</a> BH, NewBH;
00644     <a class="code" href="../../d2/dc9/_platform_8h.html#a34">Platform_Lock</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>);
00645 
00646     ++C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o20">InUseCount</a>;
00647 
00648     <a class="code" href="../../da/df4/_log_8h.html#a29">Log_Write1</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a2">CONNECTION_LOG</a>(C), <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a1">TCP_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga6a172">IPDR_LEVEL_DEBUG</a>,
00649                <span class="stringliteral">"TCP_ConnectionCallback"</span>,
00650                <span class="stringliteral">"%.199s"</span>, <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a40">TCP_GetConnectionInfoStr</a>(C));
00651 
00652     <span class="keywordflow">if</span> (! <a class="code" href="../../dc/d2f/group___i_p_d_r__transitional__typedefs.html#ga3">IPDR_SocketEq</a>(FD, C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o6">FD</a>)) {
00653         <a class="code" href="../../da/df4/_log_8h.html#a31">Log_Write3</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a2">CONNECTION_LOG</a>(C), <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a1">TCP_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga6a168">IPDR_LEVEL_FATAL</a>,
00654                    <span class="stringliteral">"TCP_ConnectionCallback"</span>,
00655                    <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a15">MSG_TCP_INVALID_CONN_FD</a>,
00656                    <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a40">TCP_GetConnectionInfoStr</a>(C),
00657                    <a class="code" href="../../d4/d2e/group___i_p_d_r___socket.html#ga1">Platform_SOCKET_DISPLAY</a>(FD), <a class="code" href="../../d4/d2e/group___i_p_d_r___socket.html#ga1">Platform_SOCKET_DISPLAY</a>(C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o6">FD</a>));
00658         --C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o20">InUseCount</a>;
00659         <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a27">TCP_HandleDisconnection</a>(C);
00660         return ;
00661     }
00662 
00663     <span class="comment">/* get a maximum size buffer from the receive chunks manager and read</span>
00664 <span class="comment">       data into it */</span>
00665 
00666     Status = <a class="code" href="../../d8/d51/_chunks_manager_8c.html#a20">ChunksManager_AllocateMaxBuffer</a>(&amp; (C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o14">ReceivedData</a>), &amp; BH,
00667                                              &amp; TotalBufferSize);
00668     <span class="keywordflow">if</span> (<a class="code" href="../../da/d39/_i_p_d_r_8h.html#a18">FAILURE</a>(Status)) {
00669         <span class="comment">/* XXX should signal error event */</span>
00670         <a class="code" href="../../da/df4/_log_8h.html#a30">Log_Write2</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a2">CONNECTION_LOG</a>(C), <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a1">TCP_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga6a169">IPDR_LEVEL_ERROR</a>, <span class="stringliteral">"TCP_ConnectionCallback[1]"</span>,
00671                    <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a11">MSG_TCP_ALLOC_MAXBUFFER_FAILED</a>,
00672                    <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a40">TCP_GetConnectionInfoStr</a>(C), <a class="code" href="../../d4/d2e/group___i_p_d_r___socket.html#ga1">Platform_SOCKET_DISPLAY</a>(FD));
00673         --C-&gt;InUseCount;
00674         <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a27">TCP_HandleDisconnection</a>(C);
00675         <a class="code" href="../../d2/dc9/_platform_8h.html#a35">Platform_Unlock</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>);
00676         return ;
00677     }
00678 
00679     <a class="code" href="../../d2/dc9/_platform_8h.html#a35">Platform_Unlock</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>);
00680     Status = <a class="code" href="../../d2/dc9/_platform_8h.html#a49">Platform_Recv</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>, FD, BH.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a>, TotalBufferSize,
00681                            <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a4">RECV_TIMEOUT</a>, &amp; B);
00682 
00683     <a class="code" href="../../da/df4/_log_8h.html#a32">Log_Write4</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a2">CONNECTION_LOG</a>(C), <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a1">TCP_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga6a172">IPDR_LEVEL_DEBUG</a>,
00684                <span class="stringliteral">"TCP_ConnectionCallback"</span>,
00685                <span class="stringliteral">"recv %.199s bytes=%u (bufsize=%u) status=%.99s"</span>,
00686                <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a40">TCP_GetConnectionInfoStr</a>(C), B, TotalBufferSize, <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_StatusMsg</a>(NULL, Status));
00687 
00688     <span class="comment">/* if the connection is closed (since another thread is currently closing it,</span>
00689 <span class="comment">       do nothing) */</span>
00690 
00691     <a class="code" href="../../d2/dc9/_platform_8h.html#a34">Platform_Lock</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>);
00692 
00693     <span class="keywordflow">if</span> (C-&gt;Disconnected) {
00694 <span class="preprocessor">#ifdef TRACE_MAINFUNC</span>
00695 <span class="preprocessor"></span>        fprintf(stderr, <span class="stringliteral">"*** after Recv[1] ... disconnected\n"</span>); fflush(stderr);
00696 <span class="preprocessor">#endif</span>
00697 <span class="preprocessor"></span>        --C-&gt;InUseCount;
00698         <a class="code" href="../../d2/dc9/_platform_8h.html#a35">Platform_Unlock</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>);
00699         return ;
00700     }
00701 
00702     <span class="keywordflow">if</span> (<a class="code" href="../../da/d39/_i_p_d_r_8h.html#a18">FAILURE</a>(Status)) {
00703         <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a22">Log_LogPlatformConnError</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a1">TRANSPORT_LOG</a>, <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a1">TCP_MODULE_ID</a>,
00704                                  <span class="stringliteral">"TCP_ConnectionCallback"</span>,
00705                                  <span class="stringliteral">"Platform_Recv[1]"</span>, C, Status);
00706         <span class="comment">/* if the socket is still registered for write, do nothing (used to solve</span>
00707 <span class="comment">           problems with implementations which try to invoke the write callback</span>
00708 <span class="comment">           in any case, even if it was unregistered, since the unregistering</span>
00709 <span class="comment">           is queued for later invocation */</span>
00710         <span class="keywordflow">if</span> (C-&gt;WriteEventID != NULL) {
00711             <a class="code" href="../../d8/d51/_chunks_manager_8c.html#a21">ChunksManager_TruncateChunk</a>(&amp; BH);
00712             --C-&gt;InUseCount;
00713             <a class="code" href="../../d2/dc9/_platform_8h.html#a35">Platform_Unlock</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>);
00714             return ;
00715         }
00716 
00717         --C-&gt;InUseCount;
00718         <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a27">TCP_HandleDisconnection</a>(C);
00719         <a class="code" href="../../d2/dc9/_platform_8h.html#a35">Platform_Unlock</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>);
00720         return ;
00721     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (B == 0) {
00722         <a class="code" href="../../d8/d51/_chunks_manager_8c.html#a21">ChunksManager_TruncateChunk</a>(&amp; BH);
00723         <span class="comment">/* no data was received due to a timeout */</span>
00724         <a class="code" href="../../da/df4/_log_8h.html#a30">Log_Write2</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a1">TRANSPORT_LOG</a>, <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a1">TCP_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga6a172">IPDR_LEVEL_DEBUG</a>, <span class="stringliteral">"TCP_ConnectionCallback"</span>,
00725                    <span class="stringliteral">"No data due to timeout: %.199s handlers=%p"</span>,
00726                    <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a40">TCP_GetConnectionInfoStr</a>(C), C-&gt;Handlers);
00727         <span class="keywordflow">if</span> (C-&gt;Handlers != NULL) {
00728             C-&gt;Handlers-&gt;Data(C, NULL, 0, C-&gt;Arg);
00729         }
00730         --C-&gt;InUseCount;
00731         <a class="code" href="../../d2/dc9/_platform_8h.html#a35">Platform_Unlock</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>);
00732         return ;
00733     }
00734 
00735     Pos = 0;
00736     RemainingBytes = B;
00737 
00738     <span class="comment">/* We are still platform locked here. We keep things locked,</span>
00739 <span class="comment">       unlocking whenever a receive is done. */</span>
00740 
00741     <span class="keywordflow">while</span> (RemainingBytes &gt; 0) {
00742 <span class="preprocessor">#ifdef TRACE_MAINFUNC</span>
00743 <span class="preprocessor"></span>        fprintf(stderr, <span class="stringliteral">"Remaining bytes: %d\n"</span>, RemainingBytes); fflush(stderr);
00744 <span class="preprocessor">#endif</span>
00745 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (RemainingBytes &gt;= <span class="keyword">sizeof</span>(MessageHeader)) {
00746             Header = (MessageHeader *) BH.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a>;
00747                         memcpy( &amp;tmpHeader, BH.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a>, <span class="keyword">sizeof</span>(MessageHeader));
00748             <span class="comment">//MessageLength = IPDR_NTOHL(Header-&gt;MessageLength);</span>
00749                         Header = &amp;tmpHeader ;
00750                         MessageLength = <a class="code" href="../../df/dde/_defs_8h.html#a12">IPDR_NTOHL</a>(Header-&gt;MessageLength);
00751             <span class="keywordflow">if</span> (MessageLength &lt; <span class="keyword">sizeof</span> *Header ||
00752                 Header-&gt;Version != <a class="code" href="../../db/d1e/_protocol_8h.html#a18">IPDR_PROTOCOL_VERSION</a>) {
00753                 <span class="comment">/* XXX should signal error event */</span>
00754                 <a class="code" href="../../da/df4/_log_8h.html#a35">Log_Write7</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a1">TRANSPORT_LOG</a>, <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a1">TCP_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga6a169">IPDR_LEVEL_ERROR</a>, <span class="stringliteral">"TCP_ConnectionCallback"</span>,
00755                            <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a7">MSG_TCP_RECEIVE_CORRUPTED</a>,
00756                            <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a40">TCP_GetConnectionInfoStr</a>(C),
00757                            MessageLength,
00758                            Header-&gt;Version,
00759                            Header-&gt;MessageID,
00760                            Header-&gt;MessageFlags,
00761                            Header-&gt;SessionID,
00762                            <a class="code" href="../../d4/d2e/group___i_p_d_r___socket.html#ga1">Platform_SOCKET_DISPLAY</a>(FD));
00763                 <span class="comment">/* This is a disaster ... all we can do is shut things down</span>
00764 <span class="comment">                 * and hope that when we reconnect, everything will get</span>
00765 <span class="comment">                 * reset. But we have a problem: if there's a pending write,</span>
00766 <span class="comment">                 * it won't see the problem because it's not due to an I/O</span>
00767 <span class="comment">                 * error. So, let's try to force an error just in case (not</span>
00768 <span class="comment">                 * guaranteed to always work on all platforms ... but this is</span>
00769 <span class="comment">                 * a situation that should never occur anyway). Note that</span>
00770 <span class="comment">                 * there's a close inside TCP_HandleDisconnection() .. it'll</span>
00771 <span class="comment">                 * just get an error. */</span>
00772                 --C-&gt;InUseCount;
00773                 <a class="code" href="../../d2/dc9/_platform_8h.html#a44">Platform_CloseAndInvalidate</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>, &amp;FD); <span class="comment">/* Maybe not needed but no harm done */</span>
00774                 <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a27">TCP_HandleDisconnection</a>(C);
00775                 <a class="code" href="../../d2/dc9/_platform_8h.html#a35">Platform_Unlock</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>);
00776                 return ;
00777             }
00778             <span class="keywordflow">if</span> (RemainingBytes &gt;= MessageLength) {
00779 
00780                 <a class="code" href="../../da/df4/_log_8h.html#a31">Log_Write3</a>(TRANSPORT_LOG, <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a1">TCP_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga6a172">IPDR_LEVEL_DEBUG</a>, <span class="stringliteral">"TCP_ConnectionCallback"</span>,
00781                            <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a5">MSG_TCP_RECEIVE</a>,
00782                            <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a40">TCP_GetConnectionInfoStr</a>(C),
00783                            MessageLength, <a class="code" href="../../d4/d2e/group___i_p_d_r___socket.html#ga1">Platform_SOCKET_DISPLAY</a>(FD));
00784 
00785                 <span class="comment">/* if this is the last message in the chunk, truncate the chunk</span>
00786 <span class="comment">                   to point after the last message */</span>
00787                 <span class="keywordflow">if</span> (RemainingBytes == MessageLength) {
00788                     <a class="code" href="../../d8/d51/_chunks_manager_8c.html#a23">ChunksManager_TruncateChunkAfter</a>(&amp; BH, MessageLength);
00789                 }
00790 
00791                 <a class="code" href="../../da/df4/_log_8h.html#a31">Log_Write3</a>(TRANSPORT_LOG, <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a1">TCP_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga6a172">IPDR_LEVEL_DEBUG</a>, <span class="stringliteral">"TCP_ConnectionCallback"</span>,
00792                            <span class="stringliteral">"Got data: %.199s handlers=%p length=%d"</span>,
00793                            <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a40">TCP_GetConnectionInfoStr</a>(C), C-&gt;Handlers, MessageLength);
00794                                 C-&gt;Handlers-&gt;Data(C, &amp; BH, MessageLength, C-&gt;Arg);
00795                 BH.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a> += MessageLength;
00796                 RemainingBytes -= MessageLength;
00797                 Pos += MessageLength;
00798 
00799             } <span class="keywordflow">else</span> {
00800 
00801                 <span class="comment">/* check if there is enough room for the rest of the message */</span>
00802                 <span class="keywordflow">if</span> (Pos + MessageLength &lt;= TotalBufferSize) {
00803                     <a class="code" href="../../d2/dc9/_platform_8h.html#a35">Platform_Unlock</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>);
00804                     Status = <a class="code" href="../../d2/dc9/_platform_8h.html#a49">Platform_Recv</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>, FD,
00805                                            BH.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a> + RemainingBytes,
00806                                            MessageLength - RemainingBytes,
00807                                            <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a4">RECV_TIMEOUT</a>, &amp; B);
00808                     <a class="code" href="../../d2/dc9/_platform_8h.html#a34">Platform_Lock</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>);
00809                     <span class="comment">/* if the connection is closed (since another thread is</span>
00810 <span class="comment">                       currently closing it, do nothing) */</span>
00811                     <span class="keywordflow">if</span> (C-&gt;Disconnected) {
00812 <span class="preprocessor">#ifdef TRACE_MAINFUNC</span>
00813 <span class="preprocessor"></span>                        fprintf(stderr, <span class="stringliteral">"*** after Recv[2] ... disconnected\n"</span>); fflush(stderr);
00814 <span class="preprocessor">#endif</span>
00815 <span class="preprocessor"></span>                        --C-&gt;InUseCount;
00816                         <a class="code" href="../../d2/dc9/_platform_8h.html#a35">Platform_Unlock</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>);
00817                         return ;
00818                     }
00819 
00820                     <span class="keywordflow">if</span> (<a class="code" href="../../da/d39/_i_p_d_r_8h.html#a18">FAILURE</a>(Status)) {
00821                         <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a22">Log_LogPlatformConnError</a>(TRANSPORT_LOG, <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a1">TCP_MODULE_ID</a>,
00822                                                  <span class="stringliteral">"TCP_ConnectionCallback"</span>,
00823                                                  <span class="stringliteral">"Platform_Recv[2]"</span>, C, Status);
00824                         <span class="keywordflow">if</span> (C-&gt;WriteEventID != NULL) { <span class="comment">/* See comment above about registered for write */</span>
00825                             <a class="code" href="../../d8/d51/_chunks_manager_8c.html#a21">ChunksManager_TruncateChunk</a>(&amp; BH);
00826                             --C-&gt;InUseCount;
00827                             <a class="code" href="../../d2/dc9/_platform_8h.html#a35">Platform_Unlock</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>);
00828                             return ;
00829                         }
00830 
00831                         --C-&gt;InUseCount;
00832                         <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a27">TCP_HandleDisconnection</a>(C);
00833                         <a class="code" href="../../d2/dc9/_platform_8h.html#a35">Platform_Unlock</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>);
00834                         return ;
00835                     }
00836                     RemainingBytes += B;
00837                 } <span class="keywordflow">else</span> {
00838 
00839                     <span class="comment">/* there is not enough space for the message, allocate</span>
00840 <span class="comment">                       a new buffer for the message, and copy the split message */</span>
00841 
00842                     <span class="comment">/* A quick check that the message length is valid ... */</span>
00843 
00844                     <span class="keywordflow">if</span> (MessageLength &gt;= <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a3">MAX_RECV_MESSAGE_LENGTH</a>) {
00845                         Status = <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga15a182">IPDR_ERR_ALLOCATION_FAILED</a>; <span class="comment">/* Don't even try this */</span>
00846                     } <span class="keywordflow">else</span> {
00847                         Status = <a class="code" href="../../d8/d51/_chunks_manager_8c.html#a19">ChunksManager_AllocateBuffer</a>(&amp; (C-&gt;ReceivedData),
00848                                                               MessageLength,
00849                                                               &amp; NewBH);
00850                     }
00851                     <span class="keywordflow">if</span> (<a class="code" href="../../da/d39/_i_p_d_r_8h.html#a18">FAILURE</a>(Status)) {
00852                         <span class="comment">/* XXX should signal error event */</span>
00853                         <a class="code" href="../../da/df4/_log_8h.html#a31">Log_Write3</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a2">CONNECTION_LOG</a>(C), <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a1">TCP_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga6a169">IPDR_LEVEL_ERROR</a>, <span class="stringliteral">"TCP_ConnectionCallback"</span>,
00854                                    <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a14">MSG_TCP_ALLOC_RECVBUFFER_FAILED</a>,
00855                                    MessageLength,
00856                                    <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a40">TCP_GetConnectionInfoStr</a>(C), <a class="code" href="../../d4/d2e/group___i_p_d_r___socket.html#ga1">Platform_SOCKET_DISPLAY</a>(FD));
00857                         --C-&gt;InUseCount;
00858                         <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a27">TCP_HandleDisconnection</a>(C);
00859                         <a class="code" href="../../d2/dc9/_platform_8h.html#a35">Platform_Unlock</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>);
00860                         return ;
00861                     }
00862 
00863                     memcpy(NewBH.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a>, BH.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a>, RemainingBytes);
00864                     <a class="code" href="../../d8/d51/_chunks_manager_8c.html#a21">ChunksManager_TruncateChunk</a>(&amp; BH); <span class="comment">/* XXX Perhaps ReleaseBuffer would be safer (and still correct)</span>
00865 <span class="comment">                                                        * ... TruncateChunk call depends on AllocateBuffer having got</span>
00866 <span class="comment">                                                        * a *new* chunk */</span>
00867 
00868                     BH = NewBH;
00869                     Pos = 0;
00870                     TotalBufferSize = MessageLength;
00871                 }
00872             }
00873         } <span class="keywordflow">else</span> {
00874 
00875             <span class="keywordflow">if</span> (Pos + (<span class="keywordtype">int</span>) <span class="keyword">sizeof</span>(MessageHeader) &lt;= TotalBufferSize) {
00876                 <a class="code" href="../../d2/dc9/_platform_8h.html#a35">Platform_Unlock</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>);
00877                 Status = <a class="code" href="../../d2/dc9/_platform_8h.html#a49">Platform_Recv</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>, FD,
00878                                        BH.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a> + RemainingBytes,
00879                                        <span class="keyword">sizeof</span>(MessageHeader) - RemainingBytes,
00880                                        <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a4">RECV_TIMEOUT</a>, &amp; B);
00881                 <a class="code" href="../../d2/dc9/_platform_8h.html#a34">Platform_Lock</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>);
00882                 <span class="comment">/* if the connection is closed (since another thread is currently closing it,</span>
00883 <span class="comment">                   do nothing) */</span>
00884                 <span class="keywordflow">if</span> (C-&gt;Disconnected) {
00885 <span class="preprocessor">#ifdef TRACE_MAINFUNC</span>
00886 <span class="preprocessor"></span>                    fprintf(stderr, <span class="stringliteral">"*** after Recv[3] ... disconnected\n"</span>); fflush(stderr);
00887 <span class="preprocessor">#endif</span>
00888 <span class="preprocessor"></span>                    --C-&gt;InUseCount;
00889                     <a class="code" href="../../d2/dc9/_platform_8h.html#a35">Platform_Unlock</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>);
00890                     return ;
00891                 }
00892                 <span class="keywordflow">if</span> (<a class="code" href="../../da/d39/_i_p_d_r_8h.html#a18">FAILURE</a>(Status)) {
00893                     <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a22">Log_LogPlatformConnError</a>(TRANSPORT_LOG, <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a1">TCP_MODULE_ID</a>,
00894                                              <span class="stringliteral">"TCP_ConnectionCallback"</span>,
00895                                              <span class="stringliteral">"Platform_Recv[3]"</span>, C, Status);
00896                     <span class="keywordflow">if</span> (C-&gt;WriteEventID != NULL) { <span class="comment">/* See comment above about registered for write */</span>
00897                         <a class="code" href="../../d8/d51/_chunks_manager_8c.html#a21">ChunksManager_TruncateChunk</a>(&amp; BH);
00898                         --C-&gt;InUseCount;
00899                         <a class="code" href="../../d2/dc9/_platform_8h.html#a35">Platform_Unlock</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>);
00900                         return ;
00901                     }
00902                     --C-&gt;InUseCount;
00903                     <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a27">TCP_HandleDisconnection</a>(C);
00904                     <a class="code" href="../../d2/dc9/_platform_8h.html#a35">Platform_Unlock</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>);
00905                     return ;
00906                 }
00907                 RemainingBytes += B;
00908             } <span class="keywordflow">else</span> {
00909 
00910                 <span class="comment">/* there is not enough space for the header, allocate</span>
00911 <span class="comment">                   a new buffer for the message, and copy the splitted message */</span>
00912 
00913                 Status = <a class="code" href="../../d8/d51/_chunks_manager_8c.html#a20">ChunksManager_AllocateMaxBuffer</a>(&amp; (C-&gt;ReceivedData),
00914                                                          &amp; NewBH,
00915                                                          &amp; TotalBufferSize);
00916 
00917                 <span class="keywordflow">if</span> (<a class="code" href="../../da/d39/_i_p_d_r_8h.html#a18">FAILURE</a>(Status)) {
00918                     <span class="comment">/* XXX should signal error event */</span>
00919                     <a class="code" href="../../da/df4/_log_8h.html#a30">Log_Write2</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a2">CONNECTION_LOG</a>(C), <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a1">TCP_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga6a169">IPDR_LEVEL_ERROR</a>, <span class="stringliteral">"TCP_ConnectionCallback[2]"</span>,
00920                                <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a11">MSG_TCP_ALLOC_MAXBUFFER_FAILED</a>,
00921                                <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a40">TCP_GetConnectionInfoStr</a>(C), <a class="code" href="../../d4/d2e/group___i_p_d_r___socket.html#ga1">Platform_SOCKET_DISPLAY</a>(FD));
00922                     --C-&gt;InUseCount;
00923                     <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a27">TCP_HandleDisconnection</a>(C);
00924                     <a class="code" href="../../d2/dc9/_platform_8h.html#a35">Platform_Unlock</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>);
00925                     return ;
00926                 }
00927 
00928                 memcpy(NewBH.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a>, BH.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a>, RemainingBytes);
00929                 <a class="code" href="../../d8/d51/_chunks_manager_8c.html#a21">ChunksManager_TruncateChunk</a>(&amp; BH);
00930 
00931                 BH = NewBH;
00932                 Pos = 0;
00933             }
00934         }
00935     }
00936 
00937     --C-&gt;InUseCount;
00938     <a class="code" href="../../d2/dc9/_platform_8h.html#a35">Platform_Unlock</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>);
00939 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="TCPTransport.c::TCP_ConnectionWriteCallback"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static void TCP_ConnectionWriteCallback           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../db/d76/struct_i_p_d_r__tag___socket.html">IPDR_SocketHandle</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>FD</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>void *&nbsp;</td>
          <td class="mdname" nowrap> <em>Arg</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Callback triggered whenever a socket becomes writable (used for performing non blocking writes).<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>FD</em>&nbsp;</td><td>file (socket) descriptor </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Arg</em>&nbsp;</td><td>extra argument to the callback</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga15a174">IPDR_OK</a> on success; <a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga15">IPDR_STATUS_RETURN_CODE</a> otherwise.</dd></dl>
++C-&gt;InUseCount;<p>
--C-&gt;InUseCount; <div class="fragment"><pre class="fragment">00609 {
00610     <a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">TCPConnection</a> *C = <span class="comment">/*(TCPConnection *)*/</span> Arg;
00611     <a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html">TCPTransport</a> *T = <span class="comment">/*(TCPTransport *)*/</span> C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o13">Transport</a>;
00612 
00613     <a class="code" href="../../d2/dc9/_platform_8h.html#a34">Platform_Lock</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>);
00615     <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a11">TCP_SendBuffers</a>(C);
00617     <a class="code" href="../../d2/dc9/_platform_8h.html#a35">Platform_Unlock</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>);
00618 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="TCPTransport.c::TCP_CreateConnection"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a> TCP_CreateConnection           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html">TCPTransport</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>T</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../db/d76/struct_i_p_d_r__tag___socket.html">IPDR_SocketHandle</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>FD</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga9">IPDR_IPAddress</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>RemoteAddr</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>unsigned short&nbsp;</td>
          <td class="mdname" nowrap> <em>RemotePort</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">TCPConnection</a> **&nbsp;</td>
          <td class="mdname" nowrap> <em>C</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">01147 {
01148         <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a> Status;
01149         <a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">TCPConnection</a>   *C ;
01150 
01151 
01152     Status = <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a26">TCP_AllocateConnection</a>(T, RemoteAddr, RemotePort,
01153                                     T-&gt;<a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html#o1">RcvAllocator</a>, &amp;C);
01154     <span class="keywordflow">if</span> (<a class="code" href="../../da/d39/_i_p_d_r_8h.html#a18">FAILURE</a>(Status)) {
01155         <a class="code" href="../../dd/d28/_log_8c.html#a28">Log_LogPlatformError</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a1">TRANSPORT_LOG</a>, <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a1">TCP_MODULE_ID</a>,
01156                              <span class="stringliteral">"TCP_CreateConnection"</span>,
01157                              <span class="stringliteral">"Platform_AllocateConnection"</span>);
01158         <span class="keywordflow">return</span> Status;
01159     }
01160 
01161         *Conn = C ;
01162         C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o6">FD</a> = FD;
01163     C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o9">Handlers</a> = T-&gt;<a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html#o4">DefaultHandlers</a>;
01164     C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o10">Arg</a> = T-&gt;<a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html#o5">DefaultArg</a>;
01165         C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o11">Owner</a> = NULL ;
01166     C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o12">NextConnection</a> = T-&gt;<a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html#o3">Connections</a>;
01167         C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o5">DummyAddr</a> = 0;
01168     T-&gt;<a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html#o3">Connections</a> = C;
01169 
01170     Status = <a class="code" href="../../d2/dc9/_platform_8h.html#a14">Platform_RegisterReadSocket</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>,
01171                                                                                 C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o6">FD</a>, <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a9">TCP_ConnectionCallback</a>,
01172                                                                                 C, &amp;(C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o7">ReadEventID</a>));
01173 
01174     Status = <a class="code" href="../../d2/dc9/_platform_8h.html#a11">Platform_RegisterPeriodicTimer</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>,
01175                                             <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a25">TCP_FlushTimerCallback</a>,
01176                                             C, T-&gt;<a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html#o13">FlushInterval</a>,
01177                                             &amp;(C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o18">FlushTimer</a>));
01178 
01179     <a class="code" href="../../da/df4/_log_8h.html#a31">Log_Write3</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a1">TRANSPORT_LOG</a>, <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a1">TCP_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga6a172">IPDR_LEVEL_DEBUG</a>, <span class="stringliteral">"TCP_AcceptCallback"</span>,
01180                <span class="stringliteral">"Register FlushTimerCallback - %.98s, Socket="</span> <a class="code" href="../../d4/d2e/group___i_p_d_r___socket.html#ga0">Platform_SOCKET_FMT</a> <span class="stringliteral">" status = %.99s"</span>,
01181                <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a40">TCP_GetConnectionInfoStr</a>(C), <a class="code" href="../../d4/d2e/group___i_p_d_r___socket.html#ga1">Platform_SOCKET_DISPLAY</a>(C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o6">FD</a>), <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_StatusMsg</a>(NULL, Status));
01182 
01183         <span class="keywordflow">return</span> Status;
01184 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a28" doxytag="TCPTransport.c::TCP_CreateConnectionIdle"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a> TCP_CreateConnectionIdle           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html">TCPTransport</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>T</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga9">IPDR_IPAddress</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>LocalAddr</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga9">IPDR_IPAddress</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>RemoteAddr</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>unsigned short&nbsp;</td>
          <td class="mdname" nowrap> <em>RemotePort</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">TCPConnection</a> **&nbsp;</td>
          <td class="mdname" nowrap> <em>Conn</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00946 {
00947         <a class="code" href="../../db/d76/struct_i_p_d_r__tag___socket.html">IPDR_SocketHandle</a> NewSocketFD;
00948     <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a> Status;
00949 
00950 
00951         Status = <a class="code" href="../../d2/dc9/_platform_8h.html#a39">Platform_CreateTCPSocket</a>(T-&gt;<a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html#o0">PS</a>, &amp; (NewSocketFD));
00952     <span class="keywordflow">if</span> (<a class="code" href="../../da/d39/_i_p_d_r_8h.html#a18">FAILURE</a>(Status))
00953         {
00954         <a class="code" href="../../dd/d28/_log_8c.html#a28">Log_LogPlatformError</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a1">TRANSPORT_LOG</a>, <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a1">TCP_MODULE_ID</a>,
00955                              <span class="stringliteral">"TCP_CreateConnectionIdle"</span>,
00956                              <span class="stringliteral">"Platform_CreateTCPSocket"</span>);
00957         <span class="keywordflow">return</span> Status;
00958     }
00959 
00960         Status = <a class="code" href="../../d2/dc9/_platform_8h.html#a41">Platform_Bind</a>(T-&gt;<a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html#o0">PS</a>, NewSocketFD, LocalAddr, 0);
00961     <span class="keywordflow">if</span> (<a class="code" href="../../da/d39/_i_p_d_r_8h.html#a18">FAILURE</a>(Status)) {
00962         <a class="code" href="../../da/df4/_log_8h.html#a57">Log_LogPlatformSocketError</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a1">TRANSPORT_LOG</a>, <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a1">TCP_MODULE_ID</a>,
00963                                    <span class="stringliteral">"TCP_CreateConnectionIdle"</span>,
00964                                    <span class="stringliteral">"Platform_Bind"</span>, LocalAddr, 0, NewSocketFD);
00965         <a class="code" href="../../d2/dc9/_platform_8h.html#a44">Platform_CloseAndInvalidate</a>(T-&gt;<a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html#o0">PS</a>, &amp;T-&gt;<a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html#o6">SocketFD</a>);
00966         <span class="keywordflow">return</span> Status;
00967     }
00968 
00969         Status = <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a14">TCP_CreateConnection</a>(T, NewSocketFD, RemoteAddr, RemotePort, Conn);
00970     <span class="keywordflow">if</span> (<a class="code" href="../../da/d39/_i_p_d_r_8h.html#a18">FAILURE</a>(Status))
00971         {
00972         <a class="code" href="../../dd/d28/_log_8c.html#a28">Log_LogPlatformError</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a1">TRANSPORT_LOG</a>, <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a1">TCP_MODULE_ID</a>,
00973                              <span class="stringliteral">"TCP_CreateConnectionIdle"</span>,
00974                              <span class="stringliteral">"TCP_CreateConnection"</span>);
00975         <span class="keywordflow">return</span> Status;
00976     }
00977 
00978         <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga15a174">IPDR_OK</a> ;
00979 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a36" doxytag="TCPTransport.c::TCP_Disconnect"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a> TCP_Disconnect           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>C</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Disconnects a TCP connection<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>C</em>&nbsp;</td><td>connection to disconnect</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga15a174">IPDR_OK</a> on success; <a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga15">IPDR_STATUS_RETURN_CODE</a> otherwise. </dd></dl>
<div class="fragment"><pre class="fragment">01627 {
01628     <a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">TCPConnection</a> *C1, *TC = <span class="comment">/*(TCPConnection *)*/</span> C;
01629     <a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html">TCPTransport</a> *T = <span class="comment">/*(TCPTransport *)*/</span> TC-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o13">Transport</a>;
01630 
01631 <span class="preprocessor">#ifdef TRACE_MAINFUNC</span>
01632 <span class="preprocessor"></span>    fprintf(stderr, <span class="stringliteral">"TCP_Disconnect "</span> <a class="code" href="../../d4/d2e/group___i_p_d_r___socket.html#ga0">Platform_SOCKET_FMT</a> <span class="stringliteral">"\n"</span>, <a class="code" href="../../d4/d2e/group___i_p_d_r___socket.html#ga1">Platform_SOCKET_DISPLAY</a>(TC-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o6">FD</a>)); fflush(stderr);
01633 <span class="preprocessor">#endif</span>
01634 <span class="preprocessor"></span>
01635     <span class="comment">/* We're not checking TC-&gt;InUseCount here ... unlike</span>
01636 <span class="comment">     * TCP_HandleDisconnection() ... this is probably OK because</span>
01637 <span class="comment">     * TCP_Disconnect is called only by client(transmitter)/session</span>
01638 <span class="comment">     * destructors or when we get connections that we don't know</span>
01639 <span class="comment">     * about. */</span>
01640 
01641     TC-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o19">Disconnected</a> = <a class="code" href="../../df/dde/_defs_8h.html#a5">IPDR_TRUE</a>;
01642 
01643     <a class="code" href="../../d2/dc9/_platform_8h.html#a13">Platform_UnregisterTimerAndClear</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>, &amp;TC-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o18">FlushTimer</a>);
01644 
01645     <a class="code" href="../../d2/dc9/_platform_8h.html#a17">Platform_UnregisterSocketAndClear</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>, &amp;TC-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o7">ReadEventID</a>);
01646     <a class="code" href="../../d2/dc9/_platform_8h.html#a17">Platform_UnregisterSocketAndClear</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>, &amp;TC-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o8">WriteEventID</a>);
01647     <a class="code" href="../../da/df4/_log_8h.html#a30">Log_Write2</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a1">TRANSPORT_LOG</a>, <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a1">TCP_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga6a172">IPDR_LEVEL_DEBUG</a>, <span class="stringliteral">"TCP_Disconnect"</span>,
01648                <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a8">MSG_TCP_CLOSE</a>, <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a40">TCP_GetConnectionInfoStr</a>(TC), <a class="code" href="../../d4/d2e/group___i_p_d_r___socket.html#ga1">Platform_SOCKET_DISPLAY</a>(TC-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o6">FD</a>));
01649     <a class="code" href="../../d2/dc9/_platform_8h.html#a44">Platform_CloseAndInvalidate</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>, &amp;TC-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o6">FD</a>);
01650 
01651     <span class="comment">/* remove the connection from the connections list */</span>
01652 
01653     C1 = T-&gt;<a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html#o3">Connections</a>;
01654     <span class="keywordflow">if</span> (C1 == TC)
01655         T-&gt;<a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html#o3">Connections</a> = TC-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o12">NextConnection</a>;
01656     <span class="keywordflow">else</span> {
01657         <span class="keywordflow">while</span> (C1 != NULL) {
01658             <span class="keywordflow">if</span> (C1-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o12">NextConnection</a> == TC) {
01659                 C1-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o12">NextConnection</a> = TC-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o12">NextConnection</a>;
01660                 break ;
01661             }
01662         C1 = C1-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o12">NextConnection</a>;
01663         }
01664     }
01665 
01666     <span class="keywordflow">if</span> (TC-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o9">Handlers</a> != NULL)
01667         TC-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o9">Handlers</a>-&gt;<a class="code" href="../../db/dcd/struct_i_p_d_r__tag___connection_handlers.html#o1">Disconnect</a>(C, TC-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o10">Arg</a>);
01668 
01669     <a class="code" href="../../d8/d51/_chunks_manager_8c.html#a18">ChunksManager_Destroy</a>(&amp; (TC-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o14">ReceivedData</a>));
01670     <a class="code" href="../../d8/d51/_chunks_manager_8c.html#a18">ChunksManager_Destroy</a>(&amp; (TC-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o15">SentData</a>));
01671     <a class="code" href="../../d8/d51/_chunks_manager_8c.html#a18">ChunksManager_Destroy</a>(&amp; (TC-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o16">SendBuffers</a>));
01672     strncpy(TC-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o0">eyecatcher</a>, <span class="stringliteral">"Dtcpcon"</span>, <span class="keyword">sizeof</span> TC-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o0">eyecatcher</a>);
01673     <a class="code" href="../../d2/dc9/_platform_8h.html#a20">Platform_MemoryFree</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>, TC);
01674 
01675     <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga15a174">IPDR_OK</a>;
01676 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a25" doxytag="TCPTransport.c::TCP_FlushTimerCallback"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static void TCP_FlushTimerCallback           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Arg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00245 {
00246     <a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">TCPConnection</a> *C = <span class="comment">/*(TCPConnection *)*/</span> Arg;
00247     <a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html">TCPTransport</a> *T = <span class="comment">/*(TCPTransport *)*/</span> C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o13">Transport</a>;
00248 
00249     <a class="code" href="../../d2/dc9/_platform_8h.html#a34">Platform_Lock</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>);
00250     <span class="comment">/* ++C-&gt;InUseCount; ... this is done by TCP_SendBuffers() */</span>
00251 
00252     <a class="code" href="../../da/df4/_log_8h.html#a17">Log_OutputStr1</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a1">TRANSPORT_LOG</a>, <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a1">TCP_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga6a172">IPDR_LEVEL_DEBUG</a>, <span class="stringliteral">"TCP_FlushTimerCallback"</span>,
00253                    <span class="stringliteral">"TCP_FlushTimerCallback %.99s"</span>, <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a40">TCP_GetConnectionInfoStr</a>(C));
00254 
00255     <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a11">TCP_SendBuffers</a>(C);
00256 
00257     <span class="comment">/* --C-&gt;InUseCount; */</span>
00258     <a class="code" href="../../d2/dc9/_platform_8h.html#a35">Platform_Unlock</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>);
00259 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a39" doxytag="TCPTransport.c::TCP_GetConnectionInfo"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a> TCP_GetConnectionInfo           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>C</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga9">IPDR_IPAddress</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>Addr</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>unsigned short *&nbsp;</td>
          <td class="mdname" nowrap> <em>Port</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Get address/port of a connection.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>C</em>&nbsp;</td><td>connection to get info of. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Addr</em>&nbsp;</td><td>remote address (output) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Port</em>&nbsp;</td><td>remote port (output)</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga15a174">IPDR_OK</a> on success; <a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga15">IPDR_STATUS_RETURN_CODE</a> otherwise. </dd></dl>
<div class="fragment"><pre class="fragment">01733 {
01734     <a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">TCPConnection</a> *TC = <span class="comment">/*(TCPConnection *)*/</span> C;
01735     *Addr = TC-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o1">RemoteAddr</a>;
01736     *Port = TC-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o2">RemotePort</a>;
01737     <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga15a174">IPDR_OK</a>;
01738 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a40" doxytag="TCPTransport.c::TCP_GetConnectionInfoStr"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">const char* TCP_GetConnectionInfoStr           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">TCPConnection</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>TC</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">01748 {
01749     <span class="keywordflow">if</span> (TC) {
01750         <span class="comment">/* The first two fields must be of the form</span>
01751 <span class="comment">           "Server=xx.xx.xx.xx, Port=xx"</span>
01752 <span class="comment">           because this is used by the TriggerEvent and some applications</span>
01753 <span class="comment">           rely on the format of the string (bad way of doing things, but</span>
01754 <span class="comment">           that's the way things are until we fix them). */</span>
01755         <span class="keywordflow">if</span> (strncmp(TC-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o0">eyecatcher</a>, <span class="stringliteral">"TCPCONN"</span>, <span class="keyword">sizeof</span> TC-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o0">eyecatcher</a>) == 0) {
01756             <a class="code" href="../../d5/d93/_transport_8h.html#a28">TL_PABuf</a> paBuf;
01757 <span class="preprocessor">#     if 0</span>
01758 <span class="preprocessor"></span>            <span class="keywordtype">char</span> buf1[50], buf2[50]; <span class="comment">/* for timer descriptions (debugging) */</span>
01759             <a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html">TCPTransport</a> *T = <span class="comment">/*(TCPTransport *)*/</span> TC-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o13">Transport</a>;
01760 <span class="preprocessor">#     endif</span>
01761 <span class="preprocessor"></span><span class="preprocessor">#     if defined(DETAILED_CONNECTION_INFO)</span>
01762 <span class="preprocessor"></span>            sprintf(TC-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o21">descrStr</a>, <span class="stringliteral">"Collector=%.50s, [s="</span> <a class="code" href="../../d4/d2e/group___i_p_d_r___socket.html#ga0">Platform_SOCKET_FMT</a> <span class="stringliteral">"]%.20s%.20s,%.20s%.20s%.20s%.60s%.60suse=%d"</span>,
01763                     <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a19">TCP_PrintConnectionRemote</a>(TC, paBuf),
01764                     <a class="code" href="../../d4/d2e/group___i_p_d_r___socket.html#ga1">Platform_SOCKET_DISPLAY</a>(TC-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o6">FD</a>),
01765                     ((TC-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o19">Disconnected</a>) ? <span class="stringliteral">"{disc}"</span> : <span class="stringliteral">""</span>),
01766                     (TC-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o7">ReadEventID</a> ? <span class="stringliteral">"read"</span> : <span class="stringliteral">""</span>),
01767                     (TC-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o8">WriteEventID</a> ? <span class="stringliteral">"write"</span> : <span class="stringliteral">""</span>),
01768                     (TC-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o9">Handlers</a> ? <span class="stringliteral">""</span> : <span class="stringliteral">"(noHndlr)"</span>),
01769                     (TC-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o13">Transport</a> ? <span class="stringliteral">""</span> : <span class="stringliteral">"(noTrnsprt)"</span>),
01770                     <span class="stringliteral">""</span>, <span class="comment">/* Platform_DescribeTimer(T-&gt;PS, "conn", TC-&gt;ConnectionTimer, buf1), */</span>
01771                     <span class="stringliteral">""</span>, <span class="comment">/* Platform_DescribeTimer(T-&gt;PS, "flush", TC-&gt;FlushTimer, buf2), */</span>
01772                     TC-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o20">InUseCount</a>);
01773 <span class="preprocessor">#     else</span>
01774 <span class="preprocessor"></span>            sprintf(TC-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o21">descrStr</a>, <span class="stringliteral">"Collector=%.50s"</span>,
01775                     <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a19">TCP_PrintConnectionRemote</a>(TC, paBuf));
01776 <span class="preprocessor">#     endif</span>
01777 <span class="preprocessor"></span>            <span class="keywordflow">return</span> TC-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o21">descrStr</a>;
01778         } <span class="keywordflow">else</span> {
01779             <span class="keyword">static</span> <span class="keywordtype">char</span> iMsg[40];
01780             sprintf(iMsg, <span class="stringliteral">"&lt;invalid connection(%.8s)&gt;"</span>, TC-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o0">eyecatcher</a>);
01781             <span class="keywordflow">return</span> iMsg;
01782         }
01783     } <span class="keywordflow">else</span> {
01784         <span class="keywordflow">return</span> <span class="stringliteral">"&lt;null connection&gt;"</span>;
01785     }
01786 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a41" doxytag="TCPTransport.c::TCP_GetReceiveChunksManager"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a> TCP_GetReceiveChunksManager           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">TCPConnection</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>TC</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d1/d38/struct_i_p_d_r__tag___chunks_manager.html">ChunksManager</a> **&nbsp;</td>
          <td class="mdname" nowrap> <em>Mgr</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Get the chunks manager for received data on a connection<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>TC</em>&nbsp;</td><td>connection to get info of. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Mgr</em>&nbsp;</td><td>chunks manager</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga15a174">IPDR_OK</a> on success; <a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga15">IPDR_STATUS_RETURN_CODE</a> otherwise. </dd></dl>
<div class="fragment"><pre class="fragment">01798 {
01799     *Mgr = &amp; (TC-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o14">ReceivedData</a>);
01800     <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga15a174">IPDR_OK</a>;
01801 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a42" doxytag="TCPTransport.c::TCP_GetSendChunksManager"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a> TCP_GetSendChunksManager           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">TCPConnection</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>TC</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d1/d38/struct_i_p_d_r__tag___chunks_manager.html">ChunksManager</a> **&nbsp;</td>
          <td class="mdname" nowrap> <em>Mgr</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Get the chunks manager for sending control messages on a connection<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>TC</em>&nbsp;</td><td>connection to get info of. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Mgr</em>&nbsp;</td><td>chunks manager</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga15a174">IPDR_OK</a> on success; <a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga15">IPDR_STATUS_RETURN_CODE</a> otherwise. </dd></dl>
<div class="fragment"><pre class="fragment">01814 {
01815     *Mgr = &amp; (TC-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o15">SentData</a>);
01816     <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga15a174">IPDR_OK</a>;
01817 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a30" doxytag="TCPTransport.c::TCP_GetSockName"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a> TCP_GetSockName           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../dd/dc5/struct_i_p_d_r__tag___platform.html">IPDR_PlatformServices</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>PS</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">TCPConnection</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>Conn</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">01009 {
01010         <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a> Status;
01011 
01012         Status = <a class="code" href="../../d2/dc9/_platform_8h.html#a43">Platform_GetSockName</a>(PS, Conn-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o6">FD</a>, &amp;(Conn-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o3">LocaleAddr</a>), &amp;(Conn-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o4">LocalePort</a>));
01013         <span class="keywordflow">if</span>(<a class="code" href="../../da/d39/_i_p_d_r_8h.html#a18">FAILURE</a>(Status))
01014         {
01015            <a class="code" href="../../dd/d28/_log_8c.html#a28">Log_LogPlatformError</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a2">CONNECTION_LOG</a>(Conn), <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a1">TCP_MODULE_ID</a>,
01016                              <span class="stringliteral">"TCP_GetSockName"</span>,
01017                              <span class="stringliteral">"Platform_GetSockName"</span>);
01018                 <span class="keywordflow">return</span> Status;
01019         }
01020 
01021         <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga15a174">IPDR_OK</a> ;
01022 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a27" doxytag="TCPTransport.c::TCP_HandleDisconnection"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void TCP_HandleDisconnection           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">TCPConnection</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>C</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Handle disconnection of the socket associated with a connection.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>C</em>&nbsp;</td><td>connection </td></tr>
  </table>
</dl>
<div class="fragment"><pre class="fragment">00375 {
00376     <a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html">TCPTransport</a> *T = <span class="comment">/*(TCPTransport *)*/</span> C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o13">Transport</a>;
00377     <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a> Status;
00378     <a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">TCPConnection</a> *C1;
00379 
00380     <a class="code" href="../../d2/dc9/_platform_8h.html#a34">Platform_Lock</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>);
00381 
00382     <a class="code" href="../../da/df4/_log_8h.html#a31">Log_Write3</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a1">TRANSPORT_LOG</a>, <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a1">TCP_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga6a172">IPDR_LEVEL_DEBUG</a>,
00383                <span class="stringliteral">"TCP_HandleDisconnection"</span>,
00384                <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a4">MSG_TCP_DISCONNECT</a>,
00385                <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a40">TCP_GetConnectionInfoStr</a>(C), <a class="code" href="../../d4/d2e/group___i_p_d_r___socket.html#ga1">Platform_SOCKET_DISPLAY</a>(C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o6">FD</a>), C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o20">InUseCount</a>);
00386 
00387     <span class="comment">/* It is possible that a problem will be discovered on just the read</span>
00388 <span class="comment">       or the write (e.g., out of memory) ... we force a problem on the</span>
00389 <span class="comment">       other side of the socket by closing it here (actually, doing a</span>
00390 <span class="comment">       shutdown ... a close could deallocate the FD, which might be a</span>
00391 <span class="comment">       bad idea if there's still another read or write open on</span>
00392 <span class="comment">       socket). */</span>
00393 
00394     Status = <a class="code" href="../../d2/dc9/_platform_8h.html#a52">Platform_Shutdown</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>, C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o6">FD</a>);
00395     <span class="keywordflow">if</span> (<a class="code" href="../../da/d39/_i_p_d_r_8h.html#a18">FAILURE</a>(Status)) {
00396         <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a22">Log_LogPlatformConnError</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a1">TRANSPORT_LOG</a>, <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a1">TCP_MODULE_ID</a>,
00397                                  <span class="stringliteral">"TCP_HandleDisconnection"</span>,
00398                                  <span class="stringliteral">"Platform_Shutdown"</span>, C, Status);
00399     }
00400 
00401     <span class="keywordflow">if</span> (C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o20">InUseCount</a> &gt; 0) {
00402         <a class="code" href="../../d2/dc9/_platform_8h.html#a35">Platform_Unlock</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>);
00403 
00404         <span class="comment">/* There should be no hurry to unregisters the callbacks ...</span>
00405 <span class="comment">           we'll eventually take care of them (and the rest of the</span>
00406 <span class="comment">           connection) when the use count drops to zero (e.g., we got an</span>
00407 <span class="comment">           error while doing a read; but there was also a write going on</span>
00408 <span class="comment">           ... the write will find the problem also and the removal of the</span>
00409 <span class="comment">           connection will happen then. */</span>
00410 
00411         return ;
00412     }
00413 
00414     <a class="code" href="../../d2/dc9/_platform_8h.html#a17">Platform_UnregisterSocketAndClear</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>, &amp;C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o7">ReadEventID</a>);
00415     <a class="code" href="../../d2/dc9/_platform_8h.html#a17">Platform_UnregisterSocketAndClear</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>, &amp;C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o8">WriteEventID</a>);
00416 
00417     <a class="code" href="../../d2/dc9/_platform_8h.html#a13">Platform_UnregisterTimerAndClear</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>, &amp;C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o17">ConnectionTimer</a>);
00418     <a class="code" href="../../d2/dc9/_platform_8h.html#a13">Platform_UnregisterTimerAndClear</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>, &amp;C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o18">FlushTimer</a>);
00419 
00420     <span class="comment">/* delete the connection (in case a passive connection) */</span>
00421     C1 = T-&gt;<a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html#o3">Connections</a>;
00422     <span class="keywordflow">if</span> (C == C1) {
00423         T-&gt;<a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html#o3">Connections</a> = C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o12">NextConnection</a>;
00424     } <span class="keywordflow">else</span> {
00425         <span class="keywordflow">while</span> (C1 != NULL) {
00426             <span class="keywordflow">if</span> (C1-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o12">NextConnection</a> == C) {
00427                 C1-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o12">NextConnection</a> = C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o12">NextConnection</a>;
00428                 break ;
00429             }
00430             C1 = C1-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o12">NextConnection</a>;
00431         }
00432     }
00433 
00434         <span class="keywordflow">if</span> (C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o9">Handlers</a> != NULL) {
00435         C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o9">Handlers</a>-&gt;<a class="code" href="../../db/dcd/struct_i_p_d_r__tag___connection_handlers.html#o1">Disconnect</a>(C, C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o10">Arg</a>);
00436     }
00437 
00438         <a class="code" href="../../d2/dc9/_platform_8h.html#a56">Platform_SleepMS</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>, 1);
00439 
00440     <a class="code" href="../../da/df4/_log_8h.html#a30">Log_Write2</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a1">TRANSPORT_LOG</a>, <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a1">TCP_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga6a172">IPDR_LEVEL_DEBUG</a>, <span class="stringliteral">"TCP_HandleDisconnection"</span>,
00441                <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a8">MSG_TCP_CLOSE</a>, <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a40">TCP_GetConnectionInfoStr</a>(C), <a class="code" href="../../d4/d2e/group___i_p_d_r___socket.html#ga1">Platform_SOCKET_DISPLAY</a>(C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o6">FD</a>));
00442     <a class="code" href="../../d2/dc9/_platform_8h.html#a44">Platform_CloseAndInvalidate</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>, &amp;C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o6">FD</a>);
00443 
00444     <a class="code" href="../../d8/d51/_chunks_manager_8c.html#a18">ChunksManager_Destroy</a>(&amp; (C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o15">SentData</a>));
00445     <a class="code" href="../../d8/d51/_chunks_manager_8c.html#a18">ChunksManager_Destroy</a>(&amp; (C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o14">ReceivedData</a>));
00446     <a class="code" href="../../d8/d51/_chunks_manager_8c.html#a18">ChunksManager_Destroy</a>(&amp; (C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o16">SendBuffers</a>));
00447 
00448     strncpy(C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o0">eyecatcher</a>, <span class="stringliteral">"Dtcpcon"</span>, <span class="keyword">sizeof</span> C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o0">eyecatcher</a>);
00449     <a class="code" href="../../d2/dc9/_platform_8h.html#a20">Platform_MemoryFree</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>, C);
00450 
00451     <a class="code" href="../../d2/dc9/_platform_8h.html#a35">Platform_Unlock</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>);
00452 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a24" doxytag="TCPTransport.c::TCP_InitializeParameters"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static <a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a> TCP_InitializeParameters           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html">TCPTransport</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>T</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00236 {
00237     T-&gt;<a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html#o13">FlushInterval</a> =
00238         <a class="code" href="../../de/d8a/_parameters_handler_8c.html#a17">ParametersHandler_GetIntParam</a>(&amp; (T-&gt;<a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html#o10">ParamsHandler</a>),
00239                                       <a class="code" href="../../de/d8f/_configuration_names_8h.html#a177">STR_configuration_transport_tcpTransport_flushInterval</a>);
00240     <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga15a174">IPDR_OK</a>;
00241 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a32" doxytag="TCPTransport.c::TCP_InitializePassive"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a> TCP_InitializePassive           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../dd/dc5/struct_i_p_d_r__tag___platform.html">IPDR_PlatformServices</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>PS</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../dc/d30/struct_i_p_d_r__tag___log.html">Log</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>Logger</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../db/d5a/struct_chunk_allocator.html">ChunkAllocator</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>RcvAllocator</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga9">IPDR_IPAddress</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>LocalAddr</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>unsigned short&nbsp;</td>
          <td class="mdname" nowrap> <em>LocalPort</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../db/dcd/struct_i_p_d_r__tag___connection_handlers.html">ConnectionHandlers</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>DefaultHandlers</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>void *&nbsp;</td>
          <td class="mdname" nowrap> <em>DefaultArg</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../df/d84/struct_parameters_handler.html">ParametersHandler</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>ParamsHandler</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html">Transport</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>Handle</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Initializes the TCP transport in passive mode.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>PS</em>&nbsp;</td><td>platform services </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Logger</em>&nbsp;</td><td>for any messages </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>RcvAllocator</em>&nbsp;</td><td>allocator which will be used for received chunks </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>LocalAddr</em>&nbsp;</td><td>local ip address. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>LocalPort</em>&nbsp;</td><td>local port number. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>DefaultHandlers</em>&nbsp;</td><td>callback which will be called when a connection arrives. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>DefaultArg</em>&nbsp;</td><td>argument passed to default handlers. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ParamsHandler</em>&nbsp;</td><td>handler for transport specific params </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Handle</em>&nbsp;</td><td>transport handle (output)</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga15a174">IPDR_OK</a> on success; <a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga15">IPDR_STATUS_RETURN_CODE</a> otherwise. </dd></dl>
<div class="fragment"><pre class="fragment">01212 {
01213     <a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html">TCPTransport</a> *T;
01214     <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a> Status;
01215 
01216     Status = <a class="code" href="../../d2/dc9/_platform_8h.html#a22">Platform_MEMORYALLOCATE</a>(PS, T);
01217     <span class="keywordflow">if</span> (<a class="code" href="../../da/d39/_i_p_d_r_8h.html#a18">FAILURE</a>(Status)) {
01218         <span class="comment">/* XXX should signal error event */</span>
01219         <a class="code" href="../../da/df4/_log_8h.html#a29">Log_Write1</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a1">TRANSPORT_LOG</a>, <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a1">TCP_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga6a169">IPDR_LEVEL_ERROR</a>,
01220                    <span class="stringliteral">"TCP_InitializePassive"</span>, <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a12">MSG_TCP_ALLOC_FAILED</a>, <span class="keyword">sizeof</span> (<a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html">TCPTransport</a>));
01221         <a class="code" href="../../d2/dc9/_platform_8h.html#a26">X_MEMPANIC</a>(T, __FILE__, __LINE__);
01222         <span class="keywordflow">return</span> Status;
01223     }
01224 
01225     T-&gt;<a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html#o0">PS</a> = PS;
01226     T-&gt;<a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html#o2">Logger</a> = Logger;
01227     T-&gt;<a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html#o1">RcvAllocator</a> = RcvAllocator;
01228 
01229     T-&gt;<a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html#o3">Connections</a> = NULL;
01230 
01231     T-&gt;<a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html#o4">DefaultHandlers</a> = DefaultHandlers;
01232     T-&gt;<a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html#o5">DefaultArg</a> = DefaultArg;
01233 
01234     T-&gt;<a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html#o9">LocalPort</a> = LocalPort;
01235     T-&gt;<a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html#o8">LocalAddr</a> = LocalAddr;
01236 
01237     <span class="keywordflow">if</span> (ParamsHandler)
01238         T-&gt;<a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html#o10">ParamsHandler</a> = *ParamsHandler;
01239     <span class="keywordflow">else</span> {
01240         T-&gt;<a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html#o10">ParamsHandler</a>.<a class="code" href="../../df/d84/struct_parameters_handler.html#o0">ParamsFunc</a> = NULL;
01241         T-&gt;<a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html#o10">ParamsHandler</a>.<a class="code" href="../../df/d84/struct_parameters_handler.html#o1">ParamsArg</a> = NULL;
01242     }
01243 
01244     Status = <a class="code" href="../../d2/dc9/_platform_8h.html#a39">Platform_CreateTCPSocket</a>(PS, &amp; (T-&gt;<a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html#o6">SocketFD</a>));
01245     <span class="keywordflow">if</span> (<a class="code" href="../../da/d39/_i_p_d_r_8h.html#a18">FAILURE</a>(Status)) {
01246         <a class="code" href="../../dd/d28/_log_8c.html#a28">Log_LogPlatformError</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a1">TRANSPORT_LOG</a>, <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a1">TCP_MODULE_ID</a>,
01247                              <span class="stringliteral">"TCP_InitializePassive"</span>,
01248                              <span class="stringliteral">"Platform_CreateTCPSocket"</span>);
01249         <span class="keywordflow">return</span> Status;
01250     }
01251 
01252     Status = <a class="code" href="../../d2/dc9/_platform_8h.html#a41">Platform_Bind</a>(PS, T-&gt;<a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html#o6">SocketFD</a>, LocalAddr, LocalPort);
01253     <span class="keywordflow">if</span> (<a class="code" href="../../da/d39/_i_p_d_r_8h.html#a18">FAILURE</a>(Status)) {
01254         <a class="code" href="../../da/df4/_log_8h.html#a57">Log_LogPlatformSocketError</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a1">TRANSPORT_LOG</a>, <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a1">TCP_MODULE_ID</a>,
01255                                    <span class="stringliteral">"TCP_InitializePassive"</span>,
01256                                    <span class="stringliteral">"Platform_Bind"</span>, T-&gt;<a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html#o8">LocalAddr</a>, T-&gt;<a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html#o9">LocalPort</a>, T-&gt;<a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html#o6">SocketFD</a>);
01257         <a class="code" href="../../d2/dc9/_platform_8h.html#a44">Platform_CloseAndInvalidate</a>(PS, &amp;T-&gt;<a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html#o6">SocketFD</a>);
01258         <span class="keywordflow">return</span> Status;
01259     }
01260 
01261     Status = <a class="code" href="../../d2/dc9/_platform_8h.html#a45">Platform_Listen</a>(PS, T-&gt;<a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html#o6">SocketFD</a>, 32);
01262     <span class="keywordflow">if</span> (<a class="code" href="../../da/d39/_i_p_d_r_8h.html#a18">FAILURE</a>(Status)) {
01263         <a class="code" href="../../da/df4/_log_8h.html#a57">Log_LogPlatformSocketError</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a1">TRANSPORT_LOG</a>, <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a1">TCP_MODULE_ID</a>,
01264                                    <span class="stringliteral">"TCP_InitializePassive"</span>,
01265                                    <span class="stringliteral">"Platform_Listen"</span>, T-&gt;<a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html#o8">LocalAddr</a>, T-&gt;<a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html#o9">LocalPort</a>, T-&gt;<a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html#o6">SocketFD</a>);
01266         <a class="code" href="../../d2/dc9/_platform_8h.html#a44">Platform_CloseAndInvalidate</a>(PS, &amp;T-&gt;<a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html#o6">SocketFD</a>);
01267         <span class="keywordflow">return</span> Status;
01268     }
01269 
01270     <span class="comment">/* associate a callback with the file descriptor */</span>
01271 
01272 <span class="preprocessor">#ifdef TRACE_MAINFUNC</span>
01273 <span class="preprocessor"></span>    fprintf(stderr, <span class="stringliteral">"RegisterReadSocket %d [InitPassive] AcceptCallback\n"</span>, T-&gt;<a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html#o6">SocketFD</a>); fflush(stderr);
01274 <span class="preprocessor">#endif</span>
01275 <span class="preprocessor"></span>    Status = <a class="code" href="../../d2/dc9/_platform_8h.html#a14">Platform_RegisterReadSocket</a>(PS, T-&gt;<a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html#o6">SocketFD</a>,
01276                                          <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a31">TCP_AcceptCallback</a>, T,
01277                                          &amp; (T-&gt;<a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html#o7">AcceptEventID</a>));
01278     <span class="keywordflow">if</span> (<a class="code" href="../../da/d39/_i_p_d_r_8h.html#a18">FAILURE</a>(Status)) {
01279         <a class="code" href="../../da/df4/_log_8h.html#a57">Log_LogPlatformSocketError</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a1">TRANSPORT_LOG</a>, <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a1">TCP_MODULE_ID</a>,
01280                                    <span class="stringliteral">"TCP_InitializePassive"</span>,
01281                                    <span class="stringliteral">"Platform_RegisterReadSocket"</span>, T-&gt;<a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html#o8">LocalAddr</a>, T-&gt;<a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html#o9">LocalPort</a>, T-&gt;<a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html#o6">SocketFD</a>);
01282         <a class="code" href="../../d2/dc9/_platform_8h.html#a44">Platform_CloseAndInvalidate</a>(PS, &amp;T-&gt;<a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html#o6">SocketFD</a>);
01283         <span class="keywordflow">return</span> Status;
01284     }
01285 
01286     <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a24">TCP_InitializeParameters</a>(T);
01287 
01288     *Handle = T;
01289 
01290     <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga15a174">IPDR_OK</a>;
01291 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="TCPTransport.c::TCP_ParseAddress"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga9">IPDR_IPAddress</a> TCP_ParseAddress           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const char *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Str</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00085 {
00086     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> Bytes[4];
00087     <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga9">IPDR_IPAddress</a> Res;
00088 
00089         <span class="keywordflow">if</span>( <a class="code" href="../../d9/d0f/_exporter_console_8c.html#a0">Str</a> &amp;&amp; strlen(<a class="code" href="../../d9/d0f/_exporter_console_8c.html#a0">Str</a>) &gt; 0)
00090         sscanf(<a class="code" href="../../d9/d0f/_exporter_console_8c.html#a0">Str</a>, <span class="stringliteral">"%u.%u.%u.%u"</span>, &amp; Bytes[0], &amp; Bytes[1], &amp; Bytes[2], &amp; Bytes[3]);
00091         <span class="keywordflow">else</span>
00092                 Bytes[0] = Bytes[1] = Bytes[2] = Bytes[3] = 0;
00093     Res = (Bytes[0] &lt;&lt; 24) | (Bytes[1] &lt;&lt; 16) | (Bytes[2] &lt;&lt; 8) | Bytes[3];
00094     <span class="keywordflow">return</span> Res;
00095 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="TCPTransport.c::TCP_PrintAddress"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">char* TCP_PrintAddress           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga9">IPDR_IPAddress</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Addr</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>AddressStr</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00098 {
00099     <span class="comment">/* Or use inet_ntoa() */</span>
00100     sprintf(AddressStr, <span class="stringliteral">"%u.%u.%u.%u"</span>,
00101             (Addr&gt;&gt;24) &amp; 0xffu,
00102             (Addr&gt;&gt;16) &amp; 0xffu,
00103             (Addr&gt;&gt; 8) &amp; 0xffu,
00104             (Addr&gt;&gt; 0) &amp; 0xffu);
00105 
00106     <span class="keywordflow">return</span> AddressStr;
00107 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a18" doxytag="TCPTransport.c::TCP_PrintAddressAndPort"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">char* TCP_PrintAddressAndPort           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga9">IPDR_IPAddress</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Addr</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>unsigned int&nbsp;</td>
          <td class="mdname" nowrap> <em>Port</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>AddressStr</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00110 {
00111     <span class="comment">/* Or use inet_ntoa() */</span>
00112     sprintf(AddressStr, <span class="stringliteral">"%d.%d.%d.%d:%u"</span>,
00113             (Addr&gt;&gt;24) &amp; 0xff,
00114             (Addr&gt;&gt;16) &amp; 0xff,
00115             (Addr&gt;&gt; 8) &amp; 0xff,
00116             (Addr&gt;&gt; 0) &amp; 0xff,
00117             Port);
00118 
00119     <span class="keywordflow">return</span> AddressStr;
00120 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a21" doxytag="TCPTransport.c::TCP_PrintConnectionFull"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">char* TCP_PrintConnectionFull           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>C</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>AddressStr</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00151 {
00152         <span class="comment">/* Or use inet_ntoa() */</span>
00153     sprintf(AddressStr, <span class="stringliteral">"%d.%d.%d.%d:%u(%d.%d.%d.%d)-&gt;%d.%d.%d.%d:%u"</span>,
00154             (C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o1">RemoteAddr</a>&gt;&gt;24) &amp; 0xff,
00155             (C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o1">RemoteAddr</a>&gt;&gt;16) &amp; 0xff,
00156             (C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o1">RemoteAddr</a>&gt;&gt; 8) &amp; 0xff,
00157             (C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o1">RemoteAddr</a>&gt;&gt; 0) &amp; 0xff,
00158             C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o2">RemotePort</a>,
00159                         (C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o5">DummyAddr</a>&gt;&gt;24) &amp; 0xff,
00160             (C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o5">DummyAddr</a>&gt;&gt;16) &amp; 0xff,
00161             (C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o5">DummyAddr</a>&gt;&gt; 8) &amp; 0xff,
00162             (C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o5">DummyAddr</a>&gt;&gt; 0) &amp; 0xff,
00163                         (C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o3">LocaleAddr</a>&gt;&gt;24) &amp; 0xff,
00164             (C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o3">LocaleAddr</a>&gt;&gt;16) &amp; 0xff,
00165             (C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o3">LocaleAddr</a>&gt;&gt; 8) &amp; 0xff,
00166             (C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o3">LocaleAddr</a>&gt;&gt; 0) &amp; 0xff,
00167             C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o4">LocalePort</a>);
00168 
00169     <span class="keywordflow">return</span> AddressStr;
00170 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a20" doxytag="TCPTransport.c::TCP_PrintConnectionLocale"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">char* TCP_PrintConnectionLocale           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>C</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>AddressStr</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00139 {
00140         <span class="comment">/* Or use inet_ntoa() */</span>
00141     sprintf(AddressStr, <span class="stringliteral">"%d.%d.%d.%d:%u"</span>,
00142             (C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o3">LocaleAddr</a>&gt;&gt;24) &amp; 0xff,
00143             (C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o3">LocaleAddr</a>&gt;&gt;16) &amp; 0xff,
00144             (C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o3">LocaleAddr</a>&gt;&gt; 8) &amp; 0xff,
00145             (C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o3">LocaleAddr</a>&gt;&gt; 0) &amp; 0xff,
00146             C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o4">LocalePort</a>);
00147 
00148     <span class="keywordflow">return</span> AddressStr;
00149 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a19" doxytag="TCPTransport.c::TCP_PrintConnectionRemote"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">char* TCP_PrintConnectionRemote           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>C</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>AddressStr</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00123 {
00124         <span class="comment">/* Or use inet_ntoa() */</span>
00125     sprintf(AddressStr, <span class="stringliteral">"%d.%d.%d.%d:%u(%d.%d.%d.%d)"</span>,
00126             (C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o1">RemoteAddr</a>&gt;&gt;24) &amp; 0xff,
00127             (C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o1">RemoteAddr</a>&gt;&gt;16) &amp; 0xff,
00128             (C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o1">RemoteAddr</a>&gt;&gt; 8) &amp; 0xff,
00129             (C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o1">RemoteAddr</a>&gt;&gt; 0) &amp; 0xff,
00130             C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o2">RemotePort</a>,
00131                         (C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o5">DummyAddr</a>&gt;&gt;24) &amp; 0xff,
00132             (C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o5">DummyAddr</a>&gt;&gt;16) &amp; 0xff,
00133             (C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o5">DummyAddr</a>&gt;&gt; 8) &amp; 0xff,
00134             (C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o5">DummyAddr</a>&gt;&gt; 0) &amp; 0xff);
00135 
00136     <span class="keywordflow">return</span> AddressStr;
00137 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a35" doxytag="TCPTransport.c::TCP_Receive"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a> TCP_Receive           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>C</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>Timeout</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html">BufferHandle</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>BH</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Receives a buffer from a connection.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>C</em>&nbsp;</td><td>connection to send through </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Timeout</em>&nbsp;</td><td>receive timeout (not supported) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>BH</em>&nbsp;</td><td>received buffer (output)</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga15a174">IPDR_OK</a> on success; <a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga15">IPDR_STATUS_RETURN_CODE</a> otherwise.</dd></dl>
++TC-&gt;InUseCount;<p>
--TC-&gt;InUseCount; <div class="fragment"><pre class="fragment">01478 {
01479     <a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">TCPConnection</a> *TC = <span class="comment">/*(TCPConnection *)*/</span> C;
01480     <a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html">TCPTransport</a> *T = <span class="comment">/*(TCPTransport *)*/</span> TC-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o13">Transport</a>;
01481 
01482     MessageHeader Header;
01483     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> MessageLength;
01484     <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a> Status;
01485 
01486     <span class="keywordflow">if</span> (! <a class="code" href="../../dc/d2f/group___i_p_d_r__transitional__typedefs.html#ga2">IPDR_IsValidSocket</a>(TC-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o6">FD</a>))
01487         <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga15a188">IPDR_ERR_COMMUNICATION_ERROR</a>;
01488 
01490         Status = <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a12">TCP_ReceiveHeader</a>(     T, TC-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o6">FD</a>, Timeout, &amp;Header);
01491         <span class="keywordflow">if</span> (<a class="code" href="../../da/d39/_i_p_d_r_8h.html#a18">FAILURE</a>(Status)) {
01492                 <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a22">Log_LogPlatformConnError</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a1">TRANSPORT_LOG</a>, <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a1">TCP_MODULE_ID</a>,
01493                                      <span class="stringliteral">"TCP_Receive"</span>,
01494                                      <span class="stringliteral">"Platform_Recv"</span>, TC, Status);
01495                 <span class="keywordflow">return</span> Status;
01496         }
01497 
01498         Status = <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a13">TCP_ReceiveMsgBody</a>( C, Timeout,
01499                                         BH,
01500                                                                 &amp;Header );
01501 
01502         MessageLength = <a class="code" href="../../df/dde/_defs_8h.html#a12">IPDR_NTOHL</a>(Header.MessageLength);
01503 
01504     <span class="keywordflow">if</span> (<a class="code" href="../../da/d39/_i_p_d_r_8h.html#a18">FAILURE</a>(Status)) {
01505         <span class="comment">/* XXX should signal error event */</span>
01506         <a class="code" href="../../da/df4/_log_8h.html#a31">Log_Write3</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a2">CONNECTION_LOG</a>(TC), <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a1">TCP_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga6a169">IPDR_LEVEL_ERROR</a>, <span class="stringliteral">"TCP_Receive"</span>,
01507                    <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a14">MSG_TCP_ALLOC_RECVBUFFER_FAILED</a>,
01508                    MessageLength,
01509                    <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a40">TCP_GetConnectionInfoStr</a>(TC), <a class="code" href="../../d4/d2e/group___i_p_d_r___socket.html#ga1">Platform_SOCKET_DISPLAY</a>(TC-&gt;FD));
01511         <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a27">TCP_HandleDisconnection</a>(TC);
01512         <span class="keywordflow">return</span> Status;
01513     }
01514     <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga15a174">IPDR_OK</a>;
01515 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="TCPTransport.c::TCP_ReceiveHeader"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a> TCP_ReceiveHeader           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html">TCPTransport</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>T</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../db/d76/struct_i_p_d_r__tag___socket.html">IPDR_SocketHandle</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>FD</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>Timeout</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>MessageHeader *&nbsp;</td>
          <td class="mdname" nowrap> <em>Header</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Reads <a class="el" href="../../d4/daa/struct_message.html">Message</a> header <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>T</em>&nbsp;</td><td>- transport services </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>FD</em>&nbsp;</td><td>- socket file handle </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Timeout</em>&nbsp;</td><td>receive timeout (not supported) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Header</em>&nbsp;</td><td>- message header received (output)</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga15a174">IPDR_OK</a> on success; <a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga15">IPDR_STATUS_RETURN_CODE</a> otherwise. </dd></dl>
<div class="fragment"><pre class="fragment">01531 {
01532     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> RB, Pos ;
01533     <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a> Status;
01534     <span class="keywordtype">char</span> *Ptr;
01535 
01536     Ptr = (<span class="keywordtype">char</span> *)Header;
01537     Pos = 0;
01538 
01539     <span class="keywordflow">while</span> (Pos &lt; <span class="keyword">sizeof</span>(MessageHeader)) {
01540         Status = <a class="code" href="../../d2/dc9/_platform_8h.html#a49">Platform_Recv</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>, FD, Ptr + Pos,
01541                                <span class="keyword">sizeof</span>(MessageHeader) - Pos, Timeout, &amp; RB);
01542         <span class="keywordflow">if</span> (<a class="code" href="../../da/d39/_i_p_d_r_8h.html#a18">FAILURE</a>(Status)) {
01543             <span class="keywordflow">return</span> Status;
01544         }
01545         Pos += RB;
01546     }
01547 
01548         <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga15a174">IPDR_OK</a> ;
01549 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="TCPTransport.c::TCP_ReceiveMsgBody"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a> TCP_ReceiveMsgBody           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">TCPConnection</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>C</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>Timeout</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html">BufferHandle</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>BH</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>MessageHeader *&nbsp;</td>
          <td class="mdname" nowrap> <em>Header</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Reads rest of the message after reading message header<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>C</em>&nbsp;</td><td>connection to send through </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Timeout</em>&nbsp;</td><td>receive timeout (not supported) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>BH</em>&nbsp;</td><td>received buffer (output) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Header</em>&nbsp;</td><td>already received message header</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga15a174">IPDR_OK</a> on success; <a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga15">IPDR_STATUS_RETURN_CODE</a> otherwise.</dd></dl>
++TC-&gt;InUseCount;<p>
--TC-&gt;InUseCount;<p>
--TC-&gt;InUseCount; <div class="fragment"><pre class="fragment">01565 {
01566     <a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">TCPConnection</a> *TC = <span class="comment">/*(TCPConnection *)*/</span> C;
01567     <a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html">TCPTransport</a> *T = <span class="comment">/*(TCPTransport *)*/</span> TC-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o13">Transport</a>;
01568 
01569     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> RB, Pos, MessageLength;
01570     <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a> Status;
01571 
01572     <span class="keywordflow">if</span> (! <a class="code" href="../../dc/d2f/group___i_p_d_r__transitional__typedefs.html#ga2">IPDR_IsValidSocket</a>(TC-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o6">FD</a>))
01573         <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga15a188">IPDR_ERR_COMMUNICATION_ERROR</a>;
01574 
01576     MessageLength = <a class="code" href="../../df/dde/_defs_8h.html#a12">IPDR_NTOHL</a>(Header-&gt;MessageLength);
01577 
01578     Status = <a class="code" href="../../d8/d51/_chunks_manager_8c.html#a19">ChunksManager_AllocateBuffer</a>(&amp; (TC-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o14">ReceivedData</a>),
01579                                           MessageLength,
01580                                           BH);
01581     <span class="keywordflow">if</span> (<a class="code" href="../../da/d39/_i_p_d_r_8h.html#a18">FAILURE</a>(Status)) {
01582         <span class="comment">/* XXX should signal error event */</span>
01583         <a class="code" href="../../da/df4/_log_8h.html#a31">Log_Write3</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a2">CONNECTION_LOG</a>(TC), <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a1">TCP_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga6a169">IPDR_LEVEL_ERROR</a>, <span class="stringliteral">"TCP_ReceiveMsgBody"</span>,
01584                    <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a14">MSG_TCP_ALLOC_RECVBUFFER_FAILED</a>,
01585                    MessageLength,
01586                    <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a40">TCP_GetConnectionInfoStr</a>(TC), <a class="code" href="../../d4/d2e/group___i_p_d_r___socket.html#ga1">Platform_SOCKET_DISPLAY</a>(TC-&gt;FD));
01587         <span class="keywordflow">return</span> Status;
01588     }
01589 
01590     memcpy(BH-&gt;<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a>, &amp; Header, <span class="keyword">sizeof</span>(MessageHeader));
01591     MessageLength -= <span class="keyword">sizeof</span>(MessageHeader);
01592     Pos = 0;
01593 
01594     <span class="keywordflow">while</span> (Pos &lt; MessageLength) {
01595         Status = <a class="code" href="../../d2/dc9/_platform_8h.html#a49">Platform_Recv</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>, TC-&gt;FD,
01596                                BH-&gt;<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a> + Pos + <span class="keyword">sizeof</span>(MessageHeader),
01597                                MessageLength - Pos, Timeout, &amp; RB);
01598         <span class="keywordflow">if</span> (<a class="code" href="../../da/d39/_i_p_d_r_8h.html#a18">FAILURE</a>(Status)) {
01599             <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a22">Log_LogPlatformConnError</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a1">TRANSPORT_LOG</a>, <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a1">TCP_MODULE_ID</a>,
01600                                      <span class="stringliteral">"TCP_ReceiveMsgBody"</span>,
01601                                      <span class="stringliteral">"Platform_Recv"</span>, TC, Status);
01603             <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga15a188">IPDR_ERR_COMMUNICATION_ERROR</a>;
01604         }
01605         Pos += RB;
01606     }
01607 
01608     <a class="code" href="../../da/df4/_log_8h.html#a31">Log_Write3</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a1">TRANSPORT_LOG</a>, <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a1">TCP_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga6a172">IPDR_LEVEL_DEBUG</a>, <span class="stringliteral">"TCP_Receive"</span>,
01609                <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a5">MSG_TCP_RECEIVE</a>,
01610                <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a40">TCP_GetConnectionInfoStr</a>(TC),
01611                MessageLength, <a class="code" href="../../d4/d2e/group___i_p_d_r___socket.html#ga1">Platform_SOCKET_DISPLAY</a>(TC-&gt;FD));
01612 
01614     <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga15a174">IPDR_OK</a>;
01615 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a43" doxytag="TCPTransport.c::TCP_Reconfigure"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a> TCP_Reconfigure           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html">Transport</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>TH</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
reconfigure the transport parameters<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>TH</em>&nbsp;</td><td>transport</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga15a174">IPDR_OK</a> on success; <a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga15">IPDR_STATUS_RETURN_CODE</a> otherwise. </dd></dl>
<div class="fragment"><pre class="fragment">01827 {
01828     <a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html">TCPTransport</a> *T = <span class="comment">/*(TCPTransport *)*/</span> TH;
01829     <a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">TCPConnection</a> *C;
01830 
01831     <span class="keywordflow">if</span> (! T) {
01832         <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga15a174">IPDR_OK</a>;
01833     }
01834 
01835     <span class="keywordflow">for</span> (C = T-&gt;<a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html#o3">Connections</a>; C != NULL; C = C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o12">NextConnection</a>) {
01836         <a class="code" href="../../d8/d51/_chunks_manager_8c.html#a17">ChunksManager_Reconfigure</a>(&amp; (C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o14">ReceivedData</a>),
01837                                   <a class="code" href="../../de/d8f/_configuration_names_8h.html#a178">STR_configuration_transport_tcpTransport_dataRcvChunkSize</a>,
01838                                   <a class="code" href="../../de/d8f/_configuration_names_8h.html#a179">STR_configuration_transport_tcpTransport_dataRcvInitialNumChunks</a>,
01839                                   <a class="code" href="../../de/d8f/_configuration_names_8h.html#a180">STR_configuration_transport_tcpTransport_dataRcvMaxMemory</a>,
01840                                   &amp; (T-&gt;<a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html#o10">ParamsHandler</a>));
01841         <a class="code" href="../../d8/d51/_chunks_manager_8c.html#a17">ChunksManager_Reconfigure</a>(&amp; (C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o15">SentData</a>),
01842                                   <a class="code" href="../../de/d8f/_configuration_names_8h.html#a181">STR_configuration_transport_tcpTransport_dataSndChunkSize</a>,
01843                                   <a class="code" href="../../de/d8f/_configuration_names_8h.html#a182">STR_configuration_transport_tcpTransport_dataSndInitialNumChunks</a>,
01844                                   <a class="code" href="../../de/d8f/_configuration_names_8h.html#a183">STR_configuration_transport_tcpTransport_dataSndMaxMemory</a>,
01845                                   &amp; (T-&gt;<a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html#o10">ParamsHandler</a>));
01846         <a class="code" href="../../d8/d51/_chunks_manager_8c.html#a17">ChunksManager_Reconfigure</a>(&amp; (C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o16">SendBuffers</a>),
01847                                   <a class="code" href="../../de/d8f/_configuration_names_8h.html#a184">STR_configuration_transport_tcpTransport_sendBuffersChunkSize</a>,
01848                                   <a class="code" href="../../de/d8f/_configuration_names_8h.html#a185">STR_configuration_transport_tcpTransport_sendBuffersInitialNumChunks</a>,
01849                                   <a class="code" href="../../de/d8f/_configuration_names_8h.html#a186">STR_configuration_transport_tcpTransport_sendBuffersMaxMemory</a>,
01850                                   &amp; (T-&gt;<a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html#o10">ParamsHandler</a>));
01851     }
01852 
01853     <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a24">TCP_InitializeParameters</a>(T);
01854 
01855     <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga15a174">IPDR_OK</a>;
01856 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a37" doxytag="TCPTransport.c::TCP_ResetConnection"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a> TCP_ResetConnection           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>C</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Empties any internal buffers used for sending data on the connection<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>C</em>&nbsp;</td><td>connection to change handlers of.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga15a174">IPDR_OK</a> on success; <a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga15">IPDR_STATUS_RETURN_CODE</a> otherwise. </dd></dl>
<div class="fragment"><pre class="fragment">01687 {
01688     <a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">TCPConnection</a> *TC = <span class="comment">/*(TCPConnection *)*/</span> C;
01689     <a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html">TCPTransport</a> *T = <span class="comment">/*(TCPTransport *)*/</span> TC-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o13">Transport</a>;
01690 
01691     <a class="code" href="../../d8/d51/_chunks_manager_8c.html#a31">ChunksManager_FreeAllChunks</a>(&amp; (TC-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o15">SentData</a>));
01692     <a class="code" href="../../d8/d51/_chunks_manager_8c.html#a31">ChunksManager_FreeAllChunks</a>(&amp; (TC-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o16">SendBuffers</a>));
01693 
01694     <a class="code" href="../../d2/dc9/_platform_8h.html#a17">Platform_UnregisterSocketAndClear</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>, &amp;TC-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o8">WriteEventID</a>);
01695 
01696     <span class="comment">/* This clears only outgoing data ... don't unregister TC-&gt;ReadEventID */</span>
01697 
01698     <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga15a174">IPDR_OK</a>;
01699 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a34" doxytag="TCPTransport.c::TCP_Send"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a> TCP_Send           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>C</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html">BufferHandle</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>BH</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../df/dde/_defs_8h.html#a16">IPDR_BOOL</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Immediate</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Sends a buffer through a TCP connection (the write operation is non blocking and any data which can't be written will be queued).<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>C</em>&nbsp;</td><td>connection to send through </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>BH</em>&nbsp;</td><td>buffer to send </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Immediate</em>&nbsp;</td><td>whether or not to send immediately or try to combine into a larger buffer (recommend this should be TRUE because underlying TCP stack should try to combine (waiting up to 200ms).</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga15a174">IPDR_OK</a> on success; <a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga15">IPDR_STATUS_RETURN_CODE</a> otherwise.</dd></dl>
--TC-&gt;InUseCount;<p>
--TC-&gt;InUseCount;<p>
--TC-&gt;InUseCount;<p>
--TC-&gt;InUseCount;<p>
--TC-&gt;InUseCount;<p>
--TC-&gt;InUseCount;<p>
--TC-&gt;InUseCount;<p>
--TC-&gt;InUseCount; <div class="fragment"><pre class="fragment">01358 {
01359     <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a> Status;
01360     MessageHeader Header;
01361     <a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html">BufferHandle</a> SBH;
01362     <a class="code" href="../../d3/db2/struct_t_c_p_send_buffer.html">TCPSendBuffer</a> *SB;
01363     <span class="keywordtype">int</span> BufferLength;
01364 
01365     <a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">TCPConnection</a> *TC = <span class="comment">/*(TCPConnection *)*/</span> C;
01366 
01367         memcpy(&amp;Header, BH-&gt;<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a>,<span class="keyword">sizeof</span>(MessageHeader));
01368     BufferLength = <a class="code" href="../../df/dde/_defs_8h.html#a12">IPDR_NTOHL</a>(Header.MessageLength);
01369 
01370     <span class="comment">/*** ++TC-&gt;InUseCount; ***/</span>
01371 
01372     <a class="code" href="../../da/df4/_log_8h.html#a31">Log_Write3</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a2">CONNECTION_LOG</a>(TC), <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a1">TCP_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga6a172">IPDR_LEVEL_DEBUG</a>, <span class="stringliteral">"TCP_Send"</span>,
01373                <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a6">MSG_TCP_SEND</a>,
01374                <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a40">TCP_GetConnectionInfoStr</a>(TC),
01375                BufferLength, <a class="code" href="../../d4/d2e/group___i_p_d_r___socket.html#ga1">Platform_SOCKET_DISPLAY</a>(TC-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o6">FD</a>));
01376 
01377     <span class="comment">/* check if the current list of send buffers is empty, if it is, create</span>
01378 <span class="comment">       a new SendBuffer and set it to point to the current buffer */</span>
01379     <a class="code" href="../../d8/d51/_chunks_manager_8c.html#a33">ChunksManager_GetLastBuffer</a>(&amp; (TC-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o16">SendBuffers</a>),
01380                                 <span class="keyword">sizeof</span>(<a class="code" href="../../d3/db2/struct_t_c_p_send_buffer.html">TCPSendBuffer</a>), &amp; SBH);
01381     <span class="keywordflow">if</span> (<a class="code" href="../../db/d10/_chunks_manager_8h.html#a2">BUFFER_IS_NULL</a>(SBH)) {
01382         Status = <a class="code" href="../../d8/d51/_chunks_manager_8c.html#a19">ChunksManager_AllocateBuffer</a>(&amp; (TC-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o16">SendBuffers</a>),
01383                                               <span class="keyword">sizeof</span>(<a class="code" href="../../d3/db2/struct_t_c_p_send_buffer.html">TCPSendBuffer</a>),
01384                                               &amp; SBH);
01385         <span class="keywordflow">if</span> (<a class="code" href="../../da/d39/_i_p_d_r_8h.html#a18">FAILURE</a>(Status)) {
01386             <span class="comment">/* XXX should signal error event */</span>
01387             <a class="code" href="../../da/df4/_log_8h.html#a31">Log_Write3</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a2">CONNECTION_LOG</a>(TC), <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a1">TCP_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga6a169">IPDR_LEVEL_ERROR</a>, <span class="stringliteral">"TCP_Send[1]"</span>,
01388                        <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a10">MSG_TCP_ALLOC_SENDBUFFER_FAILED</a>,
01389                        <span class="keyword">sizeof</span>(<a class="code" href="../../d3/db2/struct_t_c_p_send_buffer.html">TCPSendBuffer</a>),
01390                        <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a40">TCP_GetConnectionInfoStr</a>(TC), <a class="code" href="../../d4/d2e/group___i_p_d_r___socket.html#ga1">Platform_SOCKET_DISPLAY</a>(TC-&gt;FD));
01392             <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a27">TCP_HandleDisconnection</a>(TC);
01393             <span class="keywordflow">return</span> Status;
01394         }
01395         SB = (TCPSendBuffer *) SBH.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a>;
01396         SB-&gt;<a class="code" href="../../d3/db2/struct_t_c_p_send_buffer.html#o0">StartBuffer</a> = *BH;
01397         SB-&gt;<a class="code" href="../../d3/db2/struct_t_c_p_send_buffer.html#o1">Size</a> = BufferLength;
01398         <a class="code" href="../../da/df4/_log_8h.html#a19">Log_OutputStr3</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a2">CONNECTION_LOG</a>(TC), <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a1">TCP_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga6a172">IPDR_LEVEL_DEBUG</a>, <span class="stringliteral">"TCP_Send"</span>,
01399                        <span class="stringliteral">"buffer-null: SB-&gt;Size(%u) SB-&gt;StartBuffer.Data=0x%p, Immediate=%d"</span>,
01400                        SB-&gt;<a class="code" href="../../d3/db2/struct_t_c_p_send_buffer.html#o1">Size</a>, SB-&gt;<a class="code" href="../../d3/db2/struct_t_c_p_send_buffer.html#o0">StartBuffer</a>.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a>, Immediate);
01401 
01402         <span class="keywordflow">if</span> (! Immediate) {
01404             <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga15a174">IPDR_OK</a>;
01405         }
01406     } <span class="keywordflow">else</span> {
01407         SB = (TCPSendBuffer *) SBH.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a>;
01408         <a class="code" href="../../da/df4/_log_8h.html#a19">Log_OutputStr3</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a2">CONNECTION_LOG</a>(TC), <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a1">TCP_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga6a172">IPDR_LEVEL_DEBUG</a>, <span class="stringliteral">"TCP_Send"</span>,
01409                        <span class="stringliteral">"buffer-non-null: SB-&gt;Size(%u) SB-&gt;StartBuffer.Data=0x%p, Immediate=%d"</span>,
01410                        SB-&gt;<a class="code" href="../../d3/db2/struct_t_c_p_send_buffer.html#o1">Size</a>, SB-&gt;<a class="code" href="../../d3/db2/struct_t_c_p_send_buffer.html#o0">StartBuffer</a>.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a>, Immediate);
01411             <span class="keywordflow">if</span> (SB-&gt;<a class="code" href="../../d3/db2/struct_t_c_p_send_buffer.html#o0">StartBuffer</a>.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a> + SB-&gt;<a class="code" href="../../d3/db2/struct_t_c_p_send_buffer.html#o1">Size</a> == BH-&gt;<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a>) {
01412                 SB-&gt;<a class="code" href="../../d3/db2/struct_t_c_p_send_buffer.html#o1">Size</a> += BufferLength;
01413                 <span class="keywordflow">if</span> (! Immediate) {
01415                     <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga15a174">IPDR_OK</a>;
01416                 }
01417             } <span class="keywordflow">else</span> {
01418                 <span class="keywordflow">if</span> (! Immediate &amp;&amp; TC-&gt;WriteEventID == NULL) {
01419                     Status = <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a11">TCP_SendBuffers</a>(TC);
01420                     <span class="keywordflow">if</span> (<a class="code" href="../../da/d39/_i_p_d_r_8h.html#a18">FAILURE</a>(Status)) {
01421                         <span class="comment">/* assume that SendBuffers has already logged the error */</span>
01423                         <span class="keywordflow">return</span> Status;
01424                     }
01425                 }
01426 
01427                 Status = <a class="code" href="../../d8/d51/_chunks_manager_8c.html#a19">ChunksManager_AllocateBuffer</a>(&amp; (TC-&gt;SendBuffers),
01428                                                       <span class="keyword">sizeof</span>(TCPSendBuffer),
01429                                                       &amp; SBH);
01430                 <span class="keywordflow">if</span> (<a class="code" href="../../da/d39/_i_p_d_r_8h.html#a18">FAILURE</a>(Status)) {
01431                     <span class="comment">/* XXX should signal error event */</span>
01432                     <a class="code" href="../../da/df4/_log_8h.html#a31">Log_Write3</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a2">CONNECTION_LOG</a>(TC), <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a1">TCP_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga6a169">IPDR_LEVEL_ERROR</a>, <span class="stringliteral">"TCP_Send[2]"</span>,
01433                                <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a10">MSG_TCP_ALLOC_SENDBUFFER_FAILED</a>,
01434                                <span class="keyword">sizeof</span>(TCPSendBuffer),
01435                                <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a40">TCP_GetConnectionInfoStr</a>(TC), <a class="code" href="../../d4/d2e/group___i_p_d_r___socket.html#ga1">Platform_SOCKET_DISPLAY</a>(TC-&gt;FD));
01437                     <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a27">TCP_HandleDisconnection</a>(TC);
01438                     <span class="keywordflow">return</span> Status;
01439                 }
01440                 SB = (TCPSendBuffer *) SBH.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a>;
01441                 SB-&gt;<a class="code" href="../../d3/db2/struct_t_c_p_send_buffer.html#o0">StartBuffer</a> = *BH;
01442                 SB-&gt;<a class="code" href="../../d3/db2/struct_t_c_p_send_buffer.html#o1">Size</a> = BufferLength;
01443 
01444                 <span class="keywordflow">if</span> (! Immediate) {
01446                     <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga15a174">IPDR_OK</a>;
01447                 }
01448             }
01449     }
01450 
01451     <span class="comment">/* if there is already a write callback registered (due to a previous</span>
01452 <span class="comment">       blocking write, do nothing) and return since the callback will later</span>
01453 <span class="comment">       be invoked and the data will be sent */</span>
01454 
01455     <span class="keywordflow">if</span> (TC-&gt;WriteEventID != NULL) {
01456         <a class="code" href="../../da/df4/_log_8h.html#a18">Log_OutputStr2</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a2">CONNECTION_LOG</a>(TC), <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a1">TCP_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga6a172">IPDR_LEVEL_DEBUG</a>, <span class="stringliteral">"TCP_Send"</span>,
01457                        <span class="stringliteral">"Already has write callback (%p) %.125s"</span>, TC-&gt;WriteEventID, <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a40">TCP_GetConnectionInfoStr</a>(TC));
01459         <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga15a174">IPDR_OK</a>;
01460     }
01461 
01463     <span class="keywordflow">return</span> <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a11">TCP_SendBuffers</a>(TC);
01464 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="TCPTransport.c::TCP_SendBuffers"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static <a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a> TCP_SendBuffers           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">TCPConnection</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>C</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Send any pending data over TCP. Assumes that it is called in the context of a PlatformLock<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>C</em>&nbsp;</td><td>connection</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga15a174">IPDR_OK</a> on success; <a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga15">IPDR_STATUS_RETURN_CODE</a> otherwise. </dd></dl>
<div class="fragment"><pre class="fragment">00466 {
00467     <a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html">TCPTransport</a> *T = <span class="comment">/*(TCPTransport *)*/</span> C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o13">Transport</a>;
00468 
00469     ++C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o20">InUseCount</a>;
00470 
00471     <a class="code" href="../../da/df4/_log_8h.html#a17">Log_OutputStr1</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a1">TRANSPORT_LOG</a>, <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a1">TCP_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga6a172">IPDR_LEVEL_DEBUG</a>, <span class="stringliteral">"TCP_SendBuffers"</span>,
00472                    <span class="stringliteral">"%.120s"</span>, <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a40">TCP_GetConnectionInfoStr</a>(C));
00473 
00474     <span class="keywordflow">if</span> (<a class="code" href="../../da/df4/_log_8h.html#a15">Log_ShouldWrite</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a1">TRANSPORT_LOG</a>, <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a1">TCP_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga6a172">IPDR_LEVEL_DEBUG</a>)) {
00475         <a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html">BufferHandle</a> SBH;
00476         <a class="code" href="../../d8/d51/_chunks_manager_8c.html#a37">ChunksManager_Dump</a>(&amp;C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o16">SendBuffers</a>, <span class="stringliteral">" +++ TCP_SendBuffers (SendBuffers) +++"</span>);
00477         <a class="code" href="../../d8/d51/_chunks_manager_8c.html#a37">ChunksManager_Dump</a>(&amp;C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o15">SentData</a>, <span class="stringliteral">" +++ TCP_SendBuffers (Sent) +++"</span>);
00478         <a class="code" href="../../da/df4/_log_8h.html#a16">Log_OutputStr</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a1">TRANSPORT_LOG</a>, <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a1">TCP_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga6a172">IPDR_LEVEL_DEBUG</a>, <span class="stringliteral">"TCP_SendBuffers"</span>,
00479                       <span class="stringliteral">"+++ dumping send buffers +++"</span>);
00480         <span class="keywordflow">for</span> (<a class="code" href="../../d8/d51/_chunks_manager_8c.html#a32">ChunksManager_GetFirstBuffer</a>(&amp;C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o16">SendBuffers</a>, &amp;SBH);
00481              ! <a class="code" href="../../db/d10/_chunks_manager_8h.html#a2">BUFFER_IS_NULL</a>(SBH);
00482              <a class="code" href="../../d8/d51/_chunks_manager_8c.html#a26">ChunksManager_GetNextBuffer</a>(&amp;SBH, <span class="keyword">sizeof</span> (<a class="code" href="../../d3/db2/struct_t_c_p_send_buffer.html">TCPSendBuffer</a>), &amp;SBH)) {
00483             TCPSendBuffer *SB = (TCPSendBuffer *)SBH.Data;
00484             <span class="keyword">const</span> <span class="keywordtype">char</span> *p = SB-&gt;<a class="code" href="../../d3/db2/struct_t_c_p_send_buffer.html#o0">StartBuffer</a>.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a>;
00485             <a class="code" href="../../da/df4/_log_8h.html#a17">Log_OutputStr1</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a1">TRANSPORT_LOG</a>, <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a1">TCP_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga6a172">IPDR_LEVEL_DEBUG</a>, <span class="stringliteral">"TCP_SendBuffers"</span>,
00486                            <span class="stringliteral">"SB-&gt;Size = %d"</span>, SB-&gt;<a class="code" href="../../d3/db2/struct_t_c_p_send_buffer.html#o1">Size</a>);
00487             <span class="keywordflow">while</span> (p &lt; SB-&gt;StartBuffer.Data + SB-&gt;<a class="code" href="../../d3/db2/struct_t_c_p_send_buffer.html#o1">Size</a>) {
00488                 <span class="keyword">const</span> MessageHeader *Header = (<span class="keyword">const</span> MessageHeader *) p;
00489                 <a class="code" href="../../da/df4/_log_8h.html#a22">Log_OutputStr6</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a1">TRANSPORT_LOG</a>, <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a1">TCP_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga6a172">IPDR_LEVEL_DEBUG</a>, <span class="stringliteral">"TCP_SendBuffers"</span>,
00490                                <span class="stringliteral">"Version=%u MessageID=%u (0x%02x) MessageFlags=0x%04x SessionID=%d MessageLength=%lu"</span>,
00491                                Header-&gt;Version, Header-&gt;MessageID, Header-&gt;MessageID, Header-&gt;MessageFlags,
00492                                Header-&gt;SessionID, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)(<a class="code" href="../../df/dde/_defs_8h.html#a12">IPDR_NTOHL</a>(Header-&gt;MessageLength)));
00493                 <span class="comment">/* ProtocolDebug_PrintOutgoingMessage(TRANSPORT_LOG, C, p, IPDR_LEVEL_DEBUG); */</span>
00494                 <span class="keywordflow">if</span> (<a class="code" href="../../df/dde/_defs_8h.html#a12">IPDR_NTOHL</a>(Header-&gt;MessageLength) &lt; <span class="keyword">sizeof</span> *Header) { <span class="comment">/* sanity check */</span>
00495                     <span class="comment">/* XXX should signal error event */</span>
00496                     <a class="code" href="../../da/df4/_log_8h.html#a17">Log_OutputStr1</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a1">TRANSPORT_LOG</a>, <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a1">TCP_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga6a169">IPDR_LEVEL_ERROR</a>, <span class="stringliteral">"TCP_SendBuffers"</span>,
00497                                    <span class="stringliteral">"Bad message length: %lu"</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)(<a class="code" href="../../df/dde/_defs_8h.html#a12">IPDR_NTOHL</a>(Header-&gt;MessageLength)));
00498                     <span class="keywordflow">break</span>;
00499                 }
00500                 p += <a class="code" href="../../df/dde/_defs_8h.html#a12">IPDR_NTOHL</a>(Header-&gt;MessageLength);
00501             }
00502         }
00503         <a class="code" href="../../da/df4/_log_8h.html#a16">Log_OutputStr</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a1">TRANSPORT_LOG</a>, <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a1">TCP_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga6a172">IPDR_LEVEL_DEBUG</a>, <span class="stringliteral">"TCP_SendBuffers"</span>,
00504                       <span class="stringliteral">"+++ END dumping send buffers +++"</span>);
00505     }
00506 
00507     <span class="comment">/* send the currently queued send buffers */</span>
00508 
00509     <span class="keywordflow">for</span> (;;) {
00510         <a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html">BufferHandle</a> SBH;
00511         TCPSendBuffer *SB;
00512         <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a> Status;
00513         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> WB;
00514 
00515         <a class="code" href="../../d8/d51/_chunks_manager_8c.html#a32">ChunksManager_GetFirstBuffer</a>(&amp; (C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o16">SendBuffers</a>), &amp; SBH);
00516         <span class="keywordflow">if</span> (<a class="code" href="../../db/d10/_chunks_manager_8h.html#a2">BUFFER_IS_NULL</a>(SBH))
00517             break ;
00518 
00519         SB = (TCPSendBuffer *) SBH.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a>;
00520 
00521         <a class="code" href="../../da/df4/_log_8h.html#a19">Log_OutputStr3</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a1">TRANSPORT_LOG</a>, <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a1">TCP_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga6a172">IPDR_LEVEL_DEBUG</a>, <span class="stringliteral">"TCP_SendBuffers"</span>,
00522                        <span class="stringliteral">"send(%u)@0x%p %.99s"</span>, SB-&gt;<a class="code" href="../../d3/db2/struct_t_c_p_send_buffer.html#o1">Size</a>, SB-&gt;<a class="code" href="../../d3/db2/struct_t_c_p_send_buffer.html#o0">StartBuffer</a>.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a>, <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a40">TCP_GetConnectionInfoStr</a>(C));
00523 
00524         Status = <a class="code" href="../../d2/dc9/_platform_8h.html#a48">Platform_Send</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>, C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o6">FD</a>,
00525                                SB-&gt;<a class="code" href="../../d3/db2/struct_t_c_p_send_buffer.html#o0">StartBuffer</a>.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a>, SB-&gt;<a class="code" href="../../d3/db2/struct_t_c_p_send_buffer.html#o1">Size</a>, &amp; WB);
00526 
00527         <a class="code" href="../../da/df4/_log_8h.html#a19">Log_OutputStr3</a>(TRANSPORT_LOG, <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a1">TCP_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga6a172">IPDR_LEVEL_DEBUG</a>, <span class="stringliteral">"TCP_SendBuffers"</span>,
00528                        <span class="stringliteral">"send(%u) wrote %u bytes with rc(%.99s)"</span>,
00529                        SB-&gt;<a class="code" href="../../d3/db2/struct_t_c_p_send_buffer.html#o1">Size</a>, WB, <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_StatusMsg</a>(NULL, Status));
00530 
00531         <span class="keywordflow">if</span> (<a class="code" href="../../da/d39/_i_p_d_r_8h.html#a18">FAILURE</a>(Status)) {
00532             <span class="comment">/* XXX should signal error event */</span>
00533             <a class="code" href="../../da/df4/_log_8h.html#a31">Log_Write3</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a2">CONNECTION_LOG</a>(C), <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a1">TCP_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga6a169">IPDR_LEVEL_ERROR</a>, <span class="stringliteral">"TCP_SendBuffers"</span>,
00534                        <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a9">MSG_TCP_SEND_FAILED</a>,
00535                        <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a40">TCP_GetConnectionInfoStr</a>(C),
00536                        <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_StatusMsg</a>(NULL, Status), <a class="code" href="../../d4/d2e/group___i_p_d_r___socket.html#ga1">Platform_SOCKET_DISPLAY</a>(C-&gt;FD));
00537             --C-&gt;InUseCount;
00538             <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a27">TCP_HandleDisconnection</a>(C);
00539             <span class="keywordflow">return</span> Status;
00540         }
00541 
00542         <span class="keywordflow">if</span> (WB &lt; SB-&gt;Size) {
00543 
00544             <span class="comment">/* if the transport is responsible for releasing the chunks,</span>
00545 <span class="comment">               release the sent bytes */</span>
00546             <span class="keywordflow">if</span> (<a class="code" href="../../db/d10/_chunks_manager_8h.html#a3">BUFFER_TAGS</a>(SB-&gt;<a class="code" href="../../d3/db2/struct_t_c_p_send_buffer.html#o0">StartBuffer</a>) &amp; <a class="code" href="../../db/d10/_chunks_manager_8h.html#a1">CHUNK_TAG_RELEASE_AFTER_SEND</a>) {
00547                 <a class="code" href="../../d8/d51/_chunks_manager_8c.html#a24">ChunksManager_ReleaseBuffer</a>(&amp; (SB-&gt;<a class="code" href="../../d3/db2/struct_t_c_p_send_buffer.html#o0">StartBuffer</a>), WB);
00548             } <span class="keywordflow">else</span> {
00549                 <a class="code" href="../../da/df4/_log_8h.html#a19">Log_OutputStr3</a>(TRANSPORT_LOG, <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a1">TCP_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga6a172">IPDR_LEVEL_DEBUG</a>, <span class="stringliteral">"TCP_SendBuffers"</span>,
00550                                <span class="stringliteral">"WB(%u) &lt; SB-&gt;Size(%u) SB-&gt;StartBuffer.Data=0x%p"</span>,
00551                                WB, SB-&gt;<a class="code" href="../../d3/db2/struct_t_c_p_send_buffer.html#o1">Size</a>, SB-&gt;<a class="code" href="../../d3/db2/struct_t_c_p_send_buffer.html#o0">StartBuffer</a>.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a>)
00552                     SB-&gt;StartBuffer.Data += WB;
00553                 SB-&gt;Size -= WB;
00554                 <a class="code" href="../../da/df4/_log_8h.html#a18">Log_OutputStr2</a>(TRANSPORT_LOG, <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a1">TCP_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga6a172">IPDR_LEVEL_DEBUG</a>, "<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a11">TCP_SendBuffers</a>",
00555                                " ... becomes SB-&gt;Size(%u) SB-&gt;StartBuffer.Data=0x%p",
00556                                SB-&gt;Size, SB-&gt;StartBuffer.Data);
00557                     }
00558 
00559             if (C-&gt;WriteEventID == NULL) {
00560 <span class="preprocessor">#ifdef TRACE_MAINFUNC</span>
00561 <span class="preprocessor"></span>                fprintf(stderr, <span class="stringliteral">"RegisterWriteSocket "</span> <a class="code" href="../../d4/d2e/group___i_p_d_r___socket.html#ga0">Platform_SOCKET_FMT</a> <span class="stringliteral">" [SendBuffers] ConnectionCallback\n"</span>, <a class="code" href="../../d4/d2e/group___i_p_d_r___socket.html#ga1">Platform_SOCKET_DISPLAY</a>(C-&gt;FD)); fflush(stderr);
00562 <span class="preprocessor">#endif</span>
00563 <span class="preprocessor"></span>                <a class="code" href="../../d2/dc9/_platform_8h.html#a15">Platform_RegisterWriteSocket</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>, C-&gt;FD,
00564                                              <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a10">TCP_ConnectionWriteCallback</a>, C,
00565                                              &amp; (C-&gt;WriteEventID));
00566             } <span class="keywordflow">else</span> {
00567 <span class="preprocessor">#ifdef TRACE_MAINFUNC</span>
00568 <span class="preprocessor"></span>                fprintf(stderr, <span class="stringliteral">"(null)WriteSocket "</span> <a class="code" href="../../d4/d2e/group___i_p_d_r___socket.html#ga0">Platform_SOCKET_FMT</a> <span class="stringliteral">" [SendBuffers] ConnectionCallback\n"</span>, <a class="code" href="../../d4/d2e/group___i_p_d_r___socket.html#ga1">Platform_SOCKET_DISPLAY</a>(C-&gt;FD)); fflush(stderr);
00569 <span class="preprocessor">#endif</span>
00570 <span class="preprocessor"></span>            }
00571 
00572             --C-&gt;InUseCount;
00573             <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga15a174">IPDR_OK</a>;
00574         }
00575 
00576         <span class="comment">/* release the send buffer if it was completely sent */</span>
00577         <span class="keywordflow">if</span> (<a class="code" href="../../db/d10/_chunks_manager_8h.html#a3">BUFFER_TAGS</a>(SB-&gt;<a class="code" href="../../d3/db2/struct_t_c_p_send_buffer.html#o0">StartBuffer</a>) &amp; CHUNK_TAG_RELEASE_AFTER_SEND) {
00578             <a class="code" href="../../d8/d51/_chunks_manager_8c.html#a24">ChunksManager_ReleaseBuffer</a>(&amp; (SB-&gt;<a class="code" href="../../d3/db2/struct_t_c_p_send_buffer.html#o0">StartBuffer</a>), SB-&gt;<a class="code" href="../../d3/db2/struct_t_c_p_send_buffer.html#o1">Size</a>);
00579         } <span class="keywordflow">else</span> {
00580             <a class="code" href="../../da/df4/_log_8h.html#a19">Log_OutputStr3</a>(TRANSPORT_LOG, TCP_MODULE_ID, IPDR_LEVEL_DEBUG, <span class="stringliteral">"TCP_SendBuffers"</span>,
00581                            <span class="stringliteral">"WB(%u) == SB-&gt;Size(%u) SB-&gt;StartBuffer.Data=0x%p"</span>,
00582                            WB, SB-&gt;<a class="code" href="../../d3/db2/struct_t_c_p_send_buffer.html#o1">Size</a>, SB-&gt;<a class="code" href="../../d3/db2/struct_t_c_p_send_buffer.html#o0">StartBuffer</a>.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a>)
00583                 SB-&gt;StartBuffer.Data += SB-&gt;Size;
00584             SB-&gt;Size = 0;
00585             <a class="code" href="../../da/df4/_log_8h.html#a18">Log_OutputStr2</a>(TRANSPORT_LOG, TCP_MODULE_ID, IPDR_LEVEL_DEBUG, "TCP_SendBuffers",
00586                            " ... becomes SB-&gt;Size(%u) SB-&gt;StartBuffer.Data=0x%p",
00587                            SB-&gt;Size, SB-&gt;StartBuffer.Data);
00588                 }
00589 
00590         <a class="code" href="../../d8/d51/_chunks_manager_8c.html#a24">ChunksManager_ReleaseBuffer</a>(&amp; SBH, sizeof(TCPSendBuffer));
00591     }
00592 
00593     <a class="code" href="../../d2/dc9/_platform_8h.html#a17">Platform_UnregisterSocketAndClear</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>, &amp;C-&gt;WriteEventID);
00594 
00595     --C-&gt;InUseCount;
00596     return <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga15a174">IPDR_OK</a>;
00597 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a38" doxytag="TCPTransport.c::TCP_SetConnectionHandlers"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a> TCP_SetConnectionHandlers           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>C</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../db/dcd/struct_i_p_d_r__tag___connection_handlers.html">ConnectionHandlers</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>Handlers</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>void *&nbsp;</td>
          <td class="mdname" nowrap> <em>Arg</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Changes the connection handlers associated with a connection<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>C</em>&nbsp;</td><td>connection to change handlers of. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Handlers</em>&nbsp;</td><td>new connection handlers </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Arg</em>&nbsp;</td><td>new argument</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga15a174">IPDR_OK</a> on success; <a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga15">IPDR_STATUS_RETURN_CODE</a> otherwise. </dd></dl>
<div class="fragment"><pre class="fragment">01714 {
01715     <a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">TCPConnection</a> *TC = <span class="comment">/*(TCPConnection *)*/</span> C;
01716     TC-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o9">Handlers</a> = Handlers;
01717     TC-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o10">Arg</a> = Arg;
01718     <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga15a174">IPDR_OK</a>;
01719 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a33" doxytag="TCPTransport.c::TCP_Shutdown"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a> TCP_Shutdown           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html">Transport</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Handle</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Shutdown a transport.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>Handle</em>&nbsp;</td><td>transport handle</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga15a174">IPDR_OK</a> on success; <a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga15">IPDR_STATUS_RETURN_CODE</a> otherwise. </dd></dl>
<div class="fragment"><pre class="fragment">01301 {
01302     <a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html">TCPTransport</a> *T = <span class="comment">/*(TCPTransport *)*/</span> Handle;
01303     <a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">TCPConnection</a> *C1, *C;
01304 
01305     <span class="keywordflow">if</span> (T == NULL) {
01306         <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga15a174">IPDR_OK</a>;
01307     }
01308 
01309     C = <span class="comment">/*(TCPConnection *)*/</span> T-&gt;<a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html#o3">Connections</a>;
01310 
01311     <span class="comment">/* Note: no check is done for C-&gt;InUseCount ... this code should</span>
01312 <span class="comment">       only be used when doing a final cleanup. */</span>
01313 
01314     <span class="keywordflow">while</span> (C != NULL) {
01315         C1 = C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o12">NextConnection</a>;
01316         <a class="code" href="../../da/df4/_log_8h.html#a30">Log_Write2</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a1">TRANSPORT_LOG</a>, <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a1">TCP_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga6a172">IPDR_LEVEL_DEBUG</a>, <span class="stringliteral">"TCP_Shutdown"</span>,
01317                    <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a8">MSG_TCP_CLOSE</a>, <a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a40">TCP_GetConnectionInfoStr</a>(C), <a class="code" href="../../d4/d2e/group___i_p_d_r___socket.html#ga1">Platform_SOCKET_DISPLAY</a>(C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o6">FD</a>));
01318         <a class="code" href="../../d2/dc9/_platform_8h.html#a17">Platform_UnregisterSocketAndClear</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>, &amp;C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o7">ReadEventID</a>);
01319         <a class="code" href="../../d2/dc9/_platform_8h.html#a17">Platform_UnregisterSocketAndClear</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>, &amp;C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o8">WriteEventID</a>);
01320         <a class="code" href="../../d2/dc9/_platform_8h.html#a44">Platform_CloseAndInvalidate</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>, &amp;C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o6">FD</a>);
01321         <a class="code" href="../../d8/d51/_chunks_manager_8c.html#a18">ChunksManager_Destroy</a>(&amp; (C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o14">ReceivedData</a>));
01322         <a class="code" href="../../d8/d51/_chunks_manager_8c.html#a18">ChunksManager_Destroy</a>(&amp; (C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o15">SentData</a>));
01323         <a class="code" href="../../d8/d51/_chunks_manager_8c.html#a18">ChunksManager_Destroy</a>(&amp; (C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o16">SendBuffers</a>));
01324         strncpy(C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o0">eyecatcher</a>, <span class="stringliteral">"Dtcpcon"</span>, <span class="keyword">sizeof</span> C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o0">eyecatcher</a>);
01325         <a class="code" href="../../d2/dc9/_platform_8h.html#a20">Platform_MemoryFree</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>, C);
01326         C = C1;
01327     }
01328 
01329     <a class="code" href="../../d2/dc9/_platform_8h.html#a17">Platform_UnregisterSocketAndClear</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>, &amp;T-&gt;<a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html#o7">AcceptEventID</a>);
01330     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d2f/group___i_p_d_r__transitional__typedefs.html#ga2">IPDR_IsValidSocket</a>(T-&gt;<a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html#o6">SocketFD</a>)) {
01331         <a class="code" href="../../da/df4/_log_8h.html#a30">Log_Write2</a>(TRANSPORT_LOG, <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a1">TCP_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga6a172">IPDR_LEVEL_DEBUG</a>, <span class="stringliteral">"TCP_Shutdown"</span>,
01332                    <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a8">MSG_TCP_CLOSE</a>, <span class="stringliteral">"accept-socket"</span>, <a class="code" href="../../d4/d2e/group___i_p_d_r___socket.html#ga1">Platform_SOCKET_DISPLAY</a>(T-&gt;<a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html#o6">SocketFD</a>));
01333         <a class="code" href="../../d2/dc9/_platform_8h.html#a44">Platform_CloseAndInvalidate</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>, &amp;T-&gt;<a class="code" href="../../d5/d51/struct_i_p_d_r__tag___t_c_p_transport.html#o6">SocketFD</a>);
01334     }
01335 
01336     <a class="code" href="../../d2/dc9/_platform_8h.html#a20">Platform_MemoryFree</a>(<a class="code" href="../../d9/d9f/_t_c_p_transport_8c.html#a0">TRANSPORT_PLATFORM</a>, T);
01337 
01338     <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga15a174">IPDR_OK</a>;
01339 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="TCPTransport.c::TCPMsgs_Initialize"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a> TCPMsgs_Initialize           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../dc/d30/struct_i_p_d_r__tag___log.html">Log</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>L</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00080 {
00081     <span class="keywordflow">return</span> <a class="code" href="../../dd/d28/_log_8c.html#a17">Log_RegisterModule</a>(L, <a class="code" href="../../db/d48/_t_c_p_msgs_8h.html#a1">TCP_MODULE_ID</a>, <span class="stringliteral">"TCP"</span>);
00082 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a8" doxytag="TCPTransport.c::TCPMsgs_h_rcsid"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">const char <a class="el" href="../../d9/d9f/_t_c_p_transport_8c.html#a8">TCPMsgs_h_rcsid</a>[] = TCP_MSGS_H_RCSID          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="TCPTransport.c::TCPTransport_h_rcsid"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">const char <a class="el" href="../../d9/d9f/_t_c_p_transport_8c.html#a6">TCPTransport_h_rcsid</a>[] = TCP_TRANSPORT_H_RCSID          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="TCPTransport.c::TCPTransport_rcsid"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">const char <a class="el" href="../../d9/d9f/_t_c_p_transport_8c.html#a5">TCPTransport_rcsid</a>[] = "@(#) $Id: TCPTransport.c,v 1.31 2005/04/21 11:30:58 dmitryk Exp $" IPDR_COPYRIGHT_STR          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="TCPTransport.c::Transport_h_rcsid"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">const char <a class="el" href="../../d9/d9f/_t_c_p_transport_8c.html#a7">Transport_h_rcsid</a>[] = TRANSPORT_H_RCSID          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Mon Apr 25 22:28:24 2005 for IPDRAPI by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.2 </small></address>
</body>
</html>
