<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>IPDRAPI: ipdr/src/Exporter/ExporterProtocol.h File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.2 -->
<div class="qindex"><a class="qindex" href="../../index.html">Main&nbsp;Page</a> | <a class="qindex" href="../../modules.html">Modules</a> | <a class="qindex" href="../../namespaces.html">Namespace List</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="../../dirs.html">Directories</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="../../globals.html">Globals</a></div>
<div class="nav">
<a class="el" href="../../dir_000003.html">ipdr</a>&nbsp;/&nbsp;<a class="el" href="../../dir_000010.html">src</a>&nbsp;/&nbsp;<a class="el" href="../../dir_000013.html">Exporter</a></div>
<h1>ExporterProtocol.h File Reference</h1><code>#include &lt;<a class="el" href="../../d4/d3a/ipdr_2include_2_i_p_d_r_2_config_8h.html">IPDR/Config.h</a>&gt;</code><br>
<code>#include &lt;<a class="el" href="../../de/d8c/ipdr_2include_2_i_p_d_r_2_i_p_d_r_8h.html">IPDR/IPDR.h</a>&gt;</code><br>
<code>#include &lt;<a class="el" href="../../df/df3/ipdr_2src_2_exporter_2_exporter_8h.html">Exporter/Exporter.h</a>&gt;</code><br>
<code>#include &lt;<a class="el" href="../../df/d5f/ipdr_2src_2_common_2_memory_management_8h.html">Common/MemoryManagement.h</a>&gt;</code><br>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/dc2/ipdr_2src_2_exporter_2_exporter_protocol_8h.html#a0">EXPORTER_PROTOCOL_H_RCSID</a>&nbsp;&nbsp;&nbsp;"@(#) $Id: ExporterProtocol.h,v 1.26 2005/03/17 12:26:47 dmitryk Exp $" IPDR_COPYRIGHT_STR</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/dc2/ipdr_2src_2_exporter_2_exporter_protocol_8h.html#a1">EXPORTER_PROTOCOL_MAX_MSG</a>&nbsp;&nbsp;&nbsp;1024*32</td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_Status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/dc2/ipdr_2src_2_exporter_2_exporter_protocol_8h.html#a2">ExporterProtocol_HandleFlowStart</a> (<a class="el" href="../../df/d71/struct_i_p_d_r__tag___exporter.html">Exporter</a> *E, <a class="el" href="../../d9/d35/struct_i_p_d_r__tag___session.html">Session</a> *S, <a class="el" href="../../de/d0d/struct_i_p_d_r__tag___collector.html">Collector</a> *Coll, const MessageHeader *Msg, <a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a> Conn)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_Status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/dc2/ipdr_2src_2_exporter_2_exporter_protocol_8h.html#a3">ExporterProtocol_HandleFlowStop</a> (<a class="el" href="../../df/d71/struct_i_p_d_r__tag___exporter.html">Exporter</a> *E, <a class="el" href="../../d9/d35/struct_i_p_d_r__tag___session.html">Session</a> *S, <a class="el" href="../../de/d0d/struct_i_p_d_r__tag___collector.html">Collector</a> *Coll, const MessageHeader *Msg, <a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a> Conn)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_Status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/dc2/ipdr_2src_2_exporter_2_exporter_protocol_8h.html#a4">ExporterProtocol_HandleModifyTemplate</a> (<a class="el" href="../../df/d71/struct_i_p_d_r__tag___exporter.html">Exporter</a> *E, <a class="el" href="../../d9/d35/struct_i_p_d_r__tag___session.html">Session</a> *S, <a class="el" href="../../de/d0d/struct_i_p_d_r__tag___collector.html">Collector</a> *Coll, const MessageHeader *Msg, <a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a> Conn)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_Status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/dc2/ipdr_2src_2_exporter_2_exporter_protocol_8h.html#a5">ExporterProtocol_HandleFinalTmplDataACK</a> (<a class="el" href="../../df/d71/struct_i_p_d_r__tag___exporter.html">Exporter</a> *E, <a class="el" href="../../d9/d35/struct_i_p_d_r__tag___session.html">Session</a> *S, <a class="el" href="../../de/d0d/struct_i_p_d_r__tag___collector.html">Collector</a> *Coll, const MessageHeader *Msg, <a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a> Conn)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_Status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/dc2/ipdr_2src_2_exporter_2_exporter_protocol_8h.html#a6">ExporterProtocol_HandleStartNegotiation</a> (<a class="el" href="../../df/d71/struct_i_p_d_r__tag___exporter.html">Exporter</a> *E, <a class="el" href="../../d9/d35/struct_i_p_d_r__tag___session.html">Session</a> *S, <a class="el" href="../../de/d0d/struct_i_p_d_r__tag___collector.html">Collector</a> *Coll, const MessageHeader *Msg, <a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a> Conn)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_Status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/dc2/ipdr_2src_2_exporter_2_exporter_protocol_8h.html#a7">ExporterProtocol_HandleGetSessions</a> (<a class="el" href="../../df/d71/struct_i_p_d_r__tag___exporter.html">Exporter</a> *E, <a class="el" href="../../d9/d35/struct_i_p_d_r__tag___session.html">Session</a> *S, <a class="el" href="../../de/d0d/struct_i_p_d_r__tag___collector.html">Collector</a> *Coll, const MessageHeader *Msg, <a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a> Conn)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_Status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/dc2/ipdr_2src_2_exporter_2_exporter_protocol_8h.html#a8">ExporterProtocol_HandleGetTemplates</a> (<a class="el" href="../../df/d71/struct_i_p_d_r__tag___exporter.html">Exporter</a> *E, <a class="el" href="../../d9/d35/struct_i_p_d_r__tag___session.html">Session</a> *S, <a class="el" href="../../de/d0d/struct_i_p_d_r__tag___collector.html">Collector</a> *Coll, const MessageHeader *Msg, <a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a> Conn)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_Status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/dc2/ipdr_2src_2_exporter_2_exporter_protocol_8h.html#a9">ExporterProtocol_HandleDataACK</a> (<a class="el" href="../../df/d71/struct_i_p_d_r__tag___exporter.html">Exporter</a> *E, <a class="el" href="../../d9/d35/struct_i_p_d_r__tag___session.html">Session</a> *S, <a class="el" href="../../de/d0d/struct_i_p_d_r__tag___collector.html">Collector</a> *Coll, const MessageHeader *Msg, <a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a> Conn)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_Status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/dc2/ipdr_2src_2_exporter_2_exporter_protocol_8h.html#a10">ExporterProtocol_HandleConnect</a> (<a class="el" href="../../df/d71/struct_i_p_d_r__tag___exporter.html">Exporter</a> *E, <a class="el" href="../../d9/d35/struct_i_p_d_r__tag___session.html">Session</a> *S, <a class="el" href="../../de/d0d/struct_i_p_d_r__tag___collector.html">Collector</a> *Coll, const MessageHeader *Msg, <a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a> Conn)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_Status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/dc2/ipdr_2src_2_exporter_2_exporter_protocol_8h.html#a11">ExporterProtocol_HandleConnectResponse</a> (<a class="el" href="../../df/d71/struct_i_p_d_r__tag___exporter.html">Exporter</a> *E, <a class="el" href="../../d9/d35/struct_i_p_d_r__tag___session.html">Session</a> *S, <a class="el" href="../../de/d0d/struct_i_p_d_r__tag___collector.html">Collector</a> *Coll, const MessageHeader *Msg, <a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a> Conn)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_Status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/dc2/ipdr_2src_2_exporter_2_exporter_protocol_8h.html#a12">ExporterProtocol_HandleDisconnect</a> (<a class="el" href="../../df/d71/struct_i_p_d_r__tag___exporter.html">Exporter</a> *E, <a class="el" href="../../d9/d35/struct_i_p_d_r__tag___session.html">Session</a> *S, <a class="el" href="../../de/d0d/struct_i_p_d_r__tag___collector.html">Collector</a> *Coll, const MessageHeader *Msg, <a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a> Conn)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_Status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/dc2/ipdr_2src_2_exporter_2_exporter_protocol_8h.html#a13">ExporterProtocol_HandleError</a> (<a class="el" href="../../df/d71/struct_i_p_d_r__tag___exporter.html">Exporter</a> *E, <a class="el" href="../../d9/d35/struct_i_p_d_r__tag___session.html">Session</a> *S, <a class="el" href="../../de/d0d/struct_i_p_d_r__tag___collector.html">Collector</a> *Coll, const MessageHeader *Msg, <a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a> Conn)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_Status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/dc2/ipdr_2src_2_exporter_2_exporter_protocol_8h.html#a14">ExporterProtocol_HandleKeepAlive</a> (<a class="el" href="../../df/d71/struct_i_p_d_r__tag___exporter.html">Exporter</a> *E, <a class="el" href="../../d9/d35/struct_i_p_d_r__tag___session.html">Session</a> *S, <a class="el" href="../../de/d0d/struct_i_p_d_r__tag___collector.html">Collector</a> *Coll, const MessageHeader *Msg, <a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a> Conn)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_Status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/dc2/ipdr_2src_2_exporter_2_exporter_protocol_8h.html#a15">ExporterProtocol_HandleUnknownMsg</a> (<a class="el" href="../../df/d71/struct_i_p_d_r__tag___exporter.html">Exporter</a> *E, <a class="el" href="../../d9/d35/struct_i_p_d_r__tag___session.html">Session</a> *S, <a class="el" href="../../de/d0d/struct_i_p_d_r__tag___collector.html">Collector</a> *Coll, const MessageHeader *Msg, <a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a> Conn)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_Status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/dc2/ipdr_2src_2_exporter_2_exporter_protocol_8h.html#a16">ExporterProtocol_FillHeader</a> (<a class="el" href="../../d9/d35/struct_i_p_d_r__tag___session.html">Session</a> *S, char *Msg, unsigned char MessageID, unsigned long MessageLength)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_Status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/dc2/ipdr_2src_2_exporter_2_exporter_protocol_8h.html#a17">ExporterProtocol_FlushRecordsQueue</a> (<a class="el" href="../../df/d71/struct_i_p_d_r__tag___exporter.html">Exporter</a> *E, <a class="el" href="../../d9/d35/struct_i_p_d_r__tag___session.html">Session</a> *S, <a class="el" href="../../de/d0d/struct_i_p_d_r__tag___collector.html">Collector</a> *Coll, const char *DebugMsg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/dc2/ipdr_2src_2_exporter_2_exporter_protocol_8h.html#a18">ExporterProtocol_DisconnectCallback</a> (<a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a> C, void *Arg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/dc2/ipdr_2src_2_exporter_2_exporter_protocol_8h.html#a19">ExporterProtocol_DataCallback</a> (<a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a> C, <a class="el" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html">BufferHandle</a> *BH, unsigned int MsgLen, void *Arg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/dc2/ipdr_2src_2_exporter_2_exporter_protocol_8h.html#a20">ExporterProtocol_ConnectCallback</a> (<a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a> C, <a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga20">IPDR_IPAddress</a> Addr, unsigned short Port, void *Arg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_Status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/dc2/ipdr_2src_2_exporter_2_exporter_protocol_8h.html#a21">ExporterProtocol_SendConnect</a> (<a class="el" href="../../df/d71/struct_i_p_d_r__tag___exporter.html">Exporter</a> *E, <a class="el" href="../../d9/d35/struct_i_p_d_r__tag___session.html">Session</a> *S, <a class="el" href="../../de/d0d/struct_i_p_d_r__tag___collector.html">Collector</a> *Coll, <a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a> Conn)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_Status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/dc2/ipdr_2src_2_exporter_2_exporter_protocol_8h.html#a22">ExporterProtocol_SendConnectResponse</a> (<a class="el" href="../../df/d71/struct_i_p_d_r__tag___exporter.html">Exporter</a> *E, <a class="el" href="../../d9/d35/struct_i_p_d_r__tag___session.html">Session</a> *S, <a class="el" href="../../de/d0d/struct_i_p_d_r__tag___collector.html">Collector</a> *Coll, <a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a> Conn)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_Status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/dc2/ipdr_2src_2_exporter_2_exporter_protocol_8h.html#a23">ExporterProtocol_SendDisconnect</a> (<a class="el" href="../../df/d71/struct_i_p_d_r__tag___exporter.html">Exporter</a> *E, <a class="el" href="../../d9/d35/struct_i_p_d_r__tag___session.html">Session</a> *S, <a class="el" href="../../de/d0d/struct_i_p_d_r__tag___collector.html">Collector</a> *Coll, <a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a> Conn)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_Status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/dc2/ipdr_2src_2_exporter_2_exporter_protocol_8h.html#a24">ExporterProtocol_SendError</a> (<a class="el" href="../../df/d71/struct_i_p_d_r__tag___exporter.html">Exporter</a> *E, <a class="el" href="../../d9/d35/struct_i_p_d_r__tag___session.html">Session</a> *S, <a class="el" href="../../de/d0d/struct_i_p_d_r__tag___collector.html">Collector</a> *Coll, <a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a> Conn, enum <a class="el" href="../../d6/dbc/ipdr_2src_2_common_2_protocol_8h.html#a57">ErrorCode</a> ErrCode, const char *Msg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_Status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/dc2/ipdr_2src_2_exporter_2_exporter_protocol_8h.html#a25">ExporterProtocol_SendKeepAlive</a> (<a class="el" href="../../df/d71/struct_i_p_d_r__tag___exporter.html">Exporter</a> *E, <a class="el" href="../../d9/d35/struct_i_p_d_r__tag___session.html">Session</a> *S, <a class="el" href="../../de/d0d/struct_i_p_d_r__tag___collector.html">Collector</a> *Coll, <a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a> Conn)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_Status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/dc2/ipdr_2src_2_exporter_2_exporter_protocol_8h.html#a26">ExporterProtocol_SendSessionStart</a> (<a class="el" href="../../df/d71/struct_i_p_d_r__tag___exporter.html">Exporter</a> *E, <a class="el" href="../../d9/d35/struct_i_p_d_r__tag___session.html">Session</a> *S, <a class="el" href="../../de/d0d/struct_i_p_d_r__tag___collector.html">Collector</a> *Coll, <a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a> Conn)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_Status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/dc2/ipdr_2src_2_exporter_2_exporter_protocol_8h.html#a27">ExporterProtocol_SendSessionStop</a> (<a class="el" href="../../df/d71/struct_i_p_d_r__tag___exporter.html">Exporter</a> *E, <a class="el" href="../../d9/d35/struct_i_p_d_r__tag___session.html">Session</a> *S, <a class="el" href="../../de/d0d/struct_i_p_d_r__tag___collector.html">Collector</a> *Coll, <a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a> Conn, unsigned short reasonCode, const char *ReasonDescripsion)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_Status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/dc2/ipdr_2src_2_exporter_2_exporter_protocol_8h.html#a28">ExporterProtocol_SendTemplateData</a> (<a class="el" href="../../df/d71/struct_i_p_d_r__tag___exporter.html">Exporter</a> *E, <a class="el" href="../../d9/d35/struct_i_p_d_r__tag___session.html">Session</a> *S, <a class="el" href="../../de/d0d/struct_i_p_d_r__tag___collector.html">Collector</a> *Coll, <a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a> Conn, <a class="el" href="../../dc/d02/ipdr_2include_2_i_p_d_r_2_defs_8h.html#a16">IPDR_BOOL</a> negotiatible)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_Status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/dc2/ipdr_2src_2_exporter_2_exporter_protocol_8h.html#a29">ExporterProtocol_SendModifyTemplateResponse</a> (<a class="el" href="../../df/d71/struct_i_p_d_r__tag___exporter.html">Exporter</a> *E, <a class="el" href="../../d9/d35/struct_i_p_d_r__tag___session.html">Session</a> *S, <a class="el" href="../../de/d0d/struct_i_p_d_r__tag___collector.html">Collector</a> *Coll, <a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a> Conn)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_Status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/dc2/ipdr_2src_2_exporter_2_exporter_protocol_8h.html#a30">ExporterProtocol_SendStartNegotiationReject</a> (<a class="el" href="../../df/d71/struct_i_p_d_r__tag___exporter.html">Exporter</a> *E, <a class="el" href="../../d9/d35/struct_i_p_d_r__tag___session.html">Session</a> *S, <a class="el" href="../../de/d0d/struct_i_p_d_r__tag___collector.html">Collector</a> *Coll, <a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a> Conn)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_Status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/dc2/ipdr_2src_2_exporter_2_exporter_protocol_8h.html#a31">ExporterProtocol_SendGetSessionsResponse</a> (<a class="el" href="../../df/d71/struct_i_p_d_r__tag___exporter.html">Exporter</a> *E, <a class="el" href="../../d9/d35/struct_i_p_d_r__tag___session.html">Session</a> *S, <a class="el" href="../../de/d0d/struct_i_p_d_r__tag___collector.html">Collector</a> *Coll, <a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a> Conn, int RequestID)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_Status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/dc2/ipdr_2src_2_exporter_2_exporter_protocol_8h.html#a32">ExporterProtocol_SendGetTemplatesResponse</a> (<a class="el" href="../../df/d71/struct_i_p_d_r__tag___exporter.html">Exporter</a> *E, <a class="el" href="../../d9/d35/struct_i_p_d_r__tag___session.html">Session</a> *S, <a class="el" href="../../de/d0d/struct_i_p_d_r__tag___collector.html">Collector</a> *Coll, <a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a> Conn, int RequestID)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_Status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/dc2/ipdr_2src_2_exporter_2_exporter_protocol_8h.html#a33">ExporterProtocol_SendData</a> (<a class="el" href="../../df/d71/struct_i_p_d_r__tag___exporter.html">Exporter</a> *E, <a class="el" href="../../d9/d35/struct_i_p_d_r__tag___session.html">Session</a> *S, <a class="el" href="../../de/d0d/struct_i_p_d_r__tag___collector.html">Collector</a> *Coll, <a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a> Conn, <a class="el" href="../../d4/dc8/struct_i_p_d_r__tag___template_handle.html">IPDR_TemplateHandle</a> TemplateHandle, const void *Data)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/dc2/ipdr_2src_2_exporter_2_exporter_protocol_8h.html#a34">ExporterProtocol_KeepAliveOutTimerReset</a> (<a class="el" href="../../db/d4f/struct_i_p_d_r__tag___connection.html">IPDRConnection</a> *IC)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/dc2/ipdr_2src_2_exporter_2_exporter_protocol_8h.html#a35">ExporterProtocol_KeepAliveInTimerReset</a> (<a class="el" href="../../db/d4f/struct_i_p_d_r__tag___connection.html">IPDRConnection</a> *IC)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_Status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/dc2/ipdr_2src_2_exporter_2_exporter_protocol_8h.html#a36">ExporterProtocol_AutoconnectCallback</a> (<a class="el" href="../../df/d71/struct_i_p_d_r__tag___exporter.html">Exporter</a> *E, <a class="el" href="../../de/d0d/struct_i_p_d_r__tag___collector.html">Collector</a> *Coll, <a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a> C)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_Status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/dc2/ipdr_2src_2_exporter_2_exporter_protocol_8h.html#a37">ExporterProtocol_CloseTLConnection</a> (<a class="el" href="../../df/d71/struct_i_p_d_r__tag___exporter.html">Exporter</a> *E, <a class="el" href="../../db/d4f/struct_i_p_d_r__tag___connection.html">IPDRConnection</a> *IC)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_Status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/dc2/ipdr_2src_2_exporter_2_exporter_protocol_8h.html#a38">ExporterProtocol_ResetIPDRConnection</a> (<a class="el" href="../../df/d71/struct_i_p_d_r__tag___exporter.html">Exporter</a> *E, <a class="el" href="../../db/d4f/struct_i_p_d_r__tag___connection.html">IPDRConnection</a> *IC)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_Status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/dc2/ipdr_2src_2_exporter_2_exporter_protocol_8h.html#a39">ExporterProtocol_SelectCollector</a> (<a class="el" href="../../df/d71/struct_i_p_d_r__tag___exporter.html">Exporter</a> *E, <a class="el" href="../../d9/d35/struct_i_p_d_r__tag___session.html">Session</a> *S, <a class="el" href="../../dc/d02/ipdr_2include_2_i_p_d_r_2_defs_8h.html#a16">IPDR_BOOL</a> forceNegotiate, <a class="el" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html">CollectorSession</a> *forceCS)</td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a0" doxytag="ExporterProtocol.h::EXPORTER_PROTOCOL_H_RCSID"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">#define EXPORTER_PROTOCOL_H_RCSID&nbsp;&nbsp;&nbsp;"@(#) $Id: ExporterProtocol.h,v 1.26 2005/03/17 12:26:47 dmitryk Exp $" IPDR_COPYRIGHT_STR          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="ExporterProtocol.h::EXPORTER_PROTOCOL_MAX_MSG"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">#define EXPORTER_PROTOCOL_MAX_MSG&nbsp;&nbsp;&nbsp;1024*32          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a36" doxytag="ExporterProtocol.h::ExporterProtocol_AutoconnectCallback"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_Status</a> ExporterProtocol_AutoconnectCallback           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../df/d71/struct_i_p_d_r__tag___exporter.html">Exporter</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>E</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../de/d0d/struct_i_p_d_r__tag___collector.html">Collector</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>Coll</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>C</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00141 {
00142         <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a> Status;
00143         Status = <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a54">ExporterProtocol_SendConnect</a>(E, NULL, Coll, C);
00144         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d8b/_for_doxygen_2include_2_i_p_d_r_2_i_p_d_r_8h.html#a18">FAILURE</a>(Status))
00145         {
00146                 <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a31">Log_Write3</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a1">EXPORTER_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a169">IPDR_LEVEL_ERROR</a>, <span class="stringliteral">"ExporterProtocol_AutoconnectCallback"</span>,
00147                                         <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a56">MSG_EXPORTER_LOG_CONNECT_ERROR</a>,
00148                                         <span class="stringliteral">"ExporterProtocol_SendConnect"</span>, <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga22">IPDR_StatusMsg</a>(E,Status), <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a14">TL_GetConnectionInfoStr</a>(C));
00149         }
00150         <span class="keywordflow">return</span> Status;
00151 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a37" doxytag="ExporterProtocol.h::ExporterProtocol_CloseTLConnection"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_Status</a> ExporterProtocol_CloseTLConnection           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../df/d71/struct_i_p_d_r__tag___exporter.html">Exporter</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>E</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../db/d4f/struct_i_p_d_r__tag___connection.html">IPDRConnection</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>IC</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Fully closes a connection <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>E</em>&nbsp;</td><td>exporter handle </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>IC</em>&nbsp;</td><td>Contains information about a ipdr connection (IPDRConnection structure) </td></tr>
  </table>
</dl>
<div class="fragment"><pre class="fragment">03728 {
03729         <a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a> C = IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o3">TCPConnection</a>;
03730 
03731         <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a71">ExporterProtocol_ResetIPDRConnection</a>( E, IC );
03732 
03733         <span class="keywordflow">if</span>( C &amp;&amp; <a class="code" href="../../dc/d2f/group___i_p_d_r__transitional__typedefs.html#ga3">IPDR_IsValidSocket</a>(C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o6">FD</a>) )
03734                 <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a24">TL_HandleDisconnection</a>(C);
03735 
03736         <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a174">IPDR_OK</a>;
03737 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a20" doxytag="ExporterProtocol.h::ExporterProtocol_ConnectCallback"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void ExporterProtocol_ConnectCallback           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Conn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga20">IPDR_IPAddress</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Addr</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>unsigned short&nbsp;</td>
          <td class="mdname" nowrap> <em>Port</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>void *&nbsp;</td>
          <td class="mdname" nowrap> <em>Arg</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Callback invoked when a server (collector) connects.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>Conn</em>&nbsp;</td><td>connected connection </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Addr</em>&nbsp;</td><td>remove address </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Port</em>&nbsp;</td><td>remove port </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Arg</em>&nbsp;</td><td>additional argument (Server) </td></tr>
  </table>
</dl>
<div class="fragment"><pre class="fragment">00165 {
00166 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a19" doxytag="ExporterProtocol.h::ExporterProtocol_DataCallback"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void ExporterProtocol_DataCallback           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>C</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html">BufferHandle</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>BH</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>unsigned int&nbsp;</td>
          <td class="mdname" nowrap> <em>MsgLen</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>void *&nbsp;</td>
          <td class="mdname" nowrap> <em>Arg</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Callback invoked when data arrives from a server (collector)<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>C</em>&nbsp;</td><td>connection </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>BH</em>&nbsp;</td><td>buffer </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>MsgLen</em>&nbsp;</td><td>message length </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Arg</em>&nbsp;</td><td>callback argument (Server) </td></tr>
  </table>
</dl>
<div class="fragment"><pre class="fragment">00221 {
00222         <a class="code" href="../../df/d71/struct_i_p_d_r__tag___exporter.html">Exporter</a>                *E = (<a class="code" href="../../df/d71/struct_i_p_d_r__tag___exporter.html">Exporter</a> *) Arg;
00223         <a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html">Session</a>                 *S = NULL;
00224         <a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html">IPDRConnection</a>  *IC = C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o11">Owner</a>;
00225         <a class="code" href="../../de/d0d/struct_i_p_d_r__tag___collector.html">Collector</a>               *Coll ;
00226         <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a16">IPDR_BOOL</a>               needsSessionID ;
00227 
00228         <span class="comment">/*char *Buf;*/</span>
00229         <span class="keywordtype">char</span>    Buf[<a class="code" href="../../d6/d50/_for_doxygen_2src_2_exporter_2_exporter_protocol_8h.html#a1">EXPORTER_PROTOCOL_MAX_MSG</a>];
00230     MessageHeader *H;
00231         <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a28">TL_PABuf</a> paBuf;
00232 
00233     <span class="keywordflow">if</span> (BH == NULL || MsgLen == 0)
00234         return ;
00235 
00236         memcpy(Buf, BH-&gt;<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a>, MsgLen &gt; <a class="code" href="../../d6/d50/_for_doxygen_2src_2_exporter_2_exporter_protocol_8h.html#a1">EXPORTER_PROTOCOL_MAX_MSG</a> ? <a class="code" href="../../d6/d50/_for_doxygen_2src_2_exporter_2_exporter_protocol_8h.html#a1">EXPORTER_PROTOCOL_MAX_MSG</a> : MsgLen);
00237 
00238     H = (MessageHeader *) Buf;
00239 
00240         <span class="keywordflow">if</span>(IC == NULL)
00241         {
00242                 <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a31">Log_Write3</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a169">IPDR_LEVEL_ERROR</a>,
00243                                         <span class="stringliteral">"ExporterProtocol_DataCallback"</span>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a33">MSG_EXPORTER_UNEXPECTED_MSG</a>,
00244                                         <a class="code" href="../../dc/dcc/_for_doxygen_2src_2_transports_2_t_c_p_2_t_c_p_transport_8c.html#a21">TCP_PrintConnectionFull</a>(C, paBuf), H-&gt;MessageID, <span class="stringliteral">"NO CONNECTION"</span>);
00245                 <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a24">TL_HandleDisconnection</a>(C);
00246                 <a class="code" href="../../d5/d9f/_for_doxygen_2src_2_common_2_chunks_manager_8c.html#a24">ChunksManager_ReleaseBuffer</a>(BH, MsgLen);
00247                 return ;
00248         }
00249         Coll = IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o4">Owner</a>;
00250 
00251         <span class="keywordflow">if</span>(Coll == NULL)
00252         {
00253         <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a31">Log_Write3</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a169">IPDR_LEVEL_ERROR</a>,
00254                                         <span class="stringliteral">"ExporterProtocol_DataCallback"</span>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a33">MSG_EXPORTER_UNEXPECTED_MSG</a>,
00255                                         <a class="code" href="../../dc/dcc/_for_doxygen_2src_2_transports_2_t_c_p_2_t_c_p_transport_8c.html#a21">TCP_PrintConnectionFull</a>(C, paBuf), H-&gt;MessageID, <span class="stringliteral">"NO COLLECTOR"</span>);
00256                 <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a24">TL_HandleDisconnection</a>(C);
00257                 <a class="code" href="../../d5/d9f/_for_doxygen_2src_2_common_2_chunks_manager_8c.html#a24">ChunksManager_ReleaseBuffer</a>(BH, MsgLen);
00258                 return ;
00259          }
00260 
00261     <span class="comment">/*Buf = BH-&gt;Data;*/</span>
00262     <span class="keywordflow">if</span>( <a class="code" href="../../d6/d50/_for_doxygen_2src_2_exporter_2_exporter_protocol_8h.html#a1">EXPORTER_PROTOCOL_MAX_MSG</a> &lt;= MsgLen )
00263     {
00264                 <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a29">Log_Write1</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a169">IPDR_LEVEL_ERROR</a>,
00265                    <span class="stringliteral">"ExporterProtocol_DataCallback"</span>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a76">MSG_EXPORTER_MESSAGE_TOO_LONG</a>,
00266                                    <a class="code" href="../../dc/dcc/_for_doxygen_2src_2_transports_2_t_c_p_2_t_c_p_transport_8c.html#a21">TCP_PrintConnectionFull</a>(C, paBuf));
00267                 <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a24">TL_HandleDisconnection</a>(C);
00268                 <a class="code" href="../../d5/d9f/_for_doxygen_2src_2_common_2_chunks_manager_8c.html#a24">ChunksManager_ReleaseBuffer</a>(BH, MsgLen);
00269                 return ;
00270     }
00271 
00272     <span class="keywordflow">switch</span> (H-&gt;MessageID) {
00273     <span class="keywordflow">case</span> <a class="code" href="../../d2/dda/_for_doxygen_2src_2_common_2_protocol_8h.html#a39">IPDR_MSG_DATA</a>:
00274     <span class="keywordflow">case</span> <a class="code" href="../../d2/dda/_for_doxygen_2src_2_common_2_protocol_8h.html#a26">IPDR_MSG_DATA_ACK</a>:
00275                 <span class="comment">/*case IPDR_MSG_KEEP_ALIVE:*/</span>
00276         <span class="comment">/* case IPDR_MSG_DATA_NACK:*/</span>
00277         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a15">Log_ShouldWrite</a>(&amp;E-&gt;<a class="code" href="../../df/d71/struct_i_p_d_r__tag___exporter.html#o29">ExporterLog</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a172">IPDR_LEVEL_DEBUG</a>)) {
00278             <a class="code" href="../../d5/d59/_for_doxygen_2src_2_exporter_2_protocol_debug_8c.html#a5">ProtocolDebug_PrintIncomingMessage</a>(&amp;E-&gt;<a class="code" href="../../df/d71/struct_i_p_d_r__tag___exporter.html#o29">ExporterLog</a>, C, Buf, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a172">IPDR_LEVEL_DEBUG</a>);
00279         }
00280         <span class="keywordflow">break</span>;
00281     <span class="keywordflow">default</span>:
00282         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a15">Log_ShouldWrite</a>(&amp;E-&gt;<a class="code" href="../../df/d71/struct_i_p_d_r__tag___exporter.html#o29">ExporterLog</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a171">IPDR_LEVEL_INFO</a>)) {
00283             <a class="code" href="../../d5/d59/_for_doxygen_2src_2_exporter_2_protocol_debug_8c.html#a5">ProtocolDebug_PrintIncomingMessage</a>(&amp;E-&gt;<a class="code" href="../../df/d71/struct_i_p_d_r__tag___exporter.html#o29">ExporterLog</a>, C, Buf, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a171">IPDR_LEVEL_INFO</a>);
00284         }
00285     }
00286 
00287     <span class="comment">/* find the session associated with the message */</span>
00288 
00289         needsSessionID = <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a4">ExporterProtocol_NeedSessionID</a>(H-&gt;MessageID);
00290 
00291     <span class="keywordflow">if</span> (needsSessionID &amp;&amp; H-&gt;SessionID &gt; 0 ) {
00292         <span class="keywordtype">int</span> i;
00293         <span class="keywordflow">for</span> (i = 0; i &lt; E-&gt;Sessions.Length; i++) {
00294             <a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html">Session</a> *S1 = (<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html">Session</a> *) E-&gt;<a class="code" href="../../df/d71/struct_i_p_d_r__tag___exporter.html#o13">Sessions</a>.<a class="code" href="../../db/dc0/struct_dynamic_array.html#o0">Data</a>[i];
00295             <span class="keywordflow">if</span> (S1 != NULL &amp;&amp; S1-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o16">ID</a> == H-&gt;SessionID) {
00296                 S = S1;
00297                 break ;
00298             }
00299         }
00300     }
00301 
00302     <span class="keywordflow">if</span> (S == NULL &amp;&amp; needsSessionID) {
00303         <span class="comment">/* We got an unexpected message - we don't don't know about</span>
00304 <span class="comment">         * this session, so complain and disconnect */</span>
00305                 <a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html">IPDRConnection</a> *IC = (<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html">IPDRConnection</a> *)C-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o11">Owner</a>;
00306                 <a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html">Session</a> Sess;
00307         <a class="code" href="../../d6/df8/struct_i_p_d_r___event_data.html">IPDR_EventData</a> eventData;
00308         <a class="code" href="../../dd/dd0/_for_doxygen_2src_2_exporter_2_exporter_8c.html#a98">EventDataInit</a>(&amp;eventData, <a class="code" href="../../df/dd7/group___i_p_d_r__event__notification.html#gga6a156">IPDR_EVENT_ERROR</a>, E, NULL, NULL);
00309         eventData.<a class="code" href="../../d6/df8/struct_i_p_d_r___event_data.html#o13">Extra</a>.Error.Reason = <a class="code" href="../../df/dd7/group___i_p_d_r__event__notification.html#gga8a165">IPDR_EVENT_ERROR_UNKNOWN_SESSION</a>;
00310         eventData.<a class="code" href="../../d6/df8/struct_i_p_d_r___event_data.html#o4">SessionID</a> = H-&gt;SessionID;
00311         <a class="code" href="../../dd/dd0/_for_doxygen_2src_2_exporter_2_exporter_8c.html#a99">Exporter_TriggerEvent</a>(E, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a169">IPDR_LEVEL_ERROR</a>,
00312                             &amp;eventData, NULL,
00313                             <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a20">MSG_EXPORTER_UNKNOWN_SESSION</a>,
00314                             <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a14">TL_GetConnectionInfoStr</a>(C), H-&gt;SessionID, H-&gt;MessageID);
00315 
00316                 <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a31">Log_Write3</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a169">IPDR_LEVEL_ERROR</a>,
00317                          <span class="stringliteral">"                              ExporterProtocol_DataCallback"</span>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a20">MSG_EXPORTER_UNKNOWN_SESSION</a>,
00318                             <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a14">TL_GetConnectionInfoStr</a>(C), H-&gt;SessionID, H-&gt;MessageID);
00319 
00320                 <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a68">ExporterProtocol_KeepAliveInTimerReset</a>(IC);
00321 
00322                 Sess.<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o16">ID</a> = H-&gt;SessionID;
00323                 <span class="keywordflow">if</span>(<a class="code" href="../../d0/d8b/_for_doxygen_2include_2_i_p_d_r_2_i_p_d_r_8h.html#a18">FAILURE</a>(<a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a57">ExporterProtocol_SendError</a>(E, &amp;Sess, Coll, C, <a class="code" href="../../d2/dda/_for_doxygen_2src_2_common_2_protocol_8h.html#a57a46">MessageInvalidForState</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a117">MSG_EXPORTER_UNKNOWN_SESSION2</a>)))
00324                 {
00325                         <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a24">TL_HandleDisconnection</a>(C);
00326                 }
00327 
00328                 <a class="code" href="../../d5/d9f/_for_doxygen_2src_2_common_2_chunks_manager_8c.html#a24">ChunksManager_ReleaseBuffer</a>(BH, MsgLen);
00329                 <span class="keywordflow">return</span>;
00330     }
00331 
00332     <span class="keywordflow">switch</span> (H-&gt;MessageID) {
00333 
00334     <span class="keywordflow">case</span> <a class="code" href="../../d2/dda/_for_doxygen_2src_2_common_2_protocol_8h.html#a19">IPDR_MSG_FLOW_START</a>:
00335         <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a41">ExporterProtocol_HandleFlowStart</a>(E, S, Coll, H, C);
00336         <span class="keywordflow">break</span>;
00337 
00338     <span class="keywordflow">case</span> <a class="code" href="../../d2/dda/_for_doxygen_2src_2_common_2_protocol_8h.html#a20">IPDR_MSG_FLOW_STOP</a>:
00339         <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a42">ExporterProtocol_HandleFlowStop</a>(E, S, Coll, H, C);
00340         <span class="keywordflow">break</span>;
00341 
00342         <span class="keywordflow">case</span> <a class="code" href="../../d2/dda/_for_doxygen_2src_2_common_2_protocol_8h.html#a21">IPDR_MSG_MODIFY_TEMPLATE</a>:
00343                 <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a43">ExporterProtocol_HandleModifyTemplate</a>(E, S, Coll, H, C);
00344                 <span class="keywordflow">break</span>;
00345 
00346     <span class="keywordflow">case</span> <a class="code" href="../../d2/dda/_for_doxygen_2src_2_common_2_protocol_8h.html#a22">IPDR_MSG_FINAL_TEMPLATE_DATA_ACK</a>:
00347         <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a44">ExporterProtocol_HandleFinalTmplDataACK</a>(E, S, Coll, H, C);
00348         <span class="keywordflow">break</span>;
00349 
00350         <span class="keywordflow">case</span> <a class="code" href="../../d2/dda/_for_doxygen_2src_2_common_2_protocol_8h.html#a23">IPDR_MSG_START_NEGOTIATION</a>:
00351                 <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a45">ExporterProtocol_HandleStartNegotiation</a>(E, S, Coll, H, C);
00352                 <span class="keywordflow">break</span>;
00353 
00354         <span class="keywordflow">case</span> <a class="code" href="../../d2/dda/_for_doxygen_2src_2_common_2_protocol_8h.html#a24">IPDR_MSG_GET_SESSIONS</a>:
00355                 <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a46">ExporterProtocol_HandleGetSessions</a>(E, S, Coll, H, C);
00356                 <span class="keywordflow">break</span>;
00357 
00358         <span class="keywordflow">case</span> <a class="code" href="../../d2/dda/_for_doxygen_2src_2_common_2_protocol_8h.html#a25">IPDR_MSG_GET_TEMPLATES</a>:
00359                 <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a47">ExporterProtocol_HandleGetTemplates</a>(E, S, Coll, H, C);
00360                 <span class="keywordflow">break</span>;
00361 
00362     <span class="keywordflow">case</span> <a class="code" href="../../d2/dda/_for_doxygen_2src_2_common_2_protocol_8h.html#a26">IPDR_MSG_DATA_ACK</a>:
00363         <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a48">ExporterProtocol_HandleDataACK</a>(E, S, Coll, H, C);
00364         <span class="keywordflow">break</span>;
00365 
00366         <span class="keywordflow">case</span> <a class="code" href="../../d2/dda/_for_doxygen_2src_2_common_2_protocol_8h.html#a27">IPDR_MSG_CONNECT</a>:
00367         <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a49">ExporterProtocol_HandleConnect</a>(E, S, Coll, H, C);
00368         <span class="keywordflow">break</span>;
00369 
00370         <span class="keywordflow">case</span> <a class="code" href="../../d2/dda/_for_doxygen_2src_2_common_2_protocol_8h.html#a28">IPDR_MSG_CONNECT_RESPONSE</a>:
00371         <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a50">ExporterProtocol_HandleConnectResponse</a>(E, S, Coll, H, C);
00372         <span class="keywordflow">break</span>;
00373 
00374         <span class="keywordflow">case</span> <a class="code" href="../../d2/dda/_for_doxygen_2src_2_common_2_protocol_8h.html#a29">IPDR_MSG_DISCONNECT</a>:
00375                 <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a51">ExporterProtocol_HandleDisconnect</a>(E, S, Coll, H, C);
00376                 <span class="keywordflow">break</span>;
00377 
00378         <span class="keywordflow">case</span> <a class="code" href="../../d2/dda/_for_doxygen_2src_2_common_2_protocol_8h.html#a30">IPDR_MSG_ERROR</a>:
00379                 <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a52">ExporterProtocol_HandleError</a>(E, S, Coll, H, C);
00380                 <span class="keywordflow">break</span>;
00381 
00382         <span class="keywordflow">case</span> <a class="code" href="../../d2/dda/_for_doxygen_2src_2_common_2_protocol_8h.html#a31">IPDR_MSG_KEEP_ALIVE</a>:
00383                 <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a53">ExporterProtocol_HandleKeepAlive</a>(E, S, Coll, H, C);
00384                 <span class="keywordflow">break</span>;
00385 
00386     <span class="keywordflow">default</span>:
00387         <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a67">ExporterProtocol_HandleUnknownMsg</a>(E, S, Coll, H, C);
00388         <span class="keywordflow">break</span>;
00389     }
00390         <span class="comment">/* Can not call ReleaseMessage here because of no padding, may be releaseBuffer will do */</span>
00391     <span class="comment">/*ChunksManager_ReleaseMessage(BH);*/</span>
00392     <a class="code" href="../../d5/d9f/_for_doxygen_2src_2_common_2_chunks_manager_8c.html#a24">ChunksManager_ReleaseBuffer</a>(BH, MsgLen);
00393 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a18" doxytag="ExporterProtocol.h::ExporterProtocol_DisconnectCallback"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void ExporterProtocol_DisconnectCallback           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Conn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>void *&nbsp;</td>
          <td class="mdname" nowrap> <em>Arg</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Callback invoked when a server (collector) disconnects.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>Conn</em>&nbsp;</td><td>disconnected connection </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Arg</em>&nbsp;</td><td>additional argument </td></tr>
  </table>
</dl>
<div class="fragment"><pre class="fragment">00176 {
00177     <a class="code" href="../../df/d71/struct_i_p_d_r__tag___exporter.html">Exporter</a>*                   E = (<a class="code" href="../../df/d71/struct_i_p_d_r__tag___exporter.html">Exporter</a>*)Arg;
00178     <a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html">IPDRConnection</a>*             IC = (<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html">IPDRConnection</a> *)Conn-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o11">Owner</a>;
00179         <a class="code" href="../../de/d0d/struct_i_p_d_r__tag___collector.html">Collector</a>*                      Coll = (<a class="code" href="../../de/d0d/struct_i_p_d_r__tag___collector.html">Collector</a> *)IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o4">Owner</a>;
00180         <a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html">CollectorSession</a>*       CS;
00181         <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a16">IPDR_BOOL</a>                       WasActive;
00182         <span class="keywordtype">int</span>                                     Index ;
00183 
00184         Conn-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o11">Owner</a> = NULL;
00185 
00186         <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a27">Log_StateTransition</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a172">IPDR_LEVEL_DEBUG</a>,
00187                         <span class="stringliteral">"ExporterProtocol_DisconnectCallback"</span>, Conn,
00188                         IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o1">State</a>, IPDR_SERVER_DISCONNECTED,
00189                         <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a14">TL_GetConnectionInfoStr</a>(Conn));
00190 
00191         <span class="comment">/* for each Session of this connection, need to have if we had active session there */</span>
00192         <span class="keywordflow">for</span>( Index = 0; Index &lt; Coll-&gt;<a class="code" href="../../de/d0d/struct_i_p_d_r__tag___collector.html#o1">CollectorSessions</a>.<a class="code" href="../../db/dc0/struct_dynamic_array.html#o1">Length</a>; Index++ )
00193         {
00194                 CS = (<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html">CollectorSession</a>*)Coll-&gt;<a class="code" href="../../de/d0d/struct_i_p_d_r__tag___collector.html#o1">CollectorSessions</a>.<a class="code" href="../../db/dc0/struct_dynamic_array.html#o0">Data</a>[Index];
00195 
00196                 <span class="comment">/* If it is active CollectorSession need to select new server now*/</span>
00197                 WasActive = (CS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o1">CSState</a> == <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a52a27">IPDR_CS_ACTIVE</a> &amp;&amp; CS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o3">SessionPtr</a>-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o13">ActiveCS</a> == CS) ;
00198                 CS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o1">CSState</a> = <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a52a24">IPDR_CS_DISCONNECTED</a>;
00199                 CS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o5">SessionConnection</a> = NULL ;
00200 
00201                 <span class="keywordflow">if</span>(WasActive)
00202                         <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a70">ExporterProtocol_SelectCollector</a>( E, CS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o3">SessionPtr</a>, <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a4">IPDR_FALSE</a>, NULL);
00203         }
00204 
00205 
00206         <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a71">ExporterProtocol_ResetIPDRConnection</a>( E, IC );
00207 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="ExporterProtocol.h::ExporterProtocol_FillHeader"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_Status</a> ExporterProtocol_FillHeader           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d9/d35/struct_i_p_d_r__tag___session.html">Session</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>S</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>Msg</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>unsigned char&nbsp;</td>
          <td class="mdname" nowrap> <em>MessageID</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>unsigned long&nbsp;</td>
          <td class="mdname" nowrap> <em>MessageLength</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Set the header fields within a message.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>S</em>&nbsp;</td><td>session handle (pointer) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Msg</em>&nbsp;</td><td>message to update </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>MessageID</em>&nbsp;</td><td>message id to put in the header </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>MessageLength</em>&nbsp;</td><td>length of the message</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga30a174">IPDR_OK</a> on success; <a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga30">IPDR_STATUS_RETURN_CODE</a> otherwise. </dd></dl>
<div class="fragment"><pre class="fragment">00429 {
00430     MessageHeader *H = (MessageHeader *) Msg;
00431 
00432     H-&gt;Version = <a class="code" href="../../d2/dda/_for_doxygen_2src_2_common_2_protocol_8h.html#a18">IPDR_PROTOCOL_VERSION</a>;
00433     H-&gt;SessionID = S ? S-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o16">ID</a> : 0;
00434     H-&gt;MessageFlags = 0;
00435     H-&gt;MessageID = MessageID;
00436     <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a9">IPDR_SET_HTONL</a>(H-&gt;MessageLength, MessageLength);
00437 
00438     <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a174">IPDR_OK</a>;
00439 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="ExporterProtocol.h::ExporterProtocol_FlushRecordsQueue"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_Status</a> ExporterProtocol_FlushRecordsQueue           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../df/d71/struct_i_p_d_r__tag___exporter.html">Exporter</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>E</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d9/d35/struct_i_p_d_r__tag___session.html">Session</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>S</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../de/d0d/struct_i_p_d_r__tag___collector.html">Collector</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>Coll</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>DebugMsg</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Move to the next transmission context if needed (i.e. the queue of the current context is empty and a next context is available), otherwise send any outstanding data.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>E</em>&nbsp;</td><td>exporter handle </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>S</em>&nbsp;</td><td>session handle (pointer) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Coll</em>&nbsp;</td><td>collector handle </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>DebugMsg</em>&nbsp;</td><td>context message for any debug message produced by this function</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga30a174">IPDR_OK</a> on success; <a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga30">IPDR_STATUS_RETURN_CODE</a> otherwise. </dd></dl>
<div class="fragment"><pre class="fragment">00411 {
00412         <span class="keywordflow">return</span> <a class="code" href="../../dd/dd0/_for_doxygen_2src_2_exporter_2_exporter_8c.html#a48">Session_SendOutstandingData</a>(E, S);
00413 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="ExporterProtocol.h::ExporterProtocol_HandleConnect"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_Status</a> ExporterProtocol_HandleConnect           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../df/d71/struct_i_p_d_r__tag___exporter.html">Exporter</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>E</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d9/d35/struct_i_p_d_r__tag___session.html">Session</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>S</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../de/d0d/struct_i_p_d_r__tag___collector.html">Collector</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>Coll</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const MessageHeader *&nbsp;</td>
          <td class="mdname" nowrap> <em>Msg</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Conn</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Handles a connect event recived from a collector<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>E</em>&nbsp;</td><td>exporter handle </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>S</em>&nbsp;</td><td>session handle (pointer) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Coll</em>&nbsp;</td><td>collector handle (pointer) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Msg</em>&nbsp;</td><td>message header from the collector </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Conn</em>&nbsp;</td><td>The Connection between S to Coll </td></tr>
  </table>
</dl>
<div class="fragment"><pre class="fragment">01209 {
01210         <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a> Status = <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a174">IPDR_OK</a>;
01211         <a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html">IPDRConnection</a> *IC = Conn-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o11">Owner</a>;
01212         <span class="keyword">const</span> ConnectMessage *CM = (<span class="keyword">const</span> ConnectMessage *)Msg;
01213         <span class="keywordtype">int</span> clientCapabilities = 0, Index;
01214         <a class="code" href="../../de/d0d/struct_i_p_d_r__tag___collector.html">Collector</a> *RealCollector = NULL ;
01215         <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a28">TL_PABuf</a> paBuf;
01216         
01217         <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga9">IPDR_IPAddress</a> Addr = <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a12">IPDR_NTOHL</a>(CM-&gt;Addr);
01218         Conn-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o5">DummyAddr</a> = Addr ;
01219         
01220         
01221         <span class="keywordflow">if</span>(Coll-&gt;<a class="code" href="../../de/d0d/struct_i_p_d_r__tag___collector.html#o9">isDummy</a> == <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a5">IPDR_TRUE</a>)
01222         {
01223                 <span class="keywordflow">for</span> (Index = 0; Index &lt; E-&gt;Collectors.Length; Index++)
01224                 {
01225                         RealCollector = (<a class="code" href="../../de/d0d/struct_i_p_d_r__tag___collector.html">Collector</a> *) E-&gt;<a class="code" href="../../df/d71/struct_i_p_d_r__tag___exporter.html#o14">Collectors</a>.<a class="code" href="../../db/dc0/struct_dynamic_array.html#o0">Data</a>[Index];
01226                         <span class="keywordflow">if</span> (Addr == RealCollector-&gt;<a class="code" href="../../de/d0d/struct_i_p_d_r__tag___collector.html#o4">Addr</a>)
01227                                 break ;
01228                         
01229                         RealCollector = NULL ;
01230                 }
01231                 
01232                 <span class="keywordflow">if</span>(RealCollector == NULL)
01233                 {
01234                         <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a29">Log_Write1</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a169">IPDR_LEVEL_ERROR</a>,
01235                                         <span class="stringliteral">"ExporterProtocol_HandleConnect"</span>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a19">MSG_EXPORTER_UNKNOWN_SERVER</a>,
01236                                         <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a20">TL_PrintConnectionFull</a>(Conn, paBuf));
01237         
01238                         Status = <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a57">ExporterProtocol_SendError</a>(E, S, Coll, Conn, <a class="code" href="../../d2/dda/_for_doxygen_2src_2_common_2_protocol_8h.html#a57a50">CollectorNotConfigured</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a125">MSG_EXPORTER_UNKNOWN_SERVER2</a>);
01239                         <span class="keywordflow">if</span>(<a class="code" href="../../d0/d8b/_for_doxygen_2include_2_i_p_d_r_2_i_p_d_r_8h.html#a18">FAILURE</a>(Status))
01240                         {
01241                                 <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a24">TL_HandleDisconnection</a>(Conn);
01242                         }
01243                         <span class="keywordflow">return</span> Status ;
01244                 }
01245                 
01246                 <span class="keywordflow">if</span>(IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o5">ConnectResponseTimerID</a> != NULL)
01247                         <a class="code" href="../../d7/d54/_for_doxygen_2src_2_common_2_platform_8h.html#a13">Platform_UnregisterTimerAndClear</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a1">EXPORTER_PLATFORM</a>, &amp; (IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o5">ConnectResponseTimerID</a>));
01248                 
01249                 <span class="keywordflow">if</span>(IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o3">TCPConnection</a>)
01250                         IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o3">TCPConnection</a>-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o11">Owner</a> = NULL ;
01251                 IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o3">TCPConnection</a> = NULL ;
01252                 
01253                 Status = <a class="code" href="../../dd/dd0/_for_doxygen_2src_2_exporter_2_exporter_8c.html#a43">Exporter_AddIPDRConnectionToCollector</a>( E, RealCollector, Conn );
01254                 <span class="keywordflow">if</span>(<a class="code" href="../../d0/d8b/_for_doxygen_2include_2_i_p_d_r_2_i_p_d_r_8h.html#a18">FAILURE</a>(Status))
01255                 {
01256                         <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a29">Log_Write1</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a169">IPDR_LEVEL_ERROR</a>,
01257                                         <span class="stringliteral">"Exporter_ConnectCallback"</span>, <span class="stringliteral">"Failed To Add IPDRConnection To Collector, Addres: %.98s"</span>,
01258                                         <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a20">TL_PrintConnectionFull</a>(Conn, paBuf));
01259                         
01260                         <a class="code" href="../../d5/d22/_for_doxygen_2src_2_common_2_memory_management_8c.html#a5">Object_Release</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a1">EXPORTER_PLATFORM</a>, Coll);
01261                         <span class="keywordflow">return</span> Status;
01262                 }
01263                 <a class="code" href="../../d5/d22/_for_doxygen_2src_2_common_2_memory_management_8c.html#a5">Object_Release</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a1">EXPORTER_PLATFORM</a>, Coll);
01264                 IC = Conn-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o11">Owner</a>;
01265         }
01266         
01267         <span class="keywordflow">if</span>(IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o1">State</a> != <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a51a21">IPDR_CONNECTION_DISCONNECTED</a>)
01268         {
01269                 <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a31">Log_Write3</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a169">IPDR_LEVEL_ERROR</a>,
01270                    <span class="stringliteral">"ExporterProtocol_HandleConnect"</span>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a35">MSG_EXPORTER_UNEXPECTED_CONNECT</a>,
01271                    <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a20">TL_PrintConnectionFull</a>(Conn, paBuf), <span class="stringliteral">"CONNECTED"</span>, <span class="stringliteral">""</span>);
01272 
01273                 Status = <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a57">ExporterProtocol_SendError</a>(E, S, RealCollector, Conn, <a class="code" href="../../d2/dda/_for_doxygen_2src_2_common_2_protocol_8h.html#a57a51">InvalidConnectionState</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a78">MSG_EXPORTER_WRONG_COLLECTOR_STATE</a>);
01274                 <span class="keywordflow">if</span>(<a class="code" href="../../d0/d8b/_for_doxygen_2include_2_i_p_d_r_2_i_p_d_r_8h.html#a18">FAILURE</a>(Status))
01275                 {
01276                         <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a24">TL_HandleDisconnection</a>(Conn);
01277                 }
01278                 <span class="keywordflow">return</span> Status ;
01279         }
01280 
01281         clientCapabilities = <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a12">IPDR_NTOHL</a>(CM-&gt;Capabilities);
01282         <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a33">ExporterProtocol_SetCollectorCapabilities</a>(E, RealCollector, clientCapabilities);
01283         IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o8">RemoteKeepAliveInterval</a> = <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a12">IPDR_NTOHL</a>(CM-&gt;keepAliveInterval);
01284 
01285         Status = <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a55">ExporterProtocol_SendConnectResponse</a>(E, S, RealCollector, Conn);
01286         <span class="keywordflow">if</span>(<a class="code" href="../../d0/d8b/_for_doxygen_2include_2_i_p_d_r_2_i_p_d_r_8h.html#a18">FAILURE</a>(Status))
01287         {
01288                 <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a28">Log_Write</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a169">IPDR_LEVEL_ERROR</a>,
01289                   <span class="stringliteral">"ExporterProtocol_HandleConnect"</span>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a97">MSG_EXPORTER_SEND_CONNECT_RESPONSE_ERROR</a>);
01290                 <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a24">TL_HandleDisconnection</a>(Conn);
01291                 <span class="keywordflow">return</span> Status ;
01292         }
01293 
01294         IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o1">State</a> = <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a51a23">IPDR_CONNECTION_CONNECTED</a>;
01295         <span class="keywordflow">if</span>(IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o6">KeepAliveINTimerID</a> != NULL)
01296         {
01297                 <a class="code" href="../../d7/d54/_for_doxygen_2src_2_common_2_platform_8h.html#a13">Platform_UnregisterTimerAndClear</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a1">EXPORTER_PLATFORM</a>, &amp;IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o6">KeepAliveINTimerID</a>);
01298                 IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o6">KeepAliveINTimerID</a> = NULL;
01299         }
01300         <a class="code" href="../../d7/d54/_for_doxygen_2src_2_common_2_platform_8h.html#a11">Platform_RegisterPeriodicTimer</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a1">EXPORTER_PLATFORM</a>,
01301                                                         <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a29">ExporterProtocol_KeepAliveInTimerCallback</a>,
01302                                                         IC,
01303                                                         (E-&gt;<a class="code" href="../../df/d71/struct_i_p_d_r__tag___exporter.html#o4">Parameters</a>.<a class="code" href="../../d1/dac/struct_exporter_parameters.html#o4">KeepAliveInterval</a>)+500,
01304                                                         &amp; (IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o6">KeepAliveINTimerID</a>));
01305 
01306         <span class="keywordflow">if</span>(IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o7">KeepAliveOUTTimerID</a> != NULL)
01307         {
01308                 <a class="code" href="../../d7/d54/_for_doxygen_2src_2_common_2_platform_8h.html#a13">Platform_UnregisterTimerAndClear</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a1">EXPORTER_PLATFORM</a>, &amp;IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o7">KeepAliveOUTTimerID</a>);
01309                 IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o7">KeepAliveOUTTimerID</a> = NULL;
01310         }
01311         <a class="code" href="../../d7/d54/_for_doxygen_2src_2_common_2_platform_8h.html#a11">Platform_RegisterPeriodicTimer</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a1">EXPORTER_PLATFORM</a>,
01312                                                         <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a30">ExporterProtocol_KeepAliveOutTimerCallback</a>,
01313                                                         IC,
01314                                                         ((IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o8">RemoteKeepAliveInterval</a>)*1000)-500,
01315                                                         &amp; (IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o7">KeepAliveOUTTimerID</a>));
01316 
01317         <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a174">IPDR_OK</a> ;
01318 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="ExporterProtocol.h::ExporterProtocol_HandleConnectResponse"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_Status</a> ExporterProtocol_HandleConnectResponse           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../df/d71/struct_i_p_d_r__tag___exporter.html">Exporter</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>E</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d9/d35/struct_i_p_d_r__tag___session.html">Session</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>S</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../de/d0d/struct_i_p_d_r__tag___collector.html">Collector</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>Coll</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const MessageHeader *&nbsp;</td>
          <td class="mdname" nowrap> <em>Msg</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Conn</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Handles a connect response event recived from a collector<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>E</em>&nbsp;</td><td>exporter handle </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>S</em>&nbsp;</td><td>session handle (pointer) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Coll</em>&nbsp;</td><td>collector handle (pointer) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Msg</em>&nbsp;</td><td>message header from the collector </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Conn</em>&nbsp;</td><td>The Connection between S to Coll </td></tr>
  </table>
</dl>
<div class="fragment"><pre class="fragment">01335 {
01336         <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a> Status = <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a174">IPDR_OK</a>;
01337         <a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html">IPDRConnection</a> *IC = Conn-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o11">Owner</a>;
01338         <span class="keyword">const</span> ConnectResponseMessage *CRM = (<span class="keyword">const</span> ConnectResponseMessage *)Msg;
01339         <span class="keywordtype">int</span> clientCapabilities = 0;
01340 
01341         <span class="keywordflow">if</span>(IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o1">State</a> != <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a51a22">IPDR_CONNECTION_WAITRESPONSE</a>)
01342         {
01343                 <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a28">Log_Write</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a169">IPDR_LEVEL_ERROR</a>,
01344                   <span class="stringliteral">"ExporterProtocol_HandleConnectResponse"</span>,
01345                   <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a105">MSG_EXPORTER_STATE_NOT_WAITRESPONSE</a>);
01346                 Status = <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a57">ExporterProtocol_SendError</a>(E, S, Coll, Conn, <a class="code" href="../../d2/dda/_for_doxygen_2src_2_common_2_protocol_8h.html#a57a51">InvalidConnectionState</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a78">MSG_EXPORTER_WRONG_COLLECTOR_STATE</a>);
01347                 <span class="keywordflow">if</span>(<a class="code" href="../../d0/d8b/_for_doxygen_2include_2_i_p_d_r_2_i_p_d_r_8h.html#a18">FAILURE</a>(Status))
01348                 {
01349                         <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a24">TL_HandleDisconnection</a>(Conn);
01350                 }
01351                 <span class="keywordflow">return</span> Status ;
01352         }
01353 
01354         <a class="code" href="../../d7/d54/_for_doxygen_2src_2_common_2_platform_8h.html#a34">Platform_Lock</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a1">EXPORTER_PLATFORM</a>);
01355 
01356         <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a28">Log_Write</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a171">IPDR_LEVEL_INFO</a>,
01357                   <span class="stringliteral">"ExporterProtocol_HandleConnectResponse"</span>,
01358                   <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a104">MSG_EXPORTER_CONNECT_RESPONSE_RECEIVED</a>);
01359         <a class="code" href="../../d7/d54/_for_doxygen_2src_2_common_2_platform_8h.html#a13">Platform_UnregisterTimerAndClear</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a1">EXPORTER_PLATFORM</a>, &amp;IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o5">ConnectResponseTimerID</a>);
01360         IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o5">ConnectResponseTimerID</a> = NULL;
01361 
01362         IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o1">State</a> = <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a51a23">IPDR_CONNECTION_CONNECTED</a>;
01363         IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o8">RemoteKeepAliveInterval</a> = <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a12">IPDR_NTOHL</a>(CRM-&gt;keepAliveInterval);
01364         clientCapabilities = <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a12">IPDR_NTOHL</a>(CRM-&gt;Capabilities);
01365         <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a33">ExporterProtocol_SetCollectorCapabilities</a>(E, Coll, clientCapabilities);
01366         <span class="keywordflow">if</span>(IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o6">KeepAliveINTimerID</a> != NULL)
01367         {
01368                 <a class="code" href="../../d7/d54/_for_doxygen_2src_2_common_2_platform_8h.html#a13">Platform_UnregisterTimerAndClear</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a1">EXPORTER_PLATFORM</a>, &amp;IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o6">KeepAliveINTimerID</a>);
01369                 IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o6">KeepAliveINTimerID</a> = NULL;
01370         }
01371         <a class="code" href="../../d7/d54/_for_doxygen_2src_2_common_2_platform_8h.html#a11">Platform_RegisterPeriodicTimer</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a1">EXPORTER_PLATFORM</a>,
01372                                                         <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a29">ExporterProtocol_KeepAliveInTimerCallback</a>,
01373                                                         IC,
01374                                                         (E-&gt;<a class="code" href="../../df/d71/struct_i_p_d_r__tag___exporter.html#o4">Parameters</a>.<a class="code" href="../../d1/dac/struct_exporter_parameters.html#o4">KeepAliveInterval</a>)+500,
01375                                                         &amp; (IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o6">KeepAliveINTimerID</a>));
01376 
01377         <span class="keywordflow">if</span>(IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o7">KeepAliveOUTTimerID</a> != NULL)
01378         {
01379                 <a class="code" href="../../d7/d54/_for_doxygen_2src_2_common_2_platform_8h.html#a13">Platform_UnregisterTimerAndClear</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a1">EXPORTER_PLATFORM</a>, &amp;IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o7">KeepAliveOUTTimerID</a>);
01380                 IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o7">KeepAliveOUTTimerID</a> = NULL;
01381         }
01382         <a class="code" href="../../d7/d54/_for_doxygen_2src_2_common_2_platform_8h.html#a11">Platform_RegisterPeriodicTimer</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a1">EXPORTER_PLATFORM</a>,
01383                                                         <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a30">ExporterProtocol_KeepAliveOutTimerCallback</a>,
01384                                                         IC,
01385                                                         ((IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o8">RemoteKeepAliveInterval</a>)*1000)-500,
01386                                                         &amp; (IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o7">KeepAliveOUTTimerID</a>));
01387 
01388         <a class="code" href="../../d7/d54/_for_doxygen_2src_2_common_2_platform_8h.html#a35">Platform_Unlock</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a1">EXPORTER_PLATFORM</a>);
01389         <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a174">IPDR_OK</a>;
01390 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="ExporterProtocol.h::ExporterProtocol_HandleDataACK"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_Status</a> ExporterProtocol_HandleDataACK           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../df/d71/struct_i_p_d_r__tag___exporter.html">Exporter</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>E</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d9/d35/struct_i_p_d_r__tag___session.html">Session</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>S</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../de/d0d/struct_i_p_d_r__tag___collector.html">Collector</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>Coll</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const MessageHeader *&nbsp;</td>
          <td class="mdname" nowrap> <em>Msg</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Conn</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Handle a DATA ACK message from a server (collector).<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>E</em>&nbsp;</td><td>exporter handle </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>S</em>&nbsp;</td><td>session handle (pointer) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Coll</em>&nbsp;</td><td>collector originating the message </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Msg</em>&nbsp;</td><td>received message </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Conn</em>&nbsp;</td><td>connection handle</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga30a174">IPDR_OK</a> on success; <a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga30">IPDR_STATUS_RETURN_CODE</a> otherwise. </dd></dl>
<div class="fragment"><pre class="fragment">01064 {
01065         <span class="keyword">const</span> DataACKMessage*   DAM = (<span class="keyword">const</span> DataACKMessage *) Msg;
01066     <a class="code" href="../../df/dd7/group___i_p_d_r__event__notification.html#ga0">IPDR_DSN_TYPE</a>                       DSN = 0 ;
01067     <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>                      ConfigurationID = <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a11">IPDR_NTOHS</a>(DAM-&gt;ConfigurationID);
01068         <a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html">CollectorSession</a>*               CS ;
01069     <a class="code" href="../../d1/d8c/struct_i_p_d_r__tag___transmission_context.html">TransmissionContext</a>*        TC = S-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o3">ActiveContext</a>;
01070         <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a>                             Status ;
01071 
01072         <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a68">ExporterProtocol_KeepAliveInTimerReset</a>(Conn-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o11">Owner</a>);
01073 
01074         DSN = <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a13">IPDR_NTOHLL</a>(DAM-&gt;sequenceNum);
01075 
01076         <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a32">Log_Write4</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a1">EXPORTER_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a172">IPDR_LEVEL_DEBUG</a>,
01077                    <span class="stringliteral">"ExporterProtocol_HandleDataACK"</span>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a50">MSG_EXPORTER_DATA_ACK</a>,
01078                    DSN, <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a3">EXPORTER_QHANDLER</a>-&gt;OutstandingDataCount(E, S),
01079                    <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a3">EXPORTER_QHANDLER</a>-&gt;UnacknowledgedDataCount(E, S), <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a14">TL_GetConnectionInfoStr</a>(Conn));
01080 
01081         Status = <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a5">ExporterProtocol_CollectorSession</a>(Coll, S, &amp;CS, NULL, <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a5">IPDR_TRUE</a> );
01082 
01083         <span class="keywordflow">if</span>( <a class="code" href="../../d0/d8b/_for_doxygen_2include_2_i_p_d_r_2_i_p_d_r_8h.html#a18">FAILURE</a>(Status) || CS == NULL)
01084         {
01085                 <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a28">Log_Write</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a169">IPDR_LEVEL_ERROR</a>,
01086                          <span class="stringliteral">"ExporterProtocol_HandleDataACK"</span>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a69">MSG_EXPORTER_COLLECTOR_SESSION_FAILED</a>);
01087                 Status = <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a57">ExporterProtocol_SendError</a>(E, S, Coll, Conn, <a class="code" href="../../d2/dda/_for_doxygen_2src_2_common_2_protocol_8h.html#a57a50">CollectorNotConfigured</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a69">MSG_EXPORTER_COLLECTOR_SESSION_FAILED</a>);
01088                 <span class="keywordflow">if</span>(<a class="code" href="../../d0/d8b/_for_doxygen_2include_2_i_p_d_r_2_i_p_d_r_8h.html#a18">FAILURE</a>(Status))
01089                 {
01090                         <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a24">TL_HandleDisconnection</a>(Conn);
01091                 }
01092                 <span class="keywordflow">return</span> Status;
01093         }
01094 
01095     <span class="comment">/* Because IPDR_INVALID_DSN is negative, it ought not have any</span>
01096 <span class="comment">       effect ... but just to be sure, let's short-circuit the whole</span>
01097 <span class="comment">       execution path below. */</span>
01098     <span class="keywordflow">if</span> (<a class="code" href="../../d2/dda/_for_doxygen_2src_2_common_2_protocol_8h.html#a3">IPDR_INVALID_DSN</a>(DSN))
01099         <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a174">IPDR_OK</a>;
01100 
01101     <span class="keywordflow">if</span> (TC-&gt;<a class="code" href="../../d1/d8c/struct_i_p_d_r__tag___transmission_context.html#o3">ConfigurationID</a> != ConfigurationID)
01102         <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a174">IPDR_OK</a>;
01103 
01104     <span class="keywordflow">if</span> (S-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o13">ActiveCS</a> == CS)
01105         {
01106         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> RemovedRecords;
01107         <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a3">EXPORTER_QHANDLER</a>-&gt;ACK(E, S, CS, DSN, &amp;RemovedRecords);
01108         <span class="keywordflow">if</span> (RemovedRecords &gt; 0)
01109                 {
01110             <span class="keywordflow">if</span> (<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a3">EXPORTER_QHANDLER</a>-&gt;UnacknowledgedDataCount(E, S) &lt;= 0 &amp;&amp;
01111                 <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a3">EXPORTER_QHANDLER</a>-&gt;OutstandingDataCount(E, S) &lt;= 0)
01112                         {
01113                 <a class="code" href="../../d6/df8/struct_i_p_d_r___event_data.html">IPDR_EventData</a> eventData;
01114 
01115                 <a class="code" href="../../d7/d54/_for_doxygen_2src_2_common_2_platform_8h.html#a13">Platform_UnregisterTimerAndClear</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a1">EXPORTER_PLATFORM</a>, &amp;CS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o9">WindowSizeTimer</a>);
01116 
01117                 <a class="code" href="../../dd/dd0/_for_doxygen_2src_2_exporter_2_exporter_8c.html#a98">EventDataInit</a>(&amp;eventData, <a class="code" href="../../df/dd7/group___i_p_d_r__event__notification.html#gga6a154">IPDR_EVENT_QUEUE_EMPTY</a>, E, CS, S);
01118                 <a class="code" href="../../dd/dd0/_for_doxygen_2src_2_exporter_2_exporter_8c.html#a99">Exporter_TriggerEvent</a>(E, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a171">IPDR_LEVEL_INFO</a>, &amp;eventData, NULL, <span class="comment">/* don't record this event in server's "last event" */</span>
01119                                     <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a59">MSG_EXPORTER_QUEUE_EMPTIED</a>,
01120                                     <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a14">TL_GetConnectionInfoStr</a>(CS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o5">SessionConnection</a>-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o3">TCPConnection</a>),
01121                                     <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a3">EXPORTER_QHANDLER</a>-&gt;OutstandingDataCount(E, S),
01122                                     <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a3">EXPORTER_QHANDLER</a>-&gt;UnacknowledgedDataCount(E, S),
01123                                     S-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o16">ID</a>, S-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o17">Name</a>, S-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o18">Description</a>);
01124                         }
01125                         <span class="keywordflow">else</span>
01126                         {
01127                                 <a class="code" href="../../d7/d54/_for_doxygen_2src_2_common_2_platform_8h.html#a10">Platform_ReregisterTimer</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a1">EXPORTER_PLATFORM</a>,
01128                                          <a class="code" href="../../dd/dd0/_for_doxygen_2src_2_exporter_2_exporter_8c.html#a44">Exporter_WindowSizeTimerCallback</a>, CS,
01129                                          E-&gt;Parameters.WindowTimeout,
01130                                          &amp;CS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o9">WindowSizeTimer</a>);
01131                         }
01132                         <span class="comment">/* We don't need to check whether:</span>
01133 <span class="comment">                        EXPORTER_QHANDLER-&gt;OutstandingDataCount(C, S) &lt;</span>
01134 <span class="comment">                        C-&gt;Parameters.WindowSize)</span>
01135 <span class="comment">                        because the flush will do this implicitly (at most WindowSize</span>
01136 <span class="comment">                        records will be outstanding). */</span>
01137                 <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a39">ExporterProtocol_FlushRecordsQueue</a>(E, S, Coll, <span class="stringliteral">"DataACK"</span>);
01138                 }
01139         }
01140         <span class="keywordflow">else</span>
01141         {
01142         <span class="comment">/* When we received an data ack from a server (collector) with a higher</span>
01143 <span class="comment">           priority, which is paused, reselect the active server (collector). Note</span>
01144 <span class="comment">           that this means that an ACK from a lower priority server (collector)</span>
01145 <span class="comment">           will be ignored; but that shouldn't matter because the</span>
01146 <span class="comment">           higher priority server (collector) will be ACKing as well. In case the</span>
01147 <span class="comment">           higher priority server (collector) does time out, the lower priority</span>
01148 <span class="comment">           server (collector) will be re-sent everything, which is safe, even</span>
01149 <span class="comment">           though perhaps not desirable (but also quite</span>
01150 <span class="comment">           unlikely). Also note that this code does behave correctly</span>
01151 <span class="comment">           in the situation with a single server (collector) that times out and</span>
01152 <span class="comment">           then sends an ACK. */</span>
01153         <span class="comment">/* The fact that we got a DATA ACK indicates that that this</span>
01154 <span class="comment">           server (collector) ought to be put into a more ready state if it isn't</span>
01155 <span class="comment">           already */</span>
01156                 <span class="keywordflow">if</span> (S-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o13">ActiveCS</a> == NULL ||
01157                         ( (CS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o1">CSState</a> == <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a52a26">IPDR_CS_READY</a> ) &amp;&amp; CS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o6">Priority</a> &lt; S-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o13">ActiveCS</a>-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o6">Priority</a>) )
01158                 {
01159                         <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a27">Log_StateTransition</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a171">IPDR_LEVEL_INFO</a>,
01160                                 <span class="stringliteral">"ExporterProtocol_HandleDataACK"</span>,
01161                                                                 CS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o5">SessionConnection</a>-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o3">TCPConnection</a>,
01162                                                                 CS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o1">CSState</a>, CS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o1">CSState</a>,
01163                                 (S-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o13">ActiveCS</a> ? <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a87">MSG_EXPORTER_DATA_ACK1</a> : <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a88">MSG_EXPORTER_DATA_ACK2</a>));
01164 
01165                         <a class="code" href="../../dd/dd0/_for_doxygen_2src_2_exporter_2_exporter_8c.html#a46">Session_SelectActiveCollector</a>(E, S);
01166                         <span class="keywordflow">if</span> (S-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o13">ActiveCS</a> != NULL &amp;&amp; S-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o13">ActiveCS</a>-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o4">Collector</a> != NULL &amp;&amp;
01167                                 S-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o13">ActiveCS</a>-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o5">SessionConnection</a> != NULL &amp;&amp;
01168                                 S-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o13">ActiveCS</a>-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o5">SessionConnection</a>-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o3">TCPConnection</a> != NULL &amp;&amp;
01169                                 (S-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o13">ActiveCS</a>-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o1">CSState</a> == <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a52a27">IPDR_CS_ACTIVE</a>))
01170                         {
01171                 <span class="comment">/* (recursively) do it with the new active server (collector) */</span>
01172                 <span class="keywordflow">return</span> <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a48">ExporterProtocol_HandleDataACK</a>(E, S, S-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o13">ActiveCS</a>-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o4">Collector</a>,
01173                                                                                                         Msg, S-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o13">ActiveCS</a>-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o5">SessionConnection</a>-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o3">TCPConnection</a>);
01174             }
01175                         <span class="keywordflow">else</span>
01176                         {
01177                 <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a174">IPDR_OK</a>;
01178             }
01179         }
01180                 <span class="keywordflow">else</span>
01181                 {
01182             <span class="comment">/* It's normal to get an ACK from a lower priority server (collector),</span>
01183 <span class="comment">               if a fail-back has occurred. Just throw them away.</span>
01184 <span class="comment">            */</span>
01185             <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a27">Log_StateTransition</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>,
01186                                 <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a171">IPDR_LEVEL_INFO</a>,
01187                                 <span class="stringliteral">"ExporterProtocol_HandleDataACK"</span>, CS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o5">SessionConnection</a>-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o3">TCPConnection</a>, CS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o1">CSState</a>, CS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o1">CSState</a>,
01188                                 <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a89">MSG_EXPORTER_DATA_ACK3</a>);
01189         }
01190     }
01191     <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a174">IPDR_OK</a>;
01192 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="ExporterProtocol.h::ExporterProtocol_HandleDisconnect"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_Status</a> ExporterProtocol_HandleDisconnect           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../df/d71/struct_i_p_d_r__tag___exporter.html">Exporter</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>E</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d9/d35/struct_i_p_d_r__tag___session.html">Session</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>S</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../de/d0d/struct_i_p_d_r__tag___collector.html">Collector</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>Coll</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const MessageHeader *&nbsp;</td>
          <td class="mdname" nowrap> <em>Msg</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Conn</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Handles a disconnect event recived from a collector<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>E</em>&nbsp;</td><td>exporter handle </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>S</em>&nbsp;</td><td>session handle (pointer) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Coll</em>&nbsp;</td><td>collector handle (pointer) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Msg</em>&nbsp;</td><td>message header from the collector </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Conn</em>&nbsp;</td><td>The Connection between S to Coll </td></tr>
  </table>
</dl>
<div class="fragment"><pre class="fragment">01407 {
01408         <a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html">IPDRConnection</a>*                 IC = Conn-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o11">Owner</a>;
01409 
01410         <span class="keywordflow">if</span>( IC == NULL )
01411         {
01412                 <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a28">Log_Write</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a169">IPDR_LEVEL_ERROR</a>,
01413                   <span class="stringliteral">"ExporterProtocol_HandleDisconnect"</span>,
01414                   <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a109">MSG_NO_CONNECTION_OWNER</a>);
01415                 <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a180">IPDR_ERR</a> ;
01416         }
01417 
01418         <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a24">TL_HandleDisconnection</a>(Conn);
01419         <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a174">IPDR_OK</a>;
01420 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="ExporterProtocol.h::ExporterProtocol_HandleError"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_Status</a> ExporterProtocol_HandleError           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../df/d71/struct_i_p_d_r__tag___exporter.html">Exporter</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>E</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d9/d35/struct_i_p_d_r__tag___session.html">Session</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>S</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../de/d0d/struct_i_p_d_r__tag___collector.html">Collector</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>Coll</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const MessageHeader *&nbsp;</td>
          <td class="mdname" nowrap> <em>Msg</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Conn</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Handles an error event recived from a collector<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>E</em>&nbsp;</td><td>exporter handle </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>S</em>&nbsp;</td><td>session handle (pointer) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Coll</em>&nbsp;</td><td>collector handle (pointer) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Msg</em>&nbsp;</td><td>message header from the collector </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Conn</em>&nbsp;</td><td>The Connection between S to Coll </td></tr>
  </table>
</dl>
<div class="fragment"><pre class="fragment">01436 {
01437         <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga10">IPDR_Time</a>               ErrorTime;
01438         <span class="keyword">const</span> ErrorMessage*     EM;
01439         <span class="keyword">enum</span> <a class="code" href="../../d2/dda/_for_doxygen_2src_2_common_2_protocol_8h.html#a57">ErrorCode</a> ErrCode;
01440         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>    MsgLen;
01441         <span class="keywordtype">char</span>                    Buf[<a class="code" href="../../d6/d50/_for_doxygen_2src_2_exporter_2_exporter_protocol_8h.html#a1">EXPORTER_PROTOCOL_MAX_MSG</a>];
01442 
01443         <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a68">ExporterProtocol_KeepAliveInTimerReset</a>(Conn-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o11">Owner</a>);
01444 
01445         EM = (<span class="keyword">const</span> ErrorMessage*)Msg;
01446         ErrorTime = <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a12">IPDR_NTOHL</a>(EM-&gt;Timestamp);
01447     ErrCode = <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a11">IPDR_NTOHS</a>(EM-&gt;ErrorCode);
01448     MsgLen = <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a12">IPDR_NTOHL</a>(EM-&gt;DescrLength);
01449         memset(Buf, 0, <a class="code" href="../../d6/d50/_for_doxygen_2src_2_exporter_2_exporter_protocol_8h.html#a1">EXPORTER_PROTOCOL_MAX_MSG</a>);
01450         strncpy(Buf, (<span class="keywordtype">char</span>*)((size_t)EM + <span class="keyword">sizeof</span>(ErrorMessage)), MsgLen);
01451         Buf[MsgLen] = 0;
01452         <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a31">Log_Write3</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a1">EXPORTER_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a171">IPDR_LEVEL_INFO</a>,
01453                <span class="stringliteral">"ExporterProtocol_HandleError"</span>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a101">MSG_EXPORTER_ERROR_RECEIVED</a>,
01454                            <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a14">TL_GetConnectionInfoStr</a>(Conn), ErrCode, Buf);
01455         <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a174">IPDR_OK</a>;
01456 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="ExporterProtocol.h::ExporterProtocol_HandleFinalTmplDataACK"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_Status</a> ExporterProtocol_HandleFinalTmplDataACK           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../df/d71/struct_i_p_d_r__tag___exporter.html">Exporter</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>E</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d9/d35/struct_i_p_d_r__tag___session.html">Session</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>S</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../de/d0d/struct_i_p_d_r__tag___collector.html">Collector</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>Coll</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const MessageHeader *&nbsp;</td>
          <td class="mdname" nowrap> <em>Msg</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Conn</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Handle a FINAL TMPL DATA ACK arriving from a collector.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>E</em>&nbsp;</td><td>exporter handle </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>S</em>&nbsp;</td><td>session handle (pointer) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Coll</em>&nbsp;</td><td>collector originating the message </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Msg</em>&nbsp;</td><td>received message </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Conn</em>&nbsp;</td><td>The Connection between S to Coll</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga30a174">IPDR_OK</a> on success; <a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga30">IPDR_STATUS_RETURN_CODE</a> otherwise. </dd></dl>
<div class="fragment"><pre class="fragment">00848 {
00849         <a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html">CollectorSession</a>*       CS ;
00850         <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a>                     Status ;
00851         <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a16">IPDR_BOOL</a>                       takeThisOne ;
00852 
00853         <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a68">ExporterProtocol_KeepAliveInTimerReset</a>(Conn-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o11">Owner</a>);
00854 
00855         Status = <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a5">ExporterProtocol_CollectorSession</a>(Coll, S, &amp;CS, &amp;takeThisOne, <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a4">IPDR_FALSE</a>);
00856 
00857         <span class="keywordflow">if</span>( CS == NULL )
00858         {
00859                 <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a28">Log_Write</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a169">IPDR_LEVEL_ERROR</a>,
00860                          <span class="stringliteral">"ExporterProtocol_HandleFinalTmplDataACK"</span>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a69">MSG_EXPORTER_COLLECTOR_SESSION_FAILED</a>);
00861                 Status = <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a57">ExporterProtocol_SendError</a>(E, S, Coll, Conn, <a class="code" href="../../d2/dda/_for_doxygen_2src_2_common_2_protocol_8h.html#a57a50">CollectorNotConfigured</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a69">MSG_EXPORTER_COLLECTOR_SESSION_FAILED</a>);
00862                 <span class="keywordflow">if</span>(<a class="code" href="../../d0/d8b/_for_doxygen_2include_2_i_p_d_r_2_i_p_d_r_8h.html#a18">FAILURE</a>(Status))
00863                 {
00864                         <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a24">TL_HandleDisconnection</a>(Conn);
00865                 }
00866                 <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a180">IPDR_ERR</a>;
00867         }
00868 
00869         <span class="keywordflow">if</span>(CS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o8">TmplDataTimer</a> != NULL)
00870         <a class="code" href="../../d7/d54/_for_doxygen_2src_2_common_2_platform_8h.html#a13">Platform_UnregisterTimerAndClear</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a1">EXPORTER_PLATFORM</a>, &amp;CS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o8">TmplDataTimer</a>);
00871 
00872         <span class="keywordflow">if</span>( takeThisOne &amp;&amp; S-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o10">Running</a> == <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a5">IPDR_TRUE</a>)
00873         {
00874                 <span class="comment">/* This collector was sent supposed to be the active one */</span>
00875                 <span class="comment">/* Send session start to this one */</span>
00876                 Status = <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a59">ExporterProtocol_SendSessionStart</a>(E, S, CS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o4">Collector</a>, CS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o5">SessionConnection</a>-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o3">TCPConnection</a>);
00877                 <span class="keywordflow">if</span>(<a class="code" href="../../d0/d8b/_for_doxygen_2include_2_i_p_d_r_2_i_p_d_r_8h.html#a18">FAILURE</a>(Status))
00878                 {
00879                         <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a29">Log_Write1</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a169">IPDR_LEVEL_ERROR</a>,
00880                          <span class="stringliteral">"ExporterProtocol_HandleFinalTmplDataACK"</span>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a79">MSG_EXPORTER_SEND_SESSION_START_FAILED</a>,
00881                          <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a14">TL_GetConnectionInfoStr</a>(Conn));
00882                          <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a24">TL_HandleDisconnection</a>(Conn);
00883                          <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a180">IPDR_ERR</a>;
00884 
00885                 }
00886                 S-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o13">ActiveCS</a> = CS ;
00887                 S-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o9">Retransmite</a> = <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a5">IPDR_TRUE</a>;
00888                 CS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o1">CSState</a> = <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a52a27">IPDR_CS_ACTIVE</a>;
00889                 Status = <a class="code" href="../../dd/dd0/_for_doxygen_2src_2_exporter_2_exporter_8c.html#a48">Session_SendOutstandingData</a>(E, S);
00890                 <span class="comment">/* Send NN template data to rest of collectors in this session  */</span>
00891                 <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a6">ExporterProtocol_SyncTemplateDataAll</a>(E, S);
00892 
00893                 <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a27">Log_StateTransition</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a171">IPDR_LEVEL_INFO</a>,
00894                                                         <span class="stringliteral">"ExporterProtocol_HandleFinalTmplDataACK"</span>, Conn, CS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o1">CSState</a>, <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a52a27">IPDR_CS_ACTIVE</a>,
00895                                                         <span class="stringliteral">"got template final data ack - ready to send data"</span>);
00896                 <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a39">ExporterProtocol_FlushRecordsQueue</a>(E, S, CS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o4">Collector</a>, <span class="stringliteral">"FinalTmplDataACK"</span>);
00897         }
00898         <span class="keywordflow">else</span>
00899         {
00900                 <span class="comment">/* check if the state is correct*/</span>
00901                 <span class="keywordflow">if</span>(CS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o1">CSState</a> != <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a52a25">IPDR_CS_INITIATION</a>)
00902                 {
00903                         <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a28">Log_Write</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a169">IPDR_LEVEL_ERROR</a>,
00904                                   <span class="stringliteral">"ExporterProtocol_HandleFlowStart"</span>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a107">MSG_EXPORTER_COLLECTOR_NOT_INITIATION</a>);
00905                         Status = <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a57">ExporterProtocol_SendError</a>(E, S, Coll, Conn, <a class="code" href="../../d2/dda/_for_doxygen_2src_2_common_2_protocol_8h.html#a57a46">MessageInvalidForState</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a107">MSG_EXPORTER_COLLECTOR_NOT_INITIATION</a>);
00906                         <span class="keywordflow">if</span>(<a class="code" href="../../d0/d8b/_for_doxygen_2include_2_i_p_d_r_2_i_p_d_r_8h.html#a18">FAILURE</a>(Status))
00907                         {
00908                                 <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a24">TL_HandleDisconnection</a>(Conn);
00909                         }
00910                         <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a174">IPDR_OK</a>;
00911                 }
00912                 CS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o1">CSState</a> = <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a52a26">IPDR_CS_READY</a>;
00913                 <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a27">Log_StateTransition</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a171">IPDR_LEVEL_INFO</a>,
00914                             <span class="stringliteral">"ExporterProtocol_HandleFinalTmplDataACK"</span>, Conn, CS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o1">CSState</a>, <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a52a26">IPDR_CS_READY</a>,
00915                             <span class="stringliteral">"got template final data ack - not ActiveCS"</span>);
00916         }
00917     <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a174">IPDR_OK</a>;
00918 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="ExporterProtocol.h::ExporterProtocol_HandleFlowStart"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_Status</a> ExporterProtocol_HandleFlowStart           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../df/d71/struct_i_p_d_r__tag___exporter.html">Exporter</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>E</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d9/d35/struct_i_p_d_r__tag___session.html">Session</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>S</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../de/d0d/struct_i_p_d_r__tag___collector.html">Collector</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>Coll</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const MessageHeader *&nbsp;</td>
          <td class="mdname" nowrap> <em>Msg</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Conn</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Handles a flow start event recived from a collector<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>E</em>&nbsp;</td><td>exporter handle </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>S</em>&nbsp;</td><td>session handle (pointer) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Coll</em>&nbsp;</td><td>collector handle (pointer) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Msg</em>&nbsp;</td><td>message header from the collector </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Conn</em>&nbsp;</td><td>The Connection between S to Coll </td></tr>
  </table>
</dl>
<div class="fragment"><pre class="fragment">00456 {
00457         <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a16">IPDR_BOOL</a>                       takeThisOne = <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a4">IPDR_FALSE</a>;
00458         <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a16">IPDR_BOOL</a>                       forceThisOne = <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a4">IPDR_FALSE</a>;
00459         <a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html">CollectorSession</a>                *CS     = NULL;
00460         <a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html">IPDRConnection</a> *IC = Conn-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o11">Owner</a>;
00461         <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a>                     Status;
00462 
00463         <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a68">ExporterProtocol_KeepAliveInTimerReset</a>(IC);
00464 
00465         Status = <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a5">ExporterProtocol_CollectorSession</a>(Coll, S, &amp;CS, &amp;takeThisOne, <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a5">IPDR_TRUE</a>);
00466 
00467         <span class="keywordflow">if</span>( CS == NULL )
00468         {
00469                 <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a28">Log_Write</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a169">IPDR_LEVEL_ERROR</a>,
00470                          <span class="stringliteral">"ExporterProtocol_HandleFlowStart"</span>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a69">MSG_EXPORTER_COLLECTOR_SESSION_FAILED</a>);
00471                 Status = <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a57">ExporterProtocol_SendError</a>(E, S, Coll, Conn, <a class="code" href="../../d2/dda/_for_doxygen_2src_2_common_2_protocol_8h.html#a57a50">CollectorNotConfigured</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a69">MSG_EXPORTER_COLLECTOR_SESSION_FAILED</a>);
00472                 <span class="keywordflow">if</span>(<a class="code" href="../../d0/d8b/_for_doxygen_2include_2_i_p_d_r_2_i_p_d_r_8h.html#a18">FAILURE</a>(Status))
00473                 {
00474                         <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a24">TL_HandleDisconnection</a>(Conn);
00475                 }
00476                 <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a180">IPDR_ERR</a>;
00477         }
00478 
00479 
00480         <span class="keywordflow">if</span>(IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o1">State</a> != <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a51a23">IPDR_CONNECTION_CONNECTED</a>)
00481         {
00482                 <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a28">Log_Write</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a169">IPDR_LEVEL_ERROR</a>,
00483                          <span class="stringliteral">"ExporterProtocol_HandleFlowStart"</span>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a77">MSG_EXPORTER_COLLECTOR_NOT_CONNECTED</a>);
00484                 Status = <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a57">ExporterProtocol_SendError</a>(E, S, Coll, Conn, <a class="code" href="../../d2/dda/_for_doxygen_2src_2_common_2_protocol_8h.html#a57a51">InvalidConnectionState</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a77">MSG_EXPORTER_COLLECTOR_NOT_CONNECTED</a>);
00485                 <span class="keywordflow">if</span>(<a class="code" href="../../d0/d8b/_for_doxygen_2include_2_i_p_d_r_2_i_p_d_r_8h.html#a18">FAILURE</a>(Status))
00486                 {
00487                         <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a24">TL_HandleDisconnection</a>(Conn);
00488                 }
00489                 <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a180">IPDR_ERR</a>;
00490         }
00491 
00492         <span class="comment">/*if(S-&gt;Running == IPDR_FALSE)</span>
00493 <span class="comment">        {</span>
00494 <span class="comment">                Log_Write(EXPORTER_LOG, PROTOCOL_MODULE_ID, IPDR_LEVEL_ERROR,</span>
00495 <span class="comment">                         "ExporterProtocol_HandleFlowStart", MSG_EXPORTER_COLLECTOR_NOT_CONNECTED);</span>
00496 <span class="comment">                Status = ExporterProtocol_SendError(E, S, Coll, Conn, MessageInvalidForState, MSG_EXPORTER_WRONG_COLLECTOR_STATE);</span>
00497 <span class="comment">                if(FAILURE(Status))</span>
00498 <span class="comment">                {</span>
00499 <span class="comment">                        TL_HandleDisconnection(Conn);</span>
00500 <span class="comment">                }</span>
00501 <span class="comment">                return IPDR_ERR;</span>
00502 <span class="comment">        }*/</span>
00503 
00504         CS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o1">CSState</a> = <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a52a25">IPDR_CS_INITIATION</a>;
00505         CS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o5">SessionConnection</a> = IC ;
00506 
00507         <span class="keywordflow">if</span>(E-&gt;<a class="code" href="../../df/d71/struct_i_p_d_r__tag___exporter.html#o25">FlowStartCallback</a> != NULL)
00508                 E-&gt;<a class="code" href="../../df/d71/struct_i_p_d_r__tag___exporter.html#o25">FlowStartCallback</a>(S, Coll, &amp;forceThisOne, E-&gt;<a class="code" href="../../df/d71/struct_i_p_d_r__tag___exporter.html#o26">FlowStartCallbackArg</a>);
00509 
00510         <span class="keywordflow">if</span>( !takeThisOne &amp;&amp; !forceThisOne)
00511         {
00512                 <span class="keywordflow">if</span>(S-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o13">ActiveCS</a> == NULL)
00513                 {
00514                         <span class="comment">/* Now, setup wait for best collector and sent TEMPLATE DATA later*/</span>
00515                         <span class="keywordflow">if</span>(S-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o20">waitBestCollectorTimerID</a> == NULL)
00516                                 <a class="code" href="../../d7/d54/_for_doxygen_2src_2_common_2_platform_8h.html#a9">Platform_RegisterTimer</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a1">EXPORTER_PLATFORM</a>,
00517                                                                 <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a7">ExporterProtocol_ConnectWaitWaitBestCollectorCallback</a>,
00518                                                                 CS,
00519                                                                 E-&gt;<a class="code" href="../../df/d71/struct_i_p_d_r__tag___exporter.html#o4">Parameters</a>.<a class="code" href="../../d1/dac/struct_exporter_parameters.html#o8">WaitBestCollectorTimeout</a>,
00520                                                                 &amp; (S-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o20">waitBestCollectorTimerID</a>));
00521                         <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a174">IPDR_OK</a>;
00522                 }
00523                 <span class="keywordflow">else</span>
00524                 {
00525                         Status = <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a61">ExporterProtocol_SendTemplateData</a>(E, S, CS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o4">Collector</a>,
00526                                                                    CS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o5">SessionConnection</a>-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o3">TCPConnection</a>, <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a4">IPDR_FALSE</a>);
00527                         <span class="keywordflow">if</span>(<a class="code" href="../../d0/d8b/_for_doxygen_2include_2_i_p_d_r_2_i_p_d_r_8h.html#a18">FAILURE</a>(Status))
00528                         {
00529                                 <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a24">TL_HandleDisconnection</a>(CS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o5">SessionConnection</a>-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o3">TCPConnection</a>);
00530                                 <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a28">Log_Write</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a171">IPDR_LEVEL_INFO</a>,
00531                                           <span class="stringliteral">"ExporterProtocol_HandleFlowStart"</span>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a70">MSG_EXPORTER_SEND_TEMPLATE_DATA_FAILED</a>);
00532                         }
00533                         <span class="keywordflow">return</span> Status;
00534                 }
00535         }
00536 
00537         <span class="keywordflow">if</span>(S-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o20">waitBestCollectorTimerID</a> != NULL)
00538                 <a class="code" href="../../d7/d54/_for_doxygen_2src_2_common_2_platform_8h.html#a13">Platform_UnregisterTimerAndClear</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a1">EXPORTER_PLATFORM</a>, &amp;S-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o20">waitBestCollectorTimerID</a>);
00539 
00540         <span class="keywordflow">return</span> <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a70">ExporterProtocol_SelectCollector</a>(E, S, <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a4">IPDR_FALSE</a>, forceThisOne==<a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a5">IPDR_TRUE</a>?CS:NULL);
00541 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="ExporterProtocol.h::ExporterProtocol_HandleFlowStop"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_Status</a> ExporterProtocol_HandleFlowStop           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../df/d71/struct_i_p_d_r__tag___exporter.html">Exporter</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>E</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d9/d35/struct_i_p_d_r__tag___session.html">Session</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>S</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../de/d0d/struct_i_p_d_r__tag___collector.html">Collector</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>Coll</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const MessageHeader *&nbsp;</td>
          <td class="mdname" nowrap> <em>Msg</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Conn</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Handles a flow stop event recived from a collector<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>E</em>&nbsp;</td><td>exporter handle </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>S</em>&nbsp;</td><td>session handle (pointer) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Coll</em>&nbsp;</td><td>collector handle (pointer) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Msg</em>&nbsp;</td><td>message header from the collector </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Conn</em>&nbsp;</td><td>The Connection between S to Coll </td></tr>
  </table>
</dl>
<div class="fragment"><pre class="fragment">00557 {
00558         <span class="keywordtype">int</span> Index;
00559         <a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html">CollectorSession</a> *SCS;
00560         <a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html">IPDRConnection</a> *IC = Conn-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o11">Owner</a>;
00561         <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a> Status;
00562 
00563         <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a68">ExporterProtocol_KeepAliveInTimerReset</a>(Conn-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o11">Owner</a>);
00564 
00565         <span class="keywordflow">for</span> (Index = 0; Index &lt; S-&gt;CollectorSessions.Length; Index++)
00566         {
00567                 SCS = (<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html">CollectorSession</a> *) S-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o14">CollectorSessions</a>.<a class="code" href="../../db/dc0/struct_dynamic_array.html#o0">Data</a>[Index];
00568                 <span class="keywordflow">if</span>(IC == SCS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o5">SessionConnection</a>)
00569                 {
00570                         <span class="keywordflow">if</span>(SCS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o1">CSState</a> != <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a52a26">IPDR_CS_READY</a> &amp;&amp; SCS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o1">CSState</a> != <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a52a27">IPDR_CS_ACTIVE</a>)
00571                         {
00572 
00573                                 <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a28">Log_Write</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a169">IPDR_LEVEL_ERROR</a>,
00574                                           <span class="stringliteral">"ExporterProtocol_HandleFlowStop"</span>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a78">MSG_EXPORTER_WRONG_COLLECTOR_STATE</a>);
00575                                 Status = <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a57">ExporterProtocol_SendError</a>(E, S, Coll, Conn, <a class="code" href="../../d2/dda/_for_doxygen_2src_2_common_2_protocol_8h.html#a57a46">MessageInvalidForState</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a78">MSG_EXPORTER_WRONG_COLLECTOR_STATE</a>);
00576                                 <span class="keywordflow">if</span>(<a class="code" href="../../d0/d8b/_for_doxygen_2include_2_i_p_d_r_2_i_p_d_r_8h.html#a18">FAILURE</a>(Status))
00577                                 {
00578                                         <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a24">TL_HandleDisconnection</a>(Conn);
00579                                 }
00580                         }
00581                         SCS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o1">CSState</a> = <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a52a24">IPDR_CS_DISCONNECTED</a> ;
00582                 }
00583         }
00584     <span class="keywordflow">return</span> <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a70">ExporterProtocol_SelectCollector</a>( E, S, <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a4">IPDR_FALSE</a>, NULL);
00585 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="ExporterProtocol.h::ExporterProtocol_HandleGetSessions"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_Status</a> ExporterProtocol_HandleGetSessions           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../df/d71/struct_i_p_d_r__tag___exporter.html">Exporter</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>E</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d9/d35/struct_i_p_d_r__tag___session.html">Session</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>S</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../de/d0d/struct_i_p_d_r__tag___collector.html">Collector</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>Coll</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const MessageHeader *&nbsp;</td>
          <td class="mdname" nowrap> <em>Msg</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Conn</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Handle a GET SESSIONS message from a collector.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>E</em>&nbsp;</td><td>exporter handle </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>S</em>&nbsp;</td><td>session handle (pointer) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Coll</em>&nbsp;</td><td>collector </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Msg</em>&nbsp;</td><td>received message </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Conn</em>&nbsp;</td><td>connection</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga30a174">IPDR_OK</a> on success; <a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga30">IPDR_STATUS_RETURN_CODE</a> otherwise. </dd></dl>
<div class="fragment"><pre class="fragment">01014 {
01015     <span class="keyword">const</span> GetSessionsMessage *GSM = (<span class="keyword">const</span> GetSessionsMessage *) Msg;
01016         <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> RequestID = <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a11">IPDR_NTOHS</a>(GSM-&gt;RequestID);
01017 
01018         <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a68">ExporterProtocol_KeepAliveInTimerReset</a>(Conn-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o11">Owner</a>);
01019 
01020     <span class="keywordflow">return</span> <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a64">ExporterProtocol_SendGetSessionsResponse</a>(E, S, Coll, Conn, RequestID);
01021 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="ExporterProtocol.h::ExporterProtocol_HandleGetTemplates"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_Status</a> ExporterProtocol_HandleGetTemplates           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../df/d71/struct_i_p_d_r__tag___exporter.html">Exporter</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>E</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d9/d35/struct_i_p_d_r__tag___session.html">Session</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>S</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../de/d0d/struct_i_p_d_r__tag___collector.html">Collector</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>Coll</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const MessageHeader *&nbsp;</td>
          <td class="mdname" nowrap> <em>Msg</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Conn</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Handle a GET TMPLS message from a server (collector).<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>E</em>&nbsp;</td><td>exporter handle </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>S</em>&nbsp;</td><td>session handle (pointer) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Coll</em>&nbsp;</td><td>collector </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Msg</em>&nbsp;</td><td>received message </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Conn</em>&nbsp;</td><td>The Connection between S to Coll</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga30a174">IPDR_OK</a> on success; <a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga30">IPDR_STATUS_RETURN_CODE</a> otherwise. </dd></dl>
<div class="fragment"><pre class="fragment">01039 {
01040     <span class="keyword">const</span> GetTemplatesMessage *GTH = (<span class="keyword">const</span> GetTemplatesMessage *) Msg;
01041         <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> RequestID = <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a11">IPDR_NTOHS</a>(GTH-&gt;RequestID);
01042 
01043         <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a68">ExporterProtocol_KeepAliveInTimerReset</a>(Conn-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o11">Owner</a>);
01044 
01045     <span class="keywordflow">return</span> <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a65">ExporterProtocol_SendGetTemplatesResponse</a>(E, S, Coll, Conn, RequestID);
01046 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="ExporterProtocol.h::ExporterProtocol_HandleKeepAlive"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_Status</a> ExporterProtocol_HandleKeepAlive           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../df/d71/struct_i_p_d_r__tag___exporter.html">Exporter</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>E</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d9/d35/struct_i_p_d_r__tag___session.html">Session</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>S</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../de/d0d/struct_i_p_d_r__tag___collector.html">Collector</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>Coll</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const MessageHeader *&nbsp;</td>
          <td class="mdname" nowrap> <em>Msg</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Conn</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">01463 {
01464         <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a28">TL_PABuf</a> paBuf;
01465         <a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html">IPDRConnection</a> *IC = (<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html">IPDRConnection</a> *)Conn-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o11">Owner</a>;
01466         <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a68">ExporterProtocol_KeepAliveInTimerReset</a>(IC);
01467         <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a29">Log_Write1</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a1">EXPORTER_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a171">IPDR_LEVEL_INFO</a>,
01468                <span class="stringliteral">"ExporterProtocol_HandleKeepAlive"</span>,
01469                <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a96">MSG_EXPORTER_SEND_KEEPALIVE_RECEIVED</a>,
01470                            <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a18">TL_PrintConnectionRemote</a>(Conn, paBuf));
01471         <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a174">IPDR_OK</a>;
01472 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="ExporterProtocol.h::ExporterProtocol_HandleModifyTemplate"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_Status</a> ExporterProtocol_HandleModifyTemplate           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../df/d71/struct_i_p_d_r__tag___exporter.html">Exporter</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>E</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d9/d35/struct_i_p_d_r__tag___session.html">Session</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>S</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../de/d0d/struct_i_p_d_r__tag___collector.html">Collector</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>Coll</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const MessageHeader *&nbsp;</td>
          <td class="mdname" nowrap> <em>Msg</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Conn</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Handles a modify template event recived from a collector<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>E</em>&nbsp;</td><td>exporter handle </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>S</em>&nbsp;</td><td>session handle (pointer) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Coll</em>&nbsp;</td><td>collector handle (pointer) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Msg</em>&nbsp;</td><td>message header from the collector </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Conn</em>&nbsp;</td><td>The Connection between S to Coll </td></tr>
  </table>
</dl>
<div class="fragment"><pre class="fragment">00602 {
00603         <a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html">IPDRConnection</a>*                                 IC;
00604         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>                                    MsgLen;
00605         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*                                  ReadBuffer;
00606         <span class="keywordtype">int</span>                                                             Index, TmplIndex, IndexTC, IndexNew, iTCFld, iNewFld;
00607         <span class="keywordtype">int</span>                                                             LengthLeft;
00608         ModifyTemplateResponseMessage   H ;
00609         <a class="code" href="../../d1/d8c/struct_i_p_d_r__tag___transmission_context.html">TransmissionContext</a>*                            TC;
00610         <a class="code" href="../../db/dc0/struct_dynamic_array.html">DynamicArray</a>                                    NewTmpls;
00611         <a class="code" href="../../da/d62/struct_i_p_d_r__tag___template.html">Template</a>                                                *T, *TemplTC ;
00612         <a class="code" href="../../de/d6f/struct_i_p_d_r__tag___key.html">Key</a>                                                     *TCKey, *NewKey;
00613     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>                                       ConfigurationID ;
00614     <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>                                      NumOfTemplates ;
00615         <a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html">CollectorSession</a>                                *CS ;
00616         <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a>                                             Status;
00617         <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a16">IPDR_BOOL</a>                                               TemplatesChanged = <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a4">IPDR_FALSE</a>;
00618 
00619         <span class="keywordflow">if</span>(!E || !S || !Coll || !Conn || !(Conn-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o11">Owner</a>) || !Msg)
00620                 <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a180">IPDR_ERR</a> ;
00621 
00622         IC = Conn-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o11">Owner</a>;
00623         MsgLen = <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a12">IPDR_NTOHL</a>(Msg-&gt;MessageLength);
00624         TC = S-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o3">ActiveContext</a>;
00625 
00626         <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a68">ExporterProtocol_KeepAliveInTimerReset</a>(IC);
00627 
00628         <span class="comment">/* check for out of the blue ACK */</span>
00629         <span class="keywordflow">if</span>( MsgLen &lt; <span class="keyword">sizeof</span>(ModifyTemplateResponseMessage) )
00630         {
00631                 <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a30">Log_Write2</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a171">IPDR_LEVEL_INFO</a>,
00632                    <span class="stringliteral">"ExporterProtocol_HandleModifyTemplate"</span>,
00633                    <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a68">MSG_EXPORTER_TEMPLATE_RESPONSE_INVALID_VALUE</a>,
00634                    MsgLen, <span class="keyword">sizeof</span>(ModifyTemplateResponseMessage));
00635                 <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a174">IPDR_OK</a>;
00636         }
00637         memcpy( &amp;H, Msg, <span class="keyword">sizeof</span>(ModifyTemplateResponseMessage) );
00638         ConfigurationID = <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a11">IPDR_NTOHS</a>(H.ConfigurationID);
00639         NumOfTemplates = <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a12">IPDR_NTOHL</a>(H.NumOfTemplates);
00640 
00641         <span class="keywordflow">if</span> (ConfigurationID != TC-&gt;<a class="code" href="../../d1/d8c/struct_i_p_d_r__tag___transmission_context.html#o3">ConfigurationID</a>)
00642         {
00643         <span class="comment">/* XXX should signal error event */</span>
00644         <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a30">Log_Write2</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a169">IPDR_LEVEL_ERROR</a>,
00645                            <span class="stringliteral">"ExporterProtocol_HandleModifyTemplate"</span>,
00646                            <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a15">MSG_EXPORTER_WRONG_CONFIGURATION_ID</a>, TC-&gt;<a class="code" href="../../d1/d8c/struct_i_p_d_r__tag___transmission_context.html#o3">ConfigurationID</a>,ConfigurationID);
00647         <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a174">IPDR_OK</a>;
00648     }
00649 
00650         <span class="comment">// The template is not negotiable, Modify Templateis not allowed</span>
00651         <span class="keywordflow">if</span> (TC-&gt;<a class="code" href="../../d1/d8c/struct_i_p_d_r__tag___transmission_context.html#o4">Negotiable</a> != <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a5">IPDR_TRUE</a>)
00652         {
00653                 <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a28">Log_Write</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a170">IPDR_LEVEL_WARNING</a>,
00654                          <span class="stringliteral">"ExporterProtocol_HandleModifyTemplate"</span>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a114">MSG_EXPORTER_INVALID_CAPABILITIES</a>);
00655                 <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a57">ExporterProtocol_SendError</a>(E, S, Coll, Conn, <a class="code" href="../../d2/dda/_for_doxygen_2src_2_common_2_protocol_8h.html#a57a45">MessageInvalidForCapabilities</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a114">MSG_EXPORTER_INVALID_CAPABILITIES</a>);
00656                 <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a174">IPDR_OK</a> ;
00657         }
00658 
00659         Status = <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a5">ExporterProtocol_CollectorSession</a>(Coll, S, &amp;CS, NULL, <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a5">IPDR_TRUE</a>);
00660         <span class="keywordflow">if</span>( <a class="code" href="../../d0/d8b/_for_doxygen_2include_2_i_p_d_r_2_i_p_d_r_8h.html#a18">FAILURE</a>(Status))
00661         {
00662                 <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a28">Log_Write</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a169">IPDR_LEVEL_ERROR</a>,
00663                          <span class="stringliteral">"ExporterProtocol_HandleModifyTemplate"</span>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a69">MSG_EXPORTER_COLLECTOR_SESSION_FAILED</a>);
00664                 <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a57">ExporterProtocol_SendError</a>(E, S, Coll, Conn, <a class="code" href="../../d2/dda/_for_doxygen_2src_2_common_2_protocol_8h.html#a57a50">CollectorNotConfigured</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a69">MSG_EXPORTER_COLLECTOR_SESSION_FAILED</a>);
00665                 <span class="keywordflow">return</span> Status ;
00666         }
00667 
00668         <span class="comment">/* Read the received templates into array */</span>
00669         Status = <a class="code" href="../../dd/d31/_for_doxygen_2src_2_common_2_dynamic_array_8c.html#a2">DynamicArray_Create</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a1">EXPORTER_PLATFORM</a>, &amp;NewTmpls, 0);
00670         <span class="keywordflow">if</span>( <a class="code" href="../../d0/d8b/_for_doxygen_2include_2_i_p_d_r_2_i_p_d_r_8h.html#a18">FAILURE</a>(Status) )
00671         {
00672                 <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a28">Log_Write</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a169">IPDR_LEVEL_ERROR</a>,
00673                          <span class="stringliteral">"ExporterProtocol_HandleModifyTemplate"</span>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a110">MSG_EXPORTER_CREATE_DYNAMIC_ARRAY_FAILED</a>);
00674                 <span class="keywordflow">return</span> Status;
00675         }
00676 
00677         ReadBuffer = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)((size_t)Msg +
00678 <span class="keyword">sizeof</span>(ModifyTemplateResponseMessage));
00679         <span class="keywordflow">for</span>( Index = 0; Index &lt; NumOfTemplates; Index++ )
00680         {
00681                 <span class="comment">/* Calculate, how much of message left to read. Do not allow to overflow this value */</span>
00682                 LengthLeft = MsgLen - ((size_t)ReadBuffer - ((size_t)Msg +
00683 <span class="keyword">sizeof</span>(ModifyTemplateResponseMessage)));
00684                 Status = <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a26">ExporterProtocol_ReadTemplateBlock</a>(S, &amp;T, &amp;ReadBuffer, &amp;LengthLeft );
00685                 <span class="keywordflow">if</span>( <a class="code" href="../../d0/d8b/_for_doxygen_2include_2_i_p_d_r_2_i_p_d_r_8h.html#a18">FAILURE</a>(Status) )
00686                 {
00687                         <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a28">Log_Write</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a171">IPDR_LEVEL_INFO</a>,
00688                                   <span class="stringliteral">"ExporterProtocol_HandleModifyTemplate"</span>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a86">MSG_EXPORTER_READ_TEMPLATE_BLOCK_FAILED</a>);
00689                         break ;
00690                 }
00691                 Status = <a class="code" href="../../dd/d31/_for_doxygen_2src_2_common_2_dynamic_array_8c.html#a12">DynamicArray_AddElement</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a1">EXPORTER_PLATFORM</a>, &amp; (NewTmpls), T, &amp;TmplIndex);
00692         }
00693 
00694         <span class="comment">/*Status = IPDR_OK;*/</span>
00695         <span class="keywordflow">for</span>(IndexTC = 0 ; IndexTC &lt; TC-&gt;<a class="code" href="../../d1/d8c/struct_i_p_d_r__tag___transmission_context.html#o2">Templates</a>.<a class="code" href="../../db/dc0/struct_dynamic_array.html#o1">Length</a>; IndexTC++)
00696         {
00697                 TemplTC = (<a class="code" href="../../da/d62/struct_i_p_d_r__tag___template.html">Template</a> *) TC-&gt;<a class="code" href="../../d1/d8c/struct_i_p_d_r__tag___transmission_context.html#o2">Templates</a>.<a class="code" href="../../db/dc0/struct_dynamic_array.html#o0">Data</a>[IndexTC];
00698                 <span class="keywordflow">for</span>(IndexNew = 0 ; IndexNew &lt; NewTmpls.<a class="code" href="../../db/dc0/struct_dynamic_array.html#o1">Length</a>; IndexNew++)
00699                 {
00700                         T = (<a class="code" href="../../da/d62/struct_i_p_d_r__tag___template.html">Template</a> *) NewTmpls.<a class="code" href="../../db/dc0/struct_dynamic_array.html#o0">Data</a>[IndexNew];
00701                         <span class="keywordflow">if</span>(TemplTC-&gt;<a class="code" href="../../da/d62/struct_i_p_d_r__tag___template.html#o0">TemplateID</a> == T-&gt;<a class="code" href="../../da/d62/struct_i_p_d_r__tag___template.html#o0">TemplateID</a>)
00702                         {
00703                                 <span class="keywordtype">int</span> keysFound = 0;
00704                                 <span class="keywordflow">for</span>(iTCFld = 0 ; iTCFld &lt; TemplTC-&gt;<a class="code" href="../../da/d62/struct_i_p_d_r__tag___template.html#o3">Keys</a>.<a class="code" href="../../db/dc0/struct_dynamic_array.html#o1">Length</a> ; iTCFld++)
00705                                 {
00706                                         TCKey = (<a class="code" href="../../de/d6f/struct_i_p_d_r__tag___key.html">Key</a> *) TemplTC-&gt;<a class="code" href="../../da/d62/struct_i_p_d_r__tag___template.html#o3">Keys</a>.<a class="code" href="../../db/dc0/struct_dynamic_array.html#o0">Data</a>[iTCFld];
00707                                         <span class="keywordflow">for</span>(iNewFld = 0 ; iNewFld &lt; T-&gt;<a class="code" href="../../da/d62/struct_i_p_d_r__tag___template.html#o3">Keys</a>.<a class="code" href="../../db/dc0/struct_dynamic_array.html#o1">Length</a> ; iNewFld++)
00708                                         {
00709                                                 NewKey = (<a class="code" href="../../de/d6f/struct_i_p_d_r__tag___key.html">Key</a> *) T-&gt;<a class="code" href="../../da/d62/struct_i_p_d_r__tag___template.html#o3">Keys</a>.<a class="code" href="../../db/dc0/struct_dynamic_array.html#o0">Data</a>[iNewFld];
00710                                                 <span class="keywordflow">if</span>(TCKey-&gt;<a class="code" href="../../de/d6f/struct_i_p_d_r__tag___key.html#o0">KeyID</a> == NewKey-&gt;<a class="code" href="../../de/d6f/struct_i_p_d_r__tag___key.html#o0">KeyID</a>)
00711                                                 {
00712                                                         keysFound++;
00713                                                         <span class="keywordflow">if</span>((TCKey-&gt;<a class="code" href="../../de/d6f/struct_i_p_d_r__tag___key.html#o1">KeyTypeID</a> &amp;~<a class="code" href="../../df/dcb/group___i_p_d_r__key__type__attributes.html#ga41">IPDR_TYPE_VAR_LENGTH</a>) != NewKey-&gt;<a class="code" href="../../de/d6f/struct_i_p_d_r__tag___key.html#o1">KeyTypeID</a>)
00714                                                         {
00715                                                                 Status = <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a180">IPDR_ERR</a>;
00716                                                                 break ;
00717                                                         }
00718                                                         <span class="keywordflow">if</span>(strcmp(TCKey-&gt;<a class="code" href="../../de/d6f/struct_i_p_d_r__tag___key.html#o2">Name</a>, NewKey-&gt;<a class="code" href="../../de/d6f/struct_i_p_d_r__tag___key.html#o2">Name</a>) != 0)
00719                                                         {
00720                                                                 Status = <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a180">IPDR_ERR</a>;
00721                                                                 break ;
00722                                                         }
00723 
00724                                                 }
00725                                         }
00726                                         <span class="keywordflow">if</span>(Status == <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a180">IPDR_ERR</a>)
00727                                                 <span class="keywordflow">break</span>;
00728                                 }
00729                                 <span class="keywordflow">if</span>(keysFound != TemplTC-&gt;<a class="code" href="../../da/d62/struct_i_p_d_r__tag___template.html#o3">Keys</a>.<a class="code" href="../../db/dc0/struct_dynamic_array.html#o1">Length</a> || Status == <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a180">IPDR_ERR</a>)
00730                                 {
00731                                         Status = <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a180">IPDR_ERR</a>;
00732                                         break ;
00733                                 }
00734                                 <span class="keywordflow">else</span>
00735                                 {
00736                                         <span class="keywordflow">for</span>(iTCFld = 0 ; iTCFld &lt; TemplTC-&gt;<a class="code" href="../../da/d62/struct_i_p_d_r__tag___template.html#o3">Keys</a>.<a class="code" href="../../db/dc0/struct_dynamic_array.html#o1">Length</a> ; iTCFld++)
00737                                         {
00738                                                 TCKey = (<a class="code" href="../../de/d6f/struct_i_p_d_r__tag___key.html">Key</a> *) TemplTC-&gt;<a class="code" href="../../da/d62/struct_i_p_d_r__tag___template.html#o3">Keys</a>.<a class="code" href="../../db/dc0/struct_dynamic_array.html#o0">Data</a>[iTCFld];
00739                                                 <span class="keywordflow">for</span>(iNewFld = 0 ; iNewFld &lt; T-&gt;<a class="code" href="../../da/d62/struct_i_p_d_r__tag___template.html#o3">Keys</a>.<a class="code" href="../../db/dc0/struct_dynamic_array.html#o1">Length</a> ; iNewFld++)
00740                                                 {
00741                                                         NewKey = (<a class="code" href="../../de/d6f/struct_i_p_d_r__tag___key.html">Key</a> *) T-&gt;<a class="code" href="../../da/d62/struct_i_p_d_r__tag___template.html#o3">Keys</a>.<a class="code" href="../../db/dc0/struct_dynamic_array.html#o0">Data</a>[iNewFld];
00742                                                         <span class="keywordflow">if</span>(TCKey-&gt;<a class="code" href="../../de/d6f/struct_i_p_d_r__tag___key.html#o0">KeyID</a> == NewKey-&gt;<a class="code" href="../../de/d6f/struct_i_p_d_r__tag___key.html#o0">KeyID</a>)
00743                                                         {
00744                                                                 <span class="keywordflow">if</span>(TCKey-&gt;<a class="code" href="../../de/d6f/struct_i_p_d_r__tag___key.html#o5">Enabled</a> != NewKey-&gt;<a class="code" href="../../de/d6f/struct_i_p_d_r__tag___key.html#o5">Enabled</a>)
00745                                                                 {
00746                                                                         TemplatesChanged = <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a5">IPDR_TRUE</a>;
00747                                                                         TCKey-&gt;<a class="code" href="../../de/d6f/struct_i_p_d_r__tag___key.html#o5">Enabled</a> = NewKey-&gt;<a class="code" href="../../de/d6f/struct_i_p_d_r__tag___key.html#o5">Enabled</a>;
00748                                                                         <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a32">Log_Write4</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a172">IPDR_LEVEL_DEBUG</a>,
00749                                                                                   <span class="stringliteral">"ExporterProtocol_HandleModifyTemplate"</span>,
00750                                                                                   <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a115">MSG_EXPORTER_TEMPLATE_CHANGE_RECIVED</a>,
00751                                                                                   TemplTC-&gt;<a class="code" href="../../da/d62/struct_i_p_d_r__tag___template.html#o0">TemplateID</a>,
00752                                                                                   TCKey-&gt;<a class="code" href="../../de/d6f/struct_i_p_d_r__tag___key.html#o0">KeyID</a>,
00753                                                                                   TCKey-&gt;<a class="code" href="../../de/d6f/struct_i_p_d_r__tag___key.html#o2">Name</a>,
00754                                                                                   TCKey-&gt;<a class="code" href="../../de/d6f/struct_i_p_d_r__tag___key.html#o5">Enabled</a> == <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a5">IPDR_TRUE</a> ? <span class="stringliteral">"Enable"</span> : <span class="stringliteral">"Disable"</span>);
00755                                                                 }
00756                                                         }
00757                                                 }
00758                                         }
00759                                 }
00760                         }
00761                         <span class="keywordflow">if</span>(Status == <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a180">IPDR_ERR</a>)
00762                                 <span class="keywordflow">break</span>;
00763                 }
00764                 <span class="keywordflow">if</span>(Status == <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a180">IPDR_ERR</a>)
00765                         <span class="keywordflow">break</span>;
00766         }
00767 
00768         <span class="keywordflow">if</span>(<a class="code" href="../../d0/d8b/_for_doxygen_2include_2_i_p_d_r_2_i_p_d_r_8h.html#a17">SUCCESS</a>(Status))
00769         {
00770                 <span class="keywordflow">if</span>(CS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o8">TmplDataTimer</a> != NULL)
00771                 <a class="code" href="../../d7/d54/_for_doxygen_2src_2_common_2_platform_8h.html#a13">Platform_UnregisterTimerAndClear</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a1">EXPORTER_PLATFORM</a>, &amp;CS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o8">TmplDataTimer</a>);
00772 
00773                 <span class="keywordflow">if</span>(TemplatesChanged == <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a5">IPDR_TRUE</a>)
00774                 {
00775                         S-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o12">TemplatesChnged</a> = <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a5">IPDR_TRUE</a>;
00776                         <a class="code" href="../../dd/dd0/_for_doxygen_2src_2_exporter_2_exporter_8c.html#a97">Exporter_TriggeTemplateChangedCallback</a>(S);
00777 
00778                         <span class="keywordflow">for</span>(IndexTC = 0 ; IndexTC &lt; TC-&gt;<a class="code" href="../../d1/d8c/struct_i_p_d_r__tag___transmission_context.html#o2">Templates</a>.<a class="code" href="../../db/dc0/struct_dynamic_array.html#o1">Length</a>; IndexTC++)
00779                         {
00780                                 TemplTC = (<a class="code" href="../../da/d62/struct_i_p_d_r__tag___template.html">Template</a> *) TC-&gt;<a class="code" href="../../d1/d8c/struct_i_p_d_r__tag___transmission_context.html#o2">Templates</a>.<a class="code" href="../../db/dc0/struct_dynamic_array.html#o0">Data</a>[IndexTC];
00781                                 <span class="keywordflow">for</span>(iTCFld = 0 ; iTCFld &lt; TemplTC-&gt;<a class="code" href="../../da/d62/struct_i_p_d_r__tag___template.html#o3">Keys</a>.<a class="code" href="../../db/dc0/struct_dynamic_array.html#o1">Length</a> ; iTCFld++)
00782                                 {
00783                                         TCKey = (<a class="code" href="../../de/d6f/struct_i_p_d_r__tag___key.html">Key</a> *) TemplTC-&gt;<a class="code" href="../../da/d62/struct_i_p_d_r__tag___template.html#o3">Keys</a>.<a class="code" href="../../db/dc0/struct_dynamic_array.html#o0">Data</a>[iTCFld];
00784                                         <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a32">Log_Write4</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a172">IPDR_LEVEL_DEBUG</a>,
00785                                                   <span class="stringliteral">"ExporterProtocol_HandleModifyTemplate"</span>,
00786                                                   <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a116">MSG_EXPORTER_TEMPLATE_CHANGE_SENT</a>,
00787                                                   TemplTC-&gt;<a class="code" href="../../da/d62/struct_i_p_d_r__tag___template.html#o0">TemplateID</a>,
00788                                                   TCKey-&gt;<a class="code" href="../../de/d6f/struct_i_p_d_r__tag___key.html#o0">KeyID</a>,
00789                                                   TCKey-&gt;<a class="code" href="../../de/d6f/struct_i_p_d_r__tag___key.html#o2">Name</a>,
00790                                                   TCKey-&gt;<a class="code" href="../../de/d6f/struct_i_p_d_r__tag___key.html#o5">Enabled</a> == <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a5">IPDR_TRUE</a> ? <span class="stringliteral">"Enable"</span> : <span class="stringliteral">"Disable"</span>);
00791                                 }
00792                         }
00793                 }
00794 
00795                 Status = <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a62">ExporterProtocol_SendModifyTemplateResponse</a>(E, S, Coll, Conn);
00796                 <span class="keywordflow">if</span>(<a class="code" href="../../d0/d8b/_for_doxygen_2include_2_i_p_d_r_2_i_p_d_r_8h.html#a18">FAILURE</a>(Status))
00797                 {
00798                         <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a24">TL_HandleDisconnection</a>(Conn);
00799                 }
00800         }
00801         <span class="keywordflow">else</span>
00802         {
00803                 <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a28">Log_Write</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a1">EXPORTER_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a170">IPDR_LEVEL_WARNING</a>,
00804                           <span class="stringliteral">"ExporterProtocol_HandleModifyTemplate"</span>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a83">MSG_EXPORTER_BROKEN_TEMPLATE</a>);
00805                 Status = <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a57">ExporterProtocol_SendError</a>(E, S, Coll, Conn, <a class="code" href="../../d2/dda/_for_doxygen_2src_2_common_2_protocol_8h.html#a57a49">BrokenTemplate</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a83">MSG_EXPORTER_BROKEN_TEMPLATE</a>);
00806                 <span class="keywordflow">if</span>(<a class="code" href="../../d0/d8b/_for_doxygen_2include_2_i_p_d_r_2_i_p_d_r_8h.html#a18">FAILURE</a>(Status))
00807                 {
00808                         <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a24">TL_HandleDisconnection</a>(Conn);
00809                 }
00810         }
00811 
00812 
00813         <a class="code" href="../../dd/d31/_for_doxygen_2src_2_common_2_dynamic_array_8c.html#a5">DynamicArray_Delete</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a1">EXPORTER_PLATFORM</a>, &amp;(NewTmpls));
00814 
00815     <span class="comment">/* check if there is a need to change the currently active server (collector) */</span>
00816     <span class="keywordflow">if</span> (S-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o13">ActiveCS</a> == NULL || CS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o6">Priority</a> &lt; S-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o13">ActiveCS</a>-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o6">Priority</a>) {
00817                 <a class="code" href="../../dd/dd0/_for_doxygen_2src_2_exporter_2_exporter_8c.html#a46">Session_SelectActiveCollector</a>(E, S);
00818     }
00819 
00820     <span class="comment">/* handle the changes placed within the message */</span>
00821     <a class="code" href="../../dd/dd0/_for_doxygen_2src_2_exporter_2_exporter_8c.html#a47">Session_HandleTemplateChanges</a>(E, S, NumOfTemplates,
00822                                   (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)((size_t)Msg +
00823                                                                         <span class="keyword">sizeof</span>(ModifyTemplateResponseMessage)),
00824                                   <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a4">IPDR_FALSE</a>, <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a4">IPDR_FALSE</a>, <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a4">IPDR_FALSE</a>);
00825 
00826     <span class="comment">/* send any outstanding data */</span>
00827     <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a39">ExporterProtocol_FlushRecordsQueue</a>(E, S, Coll, <span class="stringliteral">"TmplDataACK"</span>);
00828 
00829     <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a174">IPDR_OK</a>;
00830 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="ExporterProtocol.h::ExporterProtocol_HandleStartNegotiation"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_Status</a> ExporterProtocol_HandleStartNegotiation           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../df/d71/struct_i_p_d_r__tag___exporter.html">Exporter</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>E</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d9/d35/struct_i_p_d_r__tag___session.html">Session</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>S</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../de/d0d/struct_i_p_d_r__tag___collector.html">Collector</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>Coll</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const MessageHeader *&nbsp;</td>
          <td class="mdname" nowrap> <em>Msg</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Conn</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Handle a START NEGOTIATE message from a collector.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>E</em>&nbsp;</td><td>exporter handle </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>S</em>&nbsp;</td><td>session handle (pointer) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Coll</em>&nbsp;</td><td>server </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Msg</em>&nbsp;</td><td>received message </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Conn</em>&nbsp;</td><td>connection</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga30a174">IPDR_OK</a> on success; <a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga30">IPDR_STATUS_RETURN_CODE</a> otherwise. </dd></dl>
<div class="fragment"><pre class="fragment">00936 {
00937         <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a16">IPDR_BOOL</a> Negotiate =   <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a4">IPDR_FALSE</a> ;
00938         <a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html">CollectorSession</a>*       CS;
00939         <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a>             Status ;
00940 
00941         <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a68">ExporterProtocol_KeepAliveInTimerReset</a>(Conn-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o11">Owner</a>);
00942 
00943         <span class="keywordflow">if</span>(E-&gt;<a class="code" href="../../df/d71/struct_i_p_d_r__tag___exporter.html#o27">StartNegotiationCallback</a> != NULL)
00944                 E-&gt;<a class="code" href="../../df/d71/struct_i_p_d_r__tag___exporter.html#o27">StartNegotiationCallback</a>(S, Coll, &amp;Negotiate, E-&gt;<a class="code" href="../../df/d71/struct_i_p_d_r__tag___exporter.html#o28">StartNegotiationCallbackArg</a>);
00945 
00946         <span class="keywordflow">if</span>(Negotiate == <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a5">IPDR_TRUE</a> &amp;&amp; S-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o11">Negotiable</a> == <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a5">IPDR_TRUE</a>)
00947         {
00948                 <span class="keywordflow">if</span>( <a class="code" href="../../d0/d8b/_for_doxygen_2include_2_i_p_d_r_2_i_p_d_r_8h.html#a18">FAILURE</a>(<a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a5">ExporterProtocol_CollectorSession</a>(Coll, S, &amp;CS, NULL, <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a5">IPDR_TRUE</a>)))
00949                 {
00950                         <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a28">Log_Write</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a171">IPDR_LEVEL_INFO</a>,
00951                                           <span class="stringliteral">"ExporterProtocol_HandleStartNegotiation"</span>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a108">MSG_EXPORTER_SEND_NEGOTIATION_REJECT_FAILED</a>);
00952                         <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a24">TL_HandleDisconnection</a>(Conn);
00953                         <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a180">IPDR_ERR</a>;
00954                 }
00955                 <span class="keywordflow">if</span>( CS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o1">CSState</a> != <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a52a27">IPDR_CS_ACTIVE</a> )
00956                 {
00957                         <span class="comment">/* TODO: set up correct message defines*/</span>
00958                         <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a28">Log_Write</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a171">IPDR_LEVEL_INFO</a>,
00959                                           <span class="stringliteral">"ExporterProtocol_HandleStartNegotiation"</span>, <span class="stringliteral">"StartNegotiation is invalid in this state"</span>);
00960                         <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a57">ExporterProtocol_SendError</a>(E, S, Coll, Conn, <a class="code" href="../../d2/dda/_for_doxygen_2src_2_common_2_protocol_8h.html#a57a46">MessageInvalidForState</a>, <span class="stringliteral">"StartNegotiation is invalid in this state"</span>);
00961                         <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a180">IPDR_ERR</a>;
00962                 }
00963                 CS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o1">CSState</a> = <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a52a25">IPDR_CS_INITIATION</a>;
00964                 <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a39">ExporterProtocol_FlushRecordsQueue</a>(E, S, Coll, <span class="stringliteral">"StartNegotiate"</span>);
00965 
00966                 Status = <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a60">ExporterProtocol_SendSessionStop</a>(E, S, Coll, Conn, <a class="code" href="../../df/dcb/group___i_p_d_r__key__type__attributes.html#gga66a124">IPDR_STOP_REASON_RENEGOTIATION</a>, <span class="stringliteral">"StartNegotiate"</span>);
00967                 <span class="keywordflow">if</span>(<a class="code" href="../../d0/d8b/_for_doxygen_2include_2_i_p_d_r_2_i_p_d_r_8h.html#a18">FAILURE</a>(Status))
00968                 {
00969                         <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a29">Log_Write1</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a171">IPDR_LEVEL_INFO</a>,
00970                                    <span class="stringliteral">"ExporterProtocol_HandleStartNegotiation"</span>,
00971                                    <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a98">MSG_EXPORTER_SEND_SESSION_STOP_FAILED</a>,<span class="stringliteral">"StartNegotiate"</span>);
00972                         <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a24">TL_HandleDisconnection</a>(Conn);
00973                         <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a180">IPDR_ERR</a>;
00974                 }
00975                 Status = <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a61">ExporterProtocol_SendTemplateData</a>(E, S, Coll, Conn, <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a5">IPDR_TRUE</a>);
00976                 <span class="keywordflow">if</span>(<a class="code" href="../../d0/d8b/_for_doxygen_2include_2_i_p_d_r_2_i_p_d_r_8h.html#a18">FAILURE</a>(Status))
00977                 {
00978                         <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a28">Log_Write</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a171">IPDR_LEVEL_INFO</a>,
00979                                           <span class="stringliteral">"ExporterProtocol_HandleStartNegotiation"</span>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a70">MSG_EXPORTER_SEND_TEMPLATE_DATA_FAILED</a>);
00980                         <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a24">TL_HandleDisconnection</a>(Conn);
00981                         <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a180">IPDR_ERR</a>;
00982                 }
00983         }
00984         <span class="keywordflow">else</span>
00985         {
00986                 Status = <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a63">ExporterProtocol_SendStartNegotiationReject</a>(E, S, Coll, Conn);
00987                 <span class="keywordflow">if</span>(<a class="code" href="../../d0/d8b/_for_doxygen_2include_2_i_p_d_r_2_i_p_d_r_8h.html#a18">FAILURE</a>(Status))
00988                 {
00989                         <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a28">Log_Write</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a171">IPDR_LEVEL_INFO</a>,
00990                                           <span class="stringliteral">"ExporterProtocol_HandleStartNegotiation"</span>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a108">MSG_EXPORTER_SEND_NEGOTIATION_REJECT_FAILED</a>);
00991                         <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a24">TL_HandleDisconnection</a>(Conn);
00992                         <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a180">IPDR_ERR</a>;
00993                 }
00994         }
00995     <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a174">IPDR_OK</a>;
00996 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="ExporterProtocol.h::ExporterProtocol_HandleUnknownMsg"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_Status</a> ExporterProtocol_HandleUnknownMsg           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../df/d71/struct_i_p_d_r__tag___exporter.html">Exporter</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>E</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d9/d35/struct_i_p_d_r__tag___session.html">Session</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>S</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../de/d0d/struct_i_p_d_r__tag___collector.html">Collector</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>Coll</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const MessageHeader *&nbsp;</td>
          <td class="mdname" nowrap> <em>Msg</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Conn</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Handle an unknown message from a server (collector).<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>E</em>&nbsp;</td><td>exporter handle </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>S</em>&nbsp;</td><td>session handle (pointer) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Coll</em>&nbsp;</td><td>collector originating the message </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Msg</em>&nbsp;</td><td>received message </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Conn</em>&nbsp;</td><td>connection</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga30a174">IPDR_OK</a> on success; <a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga30">IPDR_STATUS_RETURN_CODE</a> otherwise. </dd></dl>
<div class="fragment"><pre class="fragment">03129 {
03130     <span class="keywordtype">char</span> errorMsg[200];
03131 
03132     <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a30">Log_Write2</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a1">EXPORTER_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a170">IPDR_LEVEL_WARNING</a>,
03133                <span class="stringliteral">"ExporterProtocol_DataCallback"</span>,
03134                <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a48">MSG_EXPORTER_UNKNOWN_MSG</a>,
03135                Msg-&gt;MessageID, Msg-&gt;MessageID);
03136 
03137     sprintf(errorMsg, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a48">MSG_EXPORTER_UNKNOWN_MSG</a>, Msg-&gt;MessageID, Msg-&gt;MessageID);
03138     <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a57">ExporterProtocol_SendError</a>(E, S, Coll, Conn, <a class="code" href="../../d2/dda/_for_doxygen_2src_2_common_2_protocol_8h.html#a57a47">MessageDecodeError</a>, errorMsg);
03139 
03140     <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a174">IPDR_OK</a>;
03141 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a35" doxytag="ExporterProtocol.h::ExporterProtocol_KeepAliveInTimerReset"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void ExporterProtocol_KeepAliveInTimerReset           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../db/d4f/struct_i_p_d_r__tag___connection.html">IPDRConnection</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>IC</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">03186 {
03187         <a class="code" href="../../de/d0d/struct_i_p_d_r__tag___collector.html">Collector</a> *Coll = NULL;
03188         <a class="code" href="../../df/d71/struct_i_p_d_r__tag___exporter.html">Exporter</a> * E = NULL;
03189 
03190         <span class="keywordflow">if</span>(IC == NULL)
03191                 return ;
03192 
03193         Coll = IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o4">Owner</a>;
03194         E = IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o10">ExporterPtr</a>;
03195 
03196         <a class="code" href="../../d7/d54/_for_doxygen_2src_2_common_2_platform_8h.html#a34">Platform_Lock</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a1">EXPORTER_PLATFORM</a>);
03197         
03198         <span class="keywordflow">if</span>(IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o6">KeepAliveINTimerID</a> != NULL)
03199         {
03200                 <a class="code" href="../../d7/d54/_for_doxygen_2src_2_common_2_platform_8h.html#a13">Platform_UnregisterTimerAndClear</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a1">EXPORTER_PLATFORM</a>, &amp;IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o6">KeepAliveINTimerID</a>);
03201                 IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o6">KeepAliveINTimerID</a> = NULL;
03202         }
03203         <span class="keywordflow">if</span>(IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o1">State</a> == <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a51a23">IPDR_CONNECTION_CONNECTED</a>)
03204         {
03205                 <a class="code" href="../../d7/d54/_for_doxygen_2src_2_common_2_platform_8h.html#a11">Platform_RegisterPeriodicTimer</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a1">EXPORTER_PLATFORM</a>,
03206                                                                 <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a29">ExporterProtocol_KeepAliveInTimerCallback</a>,
03207                                                                 IC,
03208                                                                 (E-&gt;<a class="code" href="../../df/d71/struct_i_p_d_r__tag___exporter.html#o4">Parameters</a>.<a class="code" href="../../d1/dac/struct_exporter_parameters.html#o4">KeepAliveInterval</a>)+500,
03209                                                                 &amp; (IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o6">KeepAliveINTimerID</a>));
03210         }                                               
03211         <a class="code" href="../../d7/d54/_for_doxygen_2src_2_common_2_platform_8h.html#a35">Platform_Unlock</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a1">EXPORTER_PLATFORM</a>);
03212 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a34" doxytag="ExporterProtocol.h::ExporterProtocol_KeepAliveOutTimerReset"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void ExporterProtocol_KeepAliveOutTimerReset           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../db/d4f/struct_i_p_d_r__tag___connection.html">IPDRConnection</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>IC</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">03216 {
03217         <a class="code" href="../../de/d0d/struct_i_p_d_r__tag___collector.html">Collector</a> *Coll = NULL;
03218         <a class="code" href="../../df/d71/struct_i_p_d_r__tag___exporter.html">Exporter</a> * E = NULL;
03219 
03220         <span class="keywordflow">if</span>(IC == NULL)
03221                 return ;
03222 
03223         Coll = IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o4">Owner</a>;
03224         E = IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o10">ExporterPtr</a>;
03225 
03226         <a class="code" href="../../d7/d54/_for_doxygen_2src_2_common_2_platform_8h.html#a34">Platform_Lock</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a1">EXPORTER_PLATFORM</a>);       
03227 
03228         <span class="keywordflow">if</span>(IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o7">KeepAliveOUTTimerID</a> != NULL)
03229         {
03230                 <a class="code" href="../../d7/d54/_for_doxygen_2src_2_common_2_platform_8h.html#a13">Platform_UnregisterTimerAndClear</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a1">EXPORTER_PLATFORM</a>, &amp;IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o7">KeepAliveOUTTimerID</a>);
03231                 IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o7">KeepAliveOUTTimerID</a> = NULL;
03232         }
03233         
03234         <span class="keywordflow">if</span>(IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o1">State</a> == <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a51a23">IPDR_CONNECTION_CONNECTED</a>)
03235         {
03236                 <a class="code" href="../../d7/d54/_for_doxygen_2src_2_common_2_platform_8h.html#a11">Platform_RegisterPeriodicTimer</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a1">EXPORTER_PLATFORM</a>,
03237                                                                 <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a30">ExporterProtocol_KeepAliveOutTimerCallback</a>,
03238                                                                 IC,
03239                                                                 ((IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o8">RemoteKeepAliveInterval</a>)*1000)-500,
03240                                                                 &amp; (IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o7">KeepAliveOUTTimerID</a>));
03241         }                                               
03242         <a class="code" href="../../d7/d54/_for_doxygen_2src_2_common_2_platform_8h.html#a35">Platform_Unlock</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a1">EXPORTER_PLATFORM</a>);
03243 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a38" doxytag="ExporterProtocol.h::ExporterProtocol_ResetIPDRConnection"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_Status</a> ExporterProtocol_ResetIPDRConnection           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../df/d71/struct_i_p_d_r__tag___exporter.html">Exporter</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>E</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../db/d4f/struct_i_p_d_r__tag___connection.html">IPDRConnection</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>IC</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Fully closes a connection <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>E</em>&nbsp;</td><td>exporter handle </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>IC</em>&nbsp;</td><td>Contains information about a ipdr connection (IPDRConnection structure) </td></tr>
  </table>
</dl>
<div class="fragment"><pre class="fragment">03699 {
03700         <span class="keywordflow">if</span>(IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o5">ConnectResponseTimerID</a> != NULL)
03701         {
03702                 <a class="code" href="../../d7/d54/_for_doxygen_2src_2_common_2_platform_8h.html#a13">Platform_UnregisterTimerAndClear</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a1">EXPORTER_PLATFORM</a>, &amp;IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o5">ConnectResponseTimerID</a>);
03703                 IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o5">ConnectResponseTimerID</a> = NULL;
03704         }
03705         <span class="keywordflow">if</span>(IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o6">KeepAliveINTimerID</a> != NULL)
03706         {
03707                 <a class="code" href="../../d7/d54/_for_doxygen_2src_2_common_2_platform_8h.html#a13">Platform_UnregisterTimerAndClear</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a1">EXPORTER_PLATFORM</a>, &amp;IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o6">KeepAliveINTimerID</a>);
03708                 IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o6">KeepAliveINTimerID</a> = NULL;
03709         }
03710         <span class="keywordflow">if</span>(IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o7">KeepAliveOUTTimerID</a> != NULL)
03711         {
03712                 <a class="code" href="../../d7/d54/_for_doxygen_2src_2_common_2_platform_8h.html#a13">Platform_UnregisterTimerAndClear</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a1">EXPORTER_PLATFORM</a>, &amp;IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o7">KeepAliveOUTTimerID</a>);
03713                 IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o7">KeepAliveOUTTimerID</a> = NULL;
03714         }
03715 
03716         IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o3">TCPConnection</a> = NULL ;
03717         IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o1">State</a> = <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a51a21">IPDR_CONNECTION_DISCONNECTED</a>;
03718         <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a174">IPDR_OK</a>;
03719 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a39" doxytag="ExporterProtocol.h::ExporterProtocol_SelectCollector"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_Status</a> ExporterProtocol_SelectCollector           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../df/d71/struct_i_p_d_r__tag___exporter.html">Exporter</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>E</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d9/d35/struct_i_p_d_r__tag___session.html">Session</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>S</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../dc/d02/ipdr_2include_2_i_p_d_r_2_defs_8h.html#a16">IPDR_BOOL</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>forceNegotiate</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html">CollectorSession</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>forceCS</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Performs a selection of a new collector from the session <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>E</em>&nbsp;</td><td>exporter handle </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>S</em>&nbsp;</td><td>the session from which the new collector is selected </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>forceNegotiate</em>&nbsp;</td><td>TRUE if a negotation must accure </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>forceCS</em>&nbsp;</td><td>is not NULL if the specified collector must be the selected one </td></tr>
  </table>
</dl>
<div class="fragment"><pre class="fragment">03407 {
03408         <span class="keywordtype">int</span> i;
03409         <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a> Status;
03410         <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a16">IPDR_BOOL</a> needsRollback;
03411     <a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html">CollectorSession</a> *OldCS;
03412     <a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html">CollectorSession</a> *SelectedCS = NULL;
03413 
03414     <span class="keywordflow">if</span> (S == NULL) {
03415         <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a174">IPDR_OK</a>; <span class="comment">/* Can happen when shutting everything down. */</span>
03416     }
03417 
03418         <a class="code" href="../../d7/d54/_for_doxygen_2src_2_common_2_platform_8h.html#a34">Platform_Lock</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a1">EXPORTER_PLATFORM</a>);
03419 
03420     OldCS = S-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o13">ActiveCS</a>;
03421 
03422     S-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o13">ActiveCS</a> = NULL;
03423 
03424         <span class="keywordflow">if</span>(forceCS == NULL)
03425         {
03426                 <span class="keywordflow">for</span> (i = 0; i &lt; S-&gt;CollectorSessions.Length; i++) {
03427                         <a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html">CollectorSession</a> *CS = (<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html">CollectorSession</a> *) S-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o14">CollectorSessions</a>.<a class="code" href="../../db/dc0/struct_dynamic_array.html#o0">Data</a>[i];
03428                         <span class="keywordflow">switch</span> (CS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o1">CSState</a>) {
03429                         <span class="keywordflow">case</span> <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a52a25">IPDR_CS_INITIATION</a>:
03430                         <span class="keywordflow">case</span> <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a52a26">IPDR_CS_READY</a>:
03431                         <span class="keywordflow">case</span> <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a52a27">IPDR_CS_ACTIVE</a>:
03432                                 <span class="keywordflow">if</span> (SelectedCS == NULL || CS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o6">Priority</a> &lt; SelectedCS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o6">Priority</a>)
03433                                 {
03434                                         SelectedCS = CS;
03435                                 }
03436                                 <span class="keywordflow">break</span>;
03437                         <span class="keywordflow">default</span>:
03438                                 <span class="keywordflow">break</span>;
03439                         }
03440                 }
03441         }
03442         <span class="keywordflow">else</span>
03443         {
03444                 SelectedCS = forceCS;
03445         }
03446 
03447     <span class="keywordflow">if</span> (SelectedCS == NULL)
03448         {
03449                 <span class="comment">/* if we have no HIGH and our state collector  */</span>
03450         <a class="code" href="../../d6/df8/struct_i_p_d_r___event_data.html">IPDR_EventData</a> eventData;
03451         <span class="keywordflow">if</span> (OldCS != NULL &amp;&amp; OldCS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o9">WindowSizeTimer</a> != NULL)
03452                 {
03453             <a class="code" href="../../d7/d54/_for_doxygen_2src_2_common_2_platform_8h.html#a13">Platform_UnregisterTimerAndClear</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a1">EXPORTER_PLATFORM</a>,
03454                                              &amp;OldCS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o9">WindowSizeTimer</a>);
03455             <span class="keywordflow">if</span> (OldCS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o5">SessionConnection</a> != NULL &amp;&amp; OldCS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o5">SessionConnection</a>-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o3">TCPConnection</a> != NULL)
03456                         {
03457                 <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a11">TL_ResetConnection</a>(OldCS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o5">SessionConnection</a>-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o3">TCPConnection</a>);
03458                                 <span class="comment">/* See comment below for TCP_ResetConnection */</span>
03459             }
03460         }
03461         <a class="code" href="../../dd/dd0/_for_doxygen_2src_2_exporter_2_exporter_8c.html#a98">EventDataInit</a>(&amp;eventData, <a class="code" href="../../df/dd7/group___i_p_d_r__event__notification.html#gga6a155">IPDR_EVENT_ALL_SERVERS_DISCONNECTED</a>, E, SelectedCS, S);
03462         <a class="code" href="../../dd/dd0/_for_doxygen_2src_2_exporter_2_exporter_8c.html#a99">Exporter_TriggerEvent</a>(E, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a171">IPDR_LEVEL_INFO</a>, &amp;eventData, NULL, <span class="stringliteral">"All collectors disconnected"</span>);
03463     }
03464         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (SelectedCS != OldCS)
03465         {
03466                 <span class="comment">/* if we have one to negotiate with TODO: WindowSizeTimer */</span>
03467         <span class="keywordflow">if</span> (OldCS != NULL &amp;&amp; OldCS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o9">WindowSizeTimer</a> != NULL)
03468                 {
03469             <a class="code" href="../../d7/d54/_for_doxygen_2src_2_common_2_platform_8h.html#a13">Platform_UnregisterTimerAndClear</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a1">EXPORTER_PLATFORM</a>,
03470                                              &amp;OldCS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o9">WindowSizeTimer</a>);
03471         }
03472 
03473         <span class="keywordflow">if</span> (OldCS != NULL &amp;&amp;
03474                         OldCS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o5">SessionConnection</a> != NULL &amp;&amp;
03475                         OldCS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o5">SessionConnection</a>-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o3">TCPConnection</a> != NULL)
03476                 {
03477                         <span class="comment">/*if we choose not currently active ecollector (Active Collector changed)*/</span>
03478             <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga9">IPDR_IPAddress</a> OldAddr;
03479             <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> OldPort;
03480             <a class="code" href="../../d6/df8/struct_i_p_d_r___event_data.html">IPDR_EventData</a> eventData;
03481             <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a28">TL_PABuf</a> paBuf;
03482             <a class="code" href="../../dd/dd0/_for_doxygen_2src_2_exporter_2_exporter_8c.html#a98">EventDataInit</a>(&amp;eventData, <a class="code" href="../../df/dd7/group___i_p_d_r__event__notification.html#gga6a153">IPDR_EVENT_ACTIVE_SERVER_CHANGED</a>, E, SelectedCS, S);
03483                         <span class="comment">/* If an active collector didn't exist NULL; Otherwize, use previous active collector*/</span>
03484                         <span class="keywordflow">if</span> (OldCS != NULL &amp;&amp; OldCS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o5">SessionConnection</a> != NULL)
03485                                 eventData.<a class="code" href="../../d6/df8/struct_i_p_d_r___event_data.html#o13">Extra</a>.ServerChanged.PreviousCollector = OldCS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o5">SessionConnection</a>;
03486                         <span class="keywordflow">else</span>
03487                                 eventData.<a class="code" href="../../d6/df8/struct_i_p_d_r___event_data.html#o13">Extra</a>.ServerChanged.PreviousCollector = NULL;
03488 
03489             <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a13">TL_GetConnectionInfo</a>(OldCS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o5">SessionConnection</a>-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o3">TCPConnection</a>, &amp; OldAddr, &amp; OldPort);
03490             <a class="code" href="../../dd/dd0/_for_doxygen_2src_2_exporter_2_exporter_8c.html#a99">Exporter_TriggerEvent</a>(E, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a170">IPDR_LEVEL_WARNING</a>, &amp;eventData, SelectedCS,
03491                                                                 <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a60">MSG_EXPORTER_ACTIVE_COLLECTOR_CHANGED</a>,
03492                                 <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a16">TL_PrintAddressAndPort</a>(OldAddr, OldPort, paBuf),
03493                                 <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a14">TL_GetConnectionInfoStr</a>(OldCS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o5">SessionConnection</a>-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o3">TCPConnection</a>),
03494                                 <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a3">EXPORTER_QHANDLER</a>-&gt;OutstandingDataCount(E, S),
03495                                 <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a3">EXPORTER_QHANDLER</a>-&gt;UnacknowledgedDataCount(E, S),
03496                                 S-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o16">ID</a>, S-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o17">Name</a>, S-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o18">Description</a>);
03497 
03498                         <span class="comment">/* Active collector has changed, reset the previous connection</span>
03499 <span class="comment">                        (Empties any internal buffers used for sending (outgoing) data and unregister+clear socket)</span>
03500 <span class="comment">                        since it might try to send obsolete data later */</span>
03501             Status = <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a11">TL_ResetConnection</a>(OldCS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o5">SessionConnection</a>-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o3">TCPConnection</a>);
03502                         <span class="keywordflow">if</span>(<a class="code" href="../../d0/d8b/_for_doxygen_2include_2_i_p_d_r_2_i_p_d_r_8h.html#a18">FAILURE</a>(Status))
03503                         {
03504                                 <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a27">Log_StateTransition</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a171">IPDR_LEVEL_INFO</a>,
03505                                 <span class="stringliteral">"ExporterProtocol_SelectCollector"</span>, OldCS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o5">SessionConnection</a>-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o3">TCPConnection</a>,
03506                                 OldCS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o1">CSState</a>, <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a52a24">IPDR_CS_DISCONNECTED</a>,
03507                                 <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a61">MSG_EXPORTER_DISCONNECT_TRANSPORT1</a>);
03508                                 <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a72">ExporterProtocol_CloseTLConnection</a>(E,OldCS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o5">SessionConnection</a>);
03509                                 <a class="code" href="../../d7/d54/_for_doxygen_2src_2_common_2_platform_8h.html#a35">Platform_Unlock</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a1">EXPORTER_PLATFORM</a>);
03510                                 <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a174">IPDR_OK</a>;
03511                         }
03512                         <span class="comment">/* if we already have an active collector and it's not the same as the new one, stop session*/</span>
03513                         Status = <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a60">ExporterProtocol_SendSessionStop</a>(E, S, OldCS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o4">Collector</a>,
03514                                                                   OldCS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o5">SessionConnection</a>-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o3">TCPConnection</a>,
03515                                                                   <a class="code" href="../../df/dcb/group___i_p_d_r__key__type__attributes.html#gga66a121">IPDR_STOP_REASON_SWITCHCOLLECTOR</a>,
03516                                                                   <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a65">MSG_EXPORTER_NEW_ACTIVE_COLLECTOR</a>);
03517                         <span class="keywordflow">if</span>(<a class="code" href="../../d0/d8b/_for_doxygen_2include_2_i_p_d_r_2_i_p_d_r_8h.html#a18">FAILURE</a>(Status))
03518                         {
03519                                 <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a27">Log_StateTransition</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a171">IPDR_LEVEL_INFO</a>,
03520                                 <span class="stringliteral">"ExporterProtocol_SelectCollector"</span>, OldCS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o5">SessionConnection</a>-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o3">TCPConnection</a>,
03521                                 OldCS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o1">CSState</a>, <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a52a24">IPDR_CS_DISCONNECTED</a>,
03522                                 <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a62">MSG_EXPORTER_DISCONNECT_TRANSPORT2</a>);
03523                                 <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a72">ExporterProtocol_CloseTLConnection</a>(E,OldCS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o5">SessionConnection</a>);
03524                                 <a class="code" href="../../d7/d54/_for_doxygen_2src_2_common_2_platform_8h.html#a35">Platform_Unlock</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a1">EXPORTER_PLATFORM</a>);
03525                                 <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a174">IPDR_OK</a>;
03526                         }
03527                         OldCS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o1">CSState</a> = <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a52a26">IPDR_CS_READY</a>;
03528         }
03529 
03530         <span class="keywordflow">switch</span> (SelectedCS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o1">CSState</a>) {
03531             <span class="keywordflow">case</span> <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a52a26">IPDR_CS_READY</a>:
03532                 <span class="comment">/* There are two cases when a server (collector) is un-paused:</span>
03533 <span class="comment">                   - the same server (collector) is being re-selected (OldSrv == NULL)</span>
03534 <span class="comment">                   - a new (higher priority) server (collector) is being selected (OldSrv != NULL)</span>
03535 <span class="comment"></span>
03536 <span class="comment">                   In theory, there shouldn't be any problem with doing a</span>
03537 <span class="comment">                   rollback in all cases (although it would be less</span>
03538 <span class="comment">                   efficient); in practice, there are subtle interactions</span>
03539 <span class="comment">                   between the queue and the list of buffers to be sent (kept</span>
03540 <span class="comment">                   by the transport layer).</span>
03541 <span class="comment"></span>
03542 <span class="comment">                   A rollback assumes that the output is freshly</span>
03543 <span class="comment">                   connected. But that's not true in the case of a "paused"</span>
03544 <span class="comment">                   server (collector) ... the connection is still connected. We could</span>
03545 <span class="comment">                   disconnect it --- but then it would have been better to</span>
03546 <span class="comment">                   have done the disconnect when the timeout happened (in</span>
03547 <span class="comment">                   fact, that might be a good idea anyway because the</span>
03548 <span class="comment">                   disconnection might jolt the collector into doing</span>
03549 <span class="comment">                   something). Otherwise, we must *not* do a rollback</span>
03550 <span class="comment">                   ... there could be records waiting to be sent (or even</span>
03551 <span class="comment">                   partially sent), and a rollback would smash them.</span>
03552 <span class="comment"></span>
03553 <span class="comment">                   This analysis applies for both cases of un-pausing. We can</span>
03554 <span class="comment">                   prune the queue (using the DSN from the DATA ACK) but we</span>
03555 <span class="comment">                   must do nothing with the data that is "pending" in the</span>
03556 <span class="comment">                   connection layer. If we do want to do a rollback, then we</span>
03557 <span class="comment">                   *must* force a disconnection first, to ensure that all the</span>
03558 <span class="comment">                   "pending" data are thrown away.</span>
03559 <span class="comment"></span>
03560 <span class="comment">                   However, we have another problem ... the sequencing</span>
03561 <span class="comment">                   of the DSNs. If we switch servers (collectors), then</span>
03562 <span class="comment">                   there will be a gap in the sequence numbers unless</span>
03563 <span class="comment">                   we also do a SyncNeeded. So, even though there is</span>
03564 <span class="comment">                   no rollback, a SYNC message is sent (when the</span>
03565 <span class="comment">                   server (collector) is switched).</span>
03566 <span class="comment"></span>
03567 <span class="comment">                   [Note added later: based on other considerations, it seemed</span>
03568 <span class="comment">                   best for timeouts to cause a disconnect anyway. So, we'll</span>
03569 <span class="comment">                   never see the "paused" state. But leave the code in, just</span>
03570 <span class="comment">                   in case we reverse this decision.</span>
03571 <span class="comment">                */</span>
03572                 needsRollback = <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a4">IPDR_FALSE</a>;
03573                 <span class="keywordflow">if</span> (OldCS != NULL) { <span class="comment">/* We're switching from another server (collector) */</span>
03574                     S-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o7">SyncNeeded</a> = <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a5">IPDR_TRUE</a>;
03575                 }
03576                 <span class="keywordflow">break</span>;
03577             <span class="keywordflow">default</span>:
03578                 needsRollback = <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a4">IPDR_FALSE</a>;
03579                 S-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o7">SyncNeeded</a> = <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a5">IPDR_TRUE</a>; <span class="comment">/* sync is needed after server (collector) change */</span>
03580                 }
03581 
03582                 <span class="keywordflow">if</span> (<a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a15">Log_ShouldWrite</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a1">EXPORTER_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a172">IPDR_LEVEL_DEBUG</a>))
03583                 {
03584                         <span class="keywordflow">if</span> (needsRollback)
03585                         {
03586                                 <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a27">Log_StateTransition</a>(EXPORTER_LOG, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a171">IPDR_LEVEL_INFO</a>,
03587                                                     <span class="stringliteral">"ExporterProtocol_SelectCollector"</span>, SelectedCS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o5">SessionConnection</a>-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o3">TCPConnection</a>,
03588                                                     SelectedCS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o1">CSState</a>, <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a52a27">IPDR_CS_ACTIVE</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a66">MSG_EXPORTER_NEW_ACTIVE_COLLECTOR_ROLLBACK</a>);
03589                         }
03590                         <span class="keywordflow">if</span> (S-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o7">SyncNeeded</a>)
03591                         {
03592             <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a27">Log_StateTransition</a>(EXPORTER_LOG, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a171">IPDR_LEVEL_INFO</a>,
03593                                                     <span class="stringliteral">"ExporterProtocol_SelectCollector"</span>, SelectedCS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o5">SessionConnection</a>-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o3">TCPConnection</a>,
03594                                                     SelectedCS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o1">CSState</a>, <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a52a27">IPDR_CS_ACTIVE</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a67">MSG_EXPORTER_NEW_ACTIVE_COLLECTOR_SYNC</a>);
03595                         }
03596 
03597 
03598         }
03599         <span class="comment">/* The following event is also done by ExporterProtocol_HandleStart: */</span>
03600         <span class="keywordflow">if</span> (SelectedCS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o5">SessionConnection</a> != NULL &amp;&amp;
03601                         SelectedCS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o5">SessionConnection</a>-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o3">TCPConnection</a> != NULL)
03602                 {
03603                         <span class="comment">/*if we choose not currently activ ecollector*/</span>
03604             <a class="code" href="../../d6/df8/struct_i_p_d_r___event_data.html">IPDR_EventData</a> eventData;
03605             <a class="code" href="../../dd/dd0/_for_doxygen_2src_2_exporter_2_exporter_8c.html#a98">EventDataInit</a>(&amp;eventData, <a class="code" href="../../df/dd7/group___i_p_d_r__event__notification.html#gga6a150">IPDR_EVENT_SERVER_CONNECTED</a>, E, SelectedCS, S);
03606             <a class="code" href="../../dd/dd0/_for_doxygen_2src_2_exporter_2_exporter_8c.html#a99">Exporter_TriggerEvent</a>(E, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a170">IPDR_LEVEL_WARNING</a>, &amp;eventData, SelectedCS,
03607                                 <span class="stringliteral">"Connected: %.98s, outstanding=%lu, unACKed=%lu, Session=%u [%.40s] (%.80s)"</span>,
03608                                 <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a14">TL_GetConnectionInfoStr</a>(SelectedCS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o5">SessionConnection</a>-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o3">TCPConnection</a>),
03609                                 <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a3">EXPORTER_QHANDLER</a>-&gt;OutstandingDataCount(E, S),
03610                                 <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a3">EXPORTER_QHANDLER</a>-&gt;UnacknowledgedDataCount(E, S),
03611                                 S-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o16">ID</a>, S-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o17">Name</a>, S-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o18">Description</a>);
03612 
03613                         <span class="keywordflow">switch</span>(SelectedCS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o1">CSState</a>){
03614                                 <span class="keywordflow">case</span> <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a52a26">IPDR_CS_READY</a>:
03615                                         <span class="keywordflow">if</span>(forceNegotiate == <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a4">IPDR_FALSE</a>)
03616                                         {
03617                                                 Status = <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a11">TL_ResetConnection</a>(SelectedCS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o5">SessionConnection</a>-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o3">TCPConnection</a>);
03618                                                 <span class="keywordflow">if</span>(<a class="code" href="../../d0/d8b/_for_doxygen_2include_2_i_p_d_r_2_i_p_d_r_8h.html#a18">FAILURE</a>(Status))
03619                                                 {
03620                                                         <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a27">Log_StateTransition</a>(EXPORTER_LOG, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a171">IPDR_LEVEL_INFO</a>,
03621                                                                     <span class="stringliteral">"ExporterProtocol_SelectCollector"</span>,
03622                                                                     SelectedCS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o5">SessionConnection</a>-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o3">TCPConnection</a>, SelectedCS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o1">CSState</a>,
03623                                                                     <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a52a24">IPDR_CS_DISCONNECTED</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a61">MSG_EXPORTER_DISCONNECT_TRANSPORT1</a>);
03624                                                         <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a24">TL_HandleDisconnection</a>(SelectedCS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o5">SessionConnection</a>-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o3">TCPConnection</a>);
03625                                                         <a class="code" href="../../d7/d54/_for_doxygen_2src_2_common_2_platform_8h.html#a35">Platform_Unlock</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a1">EXPORTER_PLATFORM</a>);
03626                                                         <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a174">IPDR_OK</a>;
03627                                                 }
03628                                                 <span class="keywordflow">if</span>(S-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o10">Running</a> == <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a5">IPDR_TRUE</a>)
03629                                                 {
03630                                                         Status = <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a59">ExporterProtocol_SendSessionStart</a>(E, S, SelectedCS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o4">Collector</a>, SelectedCS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o5">SessionConnection</a>-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o3">TCPConnection</a>);
03631                                                         <span class="keywordflow">if</span>(<a class="code" href="../../d0/d8b/_for_doxygen_2include_2_i_p_d_r_2_i_p_d_r_8h.html#a18">FAILURE</a>(Status))
03632                                                         {
03633                                                                 <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a27">Log_StateTransition</a>(EXPORTER_LOG, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a171">IPDR_LEVEL_INFO</a>,
03634                                                                                 <span class="stringliteral">"ExporterProtocol_SelectCollector"</span>,
03635                                                                                 SelectedCS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o5">SessionConnection</a>-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o3">TCPConnection</a>,
03636                                                                                                 SelectedCS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o1">CSState</a>, <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a52a24">IPDR_CS_DISCONNECTED</a>,
03637                                                                                 <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a63">MSG_EXPORTER_DISCONNECT_TRANSPORT3</a>);
03638                                                                 <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a24">TL_HandleDisconnection</a>(SelectedCS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o5">SessionConnection</a>-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o3">TCPConnection</a>);
03639                                                                 <a class="code" href="../../d7/d54/_for_doxygen_2src_2_common_2_platform_8h.html#a35">Platform_Unlock</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a1">EXPORTER_PLATFORM</a>);
03640                                                                 <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a174">IPDR_OK</a>;
03641                                                         }
03642                                                         SelectedCS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o1">CSState</a> = <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a52a27">IPDR_CS_ACTIVE</a>;
03643                                                         S-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o13">ActiveCS</a> = SelectedCS;
03644                                                         S-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o9">Retransmite</a> = <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a5">IPDR_TRUE</a>;
03645                                                         Status = <a class="code" href="../../dd/dd0/_for_doxygen_2src_2_exporter_2_exporter_8c.html#a48">Session_SendOutstandingData</a>(E, S);
03646                                                 }
03647                                                 <span class="keywordflow">break</span>;
03648                                         }
03649                                 <span class="keywordflow">case</span> <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a52a25">IPDR_CS_INITIATION</a>:
03650                                         Status = <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a61">ExporterProtocol_SendTemplateData</a>(E, S,
03651                                                                 SelectedCS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o4">Collector</a>,
03652                                                                 SelectedCS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o5">SessionConnection</a>-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o3">TCPConnection</a>,
03653                                                                 (OldCS==NULL || <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a52a25">IPDR_CS_INITIATION</a>==<a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a5">IPDR_TRUE</a>)?IPDR_TRUE:IPDR_FALSE);
03654                                         <span class="keywordflow">if</span>(<a class="code" href="../../d0/d8b/_for_doxygen_2include_2_i_p_d_r_2_i_p_d_r_8h.html#a18">FAILURE</a>(Status))
03655                                         {
03656                                                 <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a27">Log_StateTransition</a>(EXPORTER_LOG, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a171">IPDR_LEVEL_INFO</a>,
03657                                                                     <span class="stringliteral">"ExporterProtocol_SelectCollector"</span>,
03658                                                                     SelectedCS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o5">SessionConnection</a>-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o3">TCPConnection</a>,
03659                                                                     SelectedCS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o1">CSState</a>, <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a52a24">IPDR_CS_DISCONNECTED</a>,
03660                                                                     <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a70">MSG_EXPORTER_SEND_TEMPLATE_DATA_FAILED</a>);
03661                                                 <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a24">TL_HandleDisconnection</a>(SelectedCS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o5">SessionConnection</a>-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o3">TCPConnection</a>);
03662                                                 <a class="code" href="../../d7/d54/_for_doxygen_2src_2_common_2_platform_8h.html#a35">Platform_Unlock</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a1">EXPORTER_PLATFORM</a>);
03663                                                 <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a174">IPDR_OK</a>;
03664                                         }
03665                                         <span class="keywordflow">break</span>;
03666                                 <span class="keywordflow">default</span>:
03667                                         <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a28">Log_Write</a>(EXPORTER_LOG, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a169">IPDR_LEVEL_ERROR</a>,
03668                                                 <span class="stringliteral">"ExporterProtocol_SelectCollector"</span>,<a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a64">MSG_EXPORTER_UNEXPECTED_STATE</a>);
03669                                         <span class="keywordflow">break</span>;
03670                         }
03671         }
03672 
03673                 <span class="keywordflow">if</span> (needsRollback)
03674                 {
03675             <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a3">EXPORTER_QHANDLER</a>-&gt;Rollback(E, S);
03676         }
03677     }
03678         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (SelectedCS == OldCS)
03679         {
03680                 <span class="comment">/* nothing todo just log */</span>
03681                 <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a27">Log_StateTransition</a>(EXPORTER_LOG, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a1">EXPORTER_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a172">IPDR_LEVEL_DEBUG</a>,
03682                                                         <span class="stringliteral">"Session_SelectActiveCollector"</span>, SelectedCS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o5">SessionConnection</a>-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o3">TCPConnection</a>,
03683                                                         SelectedCS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o1">CSState</a>, IPDR_SERVER_ACTIVE,
03684                                                         <span class="stringliteral">"got same active server (collector)"</span>);
03685         SelectedCS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o1">CSState</a> = <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a52a27">IPDR_CS_ACTIVE</a>;
03686         S-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o13">ActiveCS</a> = SelectedCS;
03687     }
03688         <a class="code" href="../../d7/d54/_for_doxygen_2src_2_common_2_platform_8h.html#a35">Platform_Unlock</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a1">EXPORTER_PLATFORM</a>);
03689         <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a174">IPDR_OK</a>;
03690 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a21" doxytag="ExporterProtocol.h::ExporterProtocol_SendConnect"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_Status</a> ExporterProtocol_SendConnect           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../df/d71/struct_i_p_d_r__tag___exporter.html">Exporter</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>E</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d9/d35/struct_i_p_d_r__tag___session.html">Session</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>S</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../de/d0d/struct_i_p_d_r__tag___collector.html">Collector</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>Coll</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Conn</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Sends a connect event to a collector<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>E</em>&nbsp;</td><td>exporter handle </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>S</em>&nbsp;</td><td>session handle (pointer) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Coll</em>&nbsp;</td><td>collector handle (pointer) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Conn</em>&nbsp;</td><td>The Connection between S to Coll </td></tr>
  </table>
</dl>
<div class="fragment"><pre class="fragment">01486 {
01487         <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a> Status;
01488         <span class="keywordtype">int</span> exporterCapabilities = 0;
01489         <span class="keywordtype">int</span> collectorCapabilities = 0;
01490     <a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html">BufferHandle</a> BH;
01491         <span class="comment">/*MessageHeader *MH;*/</span>
01492     ConnectMessage *CM;
01493     <a class="code" href="../../d1/d38/struct_i_p_d_r__tag___chunks_manager.html">ChunksManager</a> *CMgr;
01494         <a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html">IPDRConnection</a> *IC = Conn-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o11">Owner</a>;
01495 
01496         <span class="keywordtype">char</span>*   vendorID = E-&gt;<a class="code" href="../../df/d71/struct_i_p_d_r__tag___exporter.html#o4">Parameters</a>.<a class="code" href="../../d1/dac/struct_exporter_parameters.html#o3">VendorString</a>;
01497         <span class="keywordtype">int</span> vendorIDLength = strlen(vendorID);
01498 
01499         <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a69">ExporterProtocol_KeepAliveOutTimerReset</a>(IC);
01500 
01501 
01502     <span class="keywordflow">if</span> (IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o1">State</a> != <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a51a21">IPDR_CONNECTION_DISCONNECTED</a>) {
01503         <span class="comment">/* XXX should signal error event */</span>
01504         <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a28">Log_Write</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a169">IPDR_LEVEL_ERROR</a>,
01505                   <span class="stringliteral">"ExporterProtocol_SendConnect"</span>,
01506                   <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a106">MSG_EXPORTER_STATE_NOT_DISCONNECTED</a>);
01507         <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a180">IPDR_ERR</a>;
01508     }
01509 
01510     <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a22">TL_GetSendChunksManager</a>(Conn, &amp; CMgr);
01511     Status = <a class="code" href="../../d5/d9f/_for_doxygen_2src_2_common_2_chunks_manager_8c.html#a19">ChunksManager_AllocateBuffer</a>(CMgr,
01512                                           <span class="keyword">sizeof</span>(ConnectMessage)+vendorIDLength+1,
01513                                                                                   &amp; BH);
01514     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d8b/_for_doxygen_2include_2_i_p_d_r_2_i_p_d_r_8h.html#a18">FAILURE</a>(Status))
01515         <span class="keywordflow">return</span> Status;
01516 
01517     <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a40">ExporterProtocol_FillHeader</a>(S, BH.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a>, <a class="code" href="../../d2/dda/_for_doxygen_2src_2_common_2_protocol_8h.html#a27">IPDR_MSG_CONNECT</a>,
01518                               <span class="keyword">sizeof</span>(ConnectMessage)+vendorIDLength+1);
01519 
01520     CM = (ConnectMessage *) BH.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a>;
01521 
01522         exporterCapabilities = <a class="code" href="../../dd/dd0/_for_doxygen_2src_2_exporter_2_exporter_8c.html#a103">Exporter_GetCapabilities</a>(E);
01523         <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a33">ExporterProtocol_SetCollectorCapabilities</a>(E, Coll, exporterCapabilities);
01524         collectorCapabilities = <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a34">ExporterProtocol_GetCollectorCapabilities</a>(Coll);
01525 
01526         <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a9">IPDR_SET_HTONL</a>(CM-&gt;Addr, ((E-&gt;<a class="code" href="../../df/d71/struct_i_p_d_r__tag___exporter.html#o4">Parameters</a>.<a class="code" href="../../d1/dac/struct_exporter_parameters.html#o1">ProtocolLevelAddr</a>==0)?Conn-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o3">LocaleAddr</a>:E-&gt;<a class="code" href="../../df/d71/struct_i_p_d_r__tag___exporter.html#o4">Parameters</a>.<a class="code" href="../../d1/dac/struct_exporter_parameters.html#o1">ProtocolLevelAddr</a>));
01527         <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a8">IPDR_SET_HTONS</a>(CM-&gt;Port, Conn-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o4">LocalePort</a>);
01528         <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a9">IPDR_SET_HTONL</a>(CM-&gt;Capabilities, collectorCapabilities);
01529         <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a9">IPDR_SET_HTONL</a>(CM-&gt;keepAliveInterval, E-&gt;<a class="code" href="../../df/d71/struct_i_p_d_r__tag___exporter.html#o4">Parameters</a>.<a class="code" href="../../d1/dac/struct_exporter_parameters.html#o4">KeepAliveInterval</a>/1000);
01530         <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a9">IPDR_SET_HTONL</a>(CM-&gt;vendorIDLength, vendorIDLength);
01531         strncpy(BH.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a>+<span class="keyword">sizeof</span>(ConnectMessage), vendorID, vendorIDLength);
01532 
01533     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a15">Log_ShouldWrite</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a171">IPDR_LEVEL_INFO</a>)) {
01534         <a class="code" href="../../d5/d59/_for_doxygen_2src_2_exporter_2_protocol_debug_8c.html#a4">ProtocolDebug_PrintOutgoingMessage</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, Conn, BH.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a171">IPDR_LEVEL_INFO</a>);
01535     }
01536 
01537     Status = <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a9">TL_Send</a>(Conn, &amp; BH, <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a5">IPDR_TRUE</a>);
01538         <span class="keywordflow">if</span>(<a class="code" href="../../d0/d8b/_for_doxygen_2include_2_i_p_d_r_2_i_p_d_r_8h.html#a18">FAILURE</a>(Status))
01539         {
01540                 <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#ga4">IPDR_LogWrite</a>(E,<span class="stringliteral">"ExporterProtocol"</span>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a171">IPDR_LEVEL_INFO</a>, <span class="stringliteral">"ExporterProtocol_SendConnect"</span>,
01541                                         <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a102">MSG_EXPORTER_SEND_CONNECT_FAILED</a>, <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a14">TL_GetConnectionInfoStr</a>(Conn));
01542                 <span class="keywordflow">return</span> Status;
01543         }
01544 
01545         <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a30">Log_Write2</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a172">IPDR_LEVEL_DEBUG</a>,
01546                                         <span class="stringliteral">"Exporter_AutoconnectCallback"</span>,
01547                                         <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a103">MSG_EXPORTER_SEND_CONNECT_TARGET</a>,
01548                                         <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a14">TL_GetConnectionInfoStr</a>(Conn), E-&gt;<a class="code" href="../../df/d71/struct_i_p_d_r__tag___exporter.html#o4">Parameters</a>.<a class="code" href="../../d1/dac/struct_exporter_parameters.html#o7">ConnectResponseTimeout</a>);
01549 
01550         <span class="keywordflow">if</span>(IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o5">ConnectResponseTimerID</a> != NULL)
01551                 <a class="code" href="../../d7/d54/_for_doxygen_2src_2_common_2_platform_8h.html#a13">Platform_UnregisterTimerAndClear</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a1">EXPORTER_PLATFORM</a>, &amp; (IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o5">ConnectResponseTimerID</a>));
01552 
01553         <a class="code" href="../../d7/d54/_for_doxygen_2src_2_common_2_platform_8h.html#a9">Platform_RegisterTimer</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a1">EXPORTER_PLATFORM</a>,
01554                                                 <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a31">ExporterProtocol_ConnectResponseTimeoutCallback</a>,
01555                                                         IC,
01556                             E-&gt;<a class="code" href="../../df/d71/struct_i_p_d_r__tag___exporter.html#o4">Parameters</a>.<a class="code" href="../../d1/dac/struct_exporter_parameters.html#o7">ConnectResponseTimeout</a>,
01557                             &amp; (IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o5">ConnectResponseTimerID</a>));
01558 
01559         IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o1">State</a> = <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a51a22">IPDR_CONNECTION_WAITRESPONSE</a>;
01560 
01561     <span class="keywordflow">return</span> Status;
01562 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a22" doxytag="ExporterProtocol.h::ExporterProtocol_SendConnectResponse"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_Status</a> ExporterProtocol_SendConnectResponse           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../df/d71/struct_i_p_d_r__tag___exporter.html">Exporter</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>E</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d9/d35/struct_i_p_d_r__tag___session.html">Session</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>S</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../de/d0d/struct_i_p_d_r__tag___collector.html">Collector</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>Coll</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Conn</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">01569 {
01570         <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a> Status;
01571         <span class="keywordtype">int</span>  collectorCapabilities = 0;
01572     <a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html">BufferHandle</a> BH;
01573     ConnectResponseMessage *CRM;
01574     <a class="code" href="../../d1/d38/struct_i_p_d_r__tag___chunks_manager.html">ChunksManager</a> *CMgr;
01575         <a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html">IPDRConnection</a> *IC = Conn-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o11">Owner</a>;
01576 
01577         <span class="keywordtype">char</span>*   vendorID = E-&gt;<a class="code" href="../../df/d71/struct_i_p_d_r__tag___exporter.html#o4">Parameters</a>.<a class="code" href="../../d1/dac/struct_exporter_parameters.html#o3">VendorString</a>;
01578         <span class="keywordtype">int</span> vendorIDLength = strlen(vendorID);
01579 
01580         <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a69">ExporterProtocol_KeepAliveOutTimerReset</a>(IC);
01581 
01582 
01583     <span class="keywordflow">if</span> (IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o1">State</a> != <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a51a21">IPDR_CONNECTION_DISCONNECTED</a>) {
01584         <span class="comment">/* XXX should signal error event */</span>
01585         <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a28">Log_Write</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a169">IPDR_LEVEL_ERROR</a>,
01586                   <span class="stringliteral">"ExporterProtocol_SendConnectResponse"</span>,
01587                   <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a106">MSG_EXPORTER_STATE_NOT_DISCONNECTED</a>);
01588         <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a180">IPDR_ERR</a>;
01589     }
01590 
01591     <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a22">TL_GetSendChunksManager</a>(Conn, &amp; CMgr);
01592     Status = <a class="code" href="../../d5/d9f/_for_doxygen_2src_2_common_2_chunks_manager_8c.html#a19">ChunksManager_AllocateBuffer</a>(CMgr,
01593                                           <span class="keyword">sizeof</span>(ConnectResponseMessage)+vendorIDLength+1,
01594                                                                                   &amp; BH);
01595     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d8b/_for_doxygen_2include_2_i_p_d_r_2_i_p_d_r_8h.html#a18">FAILURE</a>(Status))
01596         <span class="keywordflow">return</span> Status;
01597 
01598     <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a40">ExporterProtocol_FillHeader</a>(S, BH.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a>, <a class="code" href="../../d2/dda/_for_doxygen_2src_2_common_2_protocol_8h.html#a28">IPDR_MSG_CONNECT_RESPONSE</a>,
01599                               <span class="keyword">sizeof</span>(ConnectResponseMessage)+vendorIDLength+1);
01600 
01601     CRM = (ConnectResponseMessage *) BH.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a>;
01602 
01603         collectorCapabilities = <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a34">ExporterProtocol_GetCollectorCapabilities</a>(Coll);
01604 
01605         <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a9">IPDR_SET_HTONL</a>(CRM-&gt;Capabilities, collectorCapabilities);
01606         <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a9">IPDR_SET_HTONL</a>(CRM-&gt;keepAliveInterval, E-&gt;<a class="code" href="../../df/d71/struct_i_p_d_r__tag___exporter.html#o4">Parameters</a>.<a class="code" href="../../d1/dac/struct_exporter_parameters.html#o4">KeepAliveInterval</a>/1000);
01607         <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a9">IPDR_SET_HTONL</a>(CRM-&gt;vendorIDLength, vendorIDLength);
01608         strncpy(BH.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a>+<span class="keyword">sizeof</span>(ConnectResponseMessage), vendorID, vendorIDLength);
01609 
01610     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a15">Log_ShouldWrite</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a171">IPDR_LEVEL_INFO</a>)) {
01611         <a class="code" href="../../d5/d59/_for_doxygen_2src_2_exporter_2_protocol_debug_8c.html#a4">ProtocolDebug_PrintOutgoingMessage</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, Conn, BH.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a171">IPDR_LEVEL_INFO</a>);
01612     }
01613 
01614     Status = <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a9">TL_Send</a>(Conn, &amp; BH, <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a5">IPDR_TRUE</a>);
01615         <span class="keywordflow">if</span>(<a class="code" href="../../d0/d8b/_for_doxygen_2include_2_i_p_d_r_2_i_p_d_r_8h.html#a18">FAILURE</a>(Status))
01616         {
01617                 <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#ga4">IPDR_LogWrite</a>(E,<span class="stringliteral">"ExporterProtocol"</span>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a169">IPDR_LEVEL_ERROR</a>, <span class="stringliteral">"ExporterProtocol_SendConnectResponse"</span>,
01618                                         <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a90">MSG_EXPORTER_SEND_CONNECT_RESPONSE_FAILED</a>, <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a14">TL_GetConnectionInfoStr</a>(Conn));
01619                 <span class="keywordflow">return</span> Status;
01620         }
01621 
01622         <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#ga4">IPDR_LogWrite</a>(E,<span class="stringliteral">"ExporterProtocol"</span>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a171">IPDR_LEVEL_INFO</a>, <span class="stringliteral">"ExporterProtocol_SendConnectResponse"</span>,
01623                                         <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a91">MSG_EXPORTER_SEND_CONNECT_RESPONSE_TARGET</a>, <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a14">TL_GetConnectionInfoStr</a>(Conn));
01624 
01625     <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a174">IPDR_OK</a>;
01626 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a33" doxytag="ExporterProtocol.h::ExporterProtocol_SendData"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_Status</a> ExporterProtocol_SendData           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../df/d71/struct_i_p_d_r__tag___exporter.html">Exporter</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>E</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d9/d35/struct_i_p_d_r__tag___session.html">Session</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>S</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../de/d0d/struct_i_p_d_r__tag___collector.html">Collector</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>Coll</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Conn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d4/dc8/struct_i_p_d_r__tag___template_handle.html">IPDR_TemplateHandle</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>TemplateHandle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const void *&nbsp;</td>
          <td class="mdname" nowrap> <em>Data</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">03029 {
03030         <a class="code" href="../../da/d62/struct_i_p_d_r__tag___template.html">Template</a>*       T ;
03031         <a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html">CollectorSession</a> *ACS = S-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o13">ActiveCS</a>;
03032         <a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html">IPDRConnection</a> *IC = NULL;
03033         <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a> Status = <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a174">IPDR_OK</a>;
03034 
03035     <span class="keywordflow">if</span> (!E || !S || !Data) {
03036         <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a181">IPDR_ERR_INVALID_VALUE</a>;
03037     }
03038 
03039     <span class="keywordflow">if</span> (! <a class="code" href="../../d7/d54/_for_doxygen_2src_2_common_2_platform_8h.html#a4">Platform_IsRunning</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a1">EXPORTER_PLATFORM</a>)) {
03040         <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a201">IPDR_ERR_NOT_RUNNING</a>;
03041     }
03042 
03043     <a class="code" href="../../d7/d54/_for_doxygen_2src_2_common_2_platform_8h.html#a34">Platform_Lock</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a1">EXPORTER_PLATFORM</a>);
03044 
03045         <span class="keywordflow">if</span>(     !S-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o3">ActiveContext</a> ||
03046                 S-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o3">ActiveContext</a>-&gt;<a class="code" href="../../d1/d8c/struct_i_p_d_r__tag___transmission_context.html#o2">Templates</a>.<a class="code" href="../../db/dc0/struct_dynamic_array.html#o1">Length</a> &lt;= TH.i ||
03047                 TH.s != S-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o16">ID</a>)
03048         {
03049                 <span class="comment">/*TODO: add errorCode and message*/</span>
03050                 <a class="code" href="../../d7/d54/_for_doxygen_2src_2_common_2_platform_8h.html#a35">Platform_Unlock</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a1">EXPORTER_PLATFORM</a>);
03051                 <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a181">IPDR_ERR_INVALID_VALUE</a>;
03052         }
03053 
03054         T = (<a class="code" href="../../da/d62/struct_i_p_d_r__tag___template.html">Template</a> *) S-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o3">ActiveContext</a>-&gt;<a class="code" href="../../d1/d8c/struct_i_p_d_r__tag___transmission_context.html#o2">Templates</a>.<a class="code" href="../../db/dc0/struct_dynamic_array.html#o0">Data</a>[TH.i];
03055     <span class="keywordflow">if</span> (!T || ! T-&gt;<a class="code" href="../../da/d62/struct_i_p_d_r__tag___template.html#o9">Enabled</a>)
03056         {
03057                 <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a29">Log_Write1</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a1">EXPORTER_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a171">IPDR_LEVEL_INFO</a>,<span class="stringliteral">"IPDR_SendData"</span>,<a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a58">MSG_EXPORTER_DISABLED_TEMPLATE</a>,T-&gt;<a class="code" href="../../da/d62/struct_i_p_d_r__tag___template.html#o0">TemplateID</a>);
03058                 <a class="code" href="../../d7/d54/_for_doxygen_2src_2_common_2_platform_8h.html#a35">Platform_Unlock</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a1">EXPORTER_PLATFORM</a>);
03059                 <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a210">IPDR_ERR_TEMPLATE_DISABLED</a>;
03060                 <span class="comment">/* NOT_DONE: Add event??? DONE: New IPDR_ERR in IPDR.H ; New field in "IPDR_API IPDR_StatusMsg" ; New Msg in ExporterMsgs,h */</span>
03061         }
03062 
03063         Status = <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a3">EXPORTER_QHANDLER</a>-&gt;SendData(E, S, T, Data);
03064 
03065         <span class="keywordflow">if</span>(ACS != NULL)
03066                 IC = ACS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o5">SessionConnection</a>;
03067 
03068         <span class="keywordflow">if</span>(IC != NULL)
03069                 Conn = IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o3">TCPConnection</a>;
03070 
03071         <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a69">ExporterProtocol_KeepAliveOutTimerReset</a>(IC);
03072 
03073     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d8b/_for_doxygen_2include_2_i_p_d_r_2_i_p_d_r_8h.html#a18">FAILURE</a>(Status)) {
03074                 <span class="keyword">const</span> <span class="keywordtype">char</span>* serverStr;
03075         <a class="code" href="../../d6/df8/struct_i_p_d_r___event_data.html">IPDR_EventData</a> eventData;
03076         <a class="code" href="../../dd/dd0/_for_doxygen_2src_2_exporter_2_exporter_8c.html#a98">EventDataInit</a>(&amp;eventData, <a class="code" href="../../df/dd7/group___i_p_d_r__event__notification.html#gga6a152">IPDR_EVENT_RECORD_LOST</a>, E, ACS, S);
03077 
03078         <span class="keywordflow">if</span> (ACS &amp;&amp; IC &amp;&amp; Conn &amp;&amp; ACS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o1">CSState</a> == <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a52a27">IPDR_CS_ACTIVE</a>) {
03079                         eventData.<a class="code" href="../../d6/df8/struct_i_p_d_r___event_data.html#o1">IC</a> = NULL;
03080                         serverStr = <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a14">TL_GetConnectionInfoStr</a>(Conn);
03081                 } <span class="keywordflow">else</span> {
03082                         eventData.<a class="code" href="../../d6/df8/struct_i_p_d_r___event_data.html#o1">IC</a> = IC;
03083                         serverStr = <span class="stringliteral">"Server=none"</span>;
03084                 }
03085                 S-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o21">Statistics</a>.<a class="code" href="../../d7/d1e/struct_i_p_d_r___statistics.html#o3">LostRecords</a>++;
03086                 <span class="keywordflow">if</span> (ACS) {
03087                         ACS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o10">Statistics</a>.<a class="code" href="../../d7/d1e/struct_i_p_d_r___statistics.html#o3">LostRecords</a>++;
03088                 }
03089 
03090         <a class="code" href="../../dd/dd0/_for_doxygen_2src_2_exporter_2_exporter_8c.html#a99">Exporter_TriggerEvent</a>(E, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a169">IPDR_LEVEL_ERROR</a>, &amp;eventData, NULL, <span class="comment">/* don't record this event with Collector*/</span>
03091                                         <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a100">MSG_EXPORTER_RECORD_LOST</a>,
03092                                     serverStr, S-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o6">DSN</a>,
03093                                         <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a3">EXPORTER_QHANDLER</a>-&gt;OutstandingDataCount(E, S),
03094                                     <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a3">EXPORTER_QHANDLER</a>-&gt;UnacknowledgedDataCount(E, S),
03095                                         S-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o16">ID</a>, S-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o17">Name</a>, S-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o18">Description</a>);
03096 
03097                 <a class="code" href="../../d7/d54/_for_doxygen_2src_2_common_2_platform_8h.html#a35">Platform_Unlock</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a1">EXPORTER_PLATFORM</a>);
03098                 <span class="keywordflow">return</span> Status;
03099         }
03100 
03101         S-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o21">Statistics</a>.<a class="code" href="../../d7/d1e/struct_i_p_d_r___statistics.html#o2">EnqueuedRecords</a>++;
03102         <span class="keywordflow">if</span> (ACS) {
03103                 ACS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o10">Statistics</a>.<a class="code" href="../../d7/d1e/struct_i_p_d_r___statistics.html#o2">EnqueuedRecords</a>++;
03104         }
03105         <a class="code" href="../../d2/dda/_for_doxygen_2src_2_common_2_protocol_8h.html#a8">IPDR_INCR_DSN</a>(S-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o6">DSN</a>);
03106 
03107         <span class="comment">/* We ignore SendOutstandingData's return code because it just</span>
03108 <span class="comment">       indicates that something went wrong whilst trying to send all</span>
03109 <span class="comment">       the records on the queue and a server failover should fix</span>
03110 <span class="comment">       things up. */</span>
03111         (void)<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a3">EXPORTER_QHANDLER</a>-&gt;SendOutstandingData(E,S);
03112         <a class="code" href="../../d7/d54/_for_doxygen_2src_2_common_2_platform_8h.html#a35">Platform_Unlock</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a1">EXPORTER_PLATFORM</a>);
03113         <span class="keywordflow">return</span> Status;
03114 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a23" doxytag="ExporterProtocol.h::ExporterProtocol_SendDisconnect"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_Status</a> ExporterProtocol_SendDisconnect           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../df/d71/struct_i_p_d_r__tag___exporter.html">Exporter</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>E</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d9/d35/struct_i_p_d_r__tag___session.html">Session</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>S</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../de/d0d/struct_i_p_d_r__tag___collector.html">Collector</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>Coll</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Conn</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">01632 {
01633         <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a>             Status;
01634         <a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html">BufferHandle</a>            BH;
01635     DisconnectMessage*  DM;
01636     <a class="code" href="../../d1/d38/struct_i_p_d_r__tag___chunks_manager.html">ChunksManager</a>*              CMgr;
01637         <a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html">IPDRConnection</a>*         IC = Conn-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o11">Owner</a>;
01638 
01639         <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a69">ExporterProtocol_KeepAliveOutTimerReset</a>(IC);
01640 
01641     <span class="keywordflow">if</span> (IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o1">State</a> == <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a51a21">IPDR_CONNECTION_DISCONNECTED</a>) {
01642         <span class="comment">/* XXX should signal error event */</span>
01643         <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a31">Log_Write3</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a169">IPDR_LEVEL_ERROR</a>,
01644                   <span class="stringliteral">"ExporterProtocol_SendDisconnect"</span>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a33">MSG_EXPORTER_UNEXPECTED_MSG</a>,
01645                                 <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a14">TL_GetConnectionInfoStr</a>(Conn), <a class="code" href="../../d2/dda/_for_doxygen_2src_2_common_2_protocol_8h.html#a29">IPDR_MSG_DISCONNECT</a>, <span class="stringliteral">"DISCONNECTED"</span>);
01646         <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a180">IPDR_ERR</a>;
01647     }
01648 
01649     <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a22">TL_GetSendChunksManager</a>(Conn, &amp; CMgr);
01650     Status = <a class="code" href="../../d5/d9f/_for_doxygen_2src_2_common_2_chunks_manager_8c.html#a19">ChunksManager_AllocateBuffer</a>(CMgr,
01651                                           <span class="keyword">sizeof</span>(DisconnectMessage),
01652                                                                                   &amp; BH);
01653     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d8b/_for_doxygen_2include_2_i_p_d_r_2_i_p_d_r_8h.html#a18">FAILURE</a>(Status))
01654     {
01655         <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a28">Log_Write</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a169">IPDR_LEVEL_ERROR</a>,
01656                   <span class="stringliteral">"ExporterProtocol_SendDisconnect"</span>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a72">MSG_EXPORTER_CHUNKS_MANAGER_FAILED</a>);
01657         <span class="keywordflow">return</span> Status;
01658     }
01659 
01660     <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a40">ExporterProtocol_FillHeader</a>(S, BH.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a>, <a class="code" href="../../d2/dda/_for_doxygen_2src_2_common_2_protocol_8h.html#a29">IPDR_MSG_DISCONNECT</a>,
01661                               <span class="keyword">sizeof</span>(DisconnectMessage));
01662 
01663     DM = (DisconnectMessage *) BH.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a>;
01664 
01665     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a15">Log_ShouldWrite</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a171">IPDR_LEVEL_INFO</a>)) {
01666         <a class="code" href="../../d5/d59/_for_doxygen_2src_2_exporter_2_protocol_debug_8c.html#a4">ProtocolDebug_PrintOutgoingMessage</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, Conn, BH.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a171">IPDR_LEVEL_INFO</a>);
01667     }
01668 
01669     Status = <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a9">TL_Send</a>(Conn, &amp; BH, <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a5">IPDR_TRUE</a>);
01670         <span class="keywordflow">if</span>(<a class="code" href="../../d0/d8b/_for_doxygen_2include_2_i_p_d_r_2_i_p_d_r_8h.html#a18">FAILURE</a>(Status))
01671         {
01672                 <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a29">Log_Write1</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a169">IPDR_LEVEL_ERROR</a>,
01673                            <span class="stringliteral">"ExporterProtocol_SendDisconnect"</span>,
01674                            <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a92">MSG_EXPORTER_SEND_DISCONNECT_FAILED</a>, <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a14">TL_GetConnectionInfoStr</a>(Conn));
01675                 <span class="keywordflow">return</span> Status;
01676         }
01677 
01678         <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a29">Log_Write1</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a172">IPDR_LEVEL_DEBUG</a>,
01679                    <span class="stringliteral">"ExporterProtocol_SendDisconnect"</span>,
01680                    <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a93">MSG_EXPORTER_SEND_DISCONNECT_TARGET</a>, <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a14">TL_GetConnectionInfoStr</a>(Conn));
01681                    
01682         <span class="keywordflow">if</span>(IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o7">KeepAliveOUTTimerID</a> != NULL)
01683         {
01684                 <a class="code" href="../../d7/d54/_for_doxygen_2src_2_common_2_platform_8h.html#a13">Platform_UnregisterTimerAndClear</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a1">EXPORTER_PLATFORM</a>, &amp;IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o7">KeepAliveOUTTimerID</a>);
01685                 IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o7">KeepAliveOUTTimerID</a> = NULL;
01686         }
01687         
01688         <span class="keywordflow">if</span>(IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o6">KeepAliveINTimerID</a> != NULL)
01689         {
01690                 <a class="code" href="../../d7/d54/_for_doxygen_2src_2_common_2_platform_8h.html#a13">Platform_UnregisterTimerAndClear</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a1">EXPORTER_PLATFORM</a>, &amp;IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o6">KeepAliveINTimerID</a>);
01691                 IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o6">KeepAliveINTimerID</a> = NULL;
01692         }
01693 
01694         IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o1">State</a> = <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a51a21">IPDR_CONNECTION_DISCONNECTED</a>;
01695     <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a174">IPDR_OK</a>;
01696 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a24" doxytag="ExporterProtocol.h::ExporterProtocol_SendError"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_Status</a> ExporterProtocol_SendError           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../df/d71/struct_i_p_d_r__tag___exporter.html">Exporter</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>E</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d9/d35/struct_i_p_d_r__tag___session.html">Session</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>S</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../de/d0d/struct_i_p_d_r__tag___collector.html">Collector</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>Coll</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Conn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>enum <a class="el" href="../../d6/dbc/ipdr_2src_2_common_2_protocol_8h.html#a57">ErrorCode</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ErrCode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>Msg</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Send an ERROR message to a collector.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>E</em>&nbsp;</td><td>exporter handle (pointer) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>S</em>&nbsp;</td><td>session handle (pointer) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Coll</em>&nbsp;</td><td>collector to which to send the message </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Conn</em>&nbsp;</td><td>connection </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ErrCode</em>&nbsp;</td><td>the error code </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Msg</em>&nbsp;</td><td>the message to send (may be null or zero-length).</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga30a174">IPDR_OK</a> on success; <a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga30">IPDR_STATUS_RETURN_CODE</a> otherwise. </dd></dl>
<div class="fragment"><pre class="fragment">01712 {
01713         <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a> Status;
01714         <a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html">BufferHandle</a> BH;
01715         <a class="code" href="../../d1/d38/struct_i_p_d_r__tag___chunks_manager.html">ChunksManager</a> *CMgr;
01716     ErrorMessage *EM;
01717     <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga10">IPDR_Time</a> Now;
01718         <a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html">IPDRConnection</a> *IC = Conn-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o11">Owner</a>;
01719     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> MsgLen = (Msg == NULL) ? 0 : strlen(Msg);
01720     <a class="code" href="../../d7/d54/_for_doxygen_2src_2_common_2_platform_8h.html#a54">Platform_GetTime</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a1">EXPORTER_PLATFORM</a>, &amp;Now);
01721 
01722         <span class="keywordflow">if</span>(Coll-&gt;<a class="code" href="../../de/d0d/struct_i_p_d_r__tag___collector.html#o9">isDummy</a> == <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a4">IPDR_FALSE</a>)
01723                 <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a69">ExporterProtocol_KeepAliveOutTimerReset</a>(IC);
01724 
01725         <span class="keywordflow">if</span> (IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o3">TCPConnection</a> == NULL <span class="comment">/*|| </span>
01726 <span class="comment">        ((IC-&gt;State == IPDR_CONNECTION_DISCONNECTED || </span>
01727 <span class="comment">        IC-&gt;State == IPDR_CONNECTION_WAITRESPONSE) &amp;&amp; (Coll-&gt;isDummy == IPDR_FALSE))*/</span>)
01728         {
01729         <span class="comment">/* XXX should signal error event */</span>
01730         <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a28">Log_Write</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a169">IPDR_LEVEL_ERROR</a>,
01731                   <span class="stringliteral">"ExporterProtocol_SendErrorMsg"</span>,
01732                   <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a37">MSG_EXPORTER_NOT_READY_SEND</a>);
01733         <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a205">IPDR_ERR_NO_ACTIVE_COLLECTOR</a>;
01734     }
01735 
01736     <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a22">TL_GetSendChunksManager</a>(Conn, &amp; CMgr);
01737     Status = <a class="code" href="../../d5/d9f/_for_doxygen_2src_2_common_2_chunks_manager_8c.html#a19">ChunksManager_AllocateBuffer</a>(CMgr,
01738                                           <span class="keyword">sizeof</span> (ErrorMessage) + MsgLen + 1,
01739                                           &amp; BH);
01740     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d8b/_for_doxygen_2include_2_i_p_d_r_2_i_p_d_r_8h.html#a18">FAILURE</a>(Status))
01741     {
01742         <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a28">Log_Write</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a169">IPDR_LEVEL_ERROR</a>,
01743                   <span class="stringliteral">"ExporterProtocol_SendError"</span>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a72">MSG_EXPORTER_CHUNKS_MANAGER_FAILED</a>);
01744         <span class="keywordflow">return</span> Status;
01745     }
01746 
01747 
01748     EM = (ErrorMessage*)BH.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a>;
01749     <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a40">ExporterProtocol_FillHeader</a>(S, BH.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a>, <a class="code" href="../../d2/dda/_for_doxygen_2src_2_common_2_protocol_8h.html#a30">IPDR_MSG_ERROR</a>,
01750                                 sizeof (ErrorMessage)  + MsgLen + 1 );
01751 
01752     <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a9">IPDR_SET_HTONL</a>(EM-&gt;Timestamp, Now);
01753     <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a8">IPDR_SET_HTONS</a>(EM-&gt;ErrorCode, ErrCode);
01754     <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a9">IPDR_SET_HTONL</a>(EM-&gt;DescrLength, MsgLen);
01755     <span class="comment">/* The description comes after the ErrorMessage ... it would have</span>
01756 <span class="comment">     * been nice to have had a char Descr[0] at the end of the</span>
01757 <span class="comment">     * struct,so we could do "memset(&amp;EM-&gt;Data, ...)" but some</span>
01758 <span class="comment">     * incorrect compilers don't allow this. */</span>
01759     memset(BH.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a> + sizeof (ErrorMessage), 0, MsgLen + 1);
01760     strncpy(BH.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a> + sizeof (ErrorMessage), Msg, MsgLen);
01761 
01762     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a15">Log_ShouldWrite</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a171">IPDR_LEVEL_INFO</a>)) {
01763         <a class="code" href="../../d5/d59/_for_doxygen_2src_2_exporter_2_protocol_debug_8c.html#a4">ProtocolDebug_PrintOutgoingMessage</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, Conn, BH.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a171">IPDR_LEVEL_INFO</a>);
01764     }
01765 
01766     Status = <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a9">TL_Send</a>(Conn, &amp; BH, <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a5">IPDR_TRUE</a>);
01767     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d8b/_for_doxygen_2include_2_i_p_d_r_2_i_p_d_r_8h.html#a18">FAILURE</a>(Status))
01768         {
01769                 <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a29">Log_Write1</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a171">IPDR_LEVEL_INFO</a>,
01770                                         <span class="stringliteral">"ExporterProtocol_SendError"</span>,
01771                                         <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a81">MSG_EXPORTER_ERROR_SEND_FAILED</a>, <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a14">TL_GetConnectionInfoStr</a>(Conn));
01772                 <span class="keywordflow">return</span> Status;
01773         }
01774 
01775         <span class="comment">/*TODO: output detailed error message*/</span>
01776         <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a29">Log_Write1</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a172">IPDR_LEVEL_DEBUG</a>,
01777                                         <span class="stringliteral">"ExporterProtocol_SendError"</span>,
01778                                         <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a82">MSG_EXPORTER_ERROR_SEND_TARGET</a>, <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a14">TL_GetConnectionInfoStr</a>(Conn));
01779 
01780     <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a174">IPDR_OK</a>;
01781 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a31" doxytag="ExporterProtocol.h::ExporterProtocol_SendGetSessionsResponse"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_Status</a> ExporterProtocol_SendGetSessionsResponse           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../df/d71/struct_i_p_d_r__tag___exporter.html">Exporter</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>E</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d9/d35/struct_i_p_d_r__tag___session.html">Session</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>S</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../de/d0d/struct_i_p_d_r__tag___collector.html">Collector</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>Coll</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Conn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>RequestID</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">02794 {
02795         size_t                          Size;
02796     <a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html">BufferHandle</a>                BH;
02797     <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a>                 Status;
02798         <span class="keywordtype">int</span>                                     Index;
02799         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>            NumSessions;
02800     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>               MsgID = <a class="code" href="../../d2/dda/_for_doxygen_2src_2_common_2_protocol_8h.html#a37">IPDR_MSG_GET_SESSIONS_RESPONSE</a>;
02801         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>           *p1;
02802     <a class="code" href="../../d1/d38/struct_i_p_d_r__tag___chunks_manager.html">ChunksManager</a>*              CMgr;
02803         <a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html">IPDRConnection</a>*         IC = Conn-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o11">Owner</a>;
02804         <span class="comment">/*CollectorSession*     CS = NULL;*/</span>
02805         GetSessionsResponseMessage      *GTR;
02806 
02807         <span class="comment">/*Status = ExporterProtocol_CollectorSession(Coll, S, &amp;CS, NULL, IPDR_TRUE);*/</span>
02808 
02809         <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a69">ExporterProtocol_KeepAliveOutTimerReset</a>(IC);
02810 
02811     <span class="keywordflow">if</span> (Conn == NULL || IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o1">State</a> == <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a51a21">IPDR_CONNECTION_DISCONNECTED</a> ||
02812                 IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o1">State</a> == <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a51a22">IPDR_CONNECTION_WAITRESPONSE</a>)
02813         {
02814         <span class="comment">/* XXX should signal error event */</span>
02815         <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a29">Log_Write1</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a169">IPDR_LEVEL_ERROR</a>,
02816                   <span class="stringliteral">"ExporterProtocol_SendGetSessionsResponse"</span>,
02817                   <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a57">MSG_EXPORTER_NOT_READY_SEND2</a>,  <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a14">TL_GetConnectionInfoStr</a>(Conn));
02818         <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a205">IPDR_ERR_NO_ACTIVE_COLLECTOR</a>;
02819     }
02820 
02821         <span class="comment">/*if(CS == NULL)</span>
02822 <span class="comment">        {</span>
02823 <span class="comment">                Log_Write2(EXPORTER_LOG, PROTOCOL_MODULE_ID, IPDR_LEVEL_ERROR,</span>
02824 <span class="comment">                                        "ExporterProtocol_SendGetSessionsResponse",</span>
02825 <span class="comment">                                        MSG_EXPORTER_NO_SESSIONS,  TL_GetConnectionInfoStr(Conn),</span>
02826 <span class="comment">                                        TL_GetConnectionInfoStr(Conn));</span>
02827 <span class="comment">                return IPDR_ERR_UNABLE_TO_FIND_SESSION ;</span>
02828 <span class="comment">        }*/</span>
02829 
02830             <span class="comment">/* calculate the size of the message */</span>
02831 
02832     <a class="code" href="../../dd/d31/_for_doxygen_2src_2_common_2_dynamic_array_8c.html#a15">DynamicArray_CountObjects</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a1">EXPORTER_PLATFORM</a>, &amp; (E-&gt;<a class="code" href="../../df/d71/struct_i_p_d_r__tag___exporter.html#o13">Sessions</a>),
02833                               &amp; NumSessions);
02834 
02835     Size = <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a13">ExporterProtocol_GetSessionsResponseMsgLen</a>(E);
02836 
02837             <span class="comment">/* allocate a buffer for the message */</span>
02838     <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a22">TL_GetSendChunksManager</a>(Conn, &amp; CMgr);
02839     Status = <a class="code" href="../../d5/d9f/_for_doxygen_2src_2_common_2_chunks_manager_8c.html#a19">ChunksManager_AllocateBuffer</a>(CMgr, Size, &amp; BH);
02840     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d8b/_for_doxygen_2include_2_i_p_d_r_2_i_p_d_r_8h.html#a18">FAILURE</a>(Status))
02841         {
02842         <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a28">Log_Write</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a169">IPDR_LEVEL_ERROR</a>,
02843                    <span class="stringliteral">"ExporterProtocol_SendGetSessionsResponse"</span>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a72">MSG_EXPORTER_CHUNKS_MANAGER_FAILED</a>);
02844         <span class="keywordflow">return</span> Status;
02845         }
02846 
02847     <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a40">ExporterProtocol_FillHeader</a>(S, BH.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a>, MsgID, Size);
02848 
02849         GTR = (GetSessionsResponseMessage *)BH.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a>;
02850 
02851         <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a8">IPDR_SET_HTONS</a>(GTR-&gt;RequestID, RequestID);
02852         <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a9">IPDR_SET_HTONL</a>(GTR-&gt;NumSessions, E-&gt;<a class="code" href="../../df/d71/struct_i_p_d_r__tag___exporter.html#o13">Sessions</a>.<a class="code" href="../../db/dc0/struct_dynamic_array.html#o1">Length</a>);
02853 
02854         p1 = BH.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a> + <span class="keyword">sizeof</span>(GetSessionsResponseMessage);
02855         <span class="keywordflow">for</span>( Index = 0 ; Index &lt; E-&gt;<a class="code" href="../../df/d71/struct_i_p_d_r__tag___exporter.html#o13">Sessions</a>.<a class="code" href="../../db/dc0/struct_dynamic_array.html#o1">Length</a> ; Index++ )
02856         {
02857                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> sl;
02858                 <a class="code" href="../../d2/d1c/struct_protocol_unsigned32.html">ProtocolUnsigned32</a> nsl, ackTimeInterval, ackSequenceInterval;
02859                 <a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html">Session</a> *SS = (<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html">Session</a> *)E-&gt;<a class="code" href="../../df/d71/struct_i_p_d_r__tag___exporter.html#o13">Sessions</a>.<a class="code" href="../../db/dc0/struct_dynamic_array.html#o0">Data</a>[Index];
02860                 memcpy(p1, &amp;(SS-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o16">ID</a>), <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>));
02861                 p1 += <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> char) * 2;
02862                 sl = strlen(SS-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o17">Name</a>);
02863                 <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a9">IPDR_SET_HTONL</a>(nsl, sl);
02864                 memcpy(p1, &amp;nsl, <span class="keyword">sizeof</span>(nsl));
02865                 p1 += <span class="keyword">sizeof</span>(nsl);
02866                 memcpy(p1, SS-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o17">Name</a>, sl);
02867                 p1 += sl;
02868                 sl = strlen(SS-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o18">Description</a>);
02869                 <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a9">IPDR_SET_HTONL</a>(nsl, sl);
02870                 memcpy(p1, &amp;nsl, <span class="keyword">sizeof</span>(nsl));
02871                 p1 += <span class="keyword">sizeof</span>(nsl);
02872                 memcpy(p1, SS-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o18">Description</a>, sl);
02873                 p1 += sl;
02874                 <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a9">IPDR_SET_HTONL</a>(ackTimeInterval, E-&gt;<a class="code" href="../../df/d71/struct_i_p_d_r__tag___exporter.html#o4">Parameters</a>.<a class="code" href="../../d1/dac/struct_exporter_parameters.html#o9">DataAckTimeInterval</a>);
02875                 <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a9">IPDR_SET_HTONL</a>(ackSequenceInterval, E-&gt;<a class="code" href="../../df/d71/struct_i_p_d_r__tag___exporter.html#o4">Parameters</a>.<a class="code" href="../../d1/dac/struct_exporter_parameters.html#o10">DataAckSequenceInterval</a>);
02876                 memcpy(p1, &amp;ackTimeInterval, <span class="keyword">sizeof</span>(ackTimeInterval));
02877                 p1 += <span class="keyword">sizeof</span>(ackTimeInterval);
02878                 memcpy(p1, &amp;ackSequenceInterval, <span class="keyword">sizeof</span>(ackSequenceInterval));
02879                 p1 += <span class="keyword">sizeof</span>(ackSequenceInterval);
02880         }
02881 
02882         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a15">Log_ShouldWrite</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a171">IPDR_LEVEL_INFO</a>)) {
02883         <a class="code" href="../../d5/d59/_for_doxygen_2src_2_exporter_2_protocol_debug_8c.html#a4">ProtocolDebug_PrintOutgoingMessage</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, Conn, BH.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a171">IPDR_LEVEL_INFO</a>);
02884     }
02885 
02886     Status = <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a9">TL_Send</a>(Conn, &amp; BH, <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a5">IPDR_TRUE</a>);
02887         <span class="keywordflow">if</span>(<a class="code" href="../../d0/d8b/_for_doxygen_2include_2_i_p_d_r_2_i_p_d_r_8h.html#a18">FAILURE</a>(Status))
02888         {
02889                 <span class="keywordflow">return</span> Status;
02890         }
02891     <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a174">IPDR_OK</a>;
02892 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a32" doxytag="ExporterProtocol.h::ExporterProtocol_SendGetTemplatesResponse"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_Status</a> ExporterProtocol_SendGetTemplatesResponse           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../df/d71/struct_i_p_d_r__tag___exporter.html">Exporter</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>E</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d9/d35/struct_i_p_d_r__tag___session.html">Session</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>S</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../de/d0d/struct_i_p_d_r__tag___collector.html">Collector</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>Coll</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Conn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>RequestID</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Send a GET TMPL RSP message to a server .<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>E</em>&nbsp;</td><td>exporter handle </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>S</em>&nbsp;</td><td>session handle (pointer)NumSessions </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Coll</em>&nbsp;</td><td>collector </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Conn</em>&nbsp;</td><td>connection </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>RequestID</em>&nbsp;</td><td>id associated with the reply.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga30a174">IPDR_OK</a> on success; <a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga30">IPDR_STATUS_RETURN_CODE</a> otherwise. </dd></dl>
<div class="fragment"><pre class="fragment">02950 {
02951         size_t                          Size;
02952     <a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html">BufferHandle</a>                BH;
02953     <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a>                 Status;
02954         <a class="code" href="../../d1/d8c/struct_i_p_d_r__tag___transmission_context.html">TransmissionContext</a>* TC = S-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o3">ActiveContext</a>;
02955     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>                NumTemplates;
02956     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>               MsgID = <a class="code" href="../../d2/dda/_for_doxygen_2src_2_common_2_protocol_8h.html#a38">IPDR_MSG_GET_TEMPLATES_RESPONSE</a>;
02957     <a class="code" href="../../d1/d38/struct_i_p_d_r__tag___chunks_manager.html">ChunksManager</a>*              CMgr;
02958         <a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html">IPDRConnection</a>*         IC = Conn-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o11">Owner</a>;
02959         <span class="comment">/*CollectorSession*     CS = NULL;*/</span>
02960 
02961         <span class="comment">/*Status = ExporterProtocol_CollectorSession(Coll, S, &amp;CS, NULL, IPDR_TRUE);*/</span>
02962         <span class="keywordflow">if</span>(S-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o10">Running</a> != <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a5">IPDR_TRUE</a>)
02963                 <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a177">IPDR_ERR_SESSION_LOGICALLY_STOPED</a>;
02964 
02965         <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a69">ExporterProtocol_KeepAliveOutTimerReset</a>(IC);
02966 
02967 
02968     <span class="keywordflow">if</span> (Conn == NULL || IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o1">State</a> == <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a51a21">IPDR_CONNECTION_DISCONNECTED</a> || IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o1">State</a> == <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a51a22">IPDR_CONNECTION_WAITRESPONSE</a>)
02969         {
02970         <span class="comment">/* XXX should signal error event */</span>
02971         <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a29">Log_Write1</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a169">IPDR_LEVEL_ERROR</a>,
02972                   <span class="stringliteral">"ExporterProtocol_SendGetTemplatesResponse"</span>,
02973                   <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a57">MSG_EXPORTER_NOT_READY_SEND2</a>,  <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a14">TL_GetConnectionInfoStr</a>(Conn));
02974         <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a205">IPDR_ERR_NO_ACTIVE_COLLECTOR</a>;
02975     }
02976 
02977         <span class="comment">/*if(CS == NULL)</span>
02978 <span class="comment">        {</span>
02979 <span class="comment">                Log_Write2(EXPORTER_LOG, PROTOCOL_MODULE_ID, IPDR_LEVEL_ERROR,</span>
02980 <span class="comment">                                        "ExporterProtocol_SendGetTemplatesResponse",</span>
02981 <span class="comment">                                        MSG_EXPORTER_NO_SESSIONS,  TL_GetConnectionInfoStr(Conn),  TL_GetConnectionInfoStr(Conn));</span>
02982 <span class="comment">                return IPDR_ERR_UNABLE_TO_FIND_SESSION ;</span>
02983 <span class="comment">        }*/</span>
02984 
02985     <span class="comment">/* calculate the size of the message */</span>
02986 
02987     <a class="code" href="../../dd/d31/_for_doxygen_2src_2_common_2_dynamic_array_8c.html#a15">DynamicArray_CountObjects</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a1">EXPORTER_PLATFORM</a>, &amp; (TC-&gt;<a class="code" href="../../d1/d8c/struct_i_p_d_r__tag___transmission_context.html#o2">Templates</a>),
02988                               &amp; NumTemplates);
02989 
02990     Size = <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a11">ExporterProtocol_GetTemplatesResponseMsgLen</a>(TC);
02991 
02992     <span class="comment">/* allocate a buffer for the message */</span>
02993     <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a22">TL_GetSendChunksManager</a>(Conn, &amp; CMgr);
02994     Status = <a class="code" href="../../d5/d9f/_for_doxygen_2src_2_common_2_chunks_manager_8c.html#a19">ChunksManager_AllocateBuffer</a>(CMgr, Size, &amp; BH);
02995     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d8b/_for_doxygen_2include_2_i_p_d_r_2_i_p_d_r_8h.html#a18">FAILURE</a>(Status))
02996         {
02997         <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a28">Log_Write</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a169">IPDR_LEVEL_ERROR</a>,
02998                    <span class="stringliteral">"ExporterProtocol_SendGetTemplatesResponse"</span>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a72">MSG_EXPORTER_CHUNKS_MANAGER_FAILED</a>);
02999         <span class="keywordflow">return</span> Status;
03000         }
03001 
03002     <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a40">ExporterProtocol_FillHeader</a>(S, BH.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a>, MsgID, Size);
03003 
03004         Status = <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a28">ExporterProtocol_GetTemplates</a>(TC, BH.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a>, RequestID);
03005     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d8b/_for_doxygen_2include_2_i_p_d_r_2_i_p_d_r_8h.html#a18">FAILURE</a>(Status))
03006         {
03007                 <span class="comment">/*NOTE: ExporterProtocol_WriteTemplateData always returns IPDR_OK !!! */</span>
03008         <span class="keywordflow">return</span> Status;
03009         }
03010 
03011     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a15">Log_ShouldWrite</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a171">IPDR_LEVEL_INFO</a>)) {
03012         <a class="code" href="../../d5/d59/_for_doxygen_2src_2_exporter_2_protocol_debug_8c.html#a4">ProtocolDebug_PrintOutgoingMessage</a>(EXPORTER_LOG, Conn, BH.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a171">IPDR_LEVEL_INFO</a>);
03013     }
03014 
03015     Status = <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a9">TL_Send</a>(Conn, &amp; BH, <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a5">IPDR_TRUE</a>);
03016         <span class="keywordflow">if</span>(<a class="code" href="../../d0/d8b/_for_doxygen_2include_2_i_p_d_r_2_i_p_d_r_8h.html#a18">FAILURE</a>(Status))
03017         {
03018                 <span class="keywordflow">return</span> Status;
03019         }
03020     <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a174">IPDR_OK</a>;
03021 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a25" doxytag="ExporterProtocol.h::ExporterProtocol_SendKeepAlive"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_Status</a> ExporterProtocol_SendKeepAlive           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../df/d71/struct_i_p_d_r__tag___exporter.html">Exporter</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>E</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d9/d35/struct_i_p_d_r__tag___session.html">Session</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>S</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../de/d0d/struct_i_p_d_r__tag___collector.html">Collector</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>Coll</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Conn</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">01787 {
01788         <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a>     Status;
01789         <a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html">BufferHandle</a>    BH;
01790     <a class="code" href="../../d1/d38/struct_i_p_d_r__tag___chunks_manager.html">ChunksManager</a>*      CMgr;
01791         <a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html">IPDRConnection</a>* IC = NULL;
01792         <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a28">TL_PABuf</a> paBuf;
01793         
01794         <span class="keywordflow">if</span>(!Conn)       
01795                 <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a174">IPDR_OK</a> ;
01796                 
01797         IC = Conn-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o11">Owner</a>;
01798 
01799         <a class="code" href="../../d7/d54/_for_doxygen_2src_2_common_2_platform_8h.html#a34">Platform_Lock</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a1">EXPORTER_PLATFORM</a>);
01800 
01801         <span class="keywordflow">if</span> (IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o1">State</a> != <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a51a23">IPDR_CONNECTION_CONNECTED</a>) {
01802         <span class="comment">/* XXX should signal error event */</span>
01803         <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a28">Log_Write</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a169">IPDR_LEVEL_ERROR</a>,
01804                   <span class="stringliteral">"ExporterProtocol_SendKeepAlive"</span>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a84">MSG_EXPORTER_CONNECTION_MUST_BE_SET</a>);
01805                                   
01806                 <a class="code" href="../../d7/d54/_for_doxygen_2src_2_common_2_platform_8h.html#a35">Platform_Unlock</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a1">EXPORTER_PLATFORM</a>);
01807         <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a180">IPDR_ERR</a>;
01808     }
01809 
01810         <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a69">ExporterProtocol_KeepAliveOutTimerReset</a>(IC);
01811 
01812     <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a22">TL_GetSendChunksManager</a>(Conn, &amp; CMgr);
01813     Status = <a class="code" href="../../d5/d9f/_for_doxygen_2src_2_common_2_chunks_manager_8c.html#a19">ChunksManager_AllocateBuffer</a>(CMgr,
01814                                           <span class="keyword">sizeof</span>(MessageHeader),
01815                                                                                   &amp; BH);
01816     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d8b/_for_doxygen_2include_2_i_p_d_r_2_i_p_d_r_8h.html#a18">FAILURE</a>(Status))
01817         {
01818                 <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a28">Log_Write</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a169">IPDR_LEVEL_ERROR</a>,
01819                            <span class="stringliteral">"ExporterProtocol_SendKeepAlive"</span>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a72">MSG_EXPORTER_CHUNKS_MANAGER_FAILED</a>);
01820                            
01821                 <a class="code" href="../../d7/d54/_for_doxygen_2src_2_common_2_platform_8h.html#a35">Platform_Unlock</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a1">EXPORTER_PLATFORM</a>);
01822         <span class="keywordflow">return</span> Status;
01823         }
01824 
01825     <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a40">ExporterProtocol_FillHeader</a>(S, BH.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a>, <a class="code" href="../../d2/dda/_for_doxygen_2src_2_common_2_protocol_8h.html#a31">IPDR_MSG_KEEP_ALIVE</a>,
01826                               <span class="keyword">sizeof</span>(MessageHeader));
01827 
01828     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a15">Log_ShouldWrite</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a171">IPDR_LEVEL_INFO</a>)) {
01829         <a class="code" href="../../d5/d59/_for_doxygen_2src_2_exporter_2_protocol_debug_8c.html#a4">ProtocolDebug_PrintOutgoingMessage</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, Conn, BH.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a171">IPDR_LEVEL_INFO</a>);
01830     }
01831 
01832     Status = <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a9">TL_Send</a>(Conn, &amp; BH, <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a5">IPDR_TRUE</a>);
01833         <span class="keywordflow">if</span>(<a class="code" href="../../d0/d8b/_for_doxygen_2include_2_i_p_d_r_2_i_p_d_r_8h.html#a18">FAILURE</a>(Status))
01834         {
01835                 <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a29">Log_Write1</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a171">IPDR_LEVEL_INFO</a>,
01836                                         <span class="stringliteral">"ExporterProtocol_SendKeepAlive"</span>,
01837                                         <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a94">MSG_EXPORTER_SEND_KEEPALIVE_FAILED</a>, <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a14">TL_GetConnectionInfoStr</a>(Conn));
01838                 <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a24">TL_HandleDisconnection</a>(Conn);
01839                 
01840                 <a class="code" href="../../d7/d54/_for_doxygen_2src_2_common_2_platform_8h.html#a35">Platform_Unlock</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a1">EXPORTER_PLATFORM</a>);
01841                 <span class="keywordflow">return</span> Status;
01842         }
01843 
01844         <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a29">Log_Write1</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a171">IPDR_LEVEL_INFO</a>,
01845                                         <span class="stringliteral">"ExporterProtocol_SendKeepAlive"</span>,
01846                                         <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a95">MSG_EXPORTER_SEND_KEEPALIVE_TARGET</a>, <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a18">TL_PrintConnectionRemote</a>(Conn,paBuf));
01847                                         
01848         <a class="code" href="../../d7/d54/_for_doxygen_2src_2_common_2_platform_8h.html#a35">Platform_Unlock</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a1">EXPORTER_PLATFORM</a>);
01849     <span class="keywordflow">return</span> Status;
01850 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a29" doxytag="ExporterProtocol.h::ExporterProtocol_SendModifyTemplateResponse"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_Status</a> ExporterProtocol_SendModifyTemplateResponse           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../df/d71/struct_i_p_d_r__tag___exporter.html">Exporter</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>E</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d9/d35/struct_i_p_d_r__tag___session.html">Session</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>S</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../de/d0d/struct_i_p_d_r__tag___collector.html">Collector</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>Coll</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Conn</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">02636 {
02637         size_t                          Size;
02638     <a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html">BufferHandle</a>                BH;
02639     <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a>                 Status;
02640         <a class="code" href="../../d1/d8c/struct_i_p_d_r__tag___transmission_context.html">TransmissionContext</a>* TC = S-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o3">ActiveContext</a>;
02641     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>                NumTemplates;
02642     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>               MsgID;
02643     <a class="code" href="../../d1/d38/struct_i_p_d_r__tag___chunks_manager.html">ChunksManager</a>*              CMgr;
02644         <a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html">IPDRConnection</a>*         IC = Conn-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o11">Owner</a>;
02645         <a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html">CollectorSession</a>*       CS = NULL;
02646 
02647         Status = <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a5">ExporterProtocol_CollectorSession</a>(Coll, S, &amp;CS, NULL, <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a5">IPDR_TRUE</a>);
02648 
02649         <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a69">ExporterProtocol_KeepAliveOutTimerReset</a>(IC);
02650 
02651 
02652     <span class="keywordflow">if</span> (Conn == NULL || IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o1">State</a> == <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a51a21">IPDR_CONNECTION_DISCONNECTED</a> || IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o1">State</a> == <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a51a22">IPDR_CONNECTION_WAITRESPONSE</a>)
02653         {
02654         <span class="comment">/* XXX should signal error event */</span>
02655         <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a29">Log_Write1</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a169">IPDR_LEVEL_ERROR</a>,
02656                            <span class="stringliteral">"ExporterProtocol_SendModifyTemplateResponse"</span>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a57">MSG_EXPORTER_NOT_READY_SEND2</a>,
02657                            <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a14">TL_GetConnectionInfoStr</a>(Conn));
02658                            <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a205">IPDR_ERR_NO_ACTIVE_COLLECTOR</a>;
02659     }
02660 
02661         <span class="keywordflow">if</span>(CS == NULL)
02662         {
02663                 <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a30">Log_Write2</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a169">IPDR_LEVEL_ERROR</a>,
02664                            <span class="stringliteral">"ExporterProtocol_SendModifyTemplateResponse"</span>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a45">MSG_EXPORTER_NO_SESSIONS</a>,
02665                            <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a14">TL_GetConnectionInfoStr</a>(Conn),  <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a14">TL_GetConnectionInfoStr</a>(Conn));
02666                 <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a192">IPDR_ERR_UNABLE_TO_FIND_SESSION</a> ;
02667         }
02668 
02669     <span class="comment">/* calculate the size of the message */</span>
02670 
02671     <a class="code" href="../../dd/d31/_for_doxygen_2src_2_common_2_dynamic_array_8c.html#a15">DynamicArray_CountObjects</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a1">EXPORTER_PLATFORM</a>, &amp; (TC-&gt;<a class="code" href="../../d1/d8c/struct_i_p_d_r__tag___transmission_context.html#o2">Templates</a>),
02672                               &amp; NumTemplates);
02673 
02674     Size = <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a10">ExporterProtocol_GetTemplateDataMsgLen</a>(TC);
02675 
02676     <span class="comment">/* allocate a buffer for the message */</span>
02677     <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a22">TL_GetSendChunksManager</a>(Conn, &amp; CMgr);
02678     Status = <a class="code" href="../../d5/d9f/_for_doxygen_2src_2_common_2_chunks_manager_8c.html#a19">ChunksManager_AllocateBuffer</a>(CMgr, Size, &amp; BH);
02679     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d8b/_for_doxygen_2include_2_i_p_d_r_2_i_p_d_r_8h.html#a18">FAILURE</a>(Status))
02680         {
02681                 <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a28">Log_Write</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a169">IPDR_LEVEL_ERROR</a>,
02682                            <span class="stringliteral">"ExporterProtocol_SendModifyTemplateResponse"</span>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a72">MSG_EXPORTER_CHUNKS_MANAGER_FAILED</a>);
02683         <span class="keywordflow">return</span> Status;
02684         }
02685 
02686 
02687     MsgID = <a class="code" href="../../d2/dda/_for_doxygen_2src_2_common_2_protocol_8h.html#a35">IPDR_MSG_MODIFY_TEMPLATE_RESPONSE</a>;
02688     <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a40">ExporterProtocol_FillHeader</a>(S, BH.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a>, MsgID, Size);
02689 
02690         Status = <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a21">ExporterProtocol_WriteTemplateData</a>(TC, BH.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a>, CS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o7">Negotiable</a>);
02691     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d8b/_for_doxygen_2include_2_i_p_d_r_2_i_p_d_r_8h.html#a18">FAILURE</a>(Status))
02692         {
02693                 <span class="comment">/*NOTE: ExporterProtocol_WriteTemplateData always returns IPDR_OK !!! */</span>
02694                 <span class="keywordflow">return</span> Status;
02695         }
02696 
02697     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a15">Log_ShouldWrite</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a171">IPDR_LEVEL_INFO</a>)) {
02698         <a class="code" href="../../d5/d59/_for_doxygen_2src_2_exporter_2_protocol_debug_8c.html#a4">ProtocolDebug_PrintOutgoingMessage</a>(EXPORTER_LOG, Conn, BH.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a171">IPDR_LEVEL_INFO</a>);
02699     }
02700 
02701     Status = <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a9">TL_Send</a>(Conn, &amp; BH, <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a5">IPDR_TRUE</a>);
02702         <span class="keywordflow">if</span>(<a class="code" href="../../d0/d8b/_for_doxygen_2include_2_i_p_d_r_2_i_p_d_r_8h.html#a18">FAILURE</a>(Status))
02703         {
02704                 <span class="keywordflow">return</span> Status;
02705         }
02706 
02707         <span class="keywordflow">if</span>(CS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o8">TmplDataTimer</a> != NULL)
02708                 <a class="code" href="../../d7/d54/_for_doxygen_2src_2_common_2_platform_8h.html#a13">Platform_UnregisterTimerAndClear</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a1">EXPORTER_PLATFORM</a>, &amp;CS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o8">TmplDataTimer</a>);
02709 
02710         <a class="code" href="../../d7/d54/_for_doxygen_2src_2_common_2_platform_8h.html#a9">Platform_RegisterTimer</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a1">EXPORTER_PLATFORM</a>,
02711                                                 <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a32">ExporterProtocol_TmplDataTimerCallback</a>,
02712                                                         CS,
02713                             E-&gt;<a class="code" href="../../df/d71/struct_i_p_d_r__tag___exporter.html#o4">Parameters</a>.<a class="code" href="../../d1/dac/struct_exporter_parameters.html#o6">TemplateAckTimeout</a>,
02714                             &amp; (CS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o8">TmplDataTimer</a>));
02715     <span class="keywordflow">return</span> Status;
02716 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a26" doxytag="ExporterProtocol.h::ExporterProtocol_SendSessionStart"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_Status</a> ExporterProtocol_SendSessionStart           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../df/d71/struct_i_p_d_r__tag___exporter.html">Exporter</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>E</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d9/d35/struct_i_p_d_r__tag___session.html">Session</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>S</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../de/d0d/struct_i_p_d_r__tag___collector.html">Collector</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>Coll</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Conn</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">01856 {
01857         <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a>                     Status;
01858         <a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html">BufferHandle</a>                    BH;
01859         <a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html">IPDRConnection</a>*                 IC = Conn-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o11">Owner</a>;
01860         SessionStartMessage*    SSM;
01861         <a class="code" href="../../d1/d38/struct_i_p_d_r__tag___chunks_manager.html">ChunksManager</a>*                  CMgr;
01862 
01863         <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a69">ExporterProtocol_KeepAliveOutTimerReset</a>(IC);
01864 
01865         <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a22">TL_GetSendChunksManager</a>(Conn, &amp; CMgr);
01866     Status = <a class="code" href="../../d5/d9f/_for_doxygen_2src_2_common_2_chunks_manager_8c.html#a19">ChunksManager_AllocateBuffer</a>(CMgr, <span class="keyword">sizeof</span>(SessionStartMessage), &amp;BH);
01867     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d8b/_for_doxygen_2include_2_i_p_d_r_2_i_p_d_r_8h.html#a18">FAILURE</a>(Status))
01868         {
01869                 <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a28">Log_Write</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a169">IPDR_LEVEL_ERROR</a>,
01870                           <span class="stringliteral">"ExporterProtocol_SendSessionStart"</span>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a72">MSG_EXPORTER_CHUNKS_MANAGER_FAILED</a>);
01871         <span class="keywordflow">return</span> Status;
01872         }
01873 
01874     <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a40">ExporterProtocol_FillHeader</a>(S, BH.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a>, <a class="code" href="../../d2/dda/_for_doxygen_2src_2_common_2_protocol_8h.html#a32">IPDR_MSG_SESSION_START</a>, <span class="keyword">sizeof</span>(SessionStartMessage));
01875 
01876         SSM = (SessionStartMessage*)BH.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a>;
01877 
01878     <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a9">IPDR_SET_HTONL</a>(SSM-&gt;exporterBootTime, E-&gt;<a class="code" href="../../df/d71/struct_i_p_d_r__tag___exporter.html#o2">ExporterStartTime</a>);
01879     <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a10">IPDR_SET_HTONLL</a>(SSM-&gt;firstRecordSequenceNumber, S-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o6">DSN</a>);
01880     <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a10">IPDR_SET_HTONLL</a>(SSM-&gt;droppedRecordCount, 0);
01881     <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a9">IPDR_SET_HTONL</a>(SSM-&gt;ackTimeInterval,((E-&gt;<a class="code" href="../../df/d71/struct_i_p_d_r__tag___exporter.html#o4">Parameters</a>.<a class="code" href="../../d1/dac/struct_exporter_parameters.html#o9">DataAckTimeInterval</a>)/1000) );
01882     <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a9">IPDR_SET_HTONL</a>(SSM-&gt;ackSequenceInterval, E-&gt;<a class="code" href="../../df/d71/struct_i_p_d_r__tag___exporter.html#o4">Parameters</a>.<a class="code" href="../../d1/dac/struct_exporter_parameters.html#o10">DataAckSequenceInterval</a> );
01883     memcpy( SSM-&gt;documentId, S-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o5">DocumentID</a>, <span class="keyword">sizeof</span>(S-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o5">DocumentID</a>) );
01884     SSM-&gt;primary = 1 ;
01885 
01886         <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a30">Log_Write2</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a171">IPDR_LEVEL_INFO</a>,
01887                         <span class="stringliteral">"ExporterProtocol_SendSessionStart"</span>,
01888                         <span class="stringliteral">"ackTimeInterval=%lu, dataAckSequenceInterval=%lu."</span>,
01889                         (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)<a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a12">IPDR_NTOHL</a>(SSM-&gt;ackTimeInterval),
01890                         (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)<a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a12">IPDR_NTOHL</a>(SSM-&gt;ackSequenceInterval));
01891 
01892 
01893     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a15">Log_ShouldWrite</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a171">IPDR_LEVEL_INFO</a>)) {
01894         <a class="code" href="../../d5/d59/_for_doxygen_2src_2_exporter_2_protocol_debug_8c.html#a4">ProtocolDebug_PrintOutgoingMessage</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, Conn, BH.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a171">IPDR_LEVEL_INFO</a>);
01895     }
01896 
01897         Status = <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a9">TL_Send</a>(Conn, &amp; BH, <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a5">IPDR_TRUE</a>);
01898         <span class="keywordflow">if</span>(<a class="code" href="../../d0/d8b/_for_doxygen_2include_2_i_p_d_r_2_i_p_d_r_8h.html#a18">FAILURE</a>(Status))
01899         {
01900                 <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a29">Log_Write1</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a171">IPDR_LEVEL_INFO</a>,
01901                                         <span class="stringliteral">"ExporterProtocol_SendSessionStart"</span>,
01902                                         <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a79">MSG_EXPORTER_SEND_SESSION_START_FAILED</a>, <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a14">TL_GetConnectionInfoStr</a>(Conn));
01903                 <span class="keywordflow">return</span> Status;
01904         }
01905 
01906         <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a29">Log_Write1</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a172">IPDR_LEVEL_DEBUG</a>,
01907                                         <span class="stringliteral">"ExporterProtocol_SendSessionStart"</span>,
01908                                         <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a80">MSG_EXPORTER_SEND_SESSION_START_TARGET</a>, <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a14">TL_GetConnectionInfoStr</a>(Conn));
01909         <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a174">IPDR_OK</a>;
01910 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a27" doxytag="ExporterProtocol.h::ExporterProtocol_SendSessionStop"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_Status</a> ExporterProtocol_SendSessionStop           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../df/d71/struct_i_p_d_r__tag___exporter.html">Exporter</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>E</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d9/d35/struct_i_p_d_r__tag___session.html">Session</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>S</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../de/d0d/struct_i_p_d_r__tag___collector.html">Collector</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>Coll</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Conn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>unsigned short&nbsp;</td>
          <td class="mdname" nowrap> <em>reasonCode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>ReasonDescripsion</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">01914 {
01915         <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a> Status;
01916     <a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html">BufferHandle</a> BH;
01917     <a class="code" href="../../d1/d38/struct_i_p_d_r__tag___chunks_manager.html">ChunksManager</a> *CMgr;
01918     SessionStopMessage *SSM;
01919     <a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html">IPDRConnection</a> *IC = NULL;
01920     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> MsgLen = (ReasonDescripsion == NULL) ? 0 : strlen(ReasonDescripsion);
01921 
01922 
01923         <span class="keywordflow">if</span>( !E || !S || !Coll )
01924                 <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a181">IPDR_ERR_INVALID_VALUE</a>;
01925 
01926         <span class="keywordflow">if</span>( Conn == NULL || Conn-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o11">Owner</a> == NULL)
01927         {
01928                 <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a28">Log_Write</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a169">IPDR_LEVEL_ERROR</a>,
01929                   <span class="stringliteral">"ExporterProtocol_SendSessionStop"</span>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a77">MSG_EXPORTER_COLLECTOR_NOT_CONNECTED</a>);
01930                 <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a205">IPDR_ERR_NO_ACTIVE_COLLECTOR</a>;
01931         }
01932 
01933         IC = Conn-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o11">Owner</a>;
01934 
01935         <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a69">ExporterProtocol_KeepAliveOutTimerReset</a>(IC);
01936 
01937         <span class="keywordflow">if</span> (IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o3">TCPConnection</a> == NULL ||
01938             IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o1">State</a> == <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a51a21">IPDR_CONNECTION_DISCONNECTED</a> ||
01939             IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o1">State</a> == <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a51a22">IPDR_CONNECTION_WAITRESPONSE</a>)
01940         {
01941         <span class="comment">/* XXX should signal error event */</span>
01942         <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a28">Log_Write</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a169">IPDR_LEVEL_ERROR</a>,
01943                   <span class="stringliteral">"ExporterProtocol_SendSessionStop"</span>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a37">MSG_EXPORTER_NOT_READY_SEND</a>);
01944         <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a205">IPDR_ERR_NO_ACTIVE_COLLECTOR</a>;
01945     }
01946 
01947     <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a22">TL_GetSendChunksManager</a>(Conn, &amp; CMgr);
01948     Status = <a class="code" href="../../d5/d9f/_for_doxygen_2src_2_common_2_chunks_manager_8c.html#a19">ChunksManager_AllocateBuffer</a>(CMgr,
01949                                           <span class="keyword">sizeof</span> (SessionStopMessage) + MsgLen + 1,
01950                                           &amp; BH);
01951     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d8b/_for_doxygen_2include_2_i_p_d_r_2_i_p_d_r_8h.html#a18">FAILURE</a>(Status))
01952     {
01953         <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a28">Log_Write</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a169">IPDR_LEVEL_ERROR</a>,
01954                    <span class="stringliteral">"ExporterProtocol_SendSessionStop"</span>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a72">MSG_EXPORTER_CHUNKS_MANAGER_FAILED</a>);
01955         <span class="keywordflow">return</span> Status;
01956     }
01957 
01958 
01959     SSM = (SessionStopMessage*)BH.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a>;
01960     <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a40">ExporterProtocol_FillHeader</a>(S, BH.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a>, <a class="code" href="../../d2/dda/_for_doxygen_2src_2_common_2_protocol_8h.html#a33">IPDR_MSG_SESSION_STOP</a>,
01961                                 sizeof (SessionStopMessage)  + MsgLen + 1 );
01962 
01963     <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a8">IPDR_SET_HTONS</a>(SSM-&gt;reasonCode, reasonCode);
01964     <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a9">IPDR_SET_HTONL</a>(SSM-&gt;reasonInfoLength, MsgLen);
01965     <span class="comment">/* The description comes after the ErrorMessage ... it would have</span>
01966 <span class="comment">     * been nice to have had a char Descr[0] at the end of the</span>
01967 <span class="comment">     * struct,so we could do "memset(&amp;EM-&gt;Data, ...)" but some</span>
01968 <span class="comment">     * incorrect compilers don't allow this. */</span>
01969     memset(BH.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a> + sizeof (SessionStopMessage), 0, MsgLen + 1);
01970     strncpy(BH.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a> + sizeof (SessionStopMessage), ReasonDescripsion, MsgLen);
01971 
01972     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a15">Log_ShouldWrite</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a171">IPDR_LEVEL_INFO</a>)) {
01973                 <a class="code" href="../../d5/d59/_for_doxygen_2src_2_exporter_2_protocol_debug_8c.html#a4">ProtocolDebug_PrintOutgoingMessage</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, Conn, BH.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a171">IPDR_LEVEL_INFO</a>);
01974     }
01975 
01976     Status = <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a9">TL_Send</a>(Conn, &amp; BH, <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a5">IPDR_TRUE</a>);
01977     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d8b/_for_doxygen_2include_2_i_p_d_r_2_i_p_d_r_8h.html#a18">FAILURE</a>(Status))
01978         {
01979                 <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a29">Log_Write1</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a169">IPDR_LEVEL_ERROR</a>,
01980                                         <span class="stringliteral">"ExporterProtocol_SendSessionStop"</span>,
01981                                         <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a81">MSG_EXPORTER_ERROR_SEND_FAILED</a>, <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a14">TL_GetConnectionInfoStr</a>(Conn));
01982                 <span class="keywordflow">return</span> Status;
01983         }
01984 
01985         <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a29">Log_Write1</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a172">IPDR_LEVEL_DEBUG</a>,
01986                                         <span class="stringliteral">"ExporterProtocol_SendError"</span>,
01987                                         <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a82">MSG_EXPORTER_ERROR_SEND_TARGET</a>, <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a14">TL_GetConnectionInfoStr</a>(Conn));
01988 
01989     <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a174">IPDR_OK</a>;
01990 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a30" doxytag="ExporterProtocol.h::ExporterProtocol_SendStartNegotiationReject"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_Status</a> ExporterProtocol_SendStartNegotiationReject           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../df/d71/struct_i_p_d_r__tag___exporter.html">Exporter</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>E</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d9/d35/struct_i_p_d_r__tag___session.html">Session</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>S</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../de/d0d/struct_i_p_d_r__tag___collector.html">Collector</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>Coll</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Conn</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">02719 {
02720         <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a>     Status;
02721         <a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html">BufferHandle</a>    BH;
02722         <a class="code" href="../../d1/d38/struct_i_p_d_r__tag___chunks_manager.html">ChunksManager</a>*  CMgr;
02723         <a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html">IPDRConnection</a>* IC = Conn-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o11">Owner</a>;
02724 
02725         <span class="keywordflow">if</span> (IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o1">State</a> != <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a51a23">IPDR_CONNECTION_CONNECTED</a>) {
02726         <span class="comment">/* XXX should signal error event */</span>
02727         <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a28">Log_Write</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a169">IPDR_LEVEL_ERROR</a>,
02728                   <span class="stringliteral">"ExporterProtocol_SendStartNegotiationReject"</span>,
02729                   <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a84">MSG_EXPORTER_CONNECTION_MUST_BE_SET</a>);
02730         <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a180">IPDR_ERR</a>;
02731     }
02732 
02733         <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a69">ExporterProtocol_KeepAliveOutTimerReset</a>(IC);
02734 
02735     <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a22">TL_GetSendChunksManager</a>(Conn, &amp; CMgr);
02736     Status = <a class="code" href="../../d5/d9f/_for_doxygen_2src_2_common_2_chunks_manager_8c.html#a19">ChunksManager_AllocateBuffer</a>(CMgr,
02737                                           <span class="keyword">sizeof</span>(MessageHeader),
02738                                                                                   &amp; BH);
02739     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d8b/_for_doxygen_2include_2_i_p_d_r_2_i_p_d_r_8h.html#a18">FAILURE</a>(Status))
02740         {
02741                 <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a28">Log_Write</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a169">IPDR_LEVEL_ERROR</a>,
02742                           <span class="stringliteral">"ExporterProtocol_SendStartNegotiationReject"</span>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a72">MSG_EXPORTER_CHUNKS_MANAGER_FAILED</a>);
02743                 <span class="keywordflow">return</span> Status;
02744         }
02745 
02746     <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a40">ExporterProtocol_FillHeader</a>(S, BH.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a>, <a class="code" href="../../d2/dda/_for_doxygen_2src_2_common_2_protocol_8h.html#a36">IPDR_MSG_START_NEGOTIATION_REJECT</a>,
02747                               <span class="keyword">sizeof</span>(MessageHeader));
02748 
02749     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a15">Log_ShouldWrite</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a171">IPDR_LEVEL_INFO</a>)) {
02750         <a class="code" href="../../d5/d59/_for_doxygen_2src_2_exporter_2_protocol_debug_8c.html#a4">ProtocolDebug_PrintOutgoingMessage</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, Conn, BH.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a171">IPDR_LEVEL_INFO</a>);
02751     }
02752 
02753     Status = <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a9">TL_Send</a>(Conn, &amp; BH, <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a5">IPDR_TRUE</a>);
02754         <span class="keywordflow">if</span>(<a class="code" href="../../d0/d8b/_for_doxygen_2include_2_i_p_d_r_2_i_p_d_r_8h.html#a18">FAILURE</a>(Status))
02755         {
02756                 <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a29">Log_Write1</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a171">IPDR_LEVEL_INFO</a>,
02757                                         <span class="stringliteral">"ExporterProtocol_SendStartNegotiationReject"</span>,
02758                                         <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a94">MSG_EXPORTER_SEND_KEEPALIVE_FAILED</a>, <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a14">TL_GetConnectionInfoStr</a>(Conn));
02759                 <span class="keywordflow">return</span> Status;
02760         }
02761 
02762         <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a29">Log_Write1</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a172">IPDR_LEVEL_DEBUG</a>,
02763                                         <span class="stringliteral">"ExporterProtocol_SendStartNegotiationReject"</span>,
02764                                         <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a95">MSG_EXPORTER_SEND_KEEPALIVE_TARGET</a>, <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a14">TL_GetConnectionInfoStr</a>(Conn));
02765     <span class="keywordflow">return</span> Status;
02766 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a28" doxytag="ExporterProtocol.h::ExporterProtocol_SendTemplateData"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga11">IPDR_Status</a> ExporterProtocol_SendTemplateData           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../df/d71/struct_i_p_d_r__tag___exporter.html">Exporter</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>E</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d9/d35/struct_i_p_d_r__tag___session.html">Session</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>S</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../de/d0d/struct_i_p_d_r__tag___collector.html">Collector</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>Coll</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html">Connection</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Conn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../dc/d02/ipdr_2include_2_i_p_d_r_2_defs_8h.html#a16">IPDR_BOOL</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Negotiable</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Sends a TEMPLATE DATA message to a collector.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>E</em>&nbsp;</td><td>exporter handle </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>S</em>&nbsp;</td><td>session handle (pointer) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Coll</em>&nbsp;</td><td>collector to which to send the message </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Conn</em>&nbsp;</td><td>connection between Coll and S </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Negotiable</em>&nbsp;</td><td>true if the template is negotiable</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga30a174">IPDR_OK</a> on success; <a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga30">IPDR_STATUS_RETURN_CODE</a> otherwise. </dd></dl>
<div class="fragment"><pre class="fragment">02548 {
02549         size_t                          Size;
02550     <a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html">BufferHandle</a>                BH;
02551     <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a>                 Status;
02552         <a class="code" href="../../d1/d8c/struct_i_p_d_r__tag___transmission_context.html">TransmissionContext</a>* TC = S-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o3">ActiveContext</a>;
02553     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>                NumTemplates;
02554     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>               MsgID;
02555     <a class="code" href="../../d1/d38/struct_i_p_d_r__tag___chunks_manager.html">ChunksManager</a>*              CMgr;
02556         <a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html">IPDRConnection</a>*         IC = Conn-&gt;<a class="code" href="../../d4/d37/struct_i_p_d_r__tag___t_c_p_connection.html#o11">Owner</a>;
02557         <a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html">CollectorSession</a>*       CS = NULL;
02558 
02559         Status = <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a5">ExporterProtocol_CollectorSession</a>(Coll, S, &amp;CS, NULL, <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a5">IPDR_TRUE</a>);
02560 
02561         <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a69">ExporterProtocol_KeepAliveOutTimerReset</a>(IC);
02562 
02563 
02564     <span class="keywordflow">if</span> (Conn == NULL || IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o1">State</a> == <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a51a21">IPDR_CONNECTION_DISCONNECTED</a> || IC-&gt;<a class="code" href="../../db/d4f/struct_i_p_d_r__tag___connection.html#o1">State</a> == <a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a51a22">IPDR_CONNECTION_WAITRESPONSE</a>)
02565         {
02566         <span class="comment">/* XXX should signal error event */</span>
02567         <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a29">Log_Write1</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a169">IPDR_LEVEL_ERROR</a>,
02568                            <span class="stringliteral">"ExporterProtocol_SendTmplData"</span>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a57">MSG_EXPORTER_NOT_READY_SEND2</a>,  <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a14">TL_GetConnectionInfoStr</a>(Conn));
02569         <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a205">IPDR_ERR_NO_ACTIVE_COLLECTOR</a>;
02570     }
02571 
02572         <span class="keywordflow">if</span>(CS == NULL)
02573         {
02574                 <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a30">Log_Write2</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a169">IPDR_LEVEL_ERROR</a>,
02575                            <span class="stringliteral">"ExporterProtocol_SendTmplData"</span>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a45">MSG_EXPORTER_NO_SESSIONS</a>,
02576                            <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a14">TL_GetConnectionInfoStr</a>(Conn),  <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a14">TL_GetConnectionInfoStr</a>(Conn));
02577                 <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga29a192">IPDR_ERR_UNABLE_TO_FIND_SESSION</a> ;
02578         }
02579 
02580     <span class="comment">/* calculate the size of the message */</span>
02581 
02582         CS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o7">Negotiable</a> = (S-&gt;<a class="code" href="../../d9/d35/struct_i_p_d_r__tag___session.html#o11">Negotiable</a> &amp; Negotiable &amp; Coll-&gt;<a class="code" href="../../de/d0d/struct_i_p_d_r__tag___collector.html#o7">Capabilities</a>.TemplateNegotiation);
02583 
02584     <a class="code" href="../../dd/d31/_for_doxygen_2src_2_common_2_dynamic_array_8c.html#a15">DynamicArray_CountObjects</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a1">EXPORTER_PLATFORM</a>, &amp; (TC-&gt;<a class="code" href="../../d1/d8c/struct_i_p_d_r__tag___transmission_context.html#o2">Templates</a>),
02585                               &amp; NumTemplates);
02586 
02587     Size = <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a10">ExporterProtocol_GetTemplateDataMsgLen</a>(TC);
02588 
02589     <span class="comment">/* allocate a buffer for the message */</span>
02590     <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a22">TL_GetSendChunksManager</a>(Conn, &amp; CMgr);
02591     Status = <a class="code" href="../../d5/d9f/_for_doxygen_2src_2_common_2_chunks_manager_8c.html#a19">ChunksManager_AllocateBuffer</a>(CMgr, Size, &amp; BH);
02592     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d8b/_for_doxygen_2include_2_i_p_d_r_2_i_p_d_r_8h.html#a18">FAILURE</a>(Status))
02593         {
02594                 <a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a28">Log_Write</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a169">IPDR_LEVEL_ERROR</a>,
02595                            <span class="stringliteral">"ExporterProtocol_SendTemplateData"</span>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a72">MSG_EXPORTER_CHUNKS_MANAGER_FAILED</a>);
02596         <span class="keywordflow">return</span> Status;
02597         }
02598 
02599 
02600     MsgID = <a class="code" href="../../d2/dda/_for_doxygen_2src_2_common_2_protocol_8h.html#a34">IPDR_MSG_TEMPLATE_DATA</a>;
02601     <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a40">ExporterProtocol_FillHeader</a>(S, BH.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a>, MsgID, Size);
02602 
02603         Status = <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a21">ExporterProtocol_WriteTemplateData</a>(TC, BH.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a>, CS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o7">Negotiable</a>);
02604     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d8b/_for_doxygen_2include_2_i_p_d_r_2_i_p_d_r_8h.html#a18">FAILURE</a>(Status))
02605         {
02606                 <span class="comment">/*NOTE: ExporterProtocol_WriteTemplateData always returns IPDR_OK !!! */</span>
02607                 <span class="keywordflow">return</span> Status;
02608         }
02609 
02610     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d4e/_for_doxygen_2src_2_common_2_log_8h.html#a15">Log_ShouldWrite</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a4">EXPORTER_LOG</a>, <a class="code" href="../../de/d4f/_for_doxygen_2src_2_exporter_2_exporter_msgs_8h.html#a3">PROTOCOL_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a171">IPDR_LEVEL_INFO</a>)) {
02611         <a class="code" href="../../d5/d59/_for_doxygen_2src_2_exporter_2_protocol_debug_8c.html#a4">ProtocolDebug_PrintOutgoingMessage</a>(EXPORTER_LOG, Conn, BH.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga7a171">IPDR_LEVEL_INFO</a>);
02612     }
02613 
02614     Status = <a class="code" href="../../db/d58/_for_doxygen_2src_2_common_2_transport_8h.html#a9">TL_Send</a>(Conn, &amp; BH, <a class="code" href="../../db/d2e/_for_doxygen_2include_2_i_p_d_r_2_defs_8h.html#a5">IPDR_TRUE</a>);
02615         <span class="keywordflow">if</span>(<a class="code" href="../../d0/d8b/_for_doxygen_2include_2_i_p_d_r_2_i_p_d_r_8h.html#a18">FAILURE</a>(Status))
02616         {
02617                 <span class="keywordflow">return</span> Status;
02618         }
02619 
02620         <span class="keywordflow">if</span>(CS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o8">TmplDataTimer</a> != NULL)
02621                 <a class="code" href="../../d7/d54/_for_doxygen_2src_2_common_2_platform_8h.html#a13">Platform_UnregisterTimerAndClear</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a1">EXPORTER_PLATFORM</a>, &amp;CS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o8">TmplDataTimer</a>);
02622 
02623         <a class="code" href="../../d7/d54/_for_doxygen_2src_2_common_2_platform_8h.html#a9">Platform_RegisterTimer</a>(<a class="code" href="../../d6/dfc/_for_doxygen_2src_2_exporter_2_exporter_8h.html#a1">EXPORTER_PLATFORM</a>,
02624                                                 <a class="code" href="../../dd/d0a/_for_doxygen_2src_2_exporter_2_exporter_protocol_8c.html#a32">ExporterProtocol_TmplDataTimerCallback</a>,
02625                                                         CS,
02626                             E-&gt;<a class="code" href="../../df/d71/struct_i_p_d_r__tag___exporter.html#o4">Parameters</a>.<a class="code" href="../../d1/dac/struct_exporter_parameters.html#o6">TemplateAckTimeout</a>,
02627                             &amp; (CS-&gt;<a class="code" href="../../d5/da9/struct_i_p_d_r__tag___collector_session.html#o8">TmplDataTimer</a>));
02628 
02629         <span class="keywordflow">return</span> Status;
02630 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Mon Apr 25 09:26:30 2005 for IPDRAPI by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.2 </small></address>
</body>
</html>
