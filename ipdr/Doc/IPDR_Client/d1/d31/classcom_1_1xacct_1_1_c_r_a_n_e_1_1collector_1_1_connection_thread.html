<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>IPDRAPI: com::xacct::CRANE::collector::ConnectionThread Class Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.2 -->
<div class="qindex"><a class="qindex" href="../../index.html">Main&nbsp;Page</a> | <a class="qindex" href="../../modules.html">Modules</a> | <a class="qindex" href="../../namespaces.html">Namespace List</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="../../dirs.html">Directories</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="../../globals.html">Globals</a></div>
<div class="nav">
<a class="el" href="../../d8/dee/namespacecom.html">com</a>::<a class="el" href="../../d9/d91/namespacecom_1_1xacct.html">xacct</a>::<a class="el" href="../../d4/d73/namespacecom_1_1xacct_1_1_c_r_a_n_e.html">CRANE</a>::<a class="el" href="../../de/d74/namespacecom_1_1xacct_1_1_c_r_a_n_e_1_1collector.html">collector</a>::<a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html">ConnectionThread</a></div>
<h1>com::xacct::CRANE::collector::ConnectionThread Class Reference</h1><p>Inheritance diagram for com::xacct::CRANE::collector::ConnectionThread:
<p><center><img src="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.png" usemap="#com::xacct::CRANE::collector::ConnectionThread_map" border="0" alt=""></center>
<map name="com::xacct::CRANE::collector::ConnectionThread_map">
<area href="../../d0/d33/interfacecom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_process_data_seq_no_ack.html" alt="com::xacct::CRANE::collector::ProcessDataSeqNoAck" shape="rect" coords="0,0,317,24">
<area href="../../df/d61/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_setup_thread.html" alt="com::xacct::CRANE::collector::ConnectionSetupThread" shape="rect" coords="0,112,317,136">
</map>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#a0">setDataAckMsgInterval</a> (int value)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#a1">getDataAckMsgInterval</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#a2">setNullInput</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#a3">ConnectionThread</a> (<a class="el" href="../../d1/da1/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_collector_config.html">CollectorConfig</a> <a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p1">collectorConfig</a>, <a class="el" href="../../d5/d67/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_config.html">ConnectionConfig</a> <a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p2">connectionConfig</a>, <a class="el" href="../../d9/d64/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_collector_outputter_factory.html">CollectorOutputterFactory</a> outputterFactory, <a class="el" href="../../d2/d43/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_log_handler.html">LogHandler</a> <a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p3">log</a>, int <a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r2">receiveBufferSize</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">final void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#a4">run</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#a5">setSessionTemplate</a> (<a class="el" href="../../d5/d67/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_config.html">ConnectionConfig</a> <a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p2">connectionConfig</a>, <a class="el" href="../../da/d92/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_session_config.html">SessionConfig</a> transmitterSession, <a class="el" href="../../d7/db7/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_template_config.html">TemplateConfig</a> tmplTransmitter)  throws ConfigException </td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">synchronized final void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#a6">processDataSeqNoAck</a> (long newDataSeqNoToAck)  throws ConnectionIOException, ProtocolMalformedMsgException, ConfigException </td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#a7">stopProcessing</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">synchronized void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#a8">logThreadStatus</a> (<a class="el" href="../../d2/d43/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_log_handler.html">LogHandler</a> <a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p3">log</a>)</td></tr>

<tr><td colspan="2"><br><h2>Static Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static String&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#e0">versionStr</a> ()</td></tr>

<tr><td colspan="2"><br><h2>Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#b0">prepareForRunning</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">final int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#b1">getNextRequestId</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get a new request Id and increment the existing one.  <a href="#b1"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#b2">runLoop</a> ()  throws ProtocolMalformedMsgException, DataException, ConfigException,         ConnectionIOException, OutputterException </td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">synchronized final void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#b3">closeConnection</a> ()  throws ConnectionIOException </td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">synchronized final void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#b4">runLoopConnection</a> ()  throws ConnectionIOException, ProtocolMalformedMsgException,         ConfigException, DataException </td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">final void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#b5">makeConnection</a> ()  throws ConnectionIOException, ProtocolMalformedMsgException, ConfigException </td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#b6">sendStatusReq</a> (String msg, String function, boolean warning)  throws ConnectionIOException, ProtocolMalformedMsgException, ConfigException </td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">synchronized final void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#b7">handleSingleDATA</a> (<a class="el" href="../../d7/dc1/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_protocol_msg_d_a_t_a.html">ProtocolMsgDATA</a> msgDATA)  throws ConnectionIOException, ProtocolMalformedMsgException,         ConfigException, DataException, OutputterException </td></tr>

<tr><td colspan="2"><br><h2>Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">volatile boolean&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p0">isRunning</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">A flag for stopping the thread(s) (set by the stop() method).  <a href="#p0"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d1/da1/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_collector_config.html">CollectorConfig</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p1">collectorConfig</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The collector configuration.  <a href="#p1"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d5/d67/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_config.html">ConnectionConfig</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p2">connectionConfig</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The connection from configuration.  <a href="#p2"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d2/d43/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_log_handler.html">LogHandler</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p3">log</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The log.  <a href="#p3"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d2/d4e/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_dynamic.html">ConnectionDynamic</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p4">connection</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The connection.  <a href="#p4"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../da/d92/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_session_config.html">SessionConfig</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p5">cachedLookupSession</a> = null</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p6">cachedLookupSessionId</a> = -1</td></tr>

<tr><td colspan="2"><br><h2>Package Attributes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">long&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#q0">lastDataSeqNo</a> = -1</td></tr>

<tr><td colspan="2"><br><h2>Private Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">final <a class="el" href="../../d5/d16/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_protocol_data.html">ProtocolData</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#d0">getSessionDataConverter</a> (int id)  throws ConfigException </td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">final void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#d1">setSessionBigEndian</a> (int id, boolean bigEndian)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">final <a class="el" href="../../da/d92/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_session_config.html">SessionConfig</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#d2">lookupSession</a> (int <a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r20">sessionId</a>)  throws ConfigException </td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">final <a class="el" href="../../d7/db7/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_template_config.html">TemplateConfig</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#d3">lookupTemplate</a> (int <a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r20">sessionId</a>, int templateId)  throws ConfigException </td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">final void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#d4">prepareSessionConfigForRunning</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">final void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#d5">sleepReconnect</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">final void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#d6">sendStartAndValidateTemplates</a> (<a class="el" href="../../da/d92/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_session_config.html">SessionConfig</a> sessionConfig)  throws ConnectionIOException, ProtocolMalformedMsgException,         DataException, ConfigException </td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">final void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#d7">handleTMPL_DATA</a> (<a class="el" href="../../df/d92/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_protocol_msg_t_m_p_l___d_a_t_a.html">ProtocolMsgTMPL_DATA</a> tmplResponse)  throws ConfigException, ProtocolMalformedMsgException, ConnectionIOException </td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../da/d92/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_session_config.html">SessionConfig</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#d8">getRuntimeSession</a> (<a class="el" href="../../d5/d67/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_config.html">ConnectionConfig</a> <a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p2">connectionConfig</a>, int <a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r20">sessionId</a>)  throws ConfigException, ProtocolMalformedMsgException, ConnectionIOException </td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">final void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#d9">receiveDataAndOutputIt</a> ()  throws ConnectionIOException, ProtocolMalformedMsgException,         DataException, ConfigException, OutputterException </td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">final void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#d10">handleERROR</a> (<a class="el" href="../../d9/d12/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_protocol_msg_e_r_r_o_r.html">ProtocolMsgERROR</a> msg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#d11">initSeqNoData</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">final void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#d12">outputDataRecord</a> (<a class="el" href="../../d7/dc1/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_protocol_msg_d_a_t_a.html">ProtocolMsgDATA</a> msgDATA)  throws DataException, ConfigException, OutputterException </td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">final int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#d13">validateTransmitterProtocolVersion</a> (int desiredTransportType, int desiredProtocolVersion)  throws ProtocolMalformedMsgException </td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">final byte[]&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#d14">sendAndReceiveVersionDatagrams</a> (byte[] sendData, int sendLength)  throws java.io.IOException </td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">final byte[]&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#d15">sendAndReceiveVersionDatagram</a> (int timeout, byte[] sendData, int sendLength)  throws java.io.IOException </td></tr>

<tr><td colspan="2"><br><h2>Private Attributes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../dc/ddd/interfacecom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_collector_outputter.html">CollectorOutputter</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r0">outputter</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The general outputting class.  <a href="#r0"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">Date&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r1">exporterBootTime</a> = null</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The "boot time" of the data exporter.  <a href="#r1"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r2">receiveBufferSize</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Receiver buffer size for the connection.  <a href="#r2"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">ArrayList&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r3">staticFields</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">boolean&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r4">nullInput</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">HashMap&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r5">sessionIdToDataConverter</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d5/d16/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_protocol_data.html">ProtocolData</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r6">connectionDataConverter</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r7">minSessionId</a> = Integer.MAX_VALUE</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r8">maxSessionId</a> = Integer.MIN_VALUE</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../da/d92/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_session_config.html">SessionConfig</a>[]&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r9">sessionLookup</a> = null</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../da/d92/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_session_config.html">SessionConfig</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r10">cachedLookupTemplateSession</a> = null</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r11">cachedLookupTemplateSessionId</a> = -1</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d7/db7/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_template_config.html">TemplateConfig</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r12">cachedLookupTemplate</a> = null</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r13">cachedLookupTemplateId</a> = -1</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r14">nextRequestId</a> = (new Random().nextInt()) &amp; 0x7fff</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Keep track of the next request Id.  <a href="#r14"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">Object&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r15">syncNextRequestId</a> = new Object()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">An object for synchronizing increment of request id.  <a href="#r15"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">boolean&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r16">anyDataRecordSeen</a> = false</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">long&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r17">nextAckTime</a> = 0</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">long&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r18">nextNoDataKeepAliveTime</a> = 0</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">long&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r19">lastDataSeqNoAcked</a> = -1</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">byte&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r20">sessionId</a> = -1</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">byte&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r21">configId</a> = -1</td></tr>

<tr><td colspan="2"><br><h2>Static Private Attributes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#v0">dataAckLogInterval</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">How often to output data-ack message to log.  <a href="#v0"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static long&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#v1">nextDataAckLogMsgTime</a> = System.currentTimeMillis()</td></tr>

</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
The thread that processes a single <a class="el" href="../../d4/d73/namespacecom_1_1xacct_1_1_c_r_a_n_e.html">CRANE</a> connection. <dl compact><dt><b>See also:</b></dt><dd><a class="el" href="../../d9/d21/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_collector_manager.html">CollectorManager</a></dd></dl>
<dl compact><dt><b>Version:</b></dt><dd><dl compact><dt><b>Id</b></dt><dd>ConnectionThread.java,v 1.4 2005/01/30 15:13:39 ilyad Exp </dd></dl>
</dd></dl>

<p>
<hr><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" name="a3" doxytag="com::xacct::CRANE::collector::ConnectionThread::ConnectionThread"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">com::xacct::CRANE::collector::ConnectionThread::ConnectionThread           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/da1/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_collector_config.html">CollectorConfig</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>collectorConfig</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d5/d67/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_config.html">ConnectionConfig</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>connectionConfig</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d9/d64/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_collector_outputter_factory.html">CollectorOutputterFactory</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>outputterFactory</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d2/d43/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_log_handler.html">LogHandler</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>log</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>receiveBufferSize</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [inline]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Create a connection thread. <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>collectorConfig</em>&nbsp;</td><td>The collector context. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>connectionConfig</em>&nbsp;</td><td>The connection configuration. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>outputterFactory</em>&nbsp;</td><td>The factory for creating outputter objects. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>log</em>&nbsp;</td><td>The log for messages. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>receiveBufferSize</em>&nbsp;</td><td>The input socket size (0 means default). </td></tr>
  </table>
</dl>
<div class="fragment"><pre class="fragment">00118                                                    {
00119         <span class="keyword">this</span>.collectorConfig = <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p1">collectorConfig</a>;
00120         <span class="keyword">this</span>.log   = <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p3">log</a>;
00121         <span class="keyword">this</span>.connection = null;
00122         <span class="keyword">this</span>.connectionConfig = <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p2">connectionConfig</a>;
00123         setName(<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p2">connectionConfig</a>.generateThreadName());
00124         <span class="keyword">this</span>.isRunning = <span class="keyword">false</span>;
00125         <span class="keyword">this</span>.exporterBootTime  = null; <span class="comment">// generate an error if it's used</span>
00126         <span class="keyword">this</span>.outputter = (outputterFactory == null) ? null : outputterFactory.create();
00127         <span class="keyword">this</span>.sessionIdToDataConverter = <span class="keyword">new</span> HashMap();
00128         <span class="keyword">this</span>.connectionDataConverter = null;
00129         <span class="keyword">this</span>.nullInput = <span class="keyword">false</span>;
00130         <span class="keyword">this</span>.receiveBufferSize = <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r2">receiveBufferSize</a>;
00131         <span class="keyword">this</span>.dataAckLogInterval = <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p2">connectionConfig</a>.getDataAckLogInterval();
00132         <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#b0">prepareForRunning</a>();
00133     }
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr><h2>Member Function Documentation</h2>
<a class="anchor" name="b3" doxytag="com::xacct::CRANE::collector::ConnectionThread::closeConnection"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">synchronized final void com::xacct::CRANE::collector::ConnectionThread::closeConnection           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>  throws <a class="el" href="../../df/d89/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_i_o_exception.html">ConnectionIOException</a> <code> [inline, protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00353                                  {
00354         <span class="keywordflow">if</span> (<span class="keyword">this</span>.<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p4">connection</a> != null) {
00355             <span class="keyword">this</span>.connection.close();
00356             <span class="keyword">this</span>.connection = null; <span class="comment">// in case of "out of the blue" processDataSeqNoAck</span>
00357         }
00358     }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="com::xacct::CRANE::collector::ConnectionThread::getDataAckMsgInterval"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int com::xacct::CRANE::collector::ConnectionThread::getDataAckMsgInterval           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [inline]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00031 { <span class="keywordflow">return</span> <span class="keyword">this</span>.dataAckLogInterval; }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b1" doxytag="com::xacct::CRANE::collector::ConnectionThread::getNextRequestId"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">final int com::xacct::CRANE::collector::ConnectionThread::getNextRequestId           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [inline, protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Get a new request Id and increment the existing one. 
<p>
<div class="fragment"><pre class="fragment">00295                                            {
00296         <span class="keyword">synchronized</span>(<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r15">syncNextRequestId</a>) {
00297             <span class="keywordflow">return</span> <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r14">nextRequestId</a>++;
00298         }
00299     }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="d8" doxytag="com::xacct::CRANE::collector::ConnectionThread::getRuntimeSession"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../da/d92/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_session_config.html">SessionConfig</a> com::xacct::CRANE::collector::ConnectionThread::getRuntimeSession           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d5/d67/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_config.html">ConnectionConfig</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>connectionConfig</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>sessionId</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2">  throws <a class="el" href="../../d4/d30/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_config_exception.html">ConfigException</a>, <a class="el" href="../../dc/d8b/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_protocol_malformed_msg_exception.html">ProtocolMalformedMsgException</a>, <a class="el" href="../../df/d89/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_i_o_exception.html">ConnectionIOException</a> <code> [inline, private]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Basic validation method. If the session is not found in configuration, it is an unexpected bug (a log message is outputted back in <a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html">ConnectionThread</a>). <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>connectionConfig</em>&nbsp;</td><td></td></tr>
    <tr><td valign="top"></td><td valign="top"><em>sessionId</em>&nbsp;</td><td></td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>session </dd></dl>
<dl compact><dt><b>Exceptions:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="../../d4/d30/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_config_exception.html">ConfigException</a></em>&nbsp;</td><td></td></tr>
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="../../df/d89/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_i_o_exception.html">ConnectionIOException</a></em>&nbsp;</td><td></td></tr>
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="../../dc/d8b/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_protocol_malformed_msg_exception.html">ProtocolMalformedMsgException</a></em>&nbsp;</td><td></td></tr>
  </table>
</dl>
<div class="fragment"><pre class="fragment">00517                                                                                      {
00518         <span class="keywordflow">return</span> <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p2">connectionConfig</a>.getSessionConfigById(<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r20">sessionId</a>);
00519     }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="d0" doxytag="com::xacct::CRANE::collector::ConnectionThread::getSessionDataConverter"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">final <a class="el" href="../../d5/d16/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_protocol_data.html">ProtocolData</a> com::xacct::CRANE::collector::ConnectionThread::getSessionDataConverter           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>id</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>  throws <a class="el" href="../../d4/d30/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_config_exception.html">ConfigException</a> <code> [inline, private]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00080                                                                                       {
00081         ProtocolData result = <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r6">connectionDataConverter</a>;
00082         <span class="keywordflow">if</span> (result == null) {
00083             result = (ProtocolData)<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r5">sessionIdToDataConverter</a>.get(<span class="keyword">new</span> Integer(<span class="keywordtype">id</span>));
00084             <span class="keywordflow">if</span> (result == null) {
00085                 <span class="keywordflow">throw</span> <span class="keyword">new</span> ConfigException(<span class="keyword">this</span>, <span class="stringliteral">"sessionIdToDataConverter"</span>,
00086                                           <span class="stringliteral">"unknown session id: "</span> + <span class="keywordtype">id</span>);
00087             }
00088         }
00089         <span class="keywordflow">return</span> result;
00090     }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="d10" doxytag="com::xacct::CRANE::collector::ConnectionThread::handleERROR"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">final void com::xacct::CRANE::collector::ConnectionThread::handleERROR           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d9/d12/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_protocol_msg_e_r_r_o_r.html">ProtocolMsgERROR</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>msg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [inline, private]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00851                                                          {
00852         <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p3">log</a>.error(<span class="keyword">this</span>, <span class="stringliteral">"handleERROR"</span>,
00853                   <span class="stringliteral">"Received ERROR message from transmitter (client): "</span> +
00854                   msg.toStringLong());
00855     }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b7" doxytag="com::xacct::CRANE::collector::ConnectionThread::handleSingleDATA"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">synchronized final void com::xacct::CRANE::collector::ConnectionThread::handleSingleDATA           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d7/dc1/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_protocol_msg_d_a_t_a.html">ProtocolMsgDATA</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>msgDATA</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>  throws <a class="el" href="../../df/d89/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_i_o_exception.html">ConnectionIOException</a>, <a class="el" href="../../dc/d8b/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_protocol_malformed_msg_exception.html">ProtocolMalformedMsgException</a>,         <a class="el" href="../../d4/d30/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_config_exception.html">ConfigException</a>, <a class="el" href="../../d6/d39/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_data_exception.html">DataException</a>, <a class="el" href="../../d4/d63/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_outputter_exception.html">OutputterException</a> <code> [inline, protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00802                                                            {
00803 
00804         <span class="keywordflow">try</span> {
00805             <span class="keyword">this</span>.lastDataSeqNo = msgDATA.processDataSeqNo(<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#q0">lastDataSeqNo</a>, <span class="keyword">this</span>.<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r16">anyDataRecordSeen</a>);
00806         } <span class="keywordflow">catch</span> (DataException e) {
00807             <span class="comment">// try to force things out as much as possible before quitting</span>
00808             <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p3">log</a>.info(<span class="keyword">this</span>, <span class="stringliteral">"receiveDataAndOutputIt"</span>,
00809                      <span class="stringliteral">"Got exception, will try to DATA ACK before restarting. Exception: "</span> + e);
00810             <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p3">log</a>.debug(<span class="keyword">this</span>, <span class="stringliteral">"receiveDataAndOutputIt"</span>,
00811                       <span class="stringliteral">"anyDataRecordSeen="</span> + <span class="keyword">this</span>.<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r16">anyDataRecordSeen</a> +
00812                       <span class="stringliteral">", isRunning="</span> + <span class="keyword">this</span>.<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p0">isRunning</a> +
00813                       <span class="stringliteral">", lastDataSeqNoAcked="</span> + <span class="keyword">this</span>.<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r19">lastDataSeqNoAcked</a> +
00814                       (<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r0">outputter</a>.isValidLastSeqNoToAck() ?
00815                        <span class="stringliteral">", outputter.seqNoToAck="</span> + <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r0">outputter</a>.getLastSeqNoToAck() :
00816                        <span class="stringliteral">", outputter.notValidSeqNoToAck"</span>) +
00817                       <span class="stringliteral">", connection="</span> + <span class="keyword">this</span>.connection);
00818             <span class="keyword">this</span>.nextDataAckLogMsgTime = System.currentTimeMillis();
00819             <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r0">outputter</a>.commitTimerExpired();
00820             <span class="keywordflow">if</span> (<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r0">outputter</a>.isValidLastSeqNoToAck()) {
00821                 <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#a6">processDataSeqNoAck</a>(<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r0">outputter</a>.getLastSeqNoToAck());
00822             }
00823             <span class="comment">// and give up</span>
00824             <span class="keywordflow">try</span> {
00825                 <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p3">log</a>.info(<span class="keyword">this</span>, <span class="stringliteral">"receiveDataAndOutputIt"</span>, <span class="stringliteral">"sleeping before closing connection"</span>);
00826                 <span class="comment">// SoLinger in ConnectionDynamic doesn't seem to work properly.</span>
00827                 sleep(<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p1">collectorConfig</a>.getAckInterval()); <span class="comment">// XXX should be a separate parameter</span>
00828             } <span class="keywordflow">catch</span> (InterruptedException e2) { }
00829             <span class="keywordflow">throw</span> e;
00830         }
00831 
00832         <span class="comment">// XXX Must confirm that seq # is on a</span>
00833         <span class="comment">// connection basis, not a session basis.</span>
00834 
00835         <span class="keywordflow">if</span> (<span class="keyword">this</span>.<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r16">anyDataRecordSeen</a>) {
00836             <span class="keywordflow">if</span> (<span class="keyword">this</span>.<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r20">sessionId</a> != (byte)msgDATA.sessionId ||
00837                 <span class="keyword">this</span>.configId != (byte)msgDATA.configId) {
00838                 <span class="keywordflow">throw</span> <span class="keyword">new</span> DataException(<span class="keyword">this</span>, <span class="stringliteral">"receiveDataAndOutputIt"</span>,
00839                                         <span class="stringliteral">"Unknown sessionId="</span> + msgDATA.sessionId +
00840                                         <span class="stringliteral">" configId="</span> + msgDATA.configId +
00841                                         <span class="stringliteral">" (expecting sessionId="</span> + <span class="keyword">this</span>.sessionId +
00842                                         <span class="stringliteral">" configId="</span> + <span class="keyword">this</span>.configId + <span class="stringliteral">")"</span>);
00843             }
00844         }
00845         <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#d12">outputDataRecord</a>(msgDATA);
00846         <span class="keyword">this</span>.sessionId = (byte)msgDATA.sessionId;
00847         <span class="keyword">this</span>.configId  = (byte)msgDATA.configId;
00848         <span class="keyword">this</span>.anyDataRecordSeen = <span class="keyword">true</span>;
00849     }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="d7" doxytag="com::xacct::CRANE::collector::ConnectionThread::handleTMPL_DATA"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">final void com::xacct::CRANE::collector::ConnectionThread::handleTMPL_DATA           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../df/d92/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_protocol_msg_t_m_p_l___d_a_t_a.html">ProtocolMsgTMPL_DATA</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>tmplResponse</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>  throws <a class="el" href="../../d4/d30/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_config_exception.html">ConfigException</a>, <a class="el" href="../../dc/d8b/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_protocol_malformed_msg_exception.html">ProtocolMalformedMsgException</a>, <a class="el" href="../../df/d89/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_i_o_exception.html">ConnectionIOException</a> <code> [inline, private]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00470                                                                                      {
00471 
00472         <span class="comment">//verifying that the requested session was retrieved</span>
00473         SessionConfig sessionConfig = <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#d8">getRuntimeSession</a>(<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p2">connectionConfig</a>, tmplResponse.sessionId);
00474         <span class="keywordflow">if</span>(sessionConfig == null) { <span class="comment">//this shouldn't happen</span>
00475             <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p3">log</a>.error(<span class="keyword">this</span>, <span class="stringliteral">"handleTMPL_DATA"</span>,
00476                       <span class="stringliteral">"configuration error, the retrieved session does not match the requested session"</span>);
00477             <span class="keywordflow">return</span>;
00478         }
00479         <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#d1">setSessionBigEndian</a>(sessionConfig.getId(), tmplResponse.bigEndian);
00480 
00481         <span class="comment">// setting the session's runtime templates</span>
00482         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; tmplResponse.templateBlock.getTemplateConfigListLength(); i++) {
00483             TemplateConfig tmplTransmitter = tmplResponse.templateBlock.getTemplateConfigAt(i);
00484             <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#a5">setSessionTemplate</a>(<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p2">connectionConfig</a>,sessionConfig,tmplTransmitter);
00485         }
00486 
00487         <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#b0">prepareForRunning</a>(); <span class="comment">// XXX needed because a template might have changed</span>
00488 
00489         <span class="comment">// XXX Need to store "enabledForInput" (but see comments in outputDataRecord)</span>
00490 
00491         <span class="comment">// XXX need to do this properly ...</span>
00492 <span class="comment">//      if (! tmpl.transmitsTheSameAs(tmplTransmitter)) {</span>
00493 <span class="comment">//           // XXX We should enter template negotiation at this point</span>
00494 <span class="comment">//           //     but for now, treat as an error</span>
00495 <span class="comment">//           throw new ConfigException(this, "sendStartAndValidateTemplates",</span>
00496 <span class="comment">//                                     "Mis-match of transmission form between transmitter (client) template: " +</span>
00497 <span class="comment">//                                     tmplTransmitter.toStringLong() + " and configuration template: " +</span>
00498 <span class="comment">//                                     tmpl.toStringLong());</span>
00499 <span class="comment">//      }</span>
00500 
00501         ProtocolMsgFINAL_TMPL_DATA_ACK msgFINAL_TMPL_DATA_ACK =
00502             <span class="keyword">new</span> ProtocolMsgFINAL_TMPL_DATA_ACK((byte)sessionConfig.getId(),
00503                                                tmplResponse.configId);
00504         msgFINAL_TMPL_DATA_ACK.sendMsg(<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p4">connection</a>);
00505     }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="d11" doxytag="com::xacct::CRANE::collector::ConnectionThread::initSeqNoData"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void com::xacct::CRANE::collector::ConnectionThread::initSeqNoData           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [inline, private]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00875                                  {
00876         <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r16">anyDataRecordSeen</a> = <span class="keyword">false</span>;
00877         <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#q0">lastDataSeqNo</a> = -1;
00878         <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r19">lastDataSeqNoAcked</a> = -1;
00879         <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r20">sessionId</a> = -1;
00880         <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r21">configId</a> = -1;
00881         <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r17">nextAckTime</a> = System.currentTimeMillis() + <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p1">collectorConfig</a>.getAckInterval();
00882         <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r18">nextNoDataKeepAliveTime</a> = System.currentTimeMillis() + <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p1">collectorConfig</a>.getNoDataKeepAliveInterval();
00883     }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="com::xacct::CRANE::collector::ConnectionThread::logThreadStatus"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">synchronized void com::xacct::CRANE::collector::ConnectionThread::logThreadStatus           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d2/d43/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_log_handler.html">LogHandler</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>log</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [inline]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Display the thread's status to the log. <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>log</em>&nbsp;</td><td></td></tr>
  </table>
</dl>

<p>
Reimplemented in <a class="el" href="../../df/d61/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_setup_thread.html#a5">com::xacct::CRANE::collector::ConnectionSetupThread</a>.<div class="fragment"><pre class="fragment">01186                                                              {
01187         <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p3">log</a>.info(<span class="keyword">this</span>, <span class="stringliteral">"logThreadStatus"</span>,
01188                  <span class="stringliteral">"Connection thread "</span> + <span class="keyword">this</span>.toString() +
01189                  <span class="stringliteral">" "</span> +
01190                  ((<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p4">connection</a> == null) ? <span class="stringliteral">"no connection"</span> : <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p4">connection</a>.toString()) +
01191                  <span class="stringliteral">" anyData="</span> + <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r16">anyDataRecordSeen</a> +
01192                  <span class="stringliteral">" lastDSNacked="</span> + <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r19">lastDataSeqNoAcked</a> +
01193                  <span class="stringliteral">" lastDSN="</span> + <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#q0">lastDataSeqNo</a> +
01194                  <span class="stringliteral">" next ACK in "</span> + (<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r17">nextAckTime</a> - System.currentTimeMillis())/1000.0 + <span class="stringliteral">" sec"</span>);
01195     }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="d2" doxytag="com::xacct::CRANE::collector::ConnectionThread::lookupSession"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">final <a class="el" href="../../da/d92/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_session_config.html">SessionConfig</a> com::xacct::CRANE::collector::ConnectionThread::lookupSession           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>sessionId</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>  throws <a class="el" href="../../d4/d30/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_config_exception.html">ConfigException</a> <code> [inline, private]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Look up a session. <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>sessionId</em>&nbsp;</td><td></td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>session configuration corresponding to the session id </dd></dl>
<dl compact><dt><b>Exceptions:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="../../d4/d30/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_config_exception.html">ConfigException</a></em>&nbsp;</td><td>If invalid session id </td></tr>
  </table>
</dl>
<div class="fragment"><pre class="fragment">00163                                {
00164         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r20">sessionId</a> != <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p6">cachedLookupSessionId</a> || <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p5">cachedLookupSession</a> == null) {
00165             <span class="keywordflow">try</span> {
00166                 <span class="comment">// cachedLookupSession = connectionConfig.getSessionConfigById(sessionId);</span>
00167                 <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p5">cachedLookupSession</a> = <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r9">sessionLookup</a>[<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r20">sessionId</a> - <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r7">minSessionId</a>];
00168                 <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p6">cachedLookupSessionId</a> = <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r20">sessionId</a>;
00169             } <span class="keywordflow">catch</span> (IndexOutOfBoundsException e) {
00170                 <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p5">cachedLookupSession</a> = null;
00171             }
00172         }
00173         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p5">cachedLookupSession</a> == null) {
00174             <span class="keywordflow">throw</span> <span class="keyword">new</span> ConfigException(<span class="keyword">this</span>, <span class="stringliteral">"lookupSession"</span>,
00175                                       <span class="stringliteral">"Unknown session: id="</span> + <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r20">sessionId</a> + <span class="stringliteral">" in range "</span> +
00176                                       <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r7">minSessionId</a> + <span class="stringliteral">"..."</span> + <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r8">maxSessionId</a> + <span class="stringliteral">" in "</span> +
00177                                       <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p2">connectionConfig</a> +
00178                                       <span class="stringliteral">" ... looked in "</span> + CollectorUtil.toStringLong(<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p2">connectionConfig</a>.getSessionConfigList()));
00179         }
00180         <span class="keywordflow">return</span> <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p5">cachedLookupSession</a>;
00181     }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="d3" doxytag="com::xacct::CRANE::collector::ConnectionThread::lookupTemplate"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">final <a class="el" href="../../d7/db7/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_template_config.html">TemplateConfig</a> com::xacct::CRANE::collector::ConnectionThread::lookupTemplate           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>sessionId</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>templateId</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2">  throws <a class="el" href="../../d4/d30/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_config_exception.html">ConfigException</a> <code> [inline, private]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Look up a template within a session XXX This code is inefficient if there are more than one template; the templates need to be in a vector for fast lookup. <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>sessionId</em>&nbsp;</td><td></td></tr>
    <tr><td valign="top"></td><td valign="top"><em>templateId</em>&nbsp;</td><td></td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>template configuration corresponding to the session id, template id </dd></dl>
<dl compact><dt><b>Exceptions:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="../../d4/d30/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_config_exception.html">ConfigException</a></em>&nbsp;</td><td>If invalid session id </td></tr>
  </table>
</dl>
<div class="fragment"><pre class="fragment">00200                                {
00201         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r20">sessionId</a> != <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r11">cachedLookupTemplateSessionId</a> || <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r10">cachedLookupTemplateSession</a> == null) {
00202             <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r10">cachedLookupTemplateSession</a> = <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#d2">lookupSession</a>(<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r20">sessionId</a>);
00203             <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r11">cachedLookupTemplateSessionId</a> = <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r20">sessionId</a>;
00204             <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r12">cachedLookupTemplate</a> = null; <span class="comment">// force lookup in next step</span>
00205             <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r13">cachedLookupTemplateId</a> = -1;
00206         }
00207         <span class="keywordflow">if</span> (templateId != <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r13">cachedLookupTemplateId</a> || <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r12">cachedLookupTemplate</a> == null) {
00208             <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r12">cachedLookupTemplate</a> = <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r10">cachedLookupTemplateSession</a>.getTemplateConfigById(templateId);
00209             <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r13">cachedLookupTemplateId</a> = templateId;
00210         }
00211         <span class="keywordflow">return</span> <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r12">cachedLookupTemplate</a>;
00212     }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b5" doxytag="com::xacct::CRANE::collector::ConnectionThread::makeConnection"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">final void com::xacct::CRANE::collector::ConnectionThread::makeConnection           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>  throws <a class="el" href="../../df/d89/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_i_o_exception.html">ConnectionIOException</a>, <a class="el" href="../../dc/d8b/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_protocol_malformed_msg_exception.html">ProtocolMalformedMsgException</a>, <a class="el" href="../../d4/d30/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_config_exception.html">ConfigException</a> <code> [inline, protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00392                                                                                      {
00393 
00394         <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p2">connectionConfig</a>.setTransmitterPort(
00395             <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#d13">validateTransmitterProtocolVersion</a>(ProtocolMsgInfoRequest.INFO_TRANSPORT_TCP,
00396                                                ProtocolMsg.PROTOCOL_VERSION));
00397 
00398         <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p3">log</a>.debug(<span class="keyword">this</span>, <span class="stringliteral">"setTransmittedPort"</span>,
00399                   <span class="stringliteral">"Transmitter (client) port="</span> + <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p2">connectionConfig</a>.getTransmitterPort());
00400 
00401         <span class="keyword">this</span>.connection =
00402             <span class="keyword">new</span> ConnectionDynamic(<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p1">collectorConfig</a>, <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p2">connectionConfig</a>, <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p3">log</a>, <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r2">receiveBufferSize</a>);
00403 
00404         ProtocolMsgCONNECT msg =
00405             <span class="keyword">new</span> ProtocolMsgCONNECT((byte)0,
00406                                    <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p1">collectorConfig</a>.getCollectorAddress().get(),
00407                                    <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p1">collectorConfig</a>.getCollectorConnectPortId());
00408         msg.sendMsg(<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p4">connection</a>);
00409 
00410         <span class="comment">// There is no response in the CRANE protocol to a CONNECT</span>
00411         <span class="comment">// ... it's just used to inform the transmitter that we're here</span>
00412         <span class="comment">// ... next thing is ask for the templates or do a START.</span>
00413     }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="d12" doxytag="com::xacct::CRANE::collector::ConnectionThread::outputDataRecord"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">final void com::xacct::CRANE::collector::ConnectionThread::outputDataRecord           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d7/dc1/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_protocol_msg_d_a_t_a.html">ProtocolMsgDATA</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>msgDATA</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>  throws <a class="el" href="../../d6/d39/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_data_exception.html">DataException</a>, <a class="el" href="../../d4/d30/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_config_exception.html">ConfigException</a>, <a class="el" href="../../d4/d63/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_outputter_exception.html">OutputterException</a> <code> [inline, private]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Output a single data record. <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>msgDATA</em>&nbsp;</td><td>The message with the data. </td></tr>
  </table>
</dl>
<dl compact><dt><b>Exceptions:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="../../d4/d30/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_config_exception.html">ConfigException</a></em>&nbsp;</td><td>If there's something wrong with the configuration (e.g., the message specifies a template that isn't in the configuration). </td></tr>
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="../../d6/d39/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_data_exception.html">DataException</a></em>&nbsp;</td><td>If there's something wrong with the data. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="../../d4/d63/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_outputter_exception.html">OutputterException</a></em>&nbsp;</td><td>Generalized exception from outputting. </td></tr>
  </table>
</dl>
<div class="fragment"><pre class="fragment">00936                                                                   {
00937 
00938         <span class="comment">// XXX Note that lookupTemplate gets a modified template (from</span>
00939         <span class="comment">// TMPL_DATA) that has the fields in the expected order, and</span>
00940         <span class="comment">// that can handle unexpected fields. It also doesn't have any</span>
00941         <span class="comment">// fields that have been disabled.</span>
00942 
00943         SessionConfig sessionConfig = <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#d2">lookupSession</a>(msgDATA.sessionId);
00944         TemplateConfig templateConfig = <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#d3">lookupTemplate</a>(msgDATA.sessionId, msgDATA.templateId);
00945         ProtocolData converter = <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#d0">getSessionDataConverter</a>(msgDATA.sessionId);
00946 
00947         <span class="comment">// XXX The following test should be done outside the loop,</span>
00948         <span class="comment">// along with a few other tests here.</span>
00949 
00950         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r0">outputter</a> instanceof CollectorFastOutputter) {
00951             <span class="keywordtype">boolean</span> isBigEndian;
00952             <span class="keywordflow">if</span> (converter instanceof ProtocolDataBigEndian) {
00953                 isBigEndian = <span class="keyword">true</span>;
00954             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (converter instanceof ProtocolDataLittleEndian) {
00955                 isBigEndian = <span class="keyword">false</span>;
00956             } <span class="keywordflow">else</span> {
00957                 <span class="keywordflow">throw</span> <span class="keyword">new</span> LogicException(<span class="keyword">this</span>, <span class="stringliteral">"outputDataReocrd"</span>,
00958                                          <span class="stringliteral">"converter neither big nor little endian: "</span> +
00959                                          converter.getClass().getName());
00960             }
00961             ((CollectorFastOutputter)<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r0">outputter</a>).
00962                 <a class="code" href="../../d9/d46/_for_doxygen_2src_2_simulators_2_i_p_d_rsimple_2_i_p_d_rsimple_8c.html#a6">outputRecord</a>(<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p2">connectionConfig</a>.getTransmitterAddress(),
00963                              <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p2">connectionConfig</a>.getTransmitterPort(),
00964                              <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p2">connectionConfig</a>.getTransmitterVendorString(),
00965                              <span class="keyword">this</span>.exporterBootTime,
00966                              msgDATA,
00967                              isBigEndian,
00968                              sessionConfig,
00969                              templateConfig);
00970             <span class="keywordflow">return</span>;
00971         }
00972 
00973 
00974         <span class="comment">// XXX The following doesn't take into account configId and configuration changes</span>
00975 
00976         <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r0">outputter</a>.startRecord(<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p2">connectionConfig</a>.getTransmitterAddress(),
00977                               <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p2">connectionConfig</a>.getTransmitterPort(),
00978                               <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p2">connectionConfig</a>.getTransmitterVendorString(),
00979                               <span class="keyword">this</span>.exporterBootTime,
00980                               msgDATA.dataSeqNo,
00981                               msgDATA.sessionId,
00982                               msgDATA.templateId);
00983 
00984 <span class="comment">//        if(((RecordOutputter)outputter).isStreamPaused())</span>
00985 <span class="comment">//        {</span>
00986 <span class="comment">//          // paying for not having an ISM context on this object... the</span>
00987 <span class="comment">//          // RecordOutputter handles the paused/resumed flag for me</span>
00988 <span class="comment">//          return;</span>
00989 <span class="comment">//        }</span>
00990 
00991         <span class="keywordtype">int</span> fieldIdListLength = templateConfig.getFieldListLength();
00992         <span class="keywordtype">int</span> offset = msgDATA.rawDataOffset;
00993 
00994         <span class="comment">// In the following, this.nullInput is for performance testing.</span>
00995         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; ! <span class="keyword">this</span>.<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r4">nullInput</a> &amp;&amp; i &lt; fieldIdListLength; i++) {
00996             <span class="comment">// XXX setSessionTemplate has already swapped in updated templates</span>
00997             FieldConfig field = templateConfig.getFieldAt(i);
00998             <span class="keywordtype">boolean</span> isEnabledForOutput = field.isEnabledForOutput();
00999             FieldDescriptor fd = field.getFieldDesc();
01000 
01001             <span class="keywordflow">if</span> (<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p3">log</a>.debug()) {
01002                 <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p3">log</a>.debug(<span class="keyword">this</span>, <span class="stringliteral">"outputDataRecord"</span>,
01003                           <span class="stringliteral">"field #"</span> + i + <span class="stringliteral">" offset="</span> + offset +
01004                           <span class="stringliteral">": "</span> + fd);
01005             }
01006 
01007             <span class="keywordflow">switch</span> (field.getTypeId()) {
01008             <span class="keywordflow">case</span> ProtocolMsgKeyBlock.TYPE_BOOLEAN:
01009                 <span class="keywordflow">if</span> (isEnabledForOutput &amp;&amp; fd != null) {
01010                     <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r0">outputter</a>.outputBoolean(i, field, fd, converter.getByte(msgDATA.rawData, offset));
01011                 }
01012                 offset += ProtocolData.byteSize;
01013                 <span class="keywordflow">break</span>;
01014             <span class="keywordflow">case</span> ProtocolMsgKeyBlock.TYPE_UINT_8:
01015                 <span class="keywordflow">if</span> (isEnabledForOutput &amp;&amp; fd != null) {
01016                     <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r0">outputter</a>.outputUnsignedInt8(i, field, fd, converter.getUnsignedByte(msgDATA.rawData, offset));
01017                 }
01018                 offset += ProtocolData.unsignedByteSize;
01019                 <span class="keywordflow">break</span>;
01020             <span class="keywordflow">case</span> ProtocolMsgKeyBlock.TYPE_INT_8:
01021                 <span class="keywordflow">if</span> (isEnabledForOutput &amp;&amp; fd != null) {
01022                     <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r0">outputter</a>.outputInt8(i, field, fd, converter.getByte(msgDATA.rawData, offset));
01023                 }
01024                 offset += ProtocolData.byteSize;
01025                 <span class="keywordflow">break</span>;
01026             <span class="keywordflow">case</span> ProtocolMsgKeyBlock.TYPE_UINT_16:
01027                 <span class="keywordflow">if</span> (isEnabledForOutput &amp;&amp; fd != null) {
01028                     <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r0">outputter</a>.outputUnsignedInt16(i, field, fd, converter.getUnsignedShort(msgDATA.rawData, offset));
01029                 }
01030                 offset += ProtocolData.unsignedShortSize;
01031                 <span class="keywordflow">break</span>;
01032             <span class="keywordflow">case</span> ProtocolMsgKeyBlock.TYPE_INT_16:
01033                 <span class="keywordflow">if</span> (isEnabledForOutput &amp;&amp; fd != null) {
01034                     <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r0">outputter</a>.outputInt16(i, field, fd, converter.getShort(msgDATA.rawData, offset));
01035                 }
01036                 offset += ProtocolData.shortSize;
01037                 <span class="keywordflow">break</span>;
01038             <span class="keywordflow">case</span> ProtocolMsgKeyBlock.TYPE_UINT_32:
01039                 <span class="keywordflow">if</span> (isEnabledForOutput &amp;&amp; fd != null) {
01040                     <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r0">outputter</a>.outputUnsignedInt32(i, field, fd, converter.getUnsignedInt(msgDATA.rawData, offset));
01041                 }
01042                 offset += ProtocolData.unsignedIntSize;
01043                 <span class="keywordflow">break</span>;
01044             <span class="keywordflow">case</span> ProtocolMsgKeyBlock.TYPE_INT_32:
01045                 <span class="keywordflow">if</span> (isEnabledForOutput &amp;&amp; fd != null) {
01046                     <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r0">outputter</a>.outputInt32(i, field, fd, converter.getInt(msgDATA.rawData, offset));
01047                 }
01048                 offset += ProtocolData.intSize;
01049                 <span class="keywordflow">break</span>;
01050             <span class="keywordflow">case</span> ProtocolMsgKeyBlock.TYPE_UINT_64:
01051                 <span class="comment">// XXX Unsigned long doesn't exist in Java</span>
01052                 <span class="keywordflow">if</span> (isEnabledForOutput &amp;&amp; fd != null) {
01053                     <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r0">outputter</a>.outputUnsignedInt64(i, field, fd, converter.getLong(msgDATA.rawData, offset));
01054                 }
01055                 offset += ProtocolData.longSize;
01056                 <span class="keywordflow">break</span>;
01057             <span class="keywordflow">case</span> ProtocolMsgKeyBlock.TYPE_INT_64:
01058                 <span class="keywordflow">if</span> (isEnabledForOutput &amp;&amp; fd != null) {
01059                     <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r0">outputter</a>.outputInt64(i, field, fd, converter.getLong(msgDATA.rawData, offset));
01060                 }
01061                 offset += ProtocolData.longSize;
01062                 <span class="keywordflow">break</span>;
01063             <span class="keywordflow">case</span> ProtocolMsgKeyBlock.TYPE_STRING: {
01064                 <span class="keywordtype">int</span> len = converter.getInt(msgDATA.rawData, offset);
01065                 offset += ProtocolData.intSize;
01066                 <span class="keywordflow">if</span> (isEnabledForOutput &amp;&amp; fd != null) {
01067                     <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r0">outputter</a>.outputString(i, field, fd, converter.getStringWithLen(msgDATA.rawData, len, offset));
01068                 }
01069                 offset += len;
01070             }
01071                 <span class="keywordflow">break</span>;
01072             <span class="keywordflow">case</span> ProtocolMsgKeyBlock.TYPE_NT_STRING: {
01073                 <span class="keywordtype">int</span> strEnd = offset;
01074                 <span class="keywordflow">while</span> (msgDATA.rawData[strEnd++] != 0) { }
01075                 <span class="keywordtype">int</span> len = strEnd - offset - 1;
01076                 <span class="keywordflow">if</span> (isEnabledForOutput &amp;&amp; fd != null) {
01077                     <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r0">outputter</a>.outputString(i, field, fd, msgDATA.rawData, offset, len);
01078                 }
01079                 offset = strEnd;
01080             }
01081                 <span class="keywordflow">break</span>;
01082             <span class="keywordflow">case</span> ProtocolMsgKeyBlock.TYPE_IPV4_ADDR:
01083                 <span class="keywordflow">if</span> (isEnabledForOutput &amp;&amp; fd != null) {
01084                     <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r0">outputter</a>.outputIPv4Addr(i, field, fd, (<span class="keywordtype">int</span>)converter.getUnsignedInt(msgDATA.rawData, offset));
01085                 }
01086                 offset += ProtocolData.unsignedIntSize;
01087                 <span class="keywordflow">break</span>;
01088             <span class="keywordflow">case</span> ProtocolMsgKeyBlock.TYPE_TIME_SEC:
01089                 <span class="comment">// XXX Check this conversion (should use date methods in ProtocolData?)</span>
01090                 <span class="keywordflow">if</span> (isEnabledForOutput &amp;&amp; fd != null) {
01091                     <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r0">outputter</a>.outputTimeSec(i, field, fd, converter.getUnsignedInt(msgDATA.rawData, offset));
01092                 }
01093                 offset += ProtocolData.unsignedIntSize;
01094                 <span class="keywordflow">break</span>;
01095             <span class="keywordflow">case</span> ProtocolMsgKeyBlock.TYPE_TIME_MSEC:
01096                 <span class="comment">// XXX Unsigned long doesn't exist in Java</span>
01097                 <span class="comment">// XXX Check this conversion (should use date methods in ProtocolData?)</span>
01098                 <span class="keywordflow">if</span> (isEnabledForOutput &amp;&amp; fd != null) {
01099                     <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r0">outputter</a>.outputTimeMillisec(i, field, fd, converter.getLong(msgDATA.rawData, offset));
01100                 }
01101                 offset += ProtocolData.longSize;
01102                 <span class="keywordflow">break</span>;
01103             <span class="keywordflow">case</span> ProtocolMsgKeyBlock.TYPE_TIME_USEC:
01104                 <span class="comment">// XXX Unsigned long doesn't exist in Java</span>
01105                 <span class="comment">// XXX Check this conversion (should use date methods in ProtocolData?)</span>
01106                 <span class="keywordflow">if</span> (isEnabledForOutput &amp;&amp; fd != null) {
01107                     <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r0">outputter</a>.outputTimeMicrosec(i, field, fd, converter.getLong(msgDATA.rawData, offset));
01108                 }
01109                 offset += ProtocolData.longSize;
01110                 <span class="keywordflow">break</span>;
01111             <span class="keywordflow">case</span> ProtocolMsgKeyBlock.TYPE_TIME_MSEC_32: {
01112                 <span class="comment">// XXX Unsigned long doesn't exist in Java</span>
01113                 <span class="keywordtype">long</span> value = ((long)converter.getUnsignedInt(msgDATA.rawData, offset)) * 1000 +
01114                     converter.getUnsignedInt(msgDATA.rawData, offset + ProtocolData.unsignedIntSize);
01115                 <span class="keywordflow">if</span> (isEnabledForOutput &amp;&amp; fd != null) {
01116                     <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r0">outputter</a>.outputTimeMillisec(i, field, fd, converter.getLong(msgDATA.rawData, offset));
01117                 }
01118                 offset += (ProtocolData.unsignedIntSize + ProtocolData.unsignedIntSize);
01119             }
01120                 <span class="keywordflow">break</span>;
01121             <span class="keywordflow">case</span> ProtocolMsgKeyBlock.TYPE_TIME_USEC_32: {
01122                 <span class="comment">// XXX Unsigned long doesn't exist in Java</span>
01123                 <span class="keywordtype">long</span> value = ((long)converter.getUnsignedInt(msgDATA.rawData, offset)) * 1000000 +
01124                     converter.getUnsignedInt(msgDATA.rawData, offset + ProtocolData.unsignedIntSize);
01125                 <span class="keywordflow">if</span> (isEnabledForOutput &amp;&amp; fd != null) {
01126                     <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r0">outputter</a>.outputTimeMicrosec(i, field, fd, converter.getLong(msgDATA.rawData, offset));
01127                 }
01128                 offset += (ProtocolData.unsignedIntSize + ProtocolData.unsignedIntSize);
01129             }
01130                 <span class="keywordflow">break</span>;
01131             <span class="keywordflow">case</span> ProtocolMsgKeyBlock.TYPE_FLOAT: {
01132                 <span class="keywordtype">int</span> asBits = converter.getInt(msgDATA.rawData, offset);
01133                 <span class="keywordtype">float</span> value = Float.intBitsToFloat(asBits);
01134                 <span class="keywordflow">if</span> (isEnabledForOutput &amp;&amp; fd != null) {
01135                     <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r0">outputter</a>.outputFloat(i, field, fd, value);
01136                 }
01137                 offset += ProtocolData.intSize;
01138             }
01139                 <span class="keywordflow">break</span>;
01140             <span class="keywordflow">case</span> ProtocolMsgKeyBlock.TYPE_DOUBLE: {
01141                 <span class="keywordtype">long</span> asBits = converter.getLong(msgDATA.rawData, offset);
01142                 <span class="keywordtype">double</span> value = Double.longBitsToDouble(asBits);
01143                 <span class="keywordflow">if</span> (isEnabledForOutput &amp;&amp; fd != null) {
01144                     <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r0">outputter</a>.outputDouble(i, field, fd, value);
01145                 }
01146                 offset += ProtocolData.longSize;
01147             }
01148               <span class="keywordflow">break</span>;
01149 <span class="comment">//              case ProtocolMsgKeyBlock.TYPE_UTF8:</span>
01150 <span class="comment">//                  break;</span>
01151 <span class="comment">//              case ProtocolMsgKeyBlock.TYPE_UTF16:</span>
01152 <span class="comment">//                  break;</span>
01153 <span class="comment">//              case ProtocolMsgKeyBlock.TYPE_BLOB:</span>
01154 <span class="comment">//                  break;</span>
01155 <span class="comment">//              case ProtocolMsgKeyBlock.TYPE_IPV6_ADDR:</span>
01156 <span class="comment">//                  break;</span>
01157 <span class="comment">//              case ProtocolMsgKeyBlock.TYPE_TIME_MSEC_32:</span>
01158 <span class="comment">//                  break;</span>
01159 <span class="comment">//              case ProtocolMsgKeyBlock.TYPE_TIME_USSEC_32:</span>
01160 <span class="comment">//                  break;</span>
01161             <span class="keywordflow">default</span>:
01162                 <span class="keywordflow">throw</span> <span class="keyword">new</span> DataException(<span class="keyword">this</span>, <span class="stringliteral">"outputDataRecord"</span>,
01163                                         <span class="stringliteral">"Unknown type: "</span> + field.getTypeId());
01164             }
01165         }
01166         <span class="keywordflow">if</span>(fieldIdListLength &gt; 0) { <span class="comment">// to avoid sending data on a template with no fields...</span>
01167                                     <span class="comment">// (which is an 'unexpected' template)</span>
01168            <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r0">outputter</a>.endRecord();
01169         }
01170     }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b0" doxytag="com::xacct::CRANE::collector::ConnectionThread::prepareForRunning"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void com::xacct::CRANE::collector::ConnectionThread::prepareForRunning           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [inline, protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Process the configuration for more efficient access. This method <em>must</em> be called whenever any part of the configuration is changed.<p>
XXX To be defined: how to handle a change as a result of template negotiation. XXX Note that we swap in new templates that we get from TMPL_DATA. 
<p>
Reimplemented in <a class="el" href="../../df/d61/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_setup_thread.html#b0">com::xacct::CRANE::collector::ConnectionSetupThread</a>.<div class="fragment"><pre class="fragment">00144                                        {
00145         <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#d4">prepareSessionConfigForRunning</a>();
00146         <span class="comment">// XXX Neeed to fix stuff for lookupTemplate() to be more</span>
00147         <span class="comment">// efficient.</span>
00148     }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="d4" doxytag="com::xacct::CRANE::collector::ConnectionThread::prepareSessionConfigForRunning"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">final void com::xacct::CRANE::collector::ConnectionThread::prepareSessionConfigForRunning           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [inline, private]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00220                                                         {
00221         <span class="keywordflow">for</span> (Iterator it = <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p2">connectionConfig</a>.getSessionConfigList().iterator(); it.hasNext(); ) {
00222             SessionConfig sess = (SessionConfig)it.next();
00223             <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p3">log</a>.debug(<span class="keyword">this</span>, <span class="stringliteral">"prepareSessionConfigForRunning"</span>,
00224                       <span class="stringliteral">"Preparing session "</span> + sess.getId());
00225             <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r7">minSessionId</a> = Math.min(sess.getId(), <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r7">minSessionId</a>);
00226             <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r8">maxSessionId</a> = Math.max(sess.getId(), <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r8">maxSessionId</a>);
00227         }
00228         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r8">maxSessionId</a> &gt;= <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r7">minSessionId</a>) {
00229             <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r9">sessionLookup</a> = <span class="keyword">new</span> SessionConfig[<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r8">maxSessionId</a> - <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r7">minSessionId</a> + 1];
00230         }
00231         <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p3">log</a>.debug(<span class="keyword">this</span>, <span class="stringliteral">"prepareSessionConfigForRunning"</span>,
00232                   <span class="stringliteral">"Session IDs: "</span> + <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r7">minSessionId</a> + <span class="stringliteral">"..."</span> + <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r8">maxSessionId</a>);
00233         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <span class="keywordtype">id</span> = <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r7">minSessionId</a>; <span class="keywordtype">id</span> &lt;= <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r8">maxSessionId</a>; <span class="keywordtype">id</span>++) {
00234             <span class="keywordflow">try</span> {
00235                 <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r9">sessionLookup</a>[<span class="keywordtype">id</span> - <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r7">minSessionId</a>] = <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p2">connectionConfig</a>.getSessionConfigById(<span class="keywordtype">id</span>);
00236             } <span class="keywordflow">catch</span> (ConfigException e) {
00237                 <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r9">sessionLookup</a>[id] = null;
00238                 <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p3">log</a>.info(<span class="keyword">this</span>, <span class="stringliteral">"prepareSessionConfigForRunning"</span>,
00239                          <span class="stringliteral">"Skipped non-used session id "</span> + <span class="keywordtype">id</span>);
00240             }
00241         }
00242     }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="com::xacct::CRANE::collector::ConnectionThread::processDataSeqNoAck"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">synchronized final void com::xacct::CRANE::collector::ConnectionThread::processDataSeqNoAck           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">long&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>newDataSeqNoToAck</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>  throws <a class="el" href="../../df/d89/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_i_o_exception.html">ConnectionIOException</a>, <a class="el" href="../../dc/d8b/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_protocol_malformed_msg_exception.html">ProtocolMalformedMsgException</a>, <a class="el" href="../../d4/d30/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_config_exception.html">ConfigException</a> <code> [inline]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
"callback" for when a new data sequence number can be sent to the transmitter. XXX synchronized ... is it correct? see other synchronized's and runLoop 
<p>
Implements <a class="el" href="../../d0/d33/interfacecom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_process_data_seq_no_ack.html#a0">com::xacct::CRANE::collector::ProcessDataSeqNoAck</a>.<div class="fragment"><pre class="fragment">00889                                                                                  {
00890         <span class="comment">// XXX</span>
00891 
00892         <span class="comment">// It is not clear that we have sufficient conditions here to</span>
00893         <span class="comment">// prevent a problem when a callback to here happens after</span>
00894         <span class="comment">// "isRunning" is set false (that is, race conditions.</span>
00895         <span class="comment">// Probably we should have a "mutex" which guarantees</span>
00896         <span class="comment">// behaviour in such cases (e.g., put a mutex on this callback</span>
00897         <span class="comment">// and also on the main read-process loop).</span>
00898 
00899         <span class="comment">// log.info(this, "processDataSeqNoAck",</span>
00900         <span class="comment">//          "isRunning=" + this.isRunning +</span>
00901         <span class="comment">//          ", anyDataSeen=" + this.anyDataRecordSeen +</span>
00902         <span class="comment">//          ", lastDSNAcked=" + this.lastDataSeqNoAcked +</span>
00903         <span class="comment">//          ", newDSNToAck=" + newDataSeqNoToAck +</span>
00904         <span class="comment">//          ", connection=" + this.connection);</span>
00905 
00906         <span class="keywordtype">long</span> now = System.currentTimeMillis();
00907         <span class="keywordtype">boolean</span> doAckLogMsg = (now &gt;= <span class="keyword">this</span>.nextDataAckLogMsgTime);
00908 
00909         <span class="keywordflow">if</span> (doAckLogMsg) {
00910             <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#b6">sendStatusReq</a>(<span class="stringliteral">"periodic update"</span>, <span class="stringliteral">"processDataSeqNoAck"</span>, <span class="keyword">false</span>);
00911             <span class="keyword">this</span>.nextDataAckLogMsgTime += <span class="keyword">this</span>.dataAckLogInterval;
00912         }
00913         <span class="keywordflow">if</span> (<span class="keyword">this</span>.<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p0">isRunning</a> &amp;&amp; <span class="keyword">this</span>.<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p4">connection</a> != null &amp;&amp; <span class="keyword">this</span>.<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r16">anyDataRecordSeen</a> &amp;&amp;
00914             newDataSeqNoToAck != <span class="keyword">this</span>.<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r19">lastDataSeqNoAcked</a>) {
00915             ProtocolMsgDATA_ACK msgACK =
00916                 <span class="keyword">new</span> ProtocolMsgDATA_ACK(<span class="keyword">this</span>.<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r20">sessionId</a>, <span class="keyword">this</span>.<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r21">configId</a>, newDataSeqNoToAck);
00917             <span class="keywordflow">if</span> (doAckLogMsg || <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p3">log</a>.debug()) {
00918                 <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p3">log</a>.info(<span class="keyword">this</span>, <span class="stringliteral">"ProcessDataSeqNoAck"</span>, <span class="stringliteral">"Sending to "</span> +
00919                          <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p4">connection</a>.addrAndPortToString() + <span class="stringliteral">": "</span> + msgACK);
00920             }
00921             msgACK.sendMsg(<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p4">connection</a>);
00922             <span class="keyword">this</span>.lastDataSeqNoAcked = newDataSeqNoToAck;
00923             <span class="keyword">this</span>.nextNoDataKeepAliveTime = now + <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p1">collectorConfig</a>.getNoDataKeepAliveInterval();
00924         }
00925         <span class="keyword">this</span>.nextAckTime = now + <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p1">collectorConfig</a>.getAckInterval();
00926     }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="d9" doxytag="com::xacct::CRANE::collector::ConnectionThread::receiveDataAndOutputIt"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">final void com::xacct::CRANE::collector::ConnectionThread::receiveDataAndOutputIt           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>  throws <a class="el" href="../../df/d89/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_i_o_exception.html">ConnectionIOException</a>, <a class="el" href="../../dc/d8b/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_protocol_malformed_msg_exception.html">ProtocolMalformedMsgException</a>,         <a class="el" href="../../d6/d39/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_data_exception.html">DataException</a>, <a class="el" href="../../d4/d30/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_config_exception.html">ConfigException</a>, <a class="el" href="../../d4/d63/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_outputter_exception.html">OutputterException</a> <code> [inline, private]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Receive data and output it. This also starts the acknowledgment timer thread. <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>connection</em>&nbsp;</td><td></td></tr>
  </table>
</dl>
<div class="fragment"><pre class="fragment">00679                                                            {
00680 
00681         <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r0">outputter</a>.registerProcessDataSeqNoAck(<span class="keyword">this</span>);
00682 
00683         <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#d11">initSeqNoData</a>();
00684 
00685         <span class="keywordflow">try</span> {
00686             <span class="comment">// By defining the buffer outside readMsg, we get about 2x</span>
00687             <span class="comment">// speed-up ... but we must be sure to not do another</span>
00688             <span class="comment">// readMsg with the same buffer while we're still using</span>
00689             <span class="comment">// the "msg" that we read (things might get corrupted, at</span>
00690             <span class="comment">// least with ProtocolMsgDATA).</span>
00691 
00692             byte [] readMsgBuf = <span class="keyword">new</span> byte[0x8000]; <span class="comment">// should be big enough</span>
00693             <span class="keywordflow">while</span> (<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p0">isRunning</a>) {
00694                 <span class="keywordtype">long</span> now = System.currentTimeMillis();
00695                 <span class="keywordtype">int</span> timeToWait = (int)(<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r17">nextAckTime</a> - now);
00696                 <span class="comment">// XXX Need to avoid multiple zero-wait responses in</span>
00697                 <span class="comment">// the case of falling severely behind in processing.</span>
00698                 <span class="comment">// see below where nextAckTime is set ... it might not be sufficient.</span>
00699                 <span class="comment">// log.debug(this, "receiveDataAndOutputIt", "timeToWait="+timeToWait);</span>
00700 
00701                 ProtocolMsg msg;
00702                 <span class="keywordflow">if</span> (timeToWait &gt; 0 &amp;&amp; timeToWait &gt; <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p1">collectorConfig</a>.getAckIntervalEpsilon()) {
00703                     msg = ProtocolMsg.readMsg(readMsgBuf, <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p4">connection</a>,
00704                                               <span class="stringliteral">"data"</span>, null, timeToWait);
00705                 } <span class="keywordflow">else</span> {
00706                     msg = <span class="keyword">new</span> ProtocolMsgEmpty();
00707                 }
00708                 <span class="keywordflow">if</span> (<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p3">log</a>.debug()) {
00709                     <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p3">log</a>.debug(<span class="keyword">this</span>, <span class="stringliteral">"receiveDataAndOutputIt"</span>,
00710                               <span class="stringliteral">"data record: "</span> + msg.toStringLong());
00711                 }
00712 
00713                 now = System.currentTimeMillis();
00714                 <span class="keywordflow">if</span> (msg instanceof ProtocolMsgDATA) {
00715                     <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#b7">handleSingleDATA</a>((ProtocolMsgDATA)msg);
00716                     <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r18">nextNoDataKeepAliveTime</a> = now + <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p1">collectorConfig</a>.getNoDataKeepAliveInterval();
00717                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msg instanceof ProtocolMsgEmpty) {
00718                     <span class="comment">// Nothing was read: a timeout or other interruption.</span>
00719 
00720                     <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r0">outputter</a>.commitTimerExpired();
00721 
00722                     ProtocolMsgEmpty msgEmpty = (ProtocolMsgEmpty)msg;
00723                     Exception e = msgEmpty.getException();
00724 
00725                     <span class="comment">// XXX For JDK 1.4, we can check that we have an</span>
00726                     <span class="comment">// instance of InterruptedIOException ...</span>
00727                     <span class="comment">// for 1.3, suppress unnecessary messages by doing</span>
00728                     <span class="comment">// a comparison with a magic string</span>
00729                     <span class="keywordtype">boolean</span> showWhatHappened = <span class="keyword">false</span>;
00730                     <span class="keywordflow">if</span> (e == null) { <span class="comment">// we generated this ourselves</span>
00731                         showWhatHappened = <span class="keyword">false</span>;
00732                     } <span class="keywordflow">else</span> {
00733                         showWhatHappened = <span class="keyword">true</span>;
00734                     }
00735                     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p3">log</a>.debug()) { showWhatHappened = <span class="keyword">true</span>; }
00736 
00737                     <span class="keywordflow">if</span> (showWhatHappened) {
00738                         <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p3">log</a>.debug(<span class="keyword">this</span>, <span class="stringliteral">"receiveDataAndOutputItLoop"</span>,
00739                                   <span class="stringliteral">"Interrupt (timeout?) on input socket: "</span> +
00740                                   msgEmpty.getException());
00741                     }
00742 
00743                     <span class="comment">// note that processDataSeqNoAck() will set the</span>
00744                     <span class="comment">// next timers (in case it's called from Outputter).</span>
00745 
00746                     <span class="keywordflow">if</span> (<span class="keyword">this</span>.<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r16">anyDataRecordSeen</a> &amp;&amp; <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r0">outputter</a>.isValidLastSeqNoToAck()) {
00747                         <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#a6">processDataSeqNoAck</a>(<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r0">outputter</a>.getLastSeqNoToAck());
00748                     }
00749                     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r17">nextAckTime</a> &lt;= (now + <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p1">collectorConfig</a>.getAckIntervalEpsilon())) {
00750                         <span class="comment">// try to avoid many zero-time acks if we fall far behind.</span>
00751                         <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r17">nextAckTime</a> = now + <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p1">collectorConfig</a>.getAckInterval() / 2;
00752                     }
00753 
00754                     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r18">nextNoDataKeepAliveTime</a> &lt;= now) {
00755                         <span class="comment">// XXX send a "keep-alive" status query</span>
00756                         <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#b6">sendStatusReq</a>(<span class="stringliteral">"no data from transmitter"</span>, <span class="stringliteral">"receiveDataAndOutputIt"</span>, <span class="keyword">true</span>);
00757                         <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r18">nextNoDataKeepAliveTime</a> = now + <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p1">collectorConfig</a>.getNoDataKeepAliveInterval();
00758                         <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p3">log</a>.debug(<span class="keyword">this</span>, <span class="stringliteral">"processDataSeqNoAck"</span>,
00759                                   <span class="stringliteral">"Next keep-alive: "</span> +
00760                                   CollectorUtil.dateFormatMillisec(<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r18">nextNoDataKeepAliveTime</a>));
00761                     }
00762                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msg instanceof ProtocolMsgTMPL_DATA) {
00763                     <span class="comment">// NB: ProtcolMsgFINAL_TMPL_DATA is subclass of</span>
00764                     <span class="comment">// ProtocolMsgTMPL_DATA, so it is also handled</span>
00765                     <span class="comment">// here.</span>
00766                     <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#d7">handleTMPL_DATA</a>((ProtocolMsgTMPL_DATA)msg);
00767                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msg instanceof ProtocolMsgERROR) {
00768                     <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#d10">handleERROR</a>((ProtocolMsgERROR)msg);
00769                 } <span class="keywordflow">else</span> {
00770                     <span class="keywordflow">throw</span> <span class="keyword">new</span> DataException(<span class="keyword">this</span>, <span class="stringliteral">"receiveDataAndOutputIt"</span>,
00771                                             <span class="stringliteral">"Unexpected message: "</span> + msg.toStringLong());
00772                 }
00773             }
00774         }
00775         <span class="comment">//Alex</span>
00776         <span class="keywordflow">catch</span>(Exception e)
00777         {
00778           e.printStackTrace();
00779         }
00780         <span class="comment">//Alex</span>
00781         finally {
00782             <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r0">outputter</a>.registerProcessDataSeqNoAck(null);
00783         }
00784     }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="com::xacct::CRANE::collector::ConnectionThread::run"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">final void com::xacct::CRANE::collector::ConnectionThread::run           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [inline]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
The main processing (thread)<p>
XXX The structure here is clumsy, with <a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#b2">runLoop()</a> not having clear semantics. Especially when this is subclassed (see <a class="el" href="../../df/d61/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_setup_thread.html">ConnectionSetupThread</a>). <div class="fragment"><pre class="fragment">00251                             {
00252         <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p0">isRunning</a> = <span class="keyword">true</span>;
00253 
00254         <span class="keywordflow">while</span> (<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p0">isRunning</a>) {
00255             <span class="keywordflow">try</span> {
00256                 <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p3">log</a>.debug(<span class="keyword">this</span>, <span class="stringliteral">"run"</span>, <span class="stringliteral">"Started CRANE collector"</span>);
00257                 <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#b2">runLoop</a>();
00258             } <span class="keywordflow">catch</span> (ProtocolMalformedMsgException e) {
00259                 <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p3">log</a>.fatal(<span class="keyword">this</span>, <span class="stringliteral">"runLoop"</span>, <span class="stringliteral">"*** exception: "</span> + e);
00260                 CollectorLog.stackTrace(e);
00261             } <span class="keywordflow">catch</span> (DataException e) {
00262                 <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p3">log</a>.fatal(<span class="keyword">this</span>, <span class="stringliteral">"runLoop"</span>, <span class="stringliteral">"*** exception: "</span> + e);
00263                 CollectorLog.stackTrace(e);
00264             } <span class="keywordflow">catch</span> (Throwable e) {
00265                 <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p3">log</a>.fatal(<span class="keyword">this</span>, <span class="stringliteral">"runLoop"</span>, <span class="stringliteral">"*** exception: "</span> + e);
00266                 CollectorLog.stackTrace(e);
00267             } finally {
00268                 <span class="keywordflow">if</span> (<span class="keyword">this</span>.<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p4">connection</a> != null) {
00269                     <span class="keywordflow">try</span> {
00270                         <span class="keyword">this</span>.connection.close(); <span class="comment">// kill the connection</span>
00271                     } <span class="keywordflow">catch</span> (Throwable e) {
00272                         <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p3">log</a>.error(<span class="keyword">this</span>, <span class="stringliteral">"runLoop"</span>, <span class="stringliteral">"Could not properly close connection: "</span> + e);
00273                         CollectorLog.stackTrace(e);
00274                     }
00275                     <span class="keyword">this</span>.connection = null;
00276                 }
00277             }
00278             <span class="keywordflow">if</span> (<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p0">isRunning</a>) {
00279                 <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p3">log</a>.error(<span class="keyword">this</span>, <span class="stringliteral">"runLoop"</span>, <span class="stringliteral">"Restarting after error"</span>);
00280             }
00281         }
00282         <span class="keywordflow">if</span> (<span class="keyword">this</span>.<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r0">outputter</a> != null) {
00283             <span class="keyword">this</span>.outputter.close(); <span class="comment">// give it a chance to shut down</span>
00284             <span class="keyword">this</span>.outputter = null;
00285         }
00286     }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b2" doxytag="com::xacct::CRANE::collector::ConnectionThread::runLoop"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void com::xacct::CRANE::collector::ConnectionThread::runLoop           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>  throws <a class="el" href="../../dc/d8b/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_protocol_malformed_msg_exception.html">ProtocolMalformedMsgException</a>, <a class="el" href="../../d6/d39/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_data_exception.html">DataException</a>, <a class="el" href="../../d4/d30/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_config_exception.html">ConfigException</a>,         <a class="el" href="../../df/d89/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_i_o_exception.html">ConnectionIOException</a>, <a class="el" href="../../d4/d63/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_outputter_exception.html">OutputterException</a> <code> [inline, protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Main run loop.<p>
XXX The structure of this method isn't quite right, especially with the sub-class <a class="el" href="../../df/d61/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_setup_thread.html">ConnectionSetupThread</a> ... need to refactor (outputter vs connection etc).<p>
<dl compact><dt><b>Exceptions:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="../../d4/d30/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_config_exception.html">ConfigException</a></em>&nbsp;</td><td>&lt;&lt;description&gt;&gt; </td></tr>
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="../../df/d89/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_i_o_exception.html">ConnectionIOException</a></em>&nbsp;</td><td>&lt;&lt;description&gt;&gt; </td></tr>
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="../../d6/d39/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_data_exception.html">DataException</a></em>&nbsp;</td><td>&lt;&lt;description&gt;&gt; </td></tr>
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="../../d4/d63/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_outputter_exception.html">OutputterException</a></em>&nbsp;</td><td>&lt;&lt;description&gt;&gt; </td></tr>
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="../../dc/d8b/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_protocol_malformed_msg_exception.html">ProtocolMalformedMsgException</a></em>&nbsp;</td><td>&lt;&lt;description&gt;&gt; </td></tr>
  </table>
</dl>

<p>
Reimplemented in <a class="el" href="../../df/d61/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_setup_thread.html#b1">com::xacct::CRANE::collector::ConnectionSetupThread</a>.<div class="fragment"><pre class="fragment">00316                                                   {
00317 
00318         <span class="keyword">this</span>.exporterBootTime = null;  <span class="comment">// generate an error if it's used</span>
00319 
00320         <span class="keywordflow">while</span> (<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p0">isRunning</a>) {
00321             <span class="keywordflow">try</span> {
00322                 <span class="comment">// if (false) { // Used for testing UDP send/receive with "daytime" server</span>
00323                 <span class="comment">//     log.print("daytime from " + connectionConfig.transmitterAddress + "(" +</span>
00324                 <span class="comment">//               connectionConfig.getConnectTimeout() + "ms): " +</span>
00325                 <span class="comment">//               testUDP(connectionConfig.transmitterAddress));</span>
00326                 <span class="comment">// }</span>
00327 
00328                 <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#b4">runLoopConnection</a>();
00329 
00330                 <span class="keywordflow">if</span> (<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p0">isRunning</a>) {
00331                     <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#b6">sendStatusReq</a>(<span class="stringliteral">"start-up"</span>, <span class="stringliteral">"runLoop"</span>, <span class="keyword">false</span>);
00332                     <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#d9">receiveDataAndOutputIt</a>();
00333                 }
00334 
00335             } <span class="keywordflow">catch</span> (ConnectionIOException e) {
00336                 <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p3">log</a>.error(<span class="keyword">this</span>, <span class="stringliteral">"runLoop"</span>,
00337                           <span class="stringliteral">"error with transmitter (client) "</span> +
00338                           <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p2">connectionConfig</a>.transmitterAndPortString() +
00339                           <span class="stringliteral">": "</span> + e.getOriginalMsg() +
00340                           <span class="stringliteral">" ... caused by: "</span> + e.getCause());
00341             }
00342 
00343             <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#b3">closeConnection</a>();
00344 
00345             <span class="keywordflow">if</span> (<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p0">isRunning</a>) {
00346                 <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#d5">sleepReconnect</a>();
00347             }
00348         }
00349     }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b4" doxytag="com::xacct::CRANE::collector::ConnectionThread::runLoopConnection"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">synchronized final void com::xacct::CRANE::collector::ConnectionThread::runLoopConnection           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>  throws <a class="el" href="../../df/d89/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_i_o_exception.html">ConnectionIOException</a>, <a class="el" href="../../dc/d8b/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_protocol_malformed_msg_exception.html">ProtocolMalformedMsgException</a>,         <a class="el" href="../../d4/d30/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_config_exception.html">ConfigException</a>, <a class="el" href="../../d6/d39/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_data_exception.html">DataException</a> <code> [inline, protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00378                                        {
00379 
00380         <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#b5">makeConnection</a>();
00381 
00382         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p0">isRunning</a>) {
00383             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p0">isRunning</a> &amp;&amp; i &lt; <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p2">connectionConfig</a>.getSessionConfigListLength(); i++) {
00384                 <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#d6">sendStartAndValidateTemplates</a>(<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p2">connectionConfig</a>.getSessionConfigAt(i));
00385                 <span class="comment">// collectorConfig.validateTemplatesFromTransmitter(templateConfigList);</span>
00386             }
00387         }
00388     }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="d15" doxytag="com::xacct::CRANE::collector::ConnectionThread::sendAndReceiveVersionDatagram"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">final byte [] com::xacct::CRANE::collector::ConnectionThread::sendAndReceiveVersionDatagram           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>timeout</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>byte[]&nbsp;</td>
          <td class="mdname" nowrap> <em>sendData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>sendLength</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2">  throws java.io.IOException <code> [inline, private]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Send a single datagram and wait for response. <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>timeout</em>&nbsp;</td><td>How long to wait for a response: 0 or negative means forever. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>sendData</em>&nbsp;</td><td>Bytes to send. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>sendLength</em>&nbsp;</td><td>How many bytes to send. </td></tr>
  </table>
</dl>
<div class="fragment"><pre class="fragment">01339                                    {
01340         DatagramSocket socket = <span class="keyword">new</span> DatagramSocket();
01341         <span class="keywordflow">try</span> {
01342             DatagramPacket sendPacket, receivePacket;
01343             byte [] receiveBuf = <span class="keyword">new</span> byte[0xffff+1]; <span class="comment">// big enough for all possibilities</span>
01344 
01345             timeout = Math.max(0, timeout);
01346             socket.setSoTimeout(timeout);
01347             sendPacket = <span class="keyword">new</span> DatagramPacket(sendData, sendData.length,
01348                                             <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p2">connectionConfig</a>.getTransmitterAddress().get(),
01349                                             <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p2">connectionConfig</a>.getTransmitterVersionPort());
01350             receivePacket = <span class="keyword">new</span> DatagramPacket(receiveBuf, receiveBuf.length);
01351 
01352             socket.send(sendPacket);
01353             socket.receive(receivePacket);
01354 
01355             <span class="comment">// If we get here, we've received a packet: a timeout would</span>
01356             <span class="comment">// throw IOException.</span>
01357 
01358             <span class="keywordtype">int</span> receivedLength = receivePacket.getLength();
01359 
01360             byte [] result = <span class="keyword">new</span> byte[receivedLength];
01361             System.arraycopy(receivePacket.getData(), receivePacket.getOffset(),
01362                              result, 0, receivedLength);
01363 
01364             socket.close();
01365             socket = null; <span class="comment">// make really sure it's gone (probably not needed)</span>
01366 
01367             <span class="keywordflow">return</span> result;
01368         } finally {
01369             <span class="keywordflow">if</span> (socket != null) {
01370                 socket.close();
01371                 socket = null; <span class="comment">// and make sure</span>
01372             }
01373         }
01374     }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="d14" doxytag="com::xacct::CRANE::collector::ConnectionThread::sendAndReceiveVersionDatagrams"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">final byte [] com::xacct::CRANE::collector::ConnectionThread::sendAndReceiveVersionDatagrams           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">byte[]&nbsp;</td>
          <td class="mdname" nowrap> <em>sendData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>sendLength</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2">  throws java.io.IOException <code> [inline, private]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Send a datagram and wait for response, resending the datagram every so often. <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>sendData</em>&nbsp;</td><td>Bytes to send. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>sendLength</em>&nbsp;</td><td>How many bytes to send. </td></tr>
  </table>
</dl>
<div class="fragment"><pre class="fragment">01310                                    {
01311         <span class="keywordtype">int</span> roundtripTimeout =
01312             Math.max(0,
01313                      Math.min(<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p2">connectionConfig</a>.getConnectRoundtripTimeout(),
01314                               <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p2">connectionConfig</a>.getConnectRetryTimeout()));
01315 
01316         <span class="keywordtype">int</span> timesToTry = Math.max(1, <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p2">connectionConfig</a>.getConnectRetryTimeout() / roundtripTimeout);
01317         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 1; ;i++) {
01318             <span class="keywordflow">try</span> {
01319                 <span class="keywordflow">return</span> <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#d15">sendAndReceiveVersionDatagram</a>(roundtripTimeout,
01320                                                      sendData, sendLength);
01321             <span class="comment">// XXX For JDK 1.4:</span>
01322             <span class="comment">// } catch (SocketTimeoutException exc) {</span>
01323             } <span class="keywordflow">catch</span> (java.io.InterruptedIOException exc) {
01324                 <span class="keywordflow">if</span> (i &gt;= timesToTry) {
01325                     <span class="keywordflow">throw</span> exc;
01326                 }
01327             }
01328         }
01329     }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="d6" doxytag="com::xacct::CRANE::collector::ConnectionThread::sendStartAndValidateTemplates"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">final void com::xacct::CRANE::collector::ConnectionThread::sendStartAndValidateTemplates           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../da/d92/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_session_config.html">SessionConfig</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>sessionConfig</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>  throws <a class="el" href="../../df/d89/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_i_o_exception.html">ConnectionIOException</a>, <a class="el" href="../../dc/d8b/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_protocol_malformed_msg_exception.html">ProtocolMalformedMsgException</a>,         <a class="el" href="../../d6/d39/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_data_exception.html">DataException</a>, <a class="el" href="../../d4/d30/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_config_exception.html">ConfigException</a> <code> [inline, private]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00420                                        {
00421         ProtocolMsgSTART msgSTART = <span class="keyword">new</span> ProtocolMsgSTART((byte)sessionConfig.getId());
00422         ProtocolMsg responseMsg = null;
00423         <span class="keywordflow">try</span> {
00424             msgSTART.sendMsg(<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p4">connection</a>);
00425             <span class="comment">// XXX Is indefinite wait the correct thing here? What if the connection dies ...</span>
00426             <span class="comment">// we should restart, I think. Need a separate timeout value from config, though.</span>
00427             responseMsg = ProtocolMsg.readMsg(connection, <span class="stringliteral">"response to"</span>, msgSTART, 0);
00428         } <span class="keywordflow">catch</span> (ConnectionIOException e) {
00429             <span class="comment">// if (e.getCause() instanceof ConnectException) {</span>
00430             <span class="keywordflow">throw</span> <span class="keyword">new</span> ConnectionIOException(e.getOriginalMsg() +
00431                                             <span class="stringliteral">" - possibly because not registered at transmitter?"</span>,
00432                                             connection,
00433                                             e.getCause());
00434         }
00435 
00436         <span class="keywordflow">if</span> (responseMsg instanceof ProtocolMsgSTART_ACK) {
00437             <span class="keyword">this</span>.exporterBootTime = ((ProtocolMsgSTART_ACK)responseMsg).bootTime;
00438             <span class="comment">// Next should be the TMPL DATA message</span>
00439             <span class="comment">// XXX Is indefinite wait the correct thing here? What if the connection dies ...</span>
00440             <span class="comment">// we should restart, I think. Need a separate timeout value from config, though.</span>
00441             responseMsg = ProtocolMsg.readMsg(connection, <span class="stringliteral">"(TEMPL DATA) response to"</span>, msgSTART, 0);
00442         } <span class="keywordflow">else</span> {
00443             <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p3">log</a>.warn(<span class="keyword">this</span>, <span class="stringliteral">"sendStartAndValidateTemplates"</span>,
00444                      <span class="stringliteral">"Did not get START ACK from transmitter (client)"</span>);
00445         }
00446 
00447         <span class="keywordflow">if</span> (responseMsg instanceof ProtocolMsgTMPL_DATA) {
00448             <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p3">log</a>.info(<span class="keyword">this</span>, <span class="stringliteral">"sendStartAndValidateTemplates"</span>,
00449                      <span class="stringliteral">"After START/ACK: "</span> +
00450                      responseMsg.toStringLong());
00451             <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#d7">handleTMPL_DATA</a>((ProtocolMsgTMPL_DATA)responseMsg);
00452         } <span class="keywordflow">else</span> {
00453             <span class="keywordflow">throw</span> <span class="keyword">new</span> DataException(<span class="keyword">this</span>, <span class="stringliteral">"sendStartAndValidateTemplates"</span>,
00454                                     <span class="stringliteral">"Expected TMPL DATA from request message "</span> + msgSTART +
00455                                     <span class="stringliteral">" but received: "</span> + responseMsg);
00456         }
00457 
00458     }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b6" doxytag="com::xacct::CRANE::collector::ConnectionThread::sendStatusReq"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void com::xacct::CRANE::collector::ConnectionThread::sendStatusReq           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">String&nbsp;</td>
          <td class="mdname" nowrap> <em>msg</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>String&nbsp;</td>
          <td class="mdname" nowrap> <em>function</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>boolean&nbsp;</td>
          <td class="mdname" nowrap> <em>warning</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2">  throws <a class="el" href="../../df/d89/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_i_o_exception.html">ConnectionIOException</a>, <a class="el" href="../../dc/d8b/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_protocol_malformed_msg_exception.html">ProtocolMalformedMsgException</a>, <a class="el" href="../../d4/d30/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_config_exception.html">ConfigException</a> <code> [inline, protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00787                                                                                      {
00788         ProtocolMsgSTATUS_REQ req = <span class="keyword">new</span> ProtocolMsgSTATUS_REQ(<span class="keyword">this</span>.<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r20">sessionId</a>);
00789         String fullMsg = <span class="stringliteral">"Sending status request ["</span> + msg +
00790             <span class="stringliteral">"] (msg.Id="</span> + req.msgId() + <span class="stringliteral">") to transmitter on "</span> + <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p4">connection</a>;
00791         <span class="keywordflow">if</span> (warning) {
00792             <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p3">log</a>.warn(<span class="keyword">this</span>, function, fullMsg);
00793         } <span class="keywordflow">else</span> {
00794             <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p3">log</a>.info(<span class="keyword">this</span>, function, fullMsg);
00795         }
00796         req.sendMsg(<span class="keyword">this</span>.<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p4">connection</a>);
00797     }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="com::xacct::CRANE::collector::ConnectionThread::setDataAckMsgInterval"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void com::xacct::CRANE::collector::ConnectionThread::setDataAckMsgInterval           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>value</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [inline]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00030 { <span class="keyword">this</span>.dataAckLogInterval = value; }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="com::xacct::CRANE::collector::ConnectionThread::setNullInput"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void com::xacct::CRANE::collector::ConnectionThread::setNullInput           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [inline]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00068 { <span class="keyword">this</span>.nullInput = <span class="keyword">true</span>; }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="d1" doxytag="com::xacct::CRANE::collector::ConnectionThread::setSessionBigEndian"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">final void com::xacct::CRANE::collector::ConnectionThread::setSessionBigEndian           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>id</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>boolean&nbsp;</td>
          <td class="mdname" nowrap> <em>bigEndian</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [inline, private]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00092                                                                       {
00093         ProtocolData pd =
00094             bigEndian ?
00095             (ProtocolData)<span class="keyword">new</span> ProtocolDataBigEndian() :
00096             (ProtocolData)new ProtocolDataLittleEndian();
00097         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r6">connectionDataConverter</a> == null) {
00098             <span class="keywordflow">if</span> (<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r5">sessionIdToDataConverter</a>.isEmpty()) {
00099                 <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r6">connectionDataConverter</a> = pd;
00100             }
00101         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r6">connectionDataConverter</a>.getClass() != pd.getClass()) {
00102             <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r6">connectionDataConverter</a> = null; <span class="comment">// it'll be looked up on a per-session-id basis</span>
00103         }
00104         <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r5">sessionIdToDataConverter</a>.put(<span class="keyword">new</span> Integer(<span class="keywordtype">id</span>), pd);
00105     }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="com::xacct::CRANE::collector::ConnectionThread::setSessionTemplate"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void com::xacct::CRANE::collector::ConnectionThread::setSessionTemplate           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d5/d67/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_config.html">ConnectionConfig</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>connectionConfig</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../da/d92/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_session_config.html">SessionConfig</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>transmitterSession</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d7/db7/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_template_config.html">TemplateConfig</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>tmplTransmitter</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2">  throws <a class="el" href="../../d4/d30/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_config_exception.html">ConfigException</a> <code> [inline]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Setting the runtime template, as retrived by handleTMPL_DATA. The template would be compared against the session in configuration and modified according to the runtime information. If a mismatch is found, a matching log message is output.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>connectionConfig</em>&nbsp;</td><td>&lt;&lt;description&gt;&gt; </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>transmitterSession</em>&nbsp;</td><td>&lt;&lt;description&gt;&gt; </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>tmplTransmitter</em>&nbsp;</td><td>&lt;&lt;description&gt;&gt; </td></tr>
  </table>
</dl>
<dl compact><dt><b>Exceptions:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="../../d4/d30/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_config_exception.html">ConfigException</a></em>&nbsp;</td><td>&lt;&lt;description&gt;&gt; </td></tr>
  </table>
</dl>
<div class="fragment"><pre class="fragment">00534                                                                                           {
00535         <span class="comment">//getting the SessionConfig from configuration</span>
00536         ConnectionConfig savedConnection = null;
00537         SessionConfig savedSession = null;
00538         TemplateConfig savedTemplate = null;
00539         <span class="keywordflow">try</span> {
00540             savedConnection =
00541                 <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p1">collectorConfig</a>.getConnectionConfigById(<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p2">connectionConfig</a>.getTransmitterAddress(),
00542                                                         <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p2">connectionConfig</a>.getTransmitterVersionPort());
00543         } <span class="keywordflow">catch</span> (ConfigException ce) {
00544             <span class="keywordflow">throw</span> <span class="keyword">new</span> ConfigException(<span class="stringliteral">"ConnectionThread.setSessionTemplate: Could not find the matching connection config on retrieval of GET_TEMPLATE: "</span> + ce);
00545         }
00546         <span class="keywordflow">if</span> (savedConnection != null) {
00547             savedSession = savedConnection.lookupSessionConfigById(transmitterSession.getId());
00548             <span class="keywordflow">if</span>(savedSession == null) {
00549                 <span class="keywordflow">throw</span> <span class="keyword">new</span> ConfigException(<span class="stringliteral">"ConnectionThread.setSessionTemplate: Could not find the matching session config on retrieval of GET_TEMPLATE"</span>);
00550             }
00551         }
00552         savedTemplate = savedSession.lookupTemplateConfigById(tmplTransmitter.getId());
00553         <span class="keywordflow">if</span> (savedTemplate == null) {
00554             <span class="comment">// this is an outstanding template, we'll set it into the</span>
00555             <span class="comment">// session we'll check whether it already exists in the</span>
00556             <span class="comment">// session's outstanding-templates list</span>
00557 
00558             <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p3">log</a>.warn(<span class="keyword">this</span>, <span class="stringliteral">"setSessionTemplate"</span>,
00559                      <span class="stringliteral">"The retrieved template (id: "</span> + tmplTransmitter.getId() +
00560                      <span class="stringliteral">", description: "</span> + tmplTransmitter.getDescription() +
00561                      <span class="stringliteral">") from session "</span>+ savedSession.getId() +
00562                      <span class="stringliteral">" and client "</span> + <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p2">connectionConfig</a>.getTransmitterAddress() +
00563                      <span class="stringliteral">":"</span> + <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p2">connectionConfig</a>.getTransmitterVersionPort() +
00564                      <span class="stringliteral">" was not found in configuration."</span> +
00565                      <span class="stringliteral">" All incoming data from this template will be acknowledged but not processed."</span> +
00566                      <span class="stringliteral">" If you wish to collect that data into the system, please reconfigure that session."</span>);
00567 
00568            <span class="comment">// setting this template to be part of the configuration</span>
00569            <span class="comment">// object but with no fields (a new array-list)</span>
00570             tmplTransmitter.set(tmplTransmitter.getId(),
00571                                 <span class="keyword">new</span> ArrayList(0),
00572                                 tmplTransmitter.getDescription(),
00573                                 tmplTransmitter.isForStatusResponse());
00574 
00575            ArrayList allSessionTemplates = savedSession.getTemplateConfigList();
00576 
00577            <span class="keywordtype">boolean</span> isTmplTransmitterFound = <span class="keyword">false</span>;
00578            <span class="keywordflow">for</span> (ListIterator iter = allSessionTemplates.listIterator(); iter.hasNext(); ) {
00579                TemplateConfig tmpl = (TemplateConfig)iter.next();
00580                <span class="keywordflow">if</span>(tmpl != null &amp;&amp; tmpl.getId() == tmplTransmitter.getId()) {
00581                    isTmplTransmitterFound = <span class="keyword">true</span>;
00582                }
00583            }
00584            <span class="keywordflow">if</span> (! isTmplTransmitterFound) {
00585                allSessionTemplates.add(tmplTransmitter);
00586            }
00587            savedSession.setTemplates(allSessionTemplates);
00588 
00589            <span class="comment">// done with this template...</span>
00590            <span class="keywordflow">return</span>;
00591         }
00592 
00593         <span class="comment">// now we know that the recieved template from the trasmitter</span>
00594         <span class="comment">// exists in configuration, it's time to verify that the</span>
00595         <span class="comment">// fields match.</span>
00596 
00597         ArrayList transmitterTemplateFields = tmplTransmitter.getFieldList();
00598         ArrayList savedTemplateFields = savedTemplate.getFieldList();
00599         ArrayList removedTransmitterFields = <span class="keyword">new</span> ArrayList();
00600         <span class="comment">// iterating through the transmitter fields to detect unusable fields (fields that have</span>
00601         <span class="comment">// no match in configutation... no mapping)</span>
00602         ArrayList orderedList = <span class="keyword">new</span> ArrayList();
00603         <span class="keywordflow">for</span> (ListIterator transmitterFieldsIter = transmitterTemplateFields.listIterator();
00604              transmitterFieldsIter.hasNext(); ) {
00605             FieldConfig transmitterField = (FieldConfig)transmitterFieldsIter.next();
00606             FieldConfig savedField = transmitterField.lookupById(null,savedTemplateFields,transmitterField.getId());
00607 
00608             <span class="comment">// the cases where the transmitter field is unusable</span>
00609             <span class="comment">// (there is no matching field in the configuraion)</span>
00610             <span class="keywordflow">if</span>(savedField == null ||
00611                transmitterField.getTypeId() != savedField.getTypeId()) {
00612                 <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p3">log</a>.warn(<span class="keyword">this</span>, <span class="stringliteral">"setSessionTemplate"</span>,
00613                          <span class="stringliteral">"The retrieved field (id: "</span> + transmitterField.getId() +
00614                          <span class="stringliteral">") from template id "</span> + tmplTransmitter.getId() +
00615                          <span class="stringliteral">" ,session id "</span> + savedSession.getId() +
00616                          <span class="stringliteral">" and client "</span>+ <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p2">connectionConfig</a>.getTransmitterAddress() +
00617                          <span class="stringliteral">":"</span> + <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p2">connectionConfig</a>.getTransmitterVersionPort() +
00618                          <span class="stringliteral">" was not found in configuration."</span> +
00619                          <span class="stringliteral">" All incoming data on this field will be discarded."</span>+
00620                          <span class="stringliteral">" If you wish to collect that data into the system, please reconfigure that template/field."</span>);
00621             } <span class="keywordflow">else</span> {
00622                 <span class="keywordflow">if</span> (! savedField.isEnabledForOutput()) {
00623                     <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p3">log</a>.warn(<span class="keyword">this</span>, <span class="stringliteral">"setSessionTemplate"</span>,
00624                              <span class="stringliteral">"The retrieved field (id: "</span> + savedField.getId() +
00625                              <span class="stringliteral">" label: "</span> + savedField.getLabel() +
00626                              <span class="stringliteral">") from template id "</span> + tmplTransmitter.getId() +
00627                              <span class="stringliteral">", session id "</span> + savedSession.getId() +
00628                              <span class="stringliteral">" and client "</span> + <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p2">connectionConfig</a>.getTransmitterAddress() +
00629                              <span class="stringliteral">":"</span> + <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p2">connectionConfig</a>.getTransmitterVersionPort() +
00630                              <span class="stringliteral">" was found in configuration and is disabled for output."</span> +
00631                              <span class="stringliteral">" All incoming data on this field will be discarded."</span> +
00632                              <span class="stringliteral">" If you wish to collect that data into the system, please reconfigure that template/field."</span>);
00633                 }
00634                 <span class="keywordflow">if</span> (savedField.getFieldDesc() == null) { <span class="comment">// the field is unmapped</span>
00635                     <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p3">log</a>.warn(<span class="keyword">this</span>, <span class="stringliteral">"setSessionTemplate"</span>,
00636                              <span class="stringliteral">"The retrieved field (id: "</span> + savedField.getId() +
00637                              <span class="stringliteral">" label: "</span> + savedField.getLabel() +
00638                              <span class="stringliteral">") from template id "</span> + tmplTransmitter.getId() +
00639                              <span class="stringliteral">", session id "</span> + savedSession.getId() +
00640                              <span class="stringliteral">" and client "</span> + <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p2">connectionConfig</a>.getTransmitterAddress() +
00641                              <span class="stringliteral">":"</span> + <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p2">connectionConfig</a>.getTransmitterVersionPort() +
00642                              <span class="stringliteral">" was found in configuration and is unmapped for output."</span> +
00643                              <span class="stringliteral">" All incoming data on this field will be discarded."</span>+
00644                              <span class="stringliteral">" If you wish to collect that data into the system, please reconfigure that template/field."</span>);
00645                 }
00646 
00647                 orderedList.add(savedField);
00648             }
00649         }
00650 
00651         <span class="comment">// now we can swap the saved template with the transmitter template</span>
00652         <span class="keyword">synchronized</span> (savedTemplate) {
00653             savedTemplate.set(savedTemplate.getId(),
00654                               orderedList,
00655                               savedTemplate.getDescription(),
00656                               savedTemplate.isForStatusResponse());
00657         }
00658 
00659         TemplateConfig sessionTemplate = savedSession.lookupTemplateConfigById(savedTemplate.getId());
00660         ArrayList allSessionTemplates = savedSession.getTemplateConfigList();
00661 
00662         <span class="keywordflow">for</span> (ListIterator templatesIter = allSessionTemplates.listIterator();
00663              templatesIter.hasNext(); ) {
00664             TemplateConfig tc = (TemplateConfig)templatesIter.next();
00665             <span class="keywordflow">if</span>(tc.getId() == sessionTemplate.getId()) {
00666                 <span class="keywordtype">int</span> index = allSessionTemplates.indexOf(tc);
00667                 allSessionTemplates.set(index,sessionTemplate);
00668                 <span class="keywordflow">break</span>;
00669             }
00670         }
00671         savedSession.setTemplates(allSessionTemplates);
00672     }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="d5" doxytag="com::xacct::CRANE::collector::ConnectionThread::sleepReconnect"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">final void com::xacct::CRANE::collector::ConnectionThread::sleepReconnect           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [inline, private]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00360                                         {
00361         <span class="keywordflow">try</span> {
00362             <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p3">log</a>.debug(<span class="keyword">this</span>, <span class="stringliteral">"runLoop"</span>,
00363                       <span class="stringliteral">"Sleeping before reconnect attempt on "</span> +
00364                       <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p2">connectionConfig</a>.transmitterAndPortString() +
00365                       <span class="stringliteral">" ("</span> +
00366                       <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p2">connectionConfig</a>.getReconnectInterval() + <span class="stringliteral">"msec)"</span>);
00367             sleep(<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p2">connectionConfig</a>.getReconnectInterval());
00368         } <span class="keywordflow">catch</span> (InterruptedException e) {
00369             <span class="comment">// No need to do anything ... interruption is typically</span>
00370             <span class="comment">// from the stopProcessing() method, which also sets</span>
00371             <span class="comment">// isRunning to false, so the loop will end.</span>
00372         }
00373     }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="com::xacct::CRANE::collector::ConnectionThread::stopProcessing"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void com::xacct::CRANE::collector::ConnectionThread::stopProcessing           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [inline]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Stop this thread, as soon as possible. Interrupts the thread, so that if it's in the middle of an I/O you can get an exception (but this is necessary; otherwise we might wait forever). 
<p>
Reimplemented in <a class="el" href="../../df/d61/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_setup_thread.html#a4">com::xacct::CRANE::collector::ConnectionSetupThread</a>.<div class="fragment"><pre class="fragment">01178                                  {
01179         <span class="keyword">this</span>.isRunning = <span class="keyword">false</span>;
01180         <span class="keyword">this</span>.interrupt(); <span class="comment">// if we're in the middle of something, stop doing it!</span>
01181     }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="d13" doxytag="com::xacct::CRANE::collector::ConnectionThread::validateTransmitterProtocolVersion"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">final int com::xacct::CRANE::collector::ConnectionThread::validateTransmitterProtocolVersion           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>desiredTransportType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>desiredProtocolVersion</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2">  throws <a class="el" href="../../dc/d8b/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_protocol_malformed_msg_exception.html">ProtocolMalformedMsgException</a> <code> [inline, private]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Get the version information from the transmitter (waiting up to <code>connectionConfig.getConnectTimeout()</code> milliseconds for a response and resending every <code>connectionConfig.getConnectRetryTimeout())</code><p>
<code> XXX This does slightly wrong things with timeouts on UDP and TCP connections. For UDP, it ought to not try just once (current design), but instead try every 1000 msec until getConnectTimeout is reached (that is, if getConnectTimeout = 5000, it will send 5 UPD packets before giving up). Note that it doesn't hurt to send extra UDP packets -- we're just looking for one response.</code><p>
<code> <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>desiredTransportType</em>&nbsp;</td><td>The desired transport type (PROTOCOL_INFO_TRANSPORT_TCP or PROTOCOL_INFO_TRANSPORT_SCTP) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>desiredProtocolVersion</em>&nbsp;</td><td>The protocol version that we can handle </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>Port to be used for getting data from the client; connectionConfig.getTransmitterVersionPort() if nothing matched the transportType/protocolVersion. </dd></dl>
<dl compact><dt><b>Exceptions:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>traps</em>&nbsp;</td><td>all I/O exceptions and simply returns versionPort </td></tr>
  </table>
</dl>
</code><div class="fragment"><pre class="fragment">01221                                              {
01222         <span class="keywordtype">int</span> overrideTransmitterPort = <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p2">connectionConfig</a>.getTransmitterPort(); <span class="comment">// set to default value</span>
01223         ProtocolMsgInfoRequest msgInfoRequest = null;
01224         byte [] msgInfoRequestRaw = null;
01225         Exception exception = null;
01226 
01227         <span class="keywordflow">try</span> {
01228             msgInfoRequest =
01229                 <span class="keyword">new</span> ProtocolMsgInfoRequest(<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p2">connectionConfig</a>.getTransmitterAddress().get(),
01230                                            <span class="keyword">new</span> Date());
01231             msgInfoRequestRaw = msgInfoRequest.createRawMsg();
01232         } <span class="keywordflow">catch</span> (UnknownHostException e) {
01233             exception = e;
01234         }
01235 
01236         <span class="keywordtype">boolean</span> finished = (exception != null);
01237         <span class="keywordtype">int</span> numberOfRetries =
01238             Math.max(1,<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p2">connectionConfig</a>.getConnectTimeout() /
01239                        <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p2">connectionConfig</a>.getConnectRetryTimeout());
01240 
01241         <span class="keywordflow">for</span> (; numberOfRetries &gt; 0 &amp;&amp; ! finished; numberOfRetries--) {
01242             exception = null;
01243             <span class="keywordflow">try</span> {
01244                 <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p3">log</a>.debug(<span class="keyword">this</span>, <span class="stringliteral">"validateTransmitterProtocolVersion"</span>,
01245                           <span class="stringliteral">"Sending UDP to "</span> +
01246                           <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p2">connectionConfig</a>.transmitterAndVersionPortString() +
01247                           <span class="stringliteral">" (with timeout "</span> + <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p2">connectionConfig</a>.getConnectRetryTimeout() +
01248                           <span class="stringliteral">"msec): "</span> + msgInfoRequest);
01249                 byte [] protocolInfo =
01250                     <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#d14">sendAndReceiveVersionDatagrams</a>(msgInfoRequestRaw,
01251                                                    msgInfoRequestRaw.length);
01252                 ProtocolMsgInfoResponse infoMsg =
01253                     <span class="keyword">new</span> ProtocolMsgInfoResponse(protocolInfo, protocolInfo.length);
01254                 <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p3">log</a>.info(<span class="keyword">this</span>, <span class="stringliteral">"validateTransmitterProtocolVersion"</span>,
01255                          <span class="stringliteral">"Received from "</span> +
01256                          <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p2">connectionConfig</a>.getTransmitterAddress().andPortToString(<a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p2">connectionConfig</a>.getTransmitterVersionPort()) +
01257                          <span class="stringliteral">": "</span> + infoMsg);
01258 
01259                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; infoMsg.info.length; i++) {
01260                     <span class="keywordflow">if</span> (infoMsg.info[i].transportType == desiredTransportType &amp;&amp;
01261                         infoMsg.info[i].protocolVersion == desiredProtocolVersion) {
01262                         overrideTransmitterPort = infoMsg.info[i].portNumber;
01263                         finished = <span class="keyword">true</span>;
01264                     }
01265                 }
01266                 <span class="keywordflow">if</span> (! finished) {
01267                     <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p3">log</a>.warn(<span class="keyword">this</span>, <span class="stringliteral">"validateTransmitterProtocolVersion"</span>,
01268                              <span class="stringliteral">"Desired transport type("</span> + desiredTransportType + <span class="stringliteral">")"</span> +
01269                              <span class="stringliteral">" and protocol version("</span> + desiredProtocolVersion + <span class="stringliteral">")"</span> +
01270                              <span class="stringliteral">" not found in protocolInfo message from transmitter (client)"</span> +
01271                              <span class="stringliteral">" ... using "</span> + overrideTransmitterPort + <span class="stringliteral">" ... received message: "</span> +
01272                              infoMsg);
01273                     finished = <span class="keyword">true</span>; <span class="comment">// No point in trying again: will get same answer.</span>
01274                 }
01275             } <span class="keywordflow">catch</span> (java.io.InterruptedIOException e) {
01276                 <span class="comment">// XXX For JDK 1.4, use SocketTimeoutException</span>
01277                 exception = e;
01278                 <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p3">log</a>.debug(<span class="keyword">this</span>, <span class="stringliteral">"validateTransmitterProtocolVersion"</span>,
01279                           <span class="stringliteral">"I/O interrupted with timeout "</span> +
01280                           <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p2">connectionConfig</a>.getConnectRetryTimeout() + <span class="stringliteral">"msec: "</span> + e +
01281                           <span class="stringliteral">" after reading "</span> + e.bytesTransferred + <span class="stringliteral">" bytes"</span>);
01282             } <span class="keywordflow">catch</span> (java.io.IOException e) {
01283                 exception = e;
01284                 <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p3">log</a>.warn(<span class="keyword">this</span>, <span class="stringliteral">"validateTransmitterProtocolVersion"</span>,
01285                          <span class="stringliteral">"I/O error "</span> +
01286                          <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p2">connectionConfig</a>.getConnectTimeout() + <span class="stringliteral">"msec: "</span> + e);
01287             }
01288         }
01289         <span class="keywordflow">if</span> (exception != null) {
01290             <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p3">log</a>.warn(<span class="keyword">this</span>, <span class="stringliteral">"validateTransmitterProtocolVersion"</span>,
01291                      <span class="stringliteral">"failed with retry timeout="</span> +
01292                      <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p2">connectionConfig</a>.getConnectRetryTimeout() + <span class="stringliteral">"msec, "</span> +
01293                      <span class="stringliteral">"roundtrip timeout="</span> +
01294                      <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p2">connectionConfig</a>.getConnectRoundtripTimeout() + <span class="stringliteral">", and "</span> +
01295                      <span class="stringliteral">"overall timeout="</span> +
01296                      <a class="code" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p2">connectionConfig</a>.getConnectTimeout() + <span class="stringliteral">"msec: "</span> + exception +
01297                      <span class="stringliteral">" ... will use port "</span> + overrideTransmitterPort);
01298         }
01299         <span class="keywordflow">return</span> overrideTransmitterPort;
01300     }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="e0" doxytag="com::xacct::CRANE::collector::ConnectionThread::versionStr"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static String com::xacct::CRANE::collector::ConnectionThread::versionStr           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [inline, static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>Id</b></dt><dd>ConnectionThread.java,v 1.4 2005/01/30 15:13:39 ilyad Exp </dd></dl>

<p>
Reimplemented in <a class="el" href="../../df/d61/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_setup_thread.html#e0">com::xacct::CRANE::collector::ConnectionSetupThread</a>.<div class="fragment"><pre class="fragment">00026 { <span class="keywordflow">return</span> <span class="stringliteral">"@(#) $Id: ConnectionThread.java,v 1.4 2005/01/30 15:13:39 ilyad Exp $"</span>; }
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr><h2>Field Documentation</h2>
<a class="anchor" name="r16" doxytag="com::xacct::CRANE::collector::ConnectionThread::anyDataRecordSeen"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">boolean <a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r16">com::xacct::CRANE::collector::ConnectionThread::anyDataRecordSeen</a> = false<code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p5" doxytag="com::xacct::CRANE::collector::ConnectionThread::cachedLookupSession"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../da/d92/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_session_config.html">SessionConfig</a> <a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p5">com::xacct::CRANE::collector::ConnectionThread::cachedLookupSession</a> = null<code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
It's not clear whether this caching helps or not but it's not a difficult thing to do, so leave it in for now.     </td>
  </tr>
</table>
<a class="anchor" name="p6" doxytag="com::xacct::CRANE::collector::ConnectionThread::cachedLookupSessionId"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int <a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p6">com::xacct::CRANE::collector::ConnectionThread::cachedLookupSessionId</a> = -1<code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
The session ID corresponding to the cached session. <dl compact><dt><b>See also:</b></dt><dd><a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p5">cachedLookupSession</a> </dd></dl>
    </td>
  </tr>
</table>
<a class="anchor" name="r12" doxytag="com::xacct::CRANE::collector::ConnectionThread::cachedLookupTemplate"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../d7/db7/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_template_config.html">TemplateConfig</a> <a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r12">com::xacct::CRANE::collector::ConnectionThread::cachedLookupTemplate</a> = null<code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="r13" doxytag="com::xacct::CRANE::collector::ConnectionThread::cachedLookupTemplateId"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int <a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r13">com::xacct::CRANE::collector::ConnectionThread::cachedLookupTemplateId</a> = -1<code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="r10" doxytag="com::xacct::CRANE::collector::ConnectionThread::cachedLookupTemplateSession"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../da/d92/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_session_config.html">SessionConfig</a> <a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r10">com::xacct::CRANE::collector::ConnectionThread::cachedLookupTemplateSession</a> = null<code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="r11" doxytag="com::xacct::CRANE::collector::ConnectionThread::cachedLookupTemplateSessionId"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int <a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r11">com::xacct::CRANE::collector::ConnectionThread::cachedLookupTemplateSessionId</a> = -1<code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p1" doxytag="com::xacct::CRANE::collector::ConnectionThread::collectorConfig"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/da1/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_collector_config.html">CollectorConfig</a> <a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p1">com::xacct::CRANE::collector::ConnectionThread::collectorConfig</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
The collector configuration. 
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="r21" doxytag="com::xacct::CRANE::collector::ConnectionThread::configId"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">byte <a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r21">com::xacct::CRANE::collector::ConnectionThread::configId</a> = -1<code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p4" doxytag="com::xacct::CRANE::collector::ConnectionThread::connection"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../d2/d4e/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_dynamic.html">ConnectionDynamic</a> <a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p4">com::xacct::CRANE::collector::ConnectionThread::connection</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
The connection. 
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p2" doxytag="com::xacct::CRANE::collector::ConnectionThread::connectionConfig"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../d5/d67/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_config.html">ConnectionConfig</a> <a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p2">com::xacct::CRANE::collector::ConnectionThread::connectionConfig</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
The connection from configuration. 
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="r6" doxytag="com::xacct::CRANE::collector::ConnectionThread::connectionDataConverter"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../d5/d16/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_protocol_data.html">ProtocolData</a> <a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r6">com::xacct::CRANE::collector::ConnectionThread::connectionDataConverter</a><code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="v0" doxytag="com::xacct::CRANE::collector::ConnectionThread::dataAckLogInterval"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int <a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#v0">com::xacct::CRANE::collector::ConnectionThread::dataAckLogInterval</a><code> [static, private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
How often to output data-ack message to log. 
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="r1" doxytag="com::xacct::CRANE::collector::ConnectionThread::exporterBootTime"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">Date <a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r1">com::xacct::CRANE::collector::ConnectionThread::exporterBootTime</a> = null<code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
The "boot time" of the data exporter. 
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p0" doxytag="com::xacct::CRANE::collector::ConnectionThread::isRunning"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">volatile boolean <a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p0">com::xacct::CRANE::collector::ConnectionThread::isRunning</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
A flag for stopping the thread(s) (set by the stop() method). 
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="q0" doxytag="com::xacct::CRANE::collector::ConnectionThread::lastDataSeqNo"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">long <a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#q0">com::xacct::CRANE::collector::ConnectionThread::lastDataSeqNo</a> = -1<code> [package]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="r19" doxytag="com::xacct::CRANE::collector::ConnectionThread::lastDataSeqNoAcked"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">long <a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r19">com::xacct::CRANE::collector::ConnectionThread::lastDataSeqNoAcked</a> = -1<code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p3" doxytag="com::xacct::CRANE::collector::ConnectionThread::log"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../d2/d43/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_log_handler.html">LogHandler</a> <a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#p3">com::xacct::CRANE::collector::ConnectionThread::log</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
The log. 
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="r8" doxytag="com::xacct::CRANE::collector::ConnectionThread::maxSessionId"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int <a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r8">com::xacct::CRANE::collector::ConnectionThread::maxSessionId</a> = Integer.MIN_VALUE<code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Maximum session ID seen so far.     </td>
  </tr>
</table>
<a class="anchor" name="r7" doxytag="com::xacct::CRANE::collector::ConnectionThread::minSessionId"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int <a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r7">com::xacct::CRANE::collector::ConnectionThread::minSessionId</a> = Integer.MAX_VALUE<code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Minimum session ID seen so far.     </td>
  </tr>
</table>
<a class="anchor" name="r17" doxytag="com::xacct::CRANE::collector::ConnectionThread::nextAckTime"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">long <a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r17">com::xacct::CRANE::collector::ConnectionThread::nextAckTime</a> = 0<code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="v1" doxytag="com::xacct::CRANE::collector::ConnectionThread::nextDataAckLogMsgTime"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">long <a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#v1">com::xacct::CRANE::collector::ConnectionThread::nextDataAckLogMsgTime</a> = System.currentTimeMillis()<code> [static, private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
When to output the next data-ack message to log <dl compact><dt><b>See also:</b></dt><dd><a class="el" href="../../d5/d67/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_config.html#r8">ConnectionConfig::dataAckLogInterval</a> </dd></dl>
    </td>
  </tr>
</table>
<a class="anchor" name="r18" doxytag="com::xacct::CRANE::collector::ConnectionThread::nextNoDataKeepAliveTime"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">long <a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r18">com::xacct::CRANE::collector::ConnectionThread::nextNoDataKeepAliveTime</a> = 0<code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="r14" doxytag="com::xacct::CRANE::collector::ConnectionThread::nextRequestId"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int <a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r14">com::xacct::CRANE::collector::ConnectionThread::nextRequestId</a> = (new Random().nextInt()) &amp; 0x7fff<code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Keep track of the next request Id. 
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="r4" doxytag="com::xacct::CRANE::collector::ConnectionThread::nullInput"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">boolean <a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r4">com::xacct::CRANE::collector::ConnectionThread::nullInput</a><code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
A flag for turning of as much input processing as possible (useful for performance testing).     </td>
  </tr>
</table>
<a class="anchor" name="r0" doxytag="com::xacct::CRANE::collector::ConnectionThread::outputter"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../dc/ddd/interfacecom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_collector_outputter.html">CollectorOutputter</a> <a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r0">com::xacct::CRANE::collector::ConnectionThread::outputter</a><code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
The general outputting class. 
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="r2" doxytag="com::xacct::CRANE::collector::ConnectionThread::receiveBufferSize"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int <a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r2">com::xacct::CRANE::collector::ConnectionThread::receiveBufferSize</a><code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Receiver buffer size for the connection. 
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="r20" doxytag="com::xacct::CRANE::collector::ConnectionThread::sessionId"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">byte <a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r20">com::xacct::CRANE::collector::ConnectionThread::sessionId</a> = -1<code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="r5" doxytag="com::xacct::CRANE::collector::ConnectionThread::sessionIdToDataConverter"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">HashMap <a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r5">com::xacct::CRANE::collector::ConnectionThread::sessionIdToDataConverter</a><code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Map a session id to the data converter (big/little endian). The <a class="el" href="../../d4/d73/namespacecom_1_1xacct_1_1_c_r_a_n_e.html">CRANE</a> protocol specifies that the big/little endian decision is made on a per-session basis; but in practice it'll be on a per-connection basis. So, we keep a <a class="el" href="../../d5/d16/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_protocol_data.html">connectionDataConverter</a> around; it'll be set to null if there are no data converters or if we need to actually map by session id.     </td>
  </tr>
</table>
<a class="anchor" name="r9" doxytag="com::xacct::CRANE::collector::ConnectionThread::sessionLookup"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../da/d92/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_session_config.html">SessionConfig</a> [] <a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r9">com::xacct::CRANE::collector::ConnectionThread::sessionLookup</a> = null<code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Valid session IDs (offset by minSessionID).     </td>
  </tr>
</table>
<a class="anchor" name="r3" doxytag="com::xacct::CRANE::collector::ConnectionThread::staticFields"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">ArrayList <a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r3">com::xacct::CRANE::collector::ConnectionThread::staticFields</a><code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="r15" doxytag="com::xacct::CRANE::collector::ConnectionThread::syncNextRequestId"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">Object <a class="el" href="../../d1/d31/classcom_1_1xacct_1_1_c_r_a_n_e_1_1collector_1_1_connection_thread.html#r15">com::xacct::CRANE::collector::ConnectionThread::syncNextRequestId</a> = new Object()<code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
An object for synchronizing increment of request id. 
<p>
    </td>
  </tr>
</table>
<hr>The documentation for this class was generated from the following file:<ul>
<li>ipdr/Collector/com/xacct/CRANE/collector/<a class="el" href="../../d6/d17/com_2xacct_2_c_r_a_n_e_2collector_2_connection_thread_8java.html">ConnectionThread.java</a></ul>
<hr size="1"><address style="align: right;"><small>Generated on Mon Apr 25 09:26:44 2005 for IPDRAPI by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.2 </small></address>
</body>
</html>
