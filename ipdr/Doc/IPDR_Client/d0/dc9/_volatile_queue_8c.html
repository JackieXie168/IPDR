<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>IPDRAPI: For Doxygen/src/Exporter/VolatileQueue.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.2 -->
<div class="qindex"><a class="qindex" href="../../index.html">Main&nbsp;Page</a> | <a class="qindex" href="../../modules.html">Modules</a> | <a class="qindex" href="../../namespaces.html">Namespace List</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="../../dirs.html">Directories</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="../../globals.html">Globals</a></div>
<div class="nav">
<a class="el" href="../../dir_000000.html">For Doxygen</a>&nbsp;/&nbsp;<a class="el" href="../../dir_000003.html">src</a>&nbsp;/&nbsp;<a class="el" href="../../dir_000006.html">Exporter</a></div>
<h1>VolatileQueue.c File Reference</h1><code>#include &lt;<a class="el" href="../../d4/d71/_config_8h.html">IPDR/Config.h</a>&gt;</code><br>
<code>#include &lt;<a class="el" href="../../d7/d98/_volatile_queue_8h.html">Exporter/VolatileQueue.h</a>&gt;</code><br>
<code>#include &lt;stdio.h&gt;</code><br>
<code>#include &lt;<a class="el" href="../../d0/dc0/_exporter_msgs_8h.html">Exporter/ExporterMsgs.h</a>&gt;</code><br>
<code>#include &lt;<a class="el" href="../../db/d1e/_protocol_8h.html">Common/Protocol.h</a>&gt;</code><br>
<code>#include &lt;<a class="el" href="../../de/d8f/_configuration_names_8h.html">Common/ConfigurationNames.h</a>&gt;</code><br>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/dc9/_volatile_queue_8c.html#a2">VolatileQueue_Initialize</a> (<a class="el" href="../../dd/dc5/struct_i_p_d_r__tag___platform.html">IPDR_PlatformServices</a> *PS, <a class="el" href="../../dc/d30/struct_i_p_d_r__tag___log.html">Log</a> *L, <a class="el" href="../../df/d84/struct_parameters_handler.html">ParametersHandler</a> *ParamsHandler, <a class="el" href="../../d4/d66/struct_volatile_queue.html">VolatileQueue</a> *VQ)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/dc9/_volatile_queue_8c.html#a3">VolatileQueue_Destroy</a> (<a class="el" href="../../d4/d66/struct_volatile_queue.html">VolatileQueue</a> *VQ)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/dc9/_volatile_queue_8c.html#a4">VolatileQueue_PushRecord</a> (<a class="el" href="../../d4/d66/struct_volatile_queue.html">VolatileQueue</a> *VQ, <a class="el" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html">BufferHandle</a> *B)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/dc9/_volatile_queue_8c.html#a5">VolatileQueue_PeekRecord</a> (<a class="el" href="../../d4/d66/struct_volatile_queue.html">VolatileQueue</a> *VQ, <a class="el" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html">BufferHandle</a> *B)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/dc9/_volatile_queue_8c.html#a6">VolatileQueue_RemoveRecords_All</a> (<a class="el" href="../../d4/d66/struct_volatile_queue.html">VolatileQueue</a> *VQ, unsigned int *RemovedRecords)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/dc9/_volatile_queue_8c.html#a7">VolatileQueue_RemoveRecords</a> (<a class="el" href="../../d4/d66/struct_volatile_queue.html">VolatileQueue</a> *VQ, <a class="el" href="../../df/dd7/group___i_p_d_r__event__notification.html#ga0">IPDR_DSN_TYPE</a> DSN, unsigned int *RemovedRecords)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/dc9/_volatile_queue_8c.html#a8">VolatileQueue_Rollback</a> (<a class="el" href="../../d4/d66/struct_volatile_queue.html">VolatileQueue</a> *VQ)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/dc9/_volatile_queue_8c.html#a9">VolatileQueue_GetOutstandingRecordsCount</a> (<a class="el" href="../../d4/d66/struct_volatile_queue.html">VolatileQueue</a> *VQ)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/dc9/_volatile_queue_8c.html#a10">VolatileQueue_ReleaseRecord</a> (<a class="el" href="../../d4/d66/struct_volatile_queue.html">VolatileQueue</a> *VQ, <a class="el" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html">BufferHandle</a> *B, unsigned int Size)</td></tr>

<tr><td colspan="2"><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">const char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/dc9/_volatile_queue_8c.html#a0">VolatileQueue_rcsid</a> [] = "@(#) $Id: VolatileQueue.c,v 1.16 2005/04/21 11:30:21 dmitryk Exp $" IPDR_COPYRIGHT_STR</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">const char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/dc9/_volatile_queue_8c.html#a1">VolatileQueue_h_rcsid</a> [] = VOLATILE_QUEUE_H_RCSID</td></tr>

</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
Implementation of a volatile queue.<p>
Copyright (2005) Â© Amdocs, All Rights Reserved<p>
This software is distributed on an "AS IS" basis, WITHOUT WARRANTY OF ANY KIND either expresses or implied.<p>
<dl compact><dt><b>Id</b></dt><dd><a class="el" href="../../d0/dc9/_volatile_queue_8c.html">VolatileQueue.c</a>,v 1.16 2005/04/21 11:30:21 dmitryk Exp </dd></dl>
<p>
The volatile queue is used to store unacknowledged records in memory. The queue supports the following operations:<p>
<ul>
<li>
<a class="el" href="../../d7/d98/_volatile_queue_8h.html#a4">VolatileQueue_AllocateRecord()</a> - allocates memory for a record within the queue </li>
<li>
<a class="el" href="../../d0/dc9/_volatile_queue_8c.html#a4">VolatileQueue_PushRecord()</a> - adds a record to the queue. </li>
<li>
<a class="el" href="../../d0/dc9/_volatile_queue_8c.html#a5">VolatileQueue_PeekRecord()</a> - get the next record from the queue, without removing it. </li>
<li>
<a class="el" href="../../d0/dc9/_volatile_queue_8c.html#a7">VolatileQueue_RemoveRecords()</a> - removes records from the queue. </li>
<li>
<a class="el" href="../../d0/dc9/_volatile_queue_8c.html#a8">VolatileQueue_Rollback()</a> - sets the peek position to the head of the queue. </li>
</ul>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a3" doxytag="VolatileQueue.c::VolatileQueue_Destroy"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a> VolatileQueue_Destroy           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d4/d66/struct_volatile_queue.html">VolatileQueue</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>VQ</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Delete a volaile queue.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>VQ</em>&nbsp;</td><td>queue to delete</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga15a174">IPDR_OK</a> on success; <a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga15">IPDR_STATUS_RETURN_CODE</a> otherwise. </dd></dl>
<div class="fragment"><pre class="fragment">00095 {
00096     <span class="keywordflow">return</span> <a class="code" href="../../d8/d51/_chunks_manager_8c.html#a18">ChunksManager_Destroy</a>(&amp; (VQ-&gt;<a class="code" href="../../d4/d66/struct_volatile_queue.html#o0">ChunksMgr</a>));
00097 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="VolatileQueue.c::VolatileQueue_GetOutstandingRecordsCount"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int VolatileQueue_GetOutstandingRecordsCount           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d4/d66/struct_volatile_queue.html">VolatileQueue</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>VQ</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Get the number of outstanding records (unacknowledged records).<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>VQ</em>&nbsp;</td><td>queue to rollback</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>Number of outstanding records </dd></dl>
<div class="fragment"><pre class="fragment">00360 {
00361     <span class="keywordflow">return</span> VQ-&gt;<a class="code" href="../../d4/d66/struct_volatile_queue.html#o5">OutstandingRecords</a>;
00362 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="VolatileQueue.c::VolatileQueue_Initialize"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a> VolatileQueue_Initialize           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../dd/dc5/struct_i_p_d_r__tag___platform.html">IPDR_PlatformServices</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>PS</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../dc/d30/struct_i_p_d_r__tag___log.html">Log</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>L</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../df/d84/struct_parameters_handler.html">ParametersHandler</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>ParamsHandler</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d4/d66/struct_volatile_queue.html">VolatileQueue</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>VQ</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Initialize a new volatile queue.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>PS</em>&nbsp;</td><td>platform services </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>L</em>&nbsp;</td><td>logger </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ParamsHandler</em>&nbsp;</td><td>handler for getting parameters </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>VQ</em>&nbsp;</td><td>queue to initialize</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga15a174">IPDR_OK</a> on success; <a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga15">IPDR_STATUS_RETURN_CODE</a> otherwise. </dd></dl>
<div class="fragment"><pre class="fragment">00056 {
00057     <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a> Status;
00058     <a class="code" href="../../db/d5a/struct_chunk_allocator.html">ChunkAllocator</a> Alloc;
00059 
00060     VQ-&gt;<a class="code" href="../../d4/d66/struct_volatile_queue.html#o1">Logger</a> = L;
00061 
00062     <a class="code" href="../../d8/d51/_chunks_manager_8c.html#a15">ChunksManager_GetDefaultChunkAllocator</a>(PS, &amp; Alloc);
00063     Status = <a class="code" href="../../d8/d51/_chunks_manager_8c.html#a16">ChunksManager_Initialize</a>(0,
00064                                       0,
00065                                       0,
00066                                       0,
00067                                       <a class="code" href="../../de/d8f/_configuration_names_8h.html#a187">STR_configuration_queueChunkSize</a>,
00068                                       <a class="code" href="../../de/d8f/_configuration_names_8h.html#a188">STR_configuration_queueInitialNumChunks</a>,
00069                                       <a class="code" href="../../de/d8f/_configuration_names_8h.html#a189">STR_configuration_queueMaxMemory</a>,
00070                                       ParamsHandler,
00071                                       Alloc,
00072                                       L,
00073                                       &amp; (VQ-&gt;<a class="code" href="../../d4/d66/struct_volatile_queue.html#o0">ChunksMgr</a>));
00074     <span class="keywordflow">if</span> (<a class="code" href="../../da/d39/_i_p_d_r_8h.html#a18">FAILURE</a>(Status))
00075         <span class="keywordflow">return</span> Status;
00076 
00077     <a class="code" href="../../db/d10/_chunks_manager_8h.html#a4">INIT_BUFFER_HANDLE</a>(VQ-&gt;<a class="code" href="../../d4/d66/struct_volatile_queue.html#o2">PeekPosition</a>);
00078 
00079     VQ-&gt;<a class="code" href="../../d4/d66/struct_volatile_queue.html#o4">QueueSize</a> = 0;
00080     VQ-&gt;<a class="code" href="../../d4/d66/struct_volatile_queue.html#o3">PeekStarted</a> = <a class="code" href="../../df/dde/_defs_8h.html#a4">IPDR_FALSE</a>;
00081     VQ-&gt;<a class="code" href="../../d4/d66/struct_volatile_queue.html#o5">OutstandingRecords</a> = 0;
00082 
00083     <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga15a174">IPDR_OK</a>;
00084 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="VolatileQueue.c::VolatileQueue_PeekRecord"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a> VolatileQueue_PeekRecord           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d4/d66/struct_volatile_queue.html">VolatileQueue</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>VQ</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html">BufferHandle</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>B</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Get a record from the queue. Note the side-effect in here of setting PeekStarted, so that a push adjust the peek position; and RemoveRecords resets the peek.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>VQ</em>&nbsp;</td><td>queue to get record from </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>B</em>&nbsp;</td><td>peeked record (output)</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga15a174">IPDR_OK</a> on success; <a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga15">IPDR_STATUS_RETURN_CODE</a> otherwise. </dd></dl>
<div class="fragment"><pre class="fragment">00152 {
00153     <span class="keywordflow">if</span> (<a class="code" href="../../db/d10/_chunks_manager_8h.html#a2">BUFFER_IS_NULL</a>(VQ-&gt;<a class="code" href="../../d4/d66/struct_volatile_queue.html#o2">PeekPosition</a>)) {
00154         <span class="keywordflow">if</span> (! VQ-&gt;<a class="code" href="../../d4/d66/struct_volatile_queue.html#o3">PeekStarted</a>) {
00155             <a class="code" href="../../d8/d51/_chunks_manager_8c.html#a32">ChunksManager_GetFirstBuffer</a>(&amp; (VQ-&gt;<a class="code" href="../../d4/d66/struct_volatile_queue.html#o0">ChunksMgr</a>), B);
00156             <span class="keywordflow">if</span> (! <a class="code" href="../../db/d10/_chunks_manager_8h.html#a2">BUFFER_IS_NULL</a>(*B)) {
00157                 <a class="code" href="../../d8/d51/_chunks_manager_8c.html#a28">ChunksManager_GetNextMessage</a>(B, &amp; (VQ-&gt;<a class="code" href="../../d4/d66/struct_volatile_queue.html#o2">PeekPosition</a>));
00158                 VQ-&gt;<a class="code" href="../../d4/d66/struct_volatile_queue.html#o5">OutstandingRecords</a>++;
00159             }
00160         } <span class="keywordflow">else</span> {
00161             <a class="code" href="../../db/d10/_chunks_manager_8h.html#a4">INIT_BUFFER_HANDLE</a>(*B);
00162         }
00163         VQ-&gt;<a class="code" href="../../d4/d66/struct_volatile_queue.html#o3">PeekStarted</a> = <a class="code" href="../../df/dde/_defs_8h.html#a5">IPDR_TRUE</a>;
00164         <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga15a174">IPDR_OK</a>;
00165     }
00166 
00167     *B = VQ-&gt;<a class="code" href="../../d4/d66/struct_volatile_queue.html#o2">PeekPosition</a>;
00168     VQ-&gt;<a class="code" href="../../d4/d66/struct_volatile_queue.html#o5">OutstandingRecords</a>++;
00169     <a class="code" href="../../d8/d51/_chunks_manager_8c.html#a28">ChunksManager_GetNextMessage</a>(&amp; (VQ-&gt;<a class="code" href="../../d4/d66/struct_volatile_queue.html#o2">PeekPosition</a>), &amp; (VQ-&gt;<a class="code" href="../../d4/d66/struct_volatile_queue.html#o2">PeekPosition</a>));
00170     VQ-&gt;<a class="code" href="../../d4/d66/struct_volatile_queue.html#o3">PeekStarted</a> = <a class="code" href="../../df/dde/_defs_8h.html#a5">IPDR_TRUE</a>;
00171 
00172     <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga15a174">IPDR_OK</a>;
00173 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="VolatileQueue.c::VolatileQueue_PushRecord"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a> VolatileQueue_PushRecord           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d4/d66/struct_volatile_queue.html">VolatileQueue</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>VQ</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html">BufferHandle</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>B</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Push a record to the queue.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>VQ</em>&nbsp;</td><td>queue to add record to </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>B</em>&nbsp;</td><td>record to push</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga15a174">IPDR_OK</a> on success; <a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga15">IPDR_STATUS_RETURN_CODE</a> otherwise. </dd></dl>
<div class="fragment"><pre class="fragment">00131 {
00132     <span class="keywordflow">if</span> (VQ-&gt;<a class="code" href="../../d4/d66/struct_volatile_queue.html#o3">PeekStarted</a> &amp;&amp; <a class="code" href="../../db/d10/_chunks_manager_8h.html#a2">BUFFER_IS_NULL</a>(VQ-&gt;<a class="code" href="../../d4/d66/struct_volatile_queue.html#o2">PeekPosition</a>))
00133         VQ-&gt;<a class="code" href="../../d4/d66/struct_volatile_queue.html#o2">PeekPosition</a> = *B;
00134     VQ-&gt;<a class="code" href="../../d4/d66/struct_volatile_queue.html#o4">QueueSize</a>++;
00135 
00136     <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga15a174">IPDR_OK</a>;
00137 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="VolatileQueue.c::VolatileQueue_ReleaseRecord"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a> VolatileQueue_ReleaseRecord           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d4/d66/struct_volatile_queue.html">VolatileQueue</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>VQ</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html">BufferHandle</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>B</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>unsigned int&nbsp;</td>
          <td class="mdname" nowrap> <em>Size</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Free the last record allocated on the queue.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>VQ</em>&nbsp;</td><td>queue to rollback </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>B</em>&nbsp;</td><td>allocated record </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Size</em>&nbsp;</td><td>record size</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga15a174">IPDR_OK</a> on success; <a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga15">IPDR_STATUS_RETURN_CODE</a> otherwise. </dd></dl>
<div class="fragment"><pre class="fragment">00387 {
00388     <span class="keywordflow">return</span> <a class="code" href="../../d8/d51/_chunks_manager_8c.html#a24">ChunksManager_ReleaseBuffer</a>(B, Size);
00389 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="VolatileQueue.c::VolatileQueue_RemoveRecords"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a> VolatileQueue_RemoveRecords           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d4/d66/struct_volatile_queue.html">VolatileQueue</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>VQ</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="../../df/dd7/group___i_p_d_r__event__notification.html#ga0">IPDR_DSN_TYPE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>DSN</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>unsigned int *&nbsp;</td>
          <td class="mdname" nowrap> <em>RemovedRecords</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Remove records with a smaller DSN then the one specified (Actually older ones, because we have to worry about wrap-around). Also resets whether we're peeking.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>VQ</em>&nbsp;</td><td>queue to get record from </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>DSN</em>&nbsp;</td><td>sequence number up to which to remove </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>RemovedRecords</em>&nbsp;</td><td>number of removed records (output)</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga15a174">IPDR_OK</a> on success; <a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga15">IPDR_STATUS_RETURN_CODE</a> otherwise. </dd></dl>
<div class="fragment"><pre class="fragment">00241 {
00242     DataMessage *Header;
00243     <a class="code" href="../../df/dd7/group___i_p_d_r__event__notification.html#ga0">IPDR_DSN_TYPE</a> CurrentDSN;
00244     <a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html">BufferHandle</a> BH;
00245 
00246     *RemovedRecords = 0;
00247 
00248     <span class="keywordflow">if</span> (<a class="code" href="../../db/d1e/_protocol_8h.html#a3">IPDR_INVALID_DSN</a>(DSN)) {
00249         <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga15a174">IPDR_OK</a>;
00250     }
00251 
00252     <span class="keywordflow">if</span> <a class="code" href="../../da/df4/_log_8h.html#a15">Log_ShouldWrite</a>(VQ-&gt;<a class="code" href="../../d4/d66/struct_volatile_queue.html#o1">Logger</a>, <a class="code" href="../../d0/dc0/_exporter_msgs_8h.html#a2">QUEUE_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga6a172">IPDR_LEVEL_DEBUG</a>) {
00253         <a class="code" href="../../d8/d51/_chunks_manager_8c.html#a37">ChunksManager_Dump</a>(&amp;VQ-&gt;<a class="code" href="../../d4/d66/struct_volatile_queue.html#o0">ChunksMgr</a>, <span class="stringliteral">" +++ VolatileQueue_RemoveRecords +++"</span>);
00254     }
00255 
00256     <a class="code" href="../../d8/d51/_chunks_manager_8c.html#a32">ChunksManager_GetFirstBuffer</a>(&amp; (VQ-&gt;<a class="code" href="../../d4/d66/struct_volatile_queue.html#o0">ChunksMgr</a>), &amp; BH);
00257 
00258     <span class="keywordflow">while</span> (! <a class="code" href="../../db/d10/_chunks_manager_8h.html#a2">BUFFER_IS_NULL</a>(BH)) {
00259         <span class="keyword">enum</span> <a class="code" href="../../db/d1e/_protocol_8h.html#a56">IPDR_compareDSN_t</a> comparison;
00260         Header = (DataMessage *) BH.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a>;
00261                 CurrentDSN = <a class="code" href="../../df/dde/_defs_8h.html#a13">IPDR_NTOHLL</a>(Header-&gt;sequenceNum);
00262 
00263         <span class="comment">/* Exit if the current dsn is larger then the acknowledged DSN,</span>
00264 <span class="comment">           handled in a modulo 2^31 fashion. */</span>
00265 
00266         comparison = <a class="code" href="../../d5/db5/_common_util_8c.html#a4">compareDSN</a>(CurrentDSN, DSN);
00267 
00268         <span class="keywordflow">if</span>(<a class="code" href="../../da/df4/_log_8h.html#a15">Log_ShouldWrite</a>(VQ-&gt;<a class="code" href="../../d4/d66/struct_volatile_queue.html#o1">Logger</a>, <a class="code" href="../../d0/dc0/_exporter_msgs_8h.html#a2">QUEUE_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga6a172">IPDR_LEVEL_DEBUG</a>)) {
00269             <span class="keyword">const</span> <span class="keywordtype">char</span> *comp;
00270             <span class="keywordflow">switch</span> (comparison) {
00271             <span class="keywordflow">case</span> <a class="code" href="../../db/d1e/_protocol_8h.html#a56a40">IPDR_compareDSN_less</a>:    comp = <span class="stringliteral">"&lt;"</span>; <span class="keywordflow">break</span>;
00272             <span class="keywordflow">case</span> <a class="code" href="../../db/d1e/_protocol_8h.html#a56a41">IPDR_compareDSN_equal</a>:   comp = <span class="stringliteral">"="</span>; <span class="keywordflow">break</span>;
00273             <span class="keywordflow">case</span> <a class="code" href="../../db/d1e/_protocol_8h.html#a56a42">IPDR_compareDSN_greater</a>: comp = <span class="stringliteral">"&gt;"</span>; <span class="keywordflow">break</span>;
00274             <span class="keywordflow">case</span> <a class="code" href="../../db/d1e/_protocol_8h.html#a56a43">IPDR_compareDSN_unknown</a>: comp = <span class="stringliteral">"?"</span>; <span class="keywordflow">break</span>;
00275             <span class="keywordflow">default</span>:                       comp = <span class="stringliteral">"-"</span>; <span class="keywordflow">break</span>;
00276             }
00277             <a class="code" href="../../da/df4/_log_8h.html#a22">Log_OutputStr6</a>(VQ-&gt;<a class="code" href="../../d4/d66/struct_volatile_queue.html#o1">Logger</a>, <a class="code" href="../../d0/dc0/_exporter_msgs_8h.html#a2">QUEUE_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga6a172">IPDR_LEVEL_DEBUG</a>, <span class="stringliteral">"VolatileQueue_RemoveRecords"</span>,
00278                            <span class="stringliteral">"currentDSN(%llu) %.20s DSN(%llu) peekStarted=%d BH.Data=0x%p PeekPosition.Data=0x%p"</span>,
00279                            CurrentDSN, comp, DSN, VQ-&gt;<a class="code" href="../../d4/d66/struct_volatile_queue.html#o3">PeekStarted</a>, BH.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a>, VQ-&gt;<a class="code" href="../../d4/d66/struct_volatile_queue.html#o2">PeekPosition</a>.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a>);
00280         }
00281 
00282         <span class="comment">/* XXX We could put in a sanity test here, verifying that if</span>
00283 <span class="comment">           CurrentDSN &gt; DSN, then CurrentDSN == DSN+1.  If this fails,</span>
00284 <span class="comment">           it indicates the server is very confused ...  we can't do</span>
00285 <span class="comment">           much with it, except log the fact. */</span>
00286 
00287         <span class="keywordflow">if</span> (comparison == <a class="code" href="../../db/d1e/_protocol_8h.html#a56a42">IPDR_compareDSN_greater</a>) {
00288             <span class="keywordflow">break</span>;
00289         }
00290 
00291         <span class="keywordflow">if</span> (comparison == <a class="code" href="../../db/d1e/_protocol_8h.html#a56a43">IPDR_compareDSN_unknown</a>) {
00292             <span class="comment">/* XXX should signal error event */</span>
00293             <a class="code" href="../../da/df4/_log_8h.html#a31">Log_Write3</a>(VQ-&gt;<a class="code" href="../../d4/d66/struct_volatile_queue.html#o1">Logger</a>, <a class="code" href="../../d0/dc0/_exporter_msgs_8h.html#a2">QUEUE_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga6a169">IPDR_LEVEL_ERROR</a>,
00294                        <span class="stringliteral">"VolatileQueue_RemoveRecords"</span>, <a class="code" href="../../d0/dc0/_exporter_msgs_8h.html#a8">MSG_QUEUE_WILD_REMOVE_RECORDS</a>,
00295                        DSN, CurrentDSN, VQ-&gt;<a class="code" href="../../d4/d66/struct_volatile_queue.html#o4">QueueSize</a>);
00296             <span class="keywordflow">break</span>;
00297         }
00298 
00299         <span class="keywordflow">if</span> (BH.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a> == VQ-&gt;<a class="code" href="../../d4/d66/struct_volatile_queue.html#o2">PeekPosition</a>.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a>) {
00300             <span class="keywordflow">if</span> <a class="code" href="../../da/df4/_log_8h.html#a15">Log_ShouldWrite</a>(VQ-&gt;<a class="code" href="../../d4/d66/struct_volatile_queue.html#o1">Logger</a>, <a class="code" href="../../d0/dc0/_exporter_msgs_8h.html#a2">QUEUE_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga6a172">IPDR_LEVEL_DEBUG</a>) {
00301                 <a class="code" href="../../da/df4/_log_8h.html#a16">Log_OutputStr</a>(VQ-&gt;<a class="code" href="../../d4/d66/struct_volatile_queue.html#o1">Logger</a>, <a class="code" href="../../d0/dc0/_exporter_msgs_8h.html#a2">QUEUE_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga6a172">IPDR_LEVEL_DEBUG</a>, <span class="stringliteral">"VolatileQueue_RemoveRecords"</span>,
00302                               <span class="stringliteral">"BH.Data == VQ-&gt;PeedkPosition.Data"</span>);
00303             }
00304             <a class="code" href="../../db/d10/_chunks_manager_8h.html#a4">INIT_BUFFER_HANDLE</a>(VQ-&gt;<a class="code" href="../../d4/d66/struct_volatile_queue.html#o2">PeekPosition</a>);
00305             VQ-&gt;<a class="code" href="../../d4/d66/struct_volatile_queue.html#o3">PeekStarted</a> = <a class="code" href="../../df/dde/_defs_8h.html#a4">IPDR_FALSE</a>;
00306         }
00307 
00308         <a class="code" href="../../d8/d51/_chunks_manager_8c.html#a29">ChunksManager_ReleaseAndGetNextMessage</a>(&amp; BH);
00309 
00310         VQ-&gt;<a class="code" href="../../d4/d66/struct_volatile_queue.html#o4">QueueSize</a>--;
00311         VQ-&gt;<a class="code" href="../../d4/d66/struct_volatile_queue.html#o5">OutstandingRecords</a>--;
00312 
00313         (*RemovedRecords)++;
00314     }
00315 
00316     <a class="code" href="../../da/df4/_log_8h.html#a20">Log_OutputStr4</a>(VQ-&gt;<a class="code" href="../../d4/d66/struct_volatile_queue.html#o1">Logger</a>, <a class="code" href="../../d0/dc0/_exporter_msgs_8h.html#a2">QUEUE_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga6a172">IPDR_LEVEL_DEBUG</a>, <span class="stringliteral">"VolatileQueue_RemoveRecords"</span>,
00317                    <span class="stringliteral">"after: DSN(%llu) peekStarted=%d BH.Data=0x%p PeekPosition.Data=0x%p"</span>,
00318                    DSN, VQ-&gt;<a class="code" href="../../d4/d66/struct_volatile_queue.html#o3">PeekStarted</a>, BH.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a>, VQ-&gt;<a class="code" href="../../d4/d66/struct_volatile_queue.html#o2">PeekPosition</a>.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a>);
00319 
00320     <a class="code" href="../../da/df4/_log_8h.html#a32">Log_Write4</a>(VQ-&gt;<a class="code" href="../../d4/d66/struct_volatile_queue.html#o1">Logger</a>, <a class="code" href="../../d0/dc0/_exporter_msgs_8h.html#a2">QUEUE_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga6a172">IPDR_LEVEL_DEBUG</a>,
00321                <span class="stringliteral">"VolatileQueue_RemoveRecords"</span>, <a class="code" href="../../d0/dc0/_exporter_msgs_8h.html#a7">MSG_QUEUE_REMOVE_RECORDS</a>,
00322                DSN, VQ-&gt;<a class="code" href="../../d4/d66/struct_volatile_queue.html#o4">QueueSize</a>, VQ-&gt;<a class="code" href="../../d4/d66/struct_volatile_queue.html#o5">OutstandingRecords</a>, *RemovedRecords);
00323 
00324     <span class="keywordflow">if</span> <a class="code" href="../../da/df4/_log_8h.html#a15">Log_ShouldWrite</a>(VQ-&gt;<a class="code" href="../../d4/d66/struct_volatile_queue.html#o1">Logger</a>, <a class="code" href="../../d0/dc0/_exporter_msgs_8h.html#a2">QUEUE_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga6a172">IPDR_LEVEL_DEBUG</a>) {
00325         <a class="code" href="../../d8/d51/_chunks_manager_8c.html#a37">ChunksManager_Dump</a>(&amp;VQ-&gt;<a class="code" href="../../d4/d66/struct_volatile_queue.html#o0">ChunksMgr</a>, <span class="stringliteral">" +++ VolatileQueue_RemoveRecords (after) +++"</span>);
00326     }
00327 
00328     <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga15a174">IPDR_OK</a>;
00329 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="VolatileQueue.c::VolatileQueue_RemoveRecords_All"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a> VolatileQueue_RemoveRecords_All           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d4/d66/struct_volatile_queue.html">VolatileQueue</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>VQ</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>unsigned int *&nbsp;</td>
          <td class="mdname" nowrap> <em>RemovedRecords</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00178 {
00179     DataMessage *Header;
00180     <a class="code" href="../../df/dd7/group___i_p_d_r__event__notification.html#ga0">IPDR_DSN_TYPE</a> LastDSN;
00181     <a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html">BufferHandle</a> BH;
00182 
00183     *RemovedRecords = 0;
00184 
00185     <span class="keywordflow">if</span> <a class="code" href="../../da/df4/_log_8h.html#a15">Log_ShouldWrite</a>(VQ-&gt;<a class="code" href="../../d4/d66/struct_volatile_queue.html#o1">Logger</a>, <a class="code" href="../../d0/dc0/_exporter_msgs_8h.html#a2">QUEUE_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga6a172">IPDR_LEVEL_DEBUG</a>) {
00186         <a class="code" href="../../d8/d51/_chunks_manager_8c.html#a37">ChunksManager_Dump</a>(&amp;VQ-&gt;<a class="code" href="../../d4/d66/struct_volatile_queue.html#o0">ChunksMgr</a>, <span class="stringliteral">" +++ VolatileQueue_RemoveRecords_All +++"</span>);
00187     }
00188 
00189     <a class="code" href="../../d8/d51/_chunks_manager_8c.html#a32">ChunksManager_GetFirstBuffer</a>(&amp; (VQ-&gt;<a class="code" href="../../d4/d66/struct_volatile_queue.html#o0">ChunksMgr</a>), &amp; BH);
00190 
00191     <span class="keywordflow">while</span> (! <a class="code" href="../../db/d10/_chunks_manager_8h.html#a2">BUFFER_IS_NULL</a>(BH)) {
00192                 Header = (DataMessage *) BH.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a>;
00193                 LastDSN = <a class="code" href="../../df/dde/_defs_8h.html#a13">IPDR_NTOHLL</a>(Header-&gt;sequenceNum);
00194 
00195 
00196         <span class="keywordflow">if</span> (BH.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a> == VQ-&gt;<a class="code" href="../../d4/d66/struct_volatile_queue.html#o2">PeekPosition</a>.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a>) {
00197             <span class="keywordflow">if</span> <a class="code" href="../../da/df4/_log_8h.html#a15">Log_ShouldWrite</a>(VQ-&gt;<a class="code" href="../../d4/d66/struct_volatile_queue.html#o1">Logger</a>, <a class="code" href="../../d0/dc0/_exporter_msgs_8h.html#a2">QUEUE_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga6a172">IPDR_LEVEL_DEBUG</a>) {
00198                 <a class="code" href="../../da/df4/_log_8h.html#a16">Log_OutputStr</a>(VQ-&gt;<a class="code" href="../../d4/d66/struct_volatile_queue.html#o1">Logger</a>, <a class="code" href="../../d0/dc0/_exporter_msgs_8h.html#a2">QUEUE_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga6a172">IPDR_LEVEL_DEBUG</a>, <span class="stringliteral">"VolatileQueue_RemoveRecords_All"</span>,
00199                               <span class="stringliteral">"BH.Data == VQ-&gt;PeedkPosition.Data"</span>);
00200             }
00201             <a class="code" href="../../db/d10/_chunks_manager_8h.html#a4">INIT_BUFFER_HANDLE</a>(VQ-&gt;<a class="code" href="../../d4/d66/struct_volatile_queue.html#o2">PeekPosition</a>);
00202             VQ-&gt;<a class="code" href="../../d4/d66/struct_volatile_queue.html#o3">PeekStarted</a> = <a class="code" href="../../df/dde/_defs_8h.html#a4">IPDR_FALSE</a>;
00203         }
00204 
00205         <a class="code" href="../../d8/d51/_chunks_manager_8c.html#a29">ChunksManager_ReleaseAndGetNextMessage</a>(&amp; BH);
00206 
00207         VQ-&gt;<a class="code" href="../../d4/d66/struct_volatile_queue.html#o4">QueueSize</a>--;
00208         VQ-&gt;<a class="code" href="../../d4/d66/struct_volatile_queue.html#o5">OutstandingRecords</a>--;
00209 
00210         (*RemovedRecords)++;
00211         }
00212     <a class="code" href="../../da/df4/_log_8h.html#a20">Log_OutputStr4</a>(VQ-&gt;<a class="code" href="../../d4/d66/struct_volatile_queue.html#o1">Logger</a>, <a class="code" href="../../d0/dc0/_exporter_msgs_8h.html#a2">QUEUE_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga6a172">IPDR_LEVEL_DEBUG</a>, <span class="stringliteral">"VolatileQueue_RemoveRecords_All"</span>,
00213                    <span class="stringliteral">"after: DSN(%llu) peekStarted=%d BH.Data=0x%p PeekPosition.Data=0x%p"</span>,
00214                    LastDSN, VQ-&gt;<a class="code" href="../../d4/d66/struct_volatile_queue.html#o3">PeekStarted</a>, BH.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a>, VQ-&gt;<a class="code" href="../../d4/d66/struct_volatile_queue.html#o2">PeekPosition</a>.<a class="code" href="../../d5/d08/struct_i_p_d_r__tag___buffer_handle.html#o1">Data</a>);
00215 
00216     <a class="code" href="../../da/df4/_log_8h.html#a32">Log_Write4</a>(VQ-&gt;<a class="code" href="../../d4/d66/struct_volatile_queue.html#o1">Logger</a>, <a class="code" href="../../d0/dc0/_exporter_msgs_8h.html#a2">QUEUE_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga6a172">IPDR_LEVEL_DEBUG</a>,
00217                <span class="stringliteral">"VolatileQueue_RemoveRecords"</span>, <a class="code" href="../../d0/dc0/_exporter_msgs_8h.html#a7">MSG_QUEUE_REMOVE_RECORDS</a>,
00218                LastDSN, VQ-&gt;<a class="code" href="../../d4/d66/struct_volatile_queue.html#o4">QueueSize</a>, VQ-&gt;<a class="code" href="../../d4/d66/struct_volatile_queue.html#o5">OutstandingRecords</a>, *RemovedRecords);
00219 
00220     <span class="keywordflow">if</span> <a class="code" href="../../da/df4/_log_8h.html#a15">Log_ShouldWrite</a>(VQ-&gt;<a class="code" href="../../d4/d66/struct_volatile_queue.html#o1">Logger</a>, <a class="code" href="../../d0/dc0/_exporter_msgs_8h.html#a2">QUEUE_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga6a172">IPDR_LEVEL_DEBUG</a>) {
00221         <a class="code" href="../../d8/d51/_chunks_manager_8c.html#a37">ChunksManager_Dump</a>(&amp;VQ-&gt;<a class="code" href="../../d4/d66/struct_volatile_queue.html#o0">ChunksMgr</a>, <span class="stringliteral">" +++ VolatileQueue_RemoveRecords_All (after) +++"</span>);
00222     }
00223 
00224     <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga15a174">IPDR_OK</a>;
00225 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="VolatileQueue.c::VolatileQueue_Rollback"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga0">IPDR_Status</a> VolatileQueue_Rollback           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d4/d66/struct_volatile_queue.html">VolatileQueue</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>VQ</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Set the peek position to the beginning of the queue.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>VQ</em>&nbsp;</td><td>queue to rollback</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd><a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga15a174">IPDR_OK</a> on success; <a class="el" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#ga15">IPDR_STATUS_RETURN_CODE</a> otherwise. </dd></dl>
<div class="fragment"><pre class="fragment">00340 {
00341     <a class="code" href="../../db/d10/_chunks_manager_8h.html#a4">INIT_BUFFER_HANDLE</a>(VQ-&gt;<a class="code" href="../../d4/d66/struct_volatile_queue.html#o2">PeekPosition</a>);
00342     VQ-&gt;<a class="code" href="../../d4/d66/struct_volatile_queue.html#o5">OutstandingRecords</a> = 0;
00343     VQ-&gt;<a class="code" href="../../d4/d66/struct_volatile_queue.html#o3">PeekStarted</a> = <a class="code" href="../../df/dde/_defs_8h.html#a4">IPDR_FALSE</a>;
00344 
00345     <a class="code" href="../../da/df4/_log_8h.html#a28">Log_Write</a>(VQ-&gt;<a class="code" href="../../d4/d66/struct_volatile_queue.html#o1">Logger</a>, <a class="code" href="../../d0/dc0/_exporter_msgs_8h.html#a2">QUEUE_MODULE_ID</a>, <a class="code" href="../../dc/d9b/group___i_p_d_r__logging.html#gga6a172">IPDR_LEVEL_DEBUG</a>,
00346               <span class="stringliteral">"VolatileQueue_Rollback"</span>, <a class="code" href="../../d0/dc0/_exporter_msgs_8h.html#a6">MSG_QUEUE_ROLLBACK_QUEUE</a>);
00347 
00348     <span class="keywordflow">return</span> <a class="code" href="../../d1/dc2/group___i_p_d_r__general__typedefs.html#gga15a174">IPDR_OK</a>;
00349 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a1" doxytag="VolatileQueue.c::VolatileQueue_h_rcsid"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">const char <a class="el" href="../../d0/dc9/_volatile_queue_8c.html#a1">VolatileQueue_h_rcsid</a>[] = VOLATILE_QUEUE_H_RCSID          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="VolatileQueue.c::VolatileQueue_rcsid"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">const char <a class="el" href="../../d0/dc9/_volatile_queue_8c.html#a0">VolatileQueue_rcsid</a>[] = "@(#) $Id: VolatileQueue.c,v 1.16 2005/04/21 11:30:21 dmitryk Exp $" IPDR_COPYRIGHT_STR          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Mon Apr 25 22:28:23 2005 for IPDRAPI by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.2 </small></address>
</body>
</html>
