<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Details of the protocol&apos;s implementation: acknowledgment, fail-over and fail-back</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.2 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>Details of the protocol's implementation: acknowledgment, fail-over and fail-back<br>
<small>
[<a class="el" href="group___i_p_d_r__reliability.html">IPDR reliability mechanism</a>]</small>
</h1><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
</table>
To be more precise, the fail-over and fail-back mechanism is as follows (this description is somewhat specific to IPDR Collector; other implementations are possible but should follow this design in its main points): <ol>
<li>
A record is sent (via <a class="el" href="group___i_p_d_r__data__delivery.html#ga0">IPDR_SendData()</a>) and the 10-second timer is started [10 seconds is the default; it can be changed]. The sent record is saved in a queue on the transmitter (client) in case it is not acknowledged. </li>
<li>
Subsequent records do not change the timer, which continues to count down. These records are also saved in a queue on the transmitter (client). </li>
<li>
The records are received at the collector (server), batched (for efficiency) and enqueued to some persistent queue implementation). </li>
<li>
Every 1 second, a timer on the collector (server) causes an ACK to be sent with the sequence number of the record most recently enqueued. [The timer interval can be changed.] </li>
<li>
When the transmitter (client) receives the ACK, it deletes all saved (queued) records up to this sequence number. If there is at least one saved (enqueued) record on the transmitter, the timer is started again (as in step 1 and processing continues as at step 2. If there are no saved (enqueued) records, the timer is turned off and processing continues as at step 1 <ul>
<li>
This processing happens only the ACK increments the sequence number (that is, if it isn't a "keep-alive" ACK). Otherwise, the ACK is ignored and the timer continues to run. </li>
</ul>
</li>
<li>
If the acknowledgment timer expires, it is assumed that the collector (server) has crashed or become "stuck". This causes the connection to be broken to the primary collector (server). All the saved (queued) records are sent to the secondary collector (server) and the 10-second timer is started. Processing continues as at step 2. </li>
<li>
While sending to the secondary collector (server), if an ACK is received from the primary collector, the connection to the secondary collector is dropped and processing continues as at step 5. </li>
</ol>
<p>
The 1-second interval by the collector (server) in sending acknowledgments is an efficiency consideration to avoid sending an acknowledgment for every record. A record is eligible for acknowledgment only after it has been persisted.<p>
There is a 1 to 10 second time-out for the collector (server) to re-try connecting to the transmitter (client) if the TCP connection is lost. (Initial connection is tried at 1-second intervals and is gradually increased to 10 seconds if there is no response). Again, this value is configurable. <hr size="1"><address style="align: right;"><small>Generated on Mon May 30 15:54:41 2005 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.2 </small></address>
</body>
</html>
