<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>IPDRAPI: org::ipdr::collector::Test Class Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.2 -->
<div class="qindex"><a class="qindex" href="../../index.html">Main&nbsp;Page</a> | <a class="qindex" href="../../modules.html">Modules</a> | <a class="qindex" href="../../namespaces.html">Namespace List</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="../../dirs.html">Directories</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="../../globals.html">Globals</a></div>
<div class="nav">
<a class="el" href="../../db/d96/namespaceorg.html">org</a>::<a class="el" href="../../df/d76/namespaceorg_1_1ipdr.html">ipdr</a>::<a class="el" href="../../d8/d3c/namespaceorg_1_1ipdr_1_1collector.html">collector</a>::<a class="el" href="../../d2/d23/classorg_1_1ipdr_1_1collector_1_1_test.html">Test</a></div>
<h1>org::ipdr::collector::Test Class Reference</h1><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Static Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/d23/classorg_1_1ipdr_1_1collector_1_1_test.html#e0">main</a> (String[] args)</td></tr>

<tr><td colspan="2"><br><h2>Static Private Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/d23/classorg_1_1ipdr_1_1collector_1_1_test.html#h0">help</a> ()</td></tr>

</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
The class provides test implementation of a basic collector 
<p>
<hr><h2>Member Function Documentation</h2>
<a class="anchor" name="h0" doxytag="org::ipdr::collector::Test::help"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static void org::ipdr::collector::Test::help           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [inline, static, private]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00201                               {
00202     System.out.println(<span class="stringliteral">"The syntax of collector command line is as follows:"</span>);
00203     System.out.println(<span class="stringliteral">"Test [[[[[[&lt;debug level ([D]ebug | [I]nfo | [W]arn | [E]rror | [F]atal)&gt;] &lt;collector config file&gt;] &lt;CRANE legacy config file&gt;] &lt;output type&gt;] &lt;output file (CSV) or output prefix(IPDRXML)&gt;] &lt;IPD RXML config file (IPDR XML only)&gt;]"</span>);
00204     System.out.println(<span class="stringliteral">""</span>);
00205     System.out.println(<span class="stringliteral">"The parameters may only be omitted from the end of the command line, in which case the following default values will be used:"</span>);
00206     System.out.println(<span class="stringliteral">"\t debug level: Debug"</span>);
00207     System.out.println(<span class="stringliteral">"\t collector config file:  config.xml"</span>);
00208     System.out.println(<span class="stringliteral">"\t CRANE legacy config file: CRANEConfig.xml"</span>);
00209     System.out.println(<span class="stringliteral">"\t output type:  xml"</span>);
00210     System.out.println(<span class="stringliteral">"\t output file or output prefix: IPDRXMLOutput"</span>);
00211     System.out.println(<span class="stringliteral">"\t IPDR XML config file: IPDR35XMLOutputConfig.xml"</span>);
00212     System.out.println(<span class="stringliteral">""</span>);
00213     System.out.println(<span class="stringliteral">"Example:"</span>);
00214     System.out.println(<span class="stringliteral">"/opt/j2sdk1.4.2_07/bin/java -classpath jdom.jar:ipdrapi.jar:collector.jar:/opt/j2sdk1.4.2_07/jre/lib/rt.jar org.ipdr.collector.Test D config.xml  CRANEConfig.xml xml IPDRXMLOutput IPDR35XMLOutputConfig.xml"</span>);
00215   }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="e0" doxytag="org::ipdr::collector::Test::main"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static void org::ipdr::collector::Test::main           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">String[]&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>args</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [inline, static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This is the main entry point of a simple collector implementation.<p>
The syntax of collector command line is as follows: &lt;xmp&gt;<a class="el" href="../../d2/d23/classorg_1_1ipdr_1_1collector_1_1_test.html">Test</a> &lt;debug level ([D]ebug | [I]nfo | [W]arn | [E]rror | [F]atal)&gt; &lt;collector config="" file=""&gt; &lt;crane legacy="" config="" file=""&gt; &lt;output type=""&gt; &lt;output file (CSV) or output prefix(IPDRXML)&gt;&lt;IPD RXML config file (IPDR XML only)&gt;&lt;/xmp&gt; The parameters may only be omitted from the end of the command line, in which case the following default values will be used: <table border="1" cellspacing="3" cellpadding="3">
<tr>
<th>Parameter</th><th>Default value </th></tr>
<tr>
<td>debug level</td><td>[D]ebug </td></tr>
<tr>
<td>collector config file</td><td>config.xml </td></tr>
<tr>
<td>CRANE legacy config file</td><td>CRANEConfig.xml </td></tr>
<tr>
<td>output type</td><td>xml </td></tr>
<tr>
<td>output file or output prefix</td><td>IPDRXMLOutput </td></tr>
<tr>
<td>IPDR XML config file</td><td>IPDR35XMLOutputConfig.xml </td></tr>
</table>
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>args</em>&nbsp;</td><td></td></tr>
  </table>
</dl>
<div class="fragment"><pre class="fragment">00046                                          {
00047     CollectorLog handler;
00048     CollectorManager cm     = null;
00049     CollectorConfigI config = null;
00050     String fileName         = <span class="stringliteral">"config.xml"</span>;
00051     String craneFileName    = <span class="stringliteral">"CRANEConfig.xml"</span>;
00052     String outputType       = <span class="stringliteral">"xml"</span>;
00053     String outputFileName   = <span class="stringliteral">"output.txt"</span>;
00054     String <a class="code" href="../../d7/def/_for_doxygen_2src_2_simulators_2_i_p_d_rsim_2_i_p_d_rsim_8cpp.html#a13">outputPrefix</a>     = <span class="stringliteral">"IPDRXMLOutput"</span>;
00055     String outputConfigXML  = <span class="stringliteral">"IPDR35XMLOutputConfig.xml"</span>;
00056     <span class="keywordtype">char</span> debugLevel         = <span class="charliteral">'D'</span>;
00057 
00058     <span class="keywordflow">if</span> (args.length &gt; 0) {   <span class="comment">// Get debug level (or help request)</span>
00059       String tmp = args[0].trim();
00060       <span class="keywordflow">if</span> (tmp.equals(<span class="stringliteral">"help"</span>) || tmp.equals(<span class="stringliteral">"-help"</span>)) {
00061         <a class="code" href="../../d2/d23/classorg_1_1ipdr_1_1collector_1_1_test.html#h0">help</a>();
00062         System.exit(0);
00063       }
00064       debugLevel = tmp.charAt(0);
00065     }
00066     <span class="keywordflow">if</span> (args.length &gt; 1)    <span class="comment">// Get the configuration file name</span>
00067       fileName = args[1];
00068     <span class="keywordflow">if</span> (args.length &gt; 2)    <span class="comment">// Get the CRANE configuration file name</span>
00069       craneFileName = args[2];
00070     <span class="keywordflow">if</span> (args.length &gt; 3) {  <span class="comment">// Get the outputter type</span>
00071       outputType = args[3];
00072       <span class="keywordflow">if</span> (!outputType.equals(<span class="stringliteral">"csv"</span>) &amp;&amp; !outputType.equals(<span class="stringliteral">"xml"</span>) &amp;&amp; !outputType.equals(<span class="stringliteral">"xml"</span>) &amp;&amp; !outputType.equals(<span class="stringliteral">"null"</span>)) {
00073         System.err.print(
00074             <span class="stringliteral">"The fourth parameter (output type) has to be csv or xml or null"</span>);
00075         <a class="code" href="../../d2/d23/classorg_1_1ipdr_1_1collector_1_1_test.html#h0">help</a>();
00076         System.exit(0);
00077       }
00078     }
00079     <span class="keywordflow">if</span> (args.length &gt; 4) {  <span class="comment">// According to the outputter's type interpret the next parameter</span>
00080       <span class="keywordflow">if</span> (outputType.equals(<span class="stringliteral">"csv"</span>)) {
00081         outputFileName = args[4];
00082       }
00083       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (outputType.equals(<span class="stringliteral">"xml"</span>)) {
00084         outputPrefix = args[4];
00085       }
00086     }
00087     <span class="keywordflow">if</span> (args.length &gt; 5) {  <span class="comment">// Get the IPDR XML configuration file name</span>
00088       outputConfigXML = args[5];
00089     }
00090 <span class="comment">//</span>
00091 <span class="comment">// Instantiate the Collector Configuration from XML file</span>
00092 <span class="comment">//</span>
00093     <span class="keywordflow">try</span> {
00094       config = <span class="keyword">new</span> CollectorConfigXml(fileName);
00095     }
00096     <span class="keywordflow">catch</span> (UnknownHostException e3) {
00097       e3.printStackTrace();
00098       <span class="keywordflow">return</span>;
00099     }
00100     <span class="keywordflow">catch</span> (DataConversionException e3) {
00101       e3.printStackTrace();
00102       <span class="keywordflow">return</span>;
00103     }
00104     <span class="keywordflow">catch</span> (ConfigException e3) {
00105       e3.printStackTrace();
00106       <span class="keywordflow">return</span>;
00107     }
00108     <span class="keywordflow">catch</span> (JDOMException e3) {
00109       e3.printStackTrace();
00110       <span class="keywordflow">return</span>;
00111     }
00112 <span class="comment">//</span>
00113 <span class="comment">// Instantiate the proper outputter</span>
00114 <span class="comment">//</span>
00115     <span class="keywordflow">try</span> {
00116       <span class="keywordflow">if</span> (outputType.equals(<span class="stringliteral">"csv"</span>)) {
00117 
00118         PrintStream ps = <span class="keyword">new</span> PrintStream(<span class="keyword">new</span> FileOutputStream(outputFileName, <span class="keyword">false</span>));
00119         cm = <span class="keyword">new</span> CollectorManager(config, <span class="keyword">new</span> CsvOutputterFactory(ps, <span class="stringliteral">","</span>),
00120                                   <span class="keyword">new</span> SimpleTemplateNegotiatorFactory(), <span class="keyword">new</span> SimpleStateMachineListener(), null);
00121       }
00122       <span class="keywordflow">else</span> <span class="keywordflow">if</span>(outputType.equals(<span class="stringliteral">"xml"</span>)) {
00123         StateMachineListenerManager stateMachineListenersManager = <span class="keyword">new</span> StateMachineListenerManager();
00124         cm = <span class="keyword">new</span> CollectorManager( config, <span class="keyword">new</span> IPDR35XMLOutputterFactory(outputConfigXML, outputPrefix,stateMachineListenersManager) ,
00125                                    <span class="keyword">new</span>  SimpleTemplateNegotiatorFactory(), stateMachineListenersManager, null);
00126 
00127 
00128       }
00129       <span class="keywordflow">else</span> <span class="keywordflow">if</span>(outputType.equals(<span class="stringliteral">"null"</span>))
00130       {
00131         cm = <span class="keyword">new</span> CollectorManager( config, <span class="keyword">new</span> NullOutputterFactory() ,
00132                                    <span class="keyword">new</span>  SimpleTemplateNegotiatorFactory(<span class="comment">/*templatesFileName*/</span>), <span class="keyword">new</span> SimpleStateMachineListener(), null);
00133 
00134       }
00135     }
00136     <span class="keywordflow">catch</span> (FileNotFoundException e1) {
00137       e1.printStackTrace();
00138       <span class="keywordflow">return</span>;
00139     }
00140 <span class="comment">//</span>
00141 <span class="comment">// Instantiate the Collector</span>
00142 <span class="comment">//</span>
00143     <span class="keywordflow">try</span> {
00144       handler = <span class="keyword">new</span> CollectorLog(<span class="stringliteral">"IPDR"</span>);
00145       <span class="comment">//</span>
00146       <span class="comment">// Set debug level</span>
00147       <span class="comment">//</span>
00148       <span class="keywordflow">if</span> (args.length &gt; 0) {  <span class="comment">// Get the CRANE configuration file name</span>
00149         <span class="keywordflow">if</span> ( (debugLevel == <span class="charliteral">'D'</span>) || (debugLevel == <span class="charliteral">'d'</span>)) {
00150           handler.setDebug();
00151         }
00152         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( (debugLevel == <span class="charliteral">'I'</span>) || (debugLevel == <span class="charliteral">'i'</span>)) {
00153           handler.setInfo();
00154         }
00155         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( (debugLevel == <span class="charliteral">'W'</span>) || (debugLevel == <span class="charliteral">'w'</span>)) {
00156           handler.setWarn();
00157         }
00158         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( (debugLevel == <span class="charliteral">'E'</span>) || (debugLevel == <span class="charliteral">'e'</span>)) {
00159           handler.setError();
00160         }
00161         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( (debugLevel == <span class="charliteral">'F'</span>) || (debugLevel == <span class="charliteral">'f'</span>)) {
00162           handler.setFatal();
00163         }
00164         <span class="keywordflow">else</span> {
00165           System.err.println(<span class="stringliteral">"incorrect debug level"</span>);
00166           <a class="code" href="../../d2/d23/classorg_1_1ipdr_1_1collector_1_1_test.html#h0">help</a>();
00167           System.exit(0);
00168         }
00169       }
00170       <span class="keywordflow">else</span> {
00171         handler.setDebug();
00172       }
00173       <span class="comment">//</span>
00174       <span class="comment">// Run Collector</span>
00175       <span class="comment">//</span>
00176       LogManager.registerLogHandler(handler);
00177       cm.run();
00178       CRANELegacyThread legacyThread = null;
00179       <span class="keywordflow">if</span> (config.getSupportCRANE()) { <span class="comment">// If support CRANE (IPDR/SP 1.0)</span>
00180         String[] fakeArguments = {
00181             craneFileName, <span class="stringliteral">"100000"</span>, <span class="stringliteral">"csv"</span>};
00182         legacyThread = <span class="keyword">new</span> CRANELegacyThread(fakeArguments);
00183         legacyThread.start();
00184       }
00185 
00186       System.in.read();
00187       <span class="keywordflow">if</span> (legacyThread != null)
00188         legacyThread.interrupt();
00189     }
00190     <span class="keywordflow">catch</span> (Exception ex) {
00191       LogManager.stackTrace(ex);
00192     }
00193     finally {
00194       <span class="keywordflow">try</span> {
00195         cm.disconnectAll();
00196         cm.joinAll();
00197       }
00198       <span class="keywordflow">catch</span> (InterruptedException e) {}
00199     }
00200   }
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr>The documentation for this class was generated from the following file:<ul>
<li>ipdr/Collector/org/ipdr/collector/<a class="el" href="../../d1/dcf/org_2ipdr_2collector_2_test_8java.html">Test.java</a></ul>
<hr size="1"><address style="align: right;"><small>Generated on Mon Apr 25 09:26:58 2005 for IPDRAPI by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.2 </small></address>
</body>
</html>
